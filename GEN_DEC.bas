Attribute VB_Name = "GENERAL_MODULE"
Option Explicit
Public Const BINDF_GETNEWESTVERSION As Long = &H10

Public Const ERROR_SUCCESS As Long = 0
Private Const INTERNET_FLAG_RELOAD As Long = &H80000000
Public Declare Function URLDownloadToFile Lib "urlmon" Alias "URLDownloadToFileA" (ByVal pCaller As Long, ByVal szURL As String, ByVal szFileName As String, ByVal dwReserved As Long, ByVal lpfnCB As Long) As Long
Public Declare Function DeleteUrlCacheEntry Lib "wininet.dll" Alias "DeleteUrlCacheEntryA" (ByVal lpszUrlName As String) As Long
Public Declare Function ShellExecute Lib "shell32.dll" Alias "ShellExecuteA" (ByVal hwnd As Long, ByVal lpOperation As String, ByVal lpFile As String, ByVal lpParameters As String, ByVal lpDirectory As String, ByVal nShowCmd As Long) As Long

Public Declare Function InternetGetConnectedState Lib "wininet" (ByRef dwFlags As Long, ByVal dwReserved As Long) As Long
Public Declare Function Beep Lib "kernel32" (ByVal dwFreq As Long, ByVal dwDuration As Long) As Long
Public Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Public RDCREPO As CRAXDRT.Report

Public Const MAX_PATH = 260
Public Const NO_ERROR = 0
Public Const FILE_ATTRIBUTE_READONLY = &H1
Public Const FILE_ATTRIBUTE_HIDDEN = &H2
Public Const FILE_ATTRIBUTE_SYSTEM = &H4
Public Const FILE_ATTRIBUTE_DIRECTORY = &H10
Public Const FILE_ATTRIBUTE_ARCHIVE = &H20
Public Const FILE_ATTRIBUTE_NORMAL = &H80
Public Const FILE_ATTRIBUTE_TEMPORARY = &H100
Public Const FILE_ATTRIBUTE_COMPRESSED = &H800
Public Const FILE_ATTRIBUTE_OFFLINE = &H1000
Public Const INTERNET_FLAG_PASSIVE = &H8000000
Public Const FORMAT_MESSAGE_FROM_HMODULE = &H800

Type WIN32_FIND_DATA
        dwFileAttributes As Long
        ftCreationTime As Currency
        ftLastAccessTime As Currency
        ftLastWriteTime As Currency
        nFileSizeHigh As Long
        nFileSizeLow As Long
        dwReserved0 As Long
        dwReserved1 As Long
        cFileName As String * MAX_PATH
        cAlternate As String * 14
End Type
Public Const ERROR_NO_MORE_FILES = 18
Public Declare Function InternetFindNextFile Lib "wininet.dll" Alias "InternetFindNextFileA" _
    (ByVal hFind As Long, lpvFindData As WIN32_FIND_DATA) As Long
   
Public Declare Function FtpFindFirstFile Lib "wininet.dll" Alias "FtpFindFirstFileA" _
(ByVal hFtpSession As Long, ByVal lpszSearchFile As String, _
      lpFindFileData As WIN32_FIND_DATA, ByVal dwFlags As Long, ByVal dwContent As Long) As Long
Declare Function FileTimeToLocalFileTime Lib "kernel32" (lpFileTime As Any, lpLocalFileTime As Any) As Long
Public Const INTERNET_OPEN_TYPE_PRECONFIG = 0
Public Const INTERNET_INVALID_PORT_NUMBER = 0
Public Const INTERNET_SERVICE_FTP = 1
Public Const FTP_TRANSFER_TYPE_BINARY = &H2
Public Const FTP_TRANSFER_TYPE_ASCII = &H1

Public Declare Function FtpSetCurrentDirectory Lib "wininet.dll" Alias "FtpSetCurrentDirectoryA" _
    (ByVal hFtpSession As Long, ByVal lpszDirectory As String) As Boolean

Public Declare Function FtpGetCurrentDirectory Lib "wininet.dll" Alias "FtpGetCurrentDirectoryA" _
   (ByVal hFtpSession As Long, ByVal lpszCurrentDirectory As String, lpdwCurrentDirectory As Long) As Boolean
   
Public Declare Function InternetWriteFile Lib "wininet.dll" _
(ByVal hFile As Long, ByRef sBuffer As Byte, ByVal lNumBytesToWite As Long, _
dwNumberOfBytesWritten As Long) As Integer

Public Declare Function FtpOpenFile Lib "wininet.dll" Alias "FtpOpenFileA" _
(ByVal hFtpSession As Long, ByVal sBuff As String, ByVal Access As Long, ByVal Flags As Long, ByVal Context As Long) As Long

Public Declare Function FtpPutFile Lib "wininet.dll" Alias "FtpPutFileA" _
(ByVal hFtpSession As Long, ByVal lpszLocalFile As String, _
      ByVal lpszRemoteFile As String, _
      ByVal dwFlags As Long, ByVal dwContext As Long) As Boolean
Public Declare Function FtpDeleteFile Lib "wininet.dll" _
    Alias "FtpDeleteFileA" (ByVal hFtpSession As Long, _
    ByVal lpszFileName As String) As Boolean
Public Declare Function InternetCloseHandle Lib "wininet.dll" _
(ByVal hInet As Long) As Long

Public Declare Function InternetOpen Lib "wininet.dll" Alias "InternetOpenA" _
(ByVal sAgent As String, ByVal lAccessType As Long, ByVal sProxyName As String, _
ByVal sProxyBypass As String, ByVal lFlags As Long) As Long

Public Declare Function InternetConnect Lib "wininet.dll" Alias "InternetConnectA" _
(ByVal hInternetSession As Long, ByVal sServerName As String, ByVal nServerPort As Integer, _
ByVal sUsername As String, ByVal sPassword As String, ByVal lService As Long, _
ByVal lFlags As Long, ByVal lContext As Long) As Long


Public Declare Function FtpGetFile Lib "wininet.dll" Alias "FtpGetFileA" _
(ByVal hFtpSession As Long, ByVal lpszRemoteFile As String, _
      ByVal lpszNewFile As String, ByVal fFailIfExists As Boolean, ByVal dwFlagsAndAttributes As Long, _
      ByVal dwFlags As Long, ByVal dwContext As Long) As Boolean


Const rDayZeroBias As Double = 109205#   ' Abs(CDbl(#01-01-1601#))
Const rMillisecondPerDay As Double = 10000000# * 60# * 60# * 24# / 10000#

Declare Function InternetGetLastResponseInfo Lib "wininet.dll" _
      Alias "InternetGetLastResponseInfoA" _
       (ByRef lpdwError As Long, _
       ByVal lpszErrorBuffer As String, _
       ByRef lpdwErrorBufferLength As Long) As Boolean
       
Declare Function FormatMessage Lib "kernel32" Alias "FormatMessageA" _
(ByVal dwFlags As Long, ByVal lpSource As Long, ByVal dwMessageId As Long, _
 ByVal dwLanguageId As Long, ByVal lpBuffer As String, ByVal nSize As Long, _
 Arguments As Long) As Long

Declare Function GetModuleHandle Lib "kernel32" Alias "GetModuleHandleA" (ByVal lpLibFileName As String) As Long
Global RDCAPP As New CRAXDRT.Application
'Company Details
Public GCompCode As Integer:        Public GCompanyName As String:      Public GCompanyAdd1 As String:  Public GCompanyAdd2 As String:   Public GCCity As String
Public GPIN As String:              Public GState As String:            Public GCompPhoneO As String:   Public GCompPhoneR As String:    Public GCompMobile As String
Public GFax As String:              Public GEmail As String:            Public GFinBegin As Date:       Public GFinEnd As Date:          Public GCINNo As String
Public GAutoBrok As Boolean:        Public GReportPath As String:       Public GAcCodeType As String:   Public GQty_Decimal  As Boolean: Public GSrvRegNo As String::
Public GBrokType As String:         Public GDailyBill  As Boolean:      Public GCtrType As String:     Public GRoundOff As String:      Public GBackPath As String:
Public GSrStdYN As String:          Public GSetInvNo As String:         Public GAmtDivide As String:    Public GAppSpread As String:     Public GBrBrok As String
Public FTPerr As String
Public GAppCnote As String:         Public GCompTitle As String:        Public GValueWiseYN As String:  Public GFutCutBrok As String:
Public GCheckRt As String:          Public GShowLot As String: Public GShowLotEntry As String:
Public GMinBrok  As String:         Public GSrvTaxYN  As String:        Public GTranFeesYN  As String:  Public GStampDutyYN As String:  Public GOptCutBrok As String:
Public GSTTYN  As String:           Public GSubBrokYN  As String:       Public GMinBrokYN As String:    Public GMarginYN As String: Public GOrderEntryYN  As String: Public GVoucherFormat As String
Public GStandingYN As String:       Public GAcOrder As String:          Public GGenQuery As String:     Public GRegNo As String:        Public GFinYear As String
Public GOnlyBrok As Integer:        Public GFlag_Fin As Boolean:        Public GEqBill As Boolean:       Public AddPerm As Boolean
Public ModiPerm As Boolean:         Public DelPerm As Boolean:          Public FLAG_QRYACC  As Boolean: Public PrintPerm As Boolean:    Public LogOffBool As Boolean
Public GPANNo As String:            Public GHDNO As String: Public LHDNo As String
Public gcurrtype As Integer:        Public Gintt1 As String:
Public Ginttype As String:          Public Gautoupdlot As String: Public GEXECODE As String:


Public GBillParties As String:      Public GExIDs As String:            Public GMinBillDate As Date

Public FlagDownloadedFromOurFTP As Boolean: Public FlagMaturity As Boolean:    Public InvGen As Boolean:           Public CNNERR As Boolean:           Public MNarr As Boolean:        Public Registered As Boolean
Public Flag_Pitbrok As Boolean:     Public FlagVerAdj As Boolean::      Public FlagIntigrity As Boolean:    Public LSDInstType As String:   Public GSGSTType As String
Public GCGSTType As String:         Public FlagBrok As Boolean:         Public GUTTType As String:          Public GIGSTType As String:     Public GSrTaxApp As String
Public GCTTType As String:          Public GScGroup As String:          Public MFinBeg As String:           Public GRiskMType As String:    Public GShowStd As String
Public MFinEnd As String:           Public GRiskMapp As String:         Public LBillCloseQty As Double:
Public LTimeCount As Double:        Public FlagStored As Boolean:       Public ViewPerm As Boolean:         Public GShree As String:
Dim GFBroktype As String:           Public GlobalVClientStatus As String

'All Exchange Account
Public GRiskMAcc As String:         Public GSEBITaxAcc As String:       Public GSTDAc As String:            Public GRoundAcc As String:     Public GSTaxAcc As String
Public GCTTAcc As String:           Public GNBOTBank As String:         Public GTrading As String:          Public GBrokrage As String:     Public GTrFeesAc As String
Public GCGSTAcc As String:          Public GSGSTAcc As String:          Public GIGSTAcc As String:          Public GUTTAcc As String:       Public GStampAcc As String

'All Company Details
Public GUniqClientId As String:     Public GCalVal As Double:           Public GGSTIN As String:            Public GSEBIRegNo As String:    Public MAdd1 As String
Public GDatabaseName As String:     Public mysql As String:             Public GSBCAcc As String:           Public Cnn As ADODB.Connection
Public CompCnn As ADODB.Connection
Public SW As String:                Public MFormat As String:           Public MServer As String:           Public GUserName As String:     Public ServerString As String
Public GBrokLot As Double:          Public LSDSTrike As Double:         Public GTradeableLot As Double:     Public GSrvDate As Date:        Public LBmaturity As Date
Public GSTMDate As Date:            Public GSysLockDt As Date:          Public GTillDate As Date:           Public GStSrvDate As Date:      Public GRptViewType As String
Public GMaxVouNo As Long:           Public GMaxBVouNo As Long:          Public GMaxSVouNo As Long:          Public GConNoType As Integer:   Public MCnn As ADODB.Connection
Public RepoApp As Object:           Public ADOUser As ADODB.Recordset:  Public SelComp_Ado As ADODB.Recordset:                              Public Jcnn As ADODB.Connection
Public LSDOptType As String:        Public GSrvDate2 As Date:
Public GMBillNo As Long
Public BkpDevPath As String
Public GLOBALFLAG As Boolean
Public FlagLoggedIn As Boolean
Public GEXCODE As String
Public GlobalAccRecSet As ADODB.Recordset
Public GlobalPartyRec As ADODB.Recordset
Public GlobalRecRpt As ADODB.Recordset
Public FlagDataImport As String
Public FlagDataBackup As String
Public FlagLiveRate As String
Public FlagBillSummary As Boolean
Public Flagorder As Boolean
Public VAdminPass As String
Public IP_ANGEL As String
Public IP_ZERODHA As String
Public IP_closing_rate As String

Declare Function GetSystemDirectory Lib "kernel32" Alias "GetSystemDirectoryA" (ByVal lpBuffer As String, ByVal nSize As Long) As Long
Declare Function GetWindowsDirectory Lib "kernel32" Alias "GetWindowsDirectoryA" (ByVal lpBuffer As String, ByVal nSize As Long) As Long

 '>>>file download testing purpose
Private Declare Function InternetSetOptionA Lib "wininet.dll" (ByVal hInternet As Long, ByVal dwOption As Long, ByVal lpBuffer As Any, ByVal dwBufferLength As Long) As Long
Private Declare Function InternetOpenUrlA Lib "wininet.dll" (ByVal hInternet As Long, ByVal lpszUrl As String, ByVal lpszHeaders As String, ByVal dwHeadersLength As Long, ByVal dwFlags As Long, ByVal dwContext As Long) As Long
Private Declare Function InternetReadFile Lib "wininet.dll" (ByVal hFile As Long, ByVal lpBuffer As String, ByVal dwNumberOfBytesToRead As Long, lpNumberOfBytesRead As Long) As Integer
Private Const INTERNET_OPTION_USERNAME As Long = 28
Private Const INTERNET_OPTION_PASSWORD As Long = 29
Public Const INTERNET_OPEN_TYPE_DIRECT = 0

Public Function DownloadFileFromHTTPS(ByVal url As String, ByVal filePath As String, ByVal USERNAME As String, ByVal PASSWORD As String) As Boolean
'>>>file download testing purpose
    Dim hInternetSession As Long
    Dim hUrl As Long
    Dim buffer As String * 4096 ' Buffer to read the file in chunks
    Dim bytesRead As Long
    Dim fileHandle As Integer
    Dim result As Boolean
    
    ' Open Internet session
    hInternetSession = InternetOpen("VB6", INTERNET_OPEN_TYPE_DIRECT, vbNullString, vbNullString, 0)
    If hInternetSession = 0 Then
        MsgBox "Failed to open Internet session."
        Exit Function
    End If
    
    ' Set username and password
    InternetSetOptionA hInternetSession, INTERNET_OPTION_USERNAME, StrPtr(USERNAME), Len(USERNAME)
    InternetSetOptionA hInternetSession, INTERNET_OPTION_PASSWORD, StrPtr(PASSWORD), Len(PASSWORD)
    
    ' Open URL
    'hUrl = InternetOpenUrlA(hInternetSession, url, vbNullString, 0, INTERNET_FLAG_RELOAD Or INTERNET_FLAG_PRAGMA_NOCACHE, 0)
    hUrl = InternetOpenUrlA(hInternetSession, url, vbNullString, 0, INTERNET_FLAG_RELOAD, 0)
        
    If hUrl = 0 Then
        MsgBox "Failed to open URL."
        InternetCloseHandle hInternetSession
        Exit Function
    End If
    
    ' Open file to save the downloaded data
    fileHandle = FreeFile
    Open filePath For Binary Access Write As fileHandle
    
    ' Read and write data in chunks
    Do
        InternetReadFile hUrl, buffer, Len(buffer), bytesRead
        If bytesRead > 0 Then
            Put #fileHandle, , Left$(buffer, bytesRead)
        End If
    Loop While bytesRead > 0
    
    ' Close file
    Close fileHandle
    
    ' Close URL and Internet session
    InternetCloseHandle hUrl
    InternetCloseHandle hInternetSession
    
    DownloadFileFromHTTPS = True ' Download successful
End Function



Sub Main()

On Error GoTo err1

    Dim A As Integer:    Dim B As Integer:    Dim C As Integer
    GFlag_Fin = False:    GEqBill = False
    GSrvDate = DateValue("2008/01/01")
    GSrvDate2 = DateValue("2022/07/18")  'GST ON BROK+TRANSACTION FEES +SEBI TAX
    CNNERR = False
    If ((Mid(Date, 3, 1) = "/") And (Mid(Date, 6, 1) = "/")) And (Val(Len(Date)) = 10) Then
    Else
        MsgBox "Invalid date format.Date format must be (DD/MM/YYYY).", vbCritical
        Exit Sub
    End If
    
    SW = "SBOT": Set RepoApp = Nothing: Set RepoApp = CreateObject("CRYSTAL.CRPE.APPLICATION")
    Open App.Path & "\WINSQL32.INI" For Input As #1
        Line Input #1, MServer
    Close #1
    
    ServerString = MServer
    A = Len(MServer)
    B = Len(Left$(MServer, (InStr(1, MServer, "database") + 8)))
    C = A - B
    GDatabaseName = Right$(ServerString, C)
    If Mid(MServer, 1, 1) = "d" Then
    Else
        MServer = Mid(MServer, 2, Len(MServer) - 2)
    End If

    Set Cnn = Nothing: Set Cnn = New ADODB.Connection: Cnn.ConnectionString = MServer
    Cnn.Mode = adModeShareExclusive: Cnn.IsolationLevel = adXactIsolated: Cnn.CursorLocation = adUseClient
    Cnn.Open
    Cnn.CommandTimeout = 300
        
    VAdminPass = "8000"
   
    IP_ANGEL = "103.186.184.40"  '89.35.28.70

    IP_ZERODHA = "103.186.184.40"  '89.35.28.70

    IP_closing_rate = "43.231.249.58" '103.186.184.40
    
    
err1: If err.Number = 53 Then
        serverfrm.Show
    Else
        loginfrm.Show
    End If
End Sub
Function SDOpQty(ByVal LTPartyCode As String, ByVal LTSaudaID As Long, ByVal LTUptoDate As Date) As Double
    'Funtion to Get Opening Standing
    Dim TRec As ADODB.Command
    Dim MOpQty As Double
    
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
    TRec.CommandText = "SPOp_Qty"
    TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("PARTY", adVarChar, adParamInput, 15, LTPartyCode)
    TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LTSaudaID)
    TRec.Parameters.Append TRec.CreateParameter("UPTODATE", adDBTimeStamp, adParamInput, , Format(LTUptoDate, "YYYY/MM/DD"))
    TRec.Parameters.Append TRec.CreateParameter("NETQTY", adDouble, adParamOutput, , MOpQty)
    TRec.Execute
    MOpQty = TRec("NETQTY")
    SDOpQty = MOpQty
    Set TRec = Nothing
End Function
Public Function SDCLRATE(ByVal LCSaudaID As Long, ByVal LCDate As Date, ByVal LCType As String, Optional LCompCnn As String) As Double
    'Function to Get Close Rate
    Dim TRec As ADODB.Command:  Dim LCloseRate As Double:
    
    Set TRec = Nothing: Set TRec = New ADODB.Command
    
    If Len(LCompCnn) = 0 Then
        Set TRec.ActiveConnection = Cnn
    Else
        Set TRec.ActiveConnection = CompCnn
    End If
    
    TRec.CommandType = adCmdStoredProc
    TRec.CommandText = "GET_CLOSINGRATE"
    TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("LCONDATE", adDBTimeStamp, adParamInput, , Format(LCDate, "YYYY/MM/DD"))
    TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LCSaudaID)
    TRec.Parameters.Append TRec.CreateParameter("LOTYPE", adVarChar, adParamInput, 1, LCType)
    TRec.Parameters.Append TRec.CreateParameter("LRATE", adDouble, adParamOutput, , LCloseRate)
    TRec.Execute
    
    LCloseRate = TRec("LRATE")
    SDCLRATE = LCloseRate
End Function
Public Sub Add_To_Ctr_D(ByVal LPPtyContype As String, ByVal LPClient As String, ByVal LPConsno As Long, ByVal LPCondate As Date, ByVal LPCount As Long, _
 ByVal LPSauda As String, ByVal LPItemCode As String, ByVal LPBParty As String, ByVal LPQty As Double, ByVal LPRATE As Double, ByVal LPSParty As String, ByVal LPContime As String, _
 ByVal LPOrdNo As String, ByVal LPUserId As String, ByVal LPOConNo As String, ByVal LPExCode As String, ByVal LPLot As Double, ByVal LPDataImport As Byte, ByVal LPOrdTime As String, ByVal LPInstType As String, _
 ByVal LPOptType As String, ByVal LPStrike As Double, ByVal LPFileType As String, ByVal LBrokFlag As String, LPEXID As Integer, lpitemid As Integer, LPSaudaID As Long)
If LPCondate <= GSysLockDt Then
    MsgBox "Can Not Insert Any Trade Before Settlement Lock Date" & GSysLockDt & ""
    Exit Sub
End If
    If LPPtyContype = "B" Then
    mysql = "EXEC INSERT_CTR_D " & GCompCode & ",'" & LPClient & "','" & LPClient & "'," & Val(LPConsno) & ",'" & Format(LPCondate, "YYYY/MM/DD") & "'," & Val(LPCount) & ",'" & LPSauda & "'"
    mysql = mysql & " ,'" & LPItemCode & "','" & LPBParty & "'," & Val(LPQty) & "," & Val(LPRATE) & ",'N','" & LPSParty & "'," & Val(LPQty) & "," & Val(LPRATE) & "," & Val(LPDataImport) & ","
    mysql = mysql & " '" & LPContime & "','" & LPUserId & " " & "','" & LPOrdNo & "','" & LPOConNo & "','" & LPExCode & "','C','" & LPSParty & "'," & LPLot & ",0,0,'" & LPOrdTime & "',"
    mysql = mysql & " '" & LPInstType & "','" & LPOptType & "'," & LPStrike & ",'" & LPFileType & "','" & LBrokFlag & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & GOnlyBrok & ""
    Cnn.Execute mysql
Else
    mysql = "EXEC INSERT_CTR_D " & GCompCode & ",'" & LPClient & "','" & LPClient & "'," & Val(LPConsno) & ",'" & Format(LPCondate, "YYYY/MM/DD") & "'," & Val(LPCount) & ",'" & LPSauda & "',"
    mysql = mysql & " '" & LPItemCode & "','" & LPSParty & "'," & Val(LPQty) & "," & Val(LPRATE) & ",'N','" & LPBParty & "'," & Val(LPQty) & "," & Val(LPRATE) & "," & Val(LPDataImport) & ","
    mysql = mysql & " '" & LPContime & "','" & LPUserId & " " & "','" & LPOrdNo & "','" & LPOConNo & "','" & LPExCode & "','C','" & LPSParty & "'," & LPLot & ",0,0,'" & LPOrdTime & "',"
    mysql = mysql & " '" & LPInstType & "','" & LPOptType & "'," & LPStrike & ",'" & LPFileType & "','" & LBrokFlag & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & GOnlyBrok & ""
    Cnn.Execute mysql
End If
End Sub

Public Sub Add_To_Ctr_D2(ByVal LPPtyContype As String, ByVal LPClient As String, ByVal LPConsno As Long, ByVal LPCondate As Date, ByVal LPCount As Long, ByVal LPSauda As String, ByVal LPItemCode As String, ByVal LPBParty As String, ByVal LPQty As Double, ByVal LPRATE As Double, ByVal LPSRate As Double, ByVal LPSParty As String, ByVal LPContime As String, ByVal LPOrdNo As String, ByVal LPUserId As String, ByVal LPOConNo As String, ByVal LPExCode As String, ByVal LPLot As Double, ByVal LPDataImport As Byte, ByVal LPOrdTime As String, ByVal LPInstType As String, ByVal LPOptType As String, ByVal LPStrike As Double, ByVal LPFileType As String, ByVal LBrokFlag As String, ByVal LPEXID As Integer, ByVal lpitemid As Integer, ByVal LPSaudaID As Long)

'    If InStr(1, LPOConNo, " ") > 0 Then
'        LPOConNo = Left(LPOConNo, InStr(1, LPOConNo, " ") - 1) + Right(LPOConNo, Len(LPOConNo) - InStr(1, LPOConNo, " ") + 1)
'    End If
    
    If LPCondate <= GSysLockDt Then
        MsgBox "Can Not Insert Any Trade Before Settlement Lodate Date" & GSysLockDt & ""
        Exit Sub
    End If

    If LPPtyContype = "B" Then
         mysql = "EXEC INSERT_CTR_D " & GCompCode & ",'" & LPClient & "','" & LPClient & "'," & Val(LPConsno) & ",'" & Format(LPCondate, "YYYY/MM/DD") & "'," & Val(LPCount) & ",'" & LPSauda & "','" & LPItemCode & "','" & LPBParty & "'," & Val(LPQty) & "," & Val(LPRATE) & ",'N','" & LPSParty & "'," & Val(LPQty) & "," & Val(LPSRate) & "," & Val(LPDataImport) & ",'" & LPContime & "','" & LPUserId & " " & "','" & LPOrdNo & "','" & LPOConNo & "','" & LPExCode & "','C','" & LPSParty & "'," & LPLot & ",0,0,'" & LPOrdTime & "','" & LPInstType & "','" & LPOptType & "'," & LPStrike & ",'" & LPFileType & "','" & LBrokFlag & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & LPSaudaID & ""
        Cnn.Execute mysql
    Else
        mysql = "EXEC INSERT_CTR_D " & GCompCode & ",'" & LPClient & "','" & LPClient & "'," & Val(LPConsno) & ",'" & Format(LPCondate, "YYYY/MM/DD") & "'," & Val(LPCount) & ",'" & LPSauda & "','" & LPItemCode & "','" & LPSParty & "'," & Val(LPQty) & "," & Val(LPSRate) & ",'N','" & LPBParty & "'," & Val(LPQty) & "," & Val(LPRATE) & "," & Val(LPDataImport) & ",'" & LPContime & "','" & LPUserId & " " & "','" & LPOrdNo & "','" & LPOConNo & "','" & LPExCode & "','C','" & LPSParty & "'," & LPLot & ",0,0,'" & LPOrdTime & "','" & LPInstType & "','" & LPOptType & "'," & LPStrike & ",'" & LPFileType & "','" & LBrokFlag & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & GOnlyBrok & ""
        Cnn.Execute mysql
    End If
End Sub
Public Sub Add_To_ORD_M_D(ByVal LPPtyContype As String, ByVal LPClient As String, ByVal LPConsno As Long, ByVal LPCondate As Date, ByVal LPCount As Long, ByVal LPSauda As String, ByVal LPItemCode As String, ByVal LPBParty As String, ByVal LPQty As Double, ByVal LPRATE As Double, ByVal LPSRate As Double, ByVal LPSParty As String, ByVal LPContime As String, ByVal LPOrdNo As String, ByVal LPUserId As String, ByVal LPOConNo As String, ByVal LPExCode As String, ByVal LPLot As Double, ByVal LPDataImport As Byte, ByVal LPOrdTime As String, ByVal LPInstType As String, ByVal LPOptType As String, ByVal LPStrike As Double, ByVal LPFileType As String, ByVal LBrokFlag As String, ByVal LPEXID As Integer, ByVal lpitemid As Integer, ByVal LPSaudaID As Long)
   
    If LPCondate <= GSysLockDt Then
        MsgBox "Can Not Insert Any Order Before Settlement Lock Date" & GSysLockDt & ""
        Exit Sub
    End If
    mysql = "EXEC INSERT_ORD_M_D " & GCompCode & ",'" & LPPtyContype & "','" & LPClient & "'," & Val(LPConsno) & ",'" & Format(LPCondate, "YYYY/MM/DD") & "'," & Val(LPCount) & ",'" & LPSauda & "','" & LPItemCode & "','" & LPBParty & "'," & Val(LPQty) & "," & Val(LPRATE) & ",'N','" & LPSParty & "'," & Val(LPQty) & "," & Val(LPSRate) & "," & Val(LPDataImport) & ",'" & LPContime & "','" & LPUserId & " " & "','" & LPOrdNo & "','" & LPOConNo & "','" & LPExCode & "','C','" & LPSParty & "'," & LPLot & ",0,0,'" & LPOrdTime & "','" & LPInstType & "','" & LPOptType & "'," & LPStrike & ",'" & LPFileType & "','" & LBrokFlag & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & GOnlyBrok & ""
    Cnn.Execute mysql
End Sub

Public Function Calc_RiskMFees(ByVal LRSaudaCode As String, ByVal LRExCode As String, ByVal LRParty As String, ByVal LRFromDate As Date, ByVal LRToDate As Date, ByVal LRMaturityDate As Date, _
ByVal LRCalVal As Double, ByVal LRItemID As Integer, LRSaudaID As Long, ByVal LRAccID As Long) As Double

Dim LRiskMAmt As Double:    Dim DateRec As ADODB.Recordset:     Dim EXRate As ADODB.Recordset
Dim LRiskMRate As Double:   Dim LPattan As String:              Dim LOpen As Double:            Dim LPOpen As Double:
Dim LNetOpen As Double:     Dim LRiskMDate As Date:             Dim LMdate  As Date
Dim LExID As Integer
LExID = Get_ExID(LRExCode)
LRiskMRate = 0
LRiskMDate = DateValue("15/10/2014")
LRiskMAmt = 0: LOpen = 0: LPOpen = 0: LNetOpen = 0
If LRFromDate > LRiskMDate Then
    LMdate = LRFromDate - 1
Else
    LMdate = LRiskMDate
End If
LPOpen = Get_CloseQty(LRAccID, LRSaudaID, LMdate)
mysql = "SELECT DISTINCT A.CONDATE,B.PATTAN,A.CLOSERATE FROM CTR_R AS A, CTR_M AS B WHERE  "
mysql = mysql & " A.CONDATE = B.CONDATE  AND A.CONDATE >='" & Format(LRFromDate, "YYYY/MM/DD") & "' AND A.SAUDAID=" & LRSaudaID & ""
mysql = mysql & " AND A.CONDATE <='" & Format(LRToDate, "YYYY/MM/DD") & "' AND A.CONDATE <='" & Format(LRMaturityDate, "YYYY/MM/DD") & "' ORDER BY A.CONDATE"
Set DateRec = Nothing: Set DateRec = New ADODB.Recordset
DateRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
Do While Not DateRec.EOF
    LNetOpen = 0
    LPattan = DateRec!PATTAN
    If DateRec!Condate >= LRiskMDate Then
        LOpen = Get_CloseQty(LRAccID, LRSaudaID, DateRec!Condate)
        If LOpen > 0 Then
            If LPOpen > 0 Then
                If LOpen > LPOpen Then LNetOpen = LOpen - LPOpen
            Else
                LNetOpen = LOpen
            End If
        Else
            If LPOpen < 0 Then
                If Abs(LOpen) > Abs(LPOpen) Then LNetOpen = Abs(LOpen) - Abs(LPOpen)
            Else
                LNetOpen = Abs(LOpen)
            End If
        End If
        LRiskMRate = 0
        If LNetOpen <> 0 Then
            LRiskMRate = Get_RiskMRate(LExID, LRItemID, DateRec!Condate, DateRec!Condate)
            If LPattan <> "O" Then LRiskMAmt = LRiskMAmt + Round(((LRiskMRate / 100) * (LRCalVal * DateRec!CLOSERATE * LNetOpen)), 2)
        End If
        LPOpen = LOpen
    End If
    DateRec.MoveNext
Loop
Set DateRec = Nothing
Set EXRate = Nothing
Calc_RiskMFees = LRiskMAmt
End Function
Public Function Calc_ShareAmt(ByVal LHSauda As Long, ByVal LHParty As String, ByVal LHFromDate As Date, ByVal LHToDate As Date) As Double

Dim TRec As ADODB.Command
Dim LShAmt As Double
LShAmt = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_SHAREAMT"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("PARTY", adVarChar, adParamInput, 15, LHParty)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, 50, LHSauda)
TRec.Parameters.Append TRec.CreateParameter("FROMDATE", adDBTimeStamp, adParamInput, , Format(LHFromDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LHToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LSHAREAMT", adDouble, adParamOutput, , LShAmt)
TRec.Execute
LShAmt = TRec("LSHAREAMT")
Calc_ShareAmt = LShAmt
End Function
Public Function Calc_SharePAmt(ByVal LHSauda As Long, ByVal LHParty As String, ByVal LHFromDate As Date, ByVal LHToDate As Date) As Double

Dim TRec As ADODB.Command
Dim LShAmt As Double
LShAmt = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_SHAREPAMT"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("PARTY", adVarChar, adParamInput, 15, LHParty)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, 50, LHSauda)
TRec.Parameters.Append TRec.CreateParameter("FROMDATE", adDBTimeStamp, adParamInput, , Format(LHFromDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LHToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LSHAREPAMT", adDouble, adParamOutput, , LShAmt)
TRec.Execute
LShAmt = TRec("LSHAREPAMT")
Calc_SharePAmt = LShAmt
End Function

Public Function Calc_SharebAmt(ByVal LHSauda As Long, ByVal LHParty As String, ByVal LHFromDate As Date, ByVal LHToDate As Date) As Double

Dim TRec As ADODB.Command
Dim LShAmt As Double
LShAmt = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_SHAREbAMT"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("PARTY", adVarChar, adParamInput, 15, LHParty)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, 50, LHSauda)
TRec.Parameters.Append TRec.CreateParameter("FROMDATE", adDBTimeStamp, adParamInput, , Format(LHFromDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LHToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LSHAREbAMT", adDouble, adParamOutput, , LShAmt)
TRec.Execute
LShAmt = TRec("LSHAREbAMT")
Calc_SharebAmt = LShAmt
End Function

Function Standing_Amt(ByVal LPSaudaCode As String, ByVal LPExCode As String, ByVal LPParty As String, ByVal LPFromDate As Date, ByVal LPToDate As Date, _
ByVal LPMaturityDate As Date, ByVal LPItemCode As String, ByVal LPSaudaID As Long) As Double
    Dim DateRec  As ADODB.Recordset:    Dim TRec As ADODB.Recordset:    Dim RecCont As ADODB.Recordset
    Dim LCondate As Date:               Dim LBQty As Double:            Dim LSQty As Double:
    Dim LNetQty As Double:              Dim MStdQty As Double:          Dim LMinDate As Date
    Dim MDt As Date:                    Dim LCloseRate As Double:       Dim LSTDRate As Double
    Dim LStandingAmt As Double:         Dim LCalval As Double
    Dim LStrMinDate As String
    Dim LACCID As Long
    LACCID = Get_AccID(LPParty)
    LStrMinDate = Get_MinCondate(LACCID, LPSaudaID, LPToDate)
    If LenB(LStrMinDate) > 0 Then
        LMinDate = DateValue(LStrMinDate)
    Else
        Standing_Amt = 0
        Exit Function
    End If
    Set RecCont = Nothing
    mysql = "SELECT * FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE >= '" & Format(LMinDate, "yyyy/MM/dd") & "' "
    mysql = mysql & " AND SETDATE >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND SETDATE <= '" & Format(LPMaturityDate, "yyyy/MM/dd") & "'"
    mysql = mysql & "  AND SETDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' ORDER BY SETDATE"
    Set DateRec = Nothing: Set DateRec = New ADODB.Recordset
    DateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not DateRec.EOF
        MStdQty = 0: LSTDRate = 0
        MDt = DateRec!SETDATE
        MStdQty = SDOpQty(LPParty, LPSaudaID, MDt + 1)
        If MDt <= LPMaturityDate Then
            If MStdQty <> 0 Then
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                mysql = "SELECT STDRATE FROM PITBROK WHERE COMPCODE = " & GCompCode & " "
                mysql = mysql & "AND AC_CODE = '" & LPParty & "' AND INSTTYPE ='FUT' AND ITEMCODE='" & LPItemCode & "' AND UPTOSTDT>='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY UPTOSTDT "
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    LSTDRate = Val(TRec!STDRATE & vbNullString)
                Else
                    Set TRec = Nothing:                Set TRec = New ADODB.Recordset
                    mysql = "SELECT STDRATE FROM PEXBROK WHERE COMPCODE = " & GCompCode & " "
                    mysql = mysql & "AND AC_CODE = '" & LPParty & "' AND INSTTYPE ='FUT' AND EXCODE ='" & LPExCode & "' AND UPTOSTDT>='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY UPTOSTDT "
                    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not TRec.EOF Then LSTDRate = Val(TRec!STDRATE & vbNullString)
                End If
                LStandingAmt = LStandingAmt + (Abs(MStdQty) * LSTDRate) * -1
                Set TRec = Nothing
            End If
        End If
        DateRec.MoveNext
    Loop
    Set DateRec = Nothing
    Set RecCont = Nothing
    Standing_Amt = LStandingAmt
End Function
Public Sub Get_Selection(B_Press As Byte)
On Error Resume Next
'0--SEARCH, 1--ADD, 2-MODIFY, 3--DELETE, 4--SAVE, 5--CANCEL, 6--LIST, 12--CLOSE
    GETMAIN.Label1.Caption = vbNullString
    GETMAIN.StatusBar1.Panels(3).text = "Ver 3.05"
    Select Case B_Press
        Case 1, 2                    '1--ADD  2--MODIFY
            If B_Press = 1 Then
                GETMAIN.StatusBar1.Panels(2).text = "Add Record"
            Else
                GETMAIN.StatusBar1.Panels(2).text = "Modify Record"
            End If
            Call Ask_Var("FFFTTTFF")
        Case 3                       '3--DELETE
            GETMAIN.StatusBar1.Panels(2).text = "Delete Record"
            Call Ask_Var("TTTFFTTT")
        Case 4, 5                    '4--SAVE  5--CANCEL
            If B_Press = 4 Then
                GETMAIN.StatusBar1.Panels(2).text = "Save Record"
            Else
                GETMAIN.StatusBar1.Panels(2).text = "Cancel Record"
            End If
            Call Ask_Var("TTTFFTTT")
        Case 7          '0--SEARCH
            GETMAIN.StatusBar1.Panels(2).text = "Search Record"
            Call Ask_Var("FFFFFTFT")
        Case 8                       'LIST
            GETMAIN.StatusBar1.Panels(2).text = "List of Record(s)"
            Call Ask_Var("FFFFFFFT")
        Case 0, 10                     'DEFAULT
            GETMAIN.StatusBar1.Panels(2).text = "Ready"
            Call Ask_Var("TTTFFTTT")
        Case 11                       'route
            Call Ask_Var("FFFFTFTT")
        Case 12                       'CLOSE
        '0131-3099268 ARVIND
            GETMAIN.StatusBar1.Panels(2).text = "Ready"
            GETMAIN.Toolbar1_Buttons(1).Enabled = False
            GETMAIN.Toolbar1_Buttons(2).Enabled = False
            GETMAIN.Toolbar1_Buttons(3).Enabled = False
            GETMAIN.Toolbar1_Buttons(4).Enabled = False
            GETMAIN.Toolbar1_Buttons(5).Enabled = False
            GETMAIN.Toolbar1_Buttons(6).Enabled = True
            GETMAIN.Toolbar1_Buttons(7).Enabled = False
            GETMAIN.Toolbar1_Buttons(8).Enabled = False
            If GETMAIN.PRINTTOGGLE.Checked = True Then
                GETMAIN.StatusBar1.Panels(1).text = "Print Toggle ON (DOS)"
            Else
                GETMAIN.StatusBar1.Panels(1).text = "Print Toggle OFF (WIN)"
            End If
        Case 13 ' only modify
            Call Ask_Var("FTFFFTFF")
            
    End Select
    DoEvents
End Sub
Public Sub Ask_Var(Mame As String)
    GETMAIN.serchrec.Enabled = IIf(Mid(Mame, 7, 1) = "T", True, False)  'SEARCH
    GETMAIN.Toolbar1_Buttons(7).Enabled = GETMAIN.serchrec.Enabled
    GETMAIN.StatusBar1.Panels(1).text = vbNullString
    'ADD
    If Mid(Mame, 1, 1) = "T" And AddPerm = True Then
        GETMAIN.addrec.Enabled = True
    Else
        GETMAIN.addrec.Enabled = False
    End If
    GETMAIN.Toolbar1_Buttons(1).Enabled = GETMAIN.addrec.Enabled
    'MODIFY
    If Mid(Mame, 2, 1) = "T" And ModiPerm = True Then
        GETMAIN.modifyrec.Enabled = True
    Else
        GETMAIN.modifyrec.Enabled = False
    End If
    GETMAIN.Toolbar1_Buttons(2).Enabled = GETMAIN.modifyrec.Enabled
    'DELETE
    If Mid(Mame, 3, 1) = "T" And DelPerm = True Then
        GETMAIN.deleterec.Enabled = True
    Else
        GETMAIN.deleterec.Enabled = False
    End If
    On Error Resume Next
    If GETMAIN.ActiveForm.NAME = "GETCOMP" Then
        GETMAIN.Toolbar1_Buttons(3).Enabled = False: GETMAIN.deleterec.Enabled = False
    Else
        GETMAIN.Toolbar1_Buttons(3).Enabled = GETMAIN.deleterec.Enabled
    End If
    'SAVE
    If Mid(Mame, 4, 1) = "T" Then
        GETMAIN.saverec.Enabled = True
    Else
        GETMAIN.saverec.Enabled = False
    End If
    GETMAIN.Toolbar1_Buttons(4).Enabled = GETMAIN.saverec.Enabled
    'CANCEL
    If Mid(Mame, 5, 1) = "T" Then
        GETMAIN.cancle.Enabled = True
    Else
        GETMAIN.cancle.Enabled = False
    End If
    GETMAIN.Toolbar1_Buttons(5).Enabled = GETMAIN.cancle.Enabled

    'LIST
    If Mid(Mame, 8, 1) = "T" Then
        GETMAIN.listrec.Enabled = True
    Else
        GETMAIN.listrec.Enabled = False
    End If
    GETMAIN.Toolbar1_Buttons(8).Enabled = GETMAIN.listrec.Enabled
    'CLOSE
    If Mid(Mame, 6, 1) = "T" Then
        GETMAIN.Close.Enabled = True
    Else
        GETMAIN.Close.Enabled = False
    End If
    GETMAIN.Toolbar1_Buttons(6).Enabled = GETMAIN.Close.Enabled
End Sub
Sub LogOff()
    GUserName = vbNullString
    Unload GETMAIN
    LogOffBool = False
    'Splash.Show
    loginfrm.Show
End Sub
Public Function MonthDays(ByVal month As Integer, ByVal Year As Integer) As Integer
    Dim I As Integer:    Dim St As String
    If Len(Trim(month)) = 1 Then
        St = "01/" & "0" & month & "/" & Year
    Else: St = "01/" & month & "/" & Year
    End If
    Do While Mid(St, 4, 2) = month
        St = CDate(St) + 1
        I = I + 1
    Loop
    MonthDays = I
End Function
Public Function NUMBERChk(Kasc As Integer) As Integer
    If Kasc >= 46 And Kasc <= 57 And Kasc <> 47 Or Kasc = 8 Or Kasc = 13 Or Kasc = 45 Or Kasc = 43 Then
       NUMBERChk = Kasc
    Else: NUMBERChk = 0
    End If
End Function
Public Function PERCENTAGE(MAXNO As Long, ACTUALNO As Long)
    GETMAIN.PERLBL.Caption = Int((ACTUALNO / MAXNO) * 100) & "%"
    
    If Int(Mid(GETMAIN.PERLBL.Caption, 1, Len(GETMAIN.PERLBL.Caption) - 1)) >= Val(99) Then GETMAIN.PERLBL.Caption = vbNullString
End Function
    Function Get_VouNo(VCHSERIES As String, FINYEAR As String) As String
    Dim TRec As New ADODB.Command
    Dim MNextNo As Long
    Dim LVouNo As String
    Dim I As Integer
    
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
    TRec.CommandText = "Max_VouNo"
    
    TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("VCHSERIES", adVarChar, adParamInput, 20, VCHSERIES)
    TRec.Parameters.Append TRec.CreateParameter("FINYEAR", adVarChar, adParamInput, 15, FINYEAR)
    TRec.Parameters.Append TRec.CreateParameter("MVOUNO", adInteger, adParamOutput, , MNextNo)
    TRec.Execute
    MNextNo = TRec("MVOUNO")
    
    MNextNo = MNextNo + 1
    I = Len(Trim(str(MNextNo)))
    LVouNo = VCHSERIES & FINYEAR & "-"
    LVouNo = LVouNo & String(Val(7) - Val(I), "0") & Trim(str(MNextNo))
    Get_VouNo = LVouNo
    Set TRec = Nothing
End Function
Function FIN_YEAR(MDate As Date) As String          ''''FUNCTION TO FIND OUT FINANCIAL YEAR
    Dim MMonth As Integer
    Dim MYear As Integer                   ''''USED IN VOUCHER NUMBER
    MMonth = CInt(month(MDate))
    MYear = CInt(Year(MDate))
    If MMonth >= 4 Then
        mysql = Mid(MYear, 3, 2) & Mid(MYear + Val(1), 3, 2)
    Else
        mysql = Mid(MYear - Val(1), 3, 2) & Mid(MYear, 3, 2)
    End If
    FIN_YEAR = mysql
End Function
Sub NOTEPAD_EXE()
On Error GoTo err
    Dim Win_Dir As String * 144:    Dim Sys_Dir As String * 144
    Dim WD As String:               Dim Y As Long:
    Dim X As Long:                  Dim SD As String
    
    Y = GetWindowsDirectory(Win_Dir, 144)
    WD = Left$(Win_Dir, Y)
    Shell (WD & "\NOTEPAD.Exe"), vbNormalFocus
    Exit Sub
err:
    If UCase(Right$(WD, 5)) = "WINNT" Then
        X = GetSystemDirectory(Sys_Dir, 144)
        SD = Left$(Sys_Dir, X)
        Shell (SD & "\NOTEPAD.Exe"), vbNormalFocus
    Else
        MsgBox err.Description, vbCritical, err.Number
    End If
End Sub
Sub CALC_EXE()
On Error GoTo err
    Dim Win_Dir As String:    Dim Sys_Dir As String:    Dim Y As Long:    Dim WD As String:    Dim SD As String:    Dim X As Integer
    Y = GetWindowsDirectory(Win_Dir, 144)
    WD = Left$(Win_Dir, Y)
    Shell (WD & "\CALC.Exe"), vbNormalFocus
    Exit Sub
err:
    If UCase(Right$(WD, 5)) = "WINNT" Then
        X = GetSystemDirectory(Sys_Dir, 144)
        SD = Left$(Sys_Dir, X)
        Shell (SD & "\CALC.Exe"), vbNormalFocus
    ElseIf UCase(Right$(WD, 7)) = "WINDOWS" Then
        X = GetSystemDirectory(Sys_Dir, 144)
        SD = Left$(Sys_Dir, X)
        Shell (SD & "\CALC.Exe"), vbNormalFocus
    Else
        MsgBox err.Description, vbCritical, err.Number
    End If
End Sub
Sub VERSION_ADJUSTMENT()
Dim MCompCode As Integer:   Dim MLFinBeg As Date:       Dim MLFinEnd As Date:           Dim MRpt_Path As String
Dim MDPath  As String:      Dim MSysLockDt As Date:     Dim MLLREC As ADODB.Recordset:  Dim TABLE_NAME As String:
Dim CnnString As String:    Dim MRec As ADODB.Recordset: Dim TRec As ADODB.Recordset
Cnn.CommandTimeout = 600
On Error GoTo Error1
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString
    If MCnn.State = 0 Then ' 0=closed
        Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
        MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
        MCnn.Open
    End If
    mysql = "SELECT * FROM SYSCOMP WHERE DATABASENAME='" & GDatabaseName & "'"
    Set MRec = Nothing
    Set MRec = New ADODB.Recordset
    MRec.Open mysql, MCnn, adOpenForwardOnly, adLockReadOnly
    If MRec.EOF Then
        mysql = "SELECT COMPCODE,FINBEGIN,FINEND,RPT_PATH,DPATH FROM COMPANY ORDER BY COMPCODE"
        Set MRec = Nothing:            Set MRec = New ADODB.Recordset
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            Do While Not MRec.EOF
                MCompCode = MRec!CompCode:                MLFinBeg = MRec!finbegin
                MLFinEnd = MRec!finend:                   MRpt_Path = MRec!Rpt_Path
                MDPath = IIf(IsNull(MRec!DPATH), "", MRec!DPATH)
                MSysLockDt = DateValue("2000/01/01")
                mysql = "INSERT INTO SYSCOMP (DATABASENAME,COMPCODE,FINBEGIN,FINEND,RPT_PATH,D_PATH,SYSLOCKDT) VALUES"
                mysql = mysql & "('" & GDatabaseName & "'," & MCompCode & ",'" & Format(MLFinBeg, "YYYY/MM/DD") & "','" & Format(MLFinEnd, "YYYY/MM/DD") & "'"
                mysql = mysql & ",'" & EncryptNEW(MRpt_Path, 13) & "','" & EncryptNEW(MDPath, 13) & "','" & Format(MSysLockDt, "YYYY/MM/DD") & "')"
                MCnn.Execute mysql
                MRec.MoveNext
            Loop
        End If
        Set MRec = Nothing
    Else
        mysql = "SELECT COMPCODE,FINBEGIN,FINEND,RPT_PATH,DPATH FROM COMPANY ORDER BY COMPCODE"
        Set MRec = Nothing:            Set MRec = New ADODB.Recordset
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            Do While Not MRec.EOF
                MCompCode = MRec!CompCode
                MLFinBeg = IIf(IsNull(MRec!finbegin), Date, MRec!finbegin)
                MLFinEnd = IIf(IsNull(MRec!finend), Date, MRec!finend)
                MRpt_Path = IIf(IsNull(MRec!Rpt_Path), "", MRec!Rpt_Path)
                MDPath = IIf(IsNull(MRec!DPATH), "", MRec!DPATH)
                MSysLockDt = DateValue("2000/01/01")
                mysql = "SELECT * FROM SYSCOMP WHERE DATABASENAME='" & GDatabaseName & "' AND COMPCODE =" & MCompCode & ""
                Set TRec = Nothing:                    Set TRec = New ADODB.Recordset
                TRec.Open mysql, MCnn, adOpenForwardOnly, adLockReadOnly
                If TRec.EOF Then
                    mysql = "INSERT INTO SYSCOMP (DATABASENAME,COMPCODE,FINBEGIN,FINEND,RPT_PATH,D_PATH,SYSLOCKDT) VALUES"
                    mysql = mysql & "('" & GDatabaseName & "'," & MCompCode & ",'" & Format(MLFinBeg, "YYYY/MM/DD") & "','" & Format(MLFinEnd, "YYYY/MM/DD") & "','" & EncryptNEW(MRpt_Path, 13) & "','" & EncryptNEW(MDPath, 13) & "','" & Format(MSysLockDt, "YYYY/MM/DD") & "')"
                    MCnn.Execute mysql
                Else
                    mysql = "UPDATE SYSCOMP SET FINBEGIN ='" & Format(MLFinBeg, "YYYY/MM/DD") & "',FINEND ='" & Format(MLFinEnd, "YYYY/MM/DD") & "', RPT_PATH='" & EncryptNEW(MRpt_Path, 13) & "',D_PATH='" & EncryptNEW(MDPath, 13) & "',SYSLOCKDT='" & Format(MSysLockDt, "YYYY/MM/DD") & "'"
                    mysql = mysql & " WHERE  DATABASENAME='" & GDatabaseName & "' AND COMPCODE =" & MCompCode & ""
                    MCnn.Execute mysql
                End If
                Set TRec = Nothing
                MRec.MoveNext
            Loop
        End If
        Set MRec = Nothing
    End If
    Call Delete_Indexes
    mysql = "IF EXISTS (SELECT TABLE_NAME  FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N'CTR_L')"
    
    mysql = mysql & " BEGIN DROP TABLE CTR_L END "
    Cnn.Execute mysql
    mysql = "IF EXISTS (SELECT TABLE_NAME  FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N'CTR_MATCH')"
    mysql = mysql & " BEGIN DROP TABLE CTR_MATCH END "
    Cnn.Execute mysql
    'convert NVarchar to Varchar
    
    mysql = "Select 'Alter Table [' + TABLE_SCHEMA + '].[' + TABLE_NAME + '] Alter Column [' + COLUMN_NAME + '] VarChar(' + CAST(CHARACTER_MAXIMUM_LENGTH As VARCHAR) + ')' AS STRSQL,TABLE_NAME ,COLUMN_NAME"
    mysql = mysql & " From INFORMATION_SCHEMA.Columns"
    mysql = mysql & " WHERE DATA_TYPE = 'NVARCHAR' AND TABLE_NAME IN ('COMPANY','CTR_D','CTR_R','CTR_M','INV_D','INV_D1','VOUCHER','VCHAMT','ACCOUNTM','ACCOUNTD','ACCT_EX','ACCFMLY','ACCFMLYD','PEXBROK','PEXSBROK',"
    mysql = mysql & "'PITBROK','PITSBROK','EXMAST','ITEMMAST','SAUDAMAST','SCRIPTMASTER','CONTRACTMASTER','DMARGIN','DLYMGN','DLYCLMGN')"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        Call Delete_DependentConstrainst(TRec!TABLE_NAME, TRec!COLUMN_NAME)
        mysql = TRec!STRSQL
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
        
    mysql = "Select 'Alter Table [' + TABLE_SCHEMA + '].[' + TABLE_NAME + '] Alter Column [' + COLUMN_NAME + '] VarChar(20)' AS STRSQL,TABLE_NAME ,COLUMN_NAME"
    mysql = mysql & " From INFORMATION_SCHEMA.Columns"
    mysql = mysql & " WHERE COLUMN_NAME IN ('ITEMCODE','EX_SYMBOL','EXHCODE') AND CHARACTER_MAXIMUM_LENGTH <>20  AND TABLE_NAME IN ('CTR_D','CTR_R','CTR_M','INV_D','INV_D1','VOUCHER','VCHAMT'"
    mysql = mysql & " ,'PEXBROK','PEXSBROK','PITBROK','PITSBROK','ITEMMAST','SAUDAMAST','SCRIPTMASTER'"
    mysql = mysql & ",'CONTRACTMASTER','DMARGIN','DLYMGN','DLYCLMGN')"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        Call Delete_DependentConstrainst(TRec!TABLE_NAME, TRec!COLUMN_NAME)
        mysql = TRec!STRSQL
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
    mysql = "Select 'Alter Table [' + TABLE_SCHEMA + '].[' + TABLE_NAME + '] Alter Column [' + COLUMN_NAME + '] VarChar(50)' AS STRSQL,TABLE_NAME ,COLUMN_NAME"
    mysql = mysql & " From INFORMATION_SCHEMA.Columns"
    mysql = mysql & " WHERE COLUMN_NAME IN ('SAUDACODE','SAUDANAME','SAUDA') AND CHARACTER_MAXIMUM_LENGTH <> 50  AND TABLE_NAME IN ('CTR_D','CTR_R','CTR_M','INV_D','INV_D1','VOUCHER','VCHAMT'"
    mysql = mysql & " ,'SAUDAMAST','SCRIPTMASTER'"
    mysql = mysql & ",'CONTRACTMASTER','DMARGIN')"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        Call Delete_DependentConstrainst(TRec!TABLE_NAME, TRec!COLUMN_NAME)
        mysql = TRec!STRSQL
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
    mysql = "Select 'Alter Table [' + TABLE_SCHEMA + '].[' + TABLE_NAME + '] Alter Column [' + COLUMN_NAME + '] VarChar(10)' AS STRSQL,TABLE_NAME ,COLUMN_NAME"
    mysql = mysql & " From INFORMATION_SCHEMA.Columns"
    mysql = mysql & " WHERE COLUMN_NAME IN ('EXCODE') AND CHARACTER_MAXIMUM_LENGTH <>10  AND TABLE_NAME IN ('CTR_D','CTR_R','CTR_M','INV_D','INV_D1','VOUCHER','VCHAMT'"
    mysql = mysql & " ,'PEXBROK','PEXSBROK','PITBROK','PITSBROK','ITEMMAST','SAUDAMAST','SCRIPTMASTER'"
    mysql = mysql & ",'CONTRACTMASTER','DMARGIN','DLYMGN','DLYCLMGN')"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        Call Delete_DependentConstrainst(TRec!TABLE_NAME, TRec!COLUMN_NAME)
        mysql = TRec!STRSQL
        Cnn.Execute mysql
        TRec.MoveNext
    Loop

    Call VER_AC_GROUP
    Call VER_COMPANY
    Call VER_ACCOUNT
    Call VER_ACCFMLY
    Call VER_EXMAST
    Call VER_EXTAX
    Call VER_ACCT_EX
    Call VER_ITEMMAST
    Call VER_SAUDAMAST
    Call Ver_ContractMaster
    Call VER_EXFILE
    Call VER_EXBROKCLIENT
    Call VER_NARRATION
    Call VER_PEXBROK
    Call VER_PITBROK
    Call VER_PEXSBROK
    Call VER_CTR_M
    Call VER_CTR_D
    Call VER_CTR_D_LOG
    Call VER_VOUCHER
    Call VER_INV_D
    Call VER_INV_D1
    Call VER_DMARGIN
    Call VER_BILLSUMREC
    Call VER_DAILYMARGIN
    Call VER_PartyYMulti
    'Call VER_ORD_M_D
            
    VER_ADJ "INV_AD", "COMPCODE", "INT", , 0
    VER_ADJ "INV_AD", "CDDATE", "SMALLDATETIME", , ""
    VER_ADJ "INV_AD", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "INV_AD", "SAUDA", "VARCHAR", 50, ""
    VER_ADJ "INV_AD", "CD", "CHAR", 1, ""
    VER_ADJ "INV_AD", "CRDR", "CHAR", 1, ""
    VER_ADJ "INV_AD", "AMOUNT", "FLOAT", , "0"
    VER_ADJ "INV_AD", "NARRATION", "VARCHAR", 150, ""
    mysql = "IF COL_LENGTH('INV_AD','ROWNO') IS NULL "
    mysql = mysql & " Alter Table INV_AD ADD ROWNO INT Identity(1,1) NOT NULL"
    Cnn.Execute mysql
    
    VER_ADJ "CTR_RP", "COMPCODE", "INT", , 0
    VER_ADJ "CTR_RP", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "CTR_RP", "SAUDA", "VARCHAR", 50, ""
    VER_ADJ "CTR_RP", "CONDATE", "SMALLDATETIME", , ""
    VER_ADJ "CTR_RP", "SETTLERATE", "FLOAT", , "0"
    VER_ADJ "CTR_RP", "ACCID", "INT", , "0"
    VER_ADJ "CTR_RP", "SAUDAID", "INT", , "0"
    VER_ADJ "CTR_RP", "OPEN", "FLOAT", , "0"
    VER_ADJ "CTR_RP", "CLOSE", "FLOAT", , "0"
    VER_ADJ "CTR_RP", "LOW", "FLOAT", , "0"
    VER_ADJ "CTR_RP", "HIGH", "FLOAT", , "0"
    
    VER_ADJ "EQUITY", "SYMBOL", "VARCHAR", 50, ""
    VER_ADJ "EQUITY", "NAME", "VARCHAR", 50, ""
    
    VER_ADJ "FILEMAPPING", "VALUE", "VARCHAR", 50, ""
    VER_ADJ "FILEMAPPING", "MAPTO", "VARCHAR", 50, ""
    VER_ADJ "FILEMAPPING", "TYPE", "VARCHAR", 15, ""
    mysql = "IF COL_LENGTH('FILEMAPPING','ID') IS NULL "
    mysql = mysql & " Alter Table FILEMAPPING Add ID INT Identity(1,1) NOT NULL"
    Cnn.Execute mysql
        
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('JAN','01','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('FEB','02','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('MAR','03','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('APR','04','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('MAY','05','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('JUN','06','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('JUL','07','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('AUG','08','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('SEP','09','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('OCT','10','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('NOV','11','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('DEC','12','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('JAN','01','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' FEB','02','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' MAR','03','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' APR','04','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' MAY','05','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' JUN','06','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' JUL','07','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' AUG','08','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' SEP','09','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' OCT','10','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' NOV','11','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES (' DEC','12','R3')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('Q','','R1')": Cnn.Execute mysql
    mysql = "INSERT INTO FILEMAPPING (value,MAPTO,TYPE) VALUES ('K','','R1')": Cnn.Execute mysql
    mysql = "insert into FILEMAPPING (value,mapto,type) values ('-DDMMM','XXXXXX','R6')": Cnn.Execute mysql
    mysql = "insert into FILEMAPPING (value,mapto,type) values ('-MMMDD','XXXXXX','R6')": Cnn.Execute mysql
    
        
    GETMAIN.Label1.Caption = "Update ExID"
    DoEvents
    Call UPD_EXID
    
    GETMAIN.Label1.Caption = "Update ACCID  "
    DoEvents
    Call UPD_ACCID
    

    VER_ADJ "PartyHead", "Compcode", "INT", , "0"
    VER_ADJ "PartyHead", "HeadCode", "INT", , "0"
    VER_ADJ "PartyHead", "HeadName", "VARCHAR", 50, ""
    VER_ADJ "PartyHead", "PCode", "INT", , ""
    VER_ADJ "PartyHead", "GroupCode", "INT", , ""
    
    VER_ADJ "USER_MENU", "MCAPTION", "VARCHAR", 100, ""
    VER_ADJ "USER_MENU", "PCODE", "INT", , "0"
    
    VER_ADJ "SETTLE", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "SelComp", "COMPCODE", "INT", , "0"
    
    Call Create_Indexes
    Call NEW_STORED
    Call Check_PExSBrok
    'Set MCnn = Nothing

    mysql = " ALTER TABLE CTR_D ALTER COLUMN FILETYPE VARCHAR(3)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE EXFILE ALTER COLUMN EXFILETYPE VARCHAR(3)"
    Cnn.Execute mysql

    'increase account code field length from 6 to 15 ********************
    mysql = " ALTER TABLE ACCFMLY ALTER COLUMN FMLYHEAD VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE ACCFMLY ALTER COLUMN CONTRA_AC VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE ACCFMLYD ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE ACCOUNTD ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE ACCOUNTM ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE ACCT_EX ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql
        
    mysql = " ALTER TABLE CTR_D ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE CTR_D ALTER COLUMN CONCODE VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE CTR_D_LOG ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE CTR_D_LOG ALTER COLUMN CONCODE VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE CTR_RP ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE DAILYMARGIN ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE DlyCLMgn ALTER COLUMN Client VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE DMARGIN ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE EXBROKCLIENT ALTER COLUMN BROKER VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXBROKCLIENT ALTER COLUMN CLIENT VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE EXFILE ALTER COLUMN CONTRACTACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXFILE ALTER COLUMN CLIENTCODE VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXFILE ALTER COLUMN BROKER2 VARCHAR(15)"
    Cnn.Execute mysql
        
    mysql = " ALTER TABLE EXMAST ALTER COLUMN TRADINGACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN BANKACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN STCACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN SBCACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN INTERESTACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN UTTACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN IGSTACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN SGSTACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN CGSTACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN RISKMACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN TRANTAX VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN BANKCLI VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN cashacc VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN clgacc VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN utttacc VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN SDUTYTAXACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN MARGINACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN SRVTAXACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN ROUNDACC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN SHREEAC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN STANDAC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN BROKAC VARCHAR(15)"
    Cnn.Execute mysql
    mysql = " ALTER TABLE EXMAST ALTER COLUMN CONTRACTACC VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE inv_d ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE inv_d1 ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE pexbrok ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE pexsbrok ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql
        
    mysql = " ALTER TABLE pitbrok ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE pitsbrok ALTER COLUMN party VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE vchamt ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql

    mysql = " ALTER TABLE voucher ALTER COLUMN cashcode VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE vchamt_log ALTER COLUMN ac_code VARCHAR(15)"
    Cnn.Execute mysql
    
    mysql = " ALTER TABLE PARTYMULTI ALTER COLUMN PARTY VARCHAR(15)"
    Cnn.Execute mysql
    
    
    Cnn.CommandTimeout = 120
   ' ---This Procedure Should Run ONLY IN Case of F3
   Exit Sub
Error1:
MsgBox err.Description

End Sub
''''FUNCTION FOR THE VERSION ADJUSTMENT
Function VER_ADJ(TABLE_NAME As String, FIELD_NAME As String, DATA_TYPE As String, Optional FIELD_LENGTH As Integer, Optional DEFAULT_VALUE As String, Optional LPROPERTY As String)
    On Error GoTo err1
    Dim MDTYPE As String
    Dim MRec As ADODB.Recordset
    Dim FIELD_FOUND As Boolean
    Select Case UCase(DATA_TYPE)
        Case "BIT", "BIGINT", "INT", "SMALLINT", "TINYINT", "DECIMAL", "FLOAT", "MONEY", "MUMERIC", "REAL", "SMALLMONEY", "SMALLDATETIME", "DATETIME"
            MDTYPE = "1"
        Case "CHAR", "VARCHAR", "NTEXT", "VARCHAR", "TEXT", "NVARCHAR"
            MDTYPE = "2"
    End Select
    mysql = "SELECT * FROM dbo.sysobjects WHERE ID = object_id(N'[dbo].[" & TABLE_NAME & "]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1"
    Set MRec = Nothing:    Set MRec = New ADODB.Recordset
    MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If MRec.EOF Then
        If MDTYPE = "2" Then
            If LenB(DEFAULT_VALUE) = 0 Then
                mysql = "CREATE TABLE [" & TABLE_NAME & "] ([" & FIELD_NAME & "] [" & DATA_TYPE & "] (" & FIELD_LENGTH & ") NULL )"
            Else
                mysql = "CREATE TABLE [" & TABLE_NAME & "] ([" & FIELD_NAME & "] [" & DATA_TYPE & "] (" & FIELD_LENGTH & ")  NOT NULL)"
                mysql = mysql & "  DEFAULT '" & DEFAULT_VALUE & "'  WITH VALUES"
            End If
        Else
            If LenB(DEFAULT_VALUE) = 0 Then
                mysql = "CREATE TABLE [" & TABLE_NAME & "] ([" & FIELD_NAME & "] [" & DATA_TYPE & "] NULL ) "
            Else
                mysql = "CREATE TABLE [" & TABLE_NAME & "] ([" & FIELD_NAME & "] [" & DATA_TYPE & "]  NOT NULL "
                mysql = mysql & "  DEFAULT " & DEFAULT_VALUE & " )"
            End If
        End If
        Cnn.Execute mysql
    Else
        If MDTYPE = "2" Then    ''''STRING TYPES
            If LenB(DEFAULT_VALUE) = 0 Then
                mysql = "IF  col_length('" & TABLE_NAME & "','" & FIELD_NAME & "') IS NULL "
                mysql = mysql & " ALTER  TABLE " & TABLE_NAME & " ADD [" & FIELD_NAME & "] " & DATA_TYPE & "(" & FIELD_LENGTH & ") NULL "
            Else
                mysql = "IF  col_length('" & TABLE_NAME & "','" & FIELD_NAME & "') IS NULL "
                mysql = mysql & " ALTER  TABLE " & TABLE_NAME & " ADD [" & FIELD_NAME & "] " & DATA_TYPE & "(" & FIELD_LENGTH & ") NOT NULL "
                mysql = mysql & "  DEFAULT '" & DEFAULT_VALUE & "'  WITH VALUES"
            End If
        Else
            If LenB(DEFAULT_VALUE) = 0 Then
                mysql = "IF  col_length('" & TABLE_NAME & "','" & FIELD_NAME & "') is null"
                mysql = mysql & " ALTER TABLE " & TABLE_NAME & " ADD [" & FIELD_NAME & "] " & DATA_TYPE & "  NULL "
            Else
                If DATA_TYPE = "DATETIME" Or DATA_TYPE = "SMALLDATETIME" Then
                    mysql = "IF  col_length('" & TABLE_NAME & "','" & FIELD_NAME & "') IS NULL "
                    mysql = mysql & " ALTER TABLE " & TABLE_NAME & " ADD [" & FIELD_NAME & "] " & DATA_TYPE & " NOT NULL DEFAULT '" & Format(DateValue(DEFAULT_VALUE), "YYYY/MM/DD") & "'  WITH VALUES"
                Else
                    mysql = "IF  col_length('" & TABLE_NAME & "','" & FIELD_NAME & "') IS NULL"
                    mysql = mysql & " ALTER TABLE " & TABLE_NAME & " ADD [" & FIELD_NAME & "] " & DATA_TYPE & " NOT NULL DEFAULT '" & DEFAULT_VALUE & "'  WITH VALUES"
                End If
            End If
        End If
        
        Cnn.Execute mysql
    End If
    
    Exit Function
err1:
    If Val(err.Number) = Val(-2147217900) Then  '       Z x'FIELD IS NOT IN THE TABLE
        MsgBox err.Description
        FIELD_FOUND = False
        Set MRec = Nothing
        Resume Next
    Else
        MsgBox err.Description, vbCritical, "Error Number : " & err.Number
    End If
End Function

Function Calculate_Percentage_BrokAmt(LOpQnty As Double, LPUptoDate As Date, LPAccID As Long, LPSaudaID As Long, LTotOpAmt As Double, LBrokRate As Double, Lmaturity As Date, mclrate As Double) As Double

        Dim AREC As ADODB.Recordset
        Dim TRec As ADODB.Recordset
        Dim TOBQTY As Double
        Dim TOSQTY As Double
        Dim TOBAMT As Double
        Dim TOSAMT As Double
        Dim MClQty As Double

        Dim BROKQTY As Double
        Dim BROKAMT As Double
        Dim TOTSQTY As Double
        Dim PFLAG As Boolean
        
        PFLAG = True
        mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE ='" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            PFLAG = True
        Else
            mysql = "SELECT COMpCODE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND ACCID = '" & LPAccID & "' AND SAUDAID = '" & LPSaudaID & "' AND CONDATE > '" & Format(LPUptoDate, "YYYY/MM/DD") & "' AND CONDATE <= ( SELECT TOP 1 SETDATE FROM SETTLE WHERE SETDATE >= '" & Format(LPUptoDate, "YYYY/MM/DD") & "' ORDER BY SETDATE) "
            Set AREC = Nothing
            Set AREC = New ADODB.Recordset
            AREC.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not AREC.EOF Then
                PFLAG = False
            End If
        End If
        
        Dim PREC As ADODB.Recordset
        Dim CRec As ADODB.Recordset
        Dim LPREVIOUSDATE As Date
                                
        mysql = "SELECT top 1 setdate FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE < '" & Format(LPUptoDate, "YYYY/MM/DD") & "' order by setdate desc"
        Set PREC = Nothing
        Set PREC = New ADODB.Recordset
        PREC.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not PREC.EOF Then
            LPREVIOUSDATE = PREC!SETDATE + 1
        Else
          LPREVIOUSDATE = LPUptoDate - 7
        End If
        
        '''Calculate Previous DAte Opening Qty
        
        LOpQnty = 0: LTotOpAmt = 0
        mysql = "SELECT  TOP 1 CLQTY,CLRATE,CALVAL FROM INV_D WHERE COMPCODE =" & GCompCode & " AND STDATE < '" & Format(LPREVIOUSDATE, "YYYY/MM/DD") & "' AND ACCID = '" & LPAccID & "' AND SAUDAID = '" & LPSaudaID & "' ORDER BY STDATE DESC"
        Set CRec = Nothing
        Set CRec = New ADODB.Recordset
        CRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not CRec.EOF Then
            LOpQnty = CRec!CLQTY * -1
            LTotOpAmt = (CRec!CLQTY * -1) * CRec!ClRate * CRec!CALVAL
        End If
        If PFLAG Then
            mysql = "SELECT CONTYPE, SUM(QTY) AS 'QTY' , SUM (QTY * RATE * CALVAL) AS 'AMOUNT' FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONDATE >= '" & Format(LPREVIOUSDATE, "YYYY/MM/DD") & "' AND CONDATE <= '" & Format(LPUptoDate, "YYYY/MM/DD") & "' AND ACCID = '" & LPAccID & "' AND SAUDAID = '" & LPSaudaID & "' GROUP BY CONTYPE"
            Set CRec = Nothing
            Set CRec = New ADODB.Recordset
            CRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            While Not CRec.EOF
                If CRec!CONTYPE = "B" Then
                    TOBQTY = CRec!QTY
                    TOBAMT = CRec!AMOUNT
                Else
                    TOSQTY = CRec!QTY
                    TOSAMT = CRec!AMOUNT
                End If
                CRec.MoveNext
            Wend
            MClQty = LOpQnty + (TOBQTY - TOSQTY)
            If LOpQnty > 0 And TOSQTY <> 0 Then
                If TOSQTY >= LOpQnty Then
                    BROKQTY = BROKQTY + LOpQnty
                    BROKAMT = BROKAMT + LTotOpAmt + (TOSAMT / TOSQTY) * (LOpQnty)
                    If TOSQTY > 0 Then
                        TOSAMT = TOSAMT - (TOSAMT / TOSQTY) * (LOpQnty)
                    End If
                    TOSQTY = TOSQTY - BROKQTY
                Else
                    BROKQTY = BROKQTY + TOSQTY
                    BROKAMT = BROKAMT + TOSAMT + ((Abs(LTotOpAmt) / Abs(LOpQnty)) * TOSQTY)
                    TOSQTY = 0
                    TOSAMT = 0
                End If
            ElseIf LOpQnty < 0 And TOBQTY <> 0 Then
                If TOBQTY >= Abs(LOpQnty) Then
                    BROKQTY = BROKQTY + Abs(LOpQnty)
                    BROKAMT = BROKAMT + Abs(LTotOpAmt) + (TOBAMT / TOBQTY) * Abs(LOpQnty)
                    TOBAMT = TOBAMT - (TOBAMT / TOBQTY) * Abs(LOpQnty)
                    TOBQTY = TOBQTY - Abs(BROKQTY)
                Else
                    BROKQTY = BROKQTY + TOBQTY
                    BROKAMT = BROKAMT + TOBAMT + ((Abs(LTotOpAmt) / Abs(LOpQnty)) * TOBQTY)
                    TOBQTY = 0
                    TOBAMT = 0
                End If
            End If
            If TOBQTY <> 0 And TOSQTY <> 0 Then
                If TOBQTY >= TOSQTY Then
                    BROKQTY = BROKQTY + (TOSQTY)
                    BROKAMT = BROKAMT + TOSAMT + (TOBAMT / TOBQTY) * TOSQTY
                Else
                    BROKQTY = BROKQTY + (TOBQTY)
                    BROKAMT = BROKAMT + TOBAMT + (TOSAMT / TOSQTY) * TOBQTY
                End If
            End If
        End If

        If LPUptoDate >= Lmaturity And MClQty <> 0 Then
            If MClQty > 0 Then
                If TOBQTY <> 0 Then
                    BROKAMT = BROKAMT + MClQty * mclrate + ((TOBAMT / TOBQTY) * MClQty)
                ElseIf LOpQnty <> 0 Then
                    BROKAMT = BROKAMT + MClQty * mclrate + ((Abs(LTotOpAmt) / Abs(LOpQnty)) * MClQty)
                End If
            Else
                'If LOpQnty <> 0 Then
                '    BROKAMT = BROKAMT + (Abs(MClQty) * mclrate) + TOSAMT + (Abs(LTotOpAmt) / Abs(LOpQnty)) * (Abs(MClQty) - TOSQTY)
                'Else
                '    BROKAMT = BROKAMT + (Abs(MClQty) * mclrate) + TOSAMT + (Abs(LTotOpAmt) / Abs(LOpQnty)) * (Abs(MClQty) - TOSQTY)
                'End If
                'BROKAMT = BROKAMT + (Abs(MClQty) * mclrate) + TOSAMT + (Abs(LTotOpAmt) / (Abs(MClQty) - TOSQTY))
            End If
        End If
        Calculate_Percentage_BrokAmt = Abs(BROKAMT) * LBrokRate / 100
End Function
Function SDBILL(ByVal LPParty As String, ByVal LPPartyName As String, ByVal LPSauda As String, ByVal LPUptoDate As Date, ByVal LPPartyType As String, ByVal LPItemCode As String, _
                ByVal LPCLOSERATE As Double, ByVal LPExCode As String, ByVal LPApplyOn As String, ByVal LPPostCode As String, ByVal lpbillby As String, LPSaudaID As Long, _
                LPOPattan As String, LPEXID As Integer, lpitemid As Integer, LPReflot As Double, LPAccID As Long) As Boolean
    On Error GoTo err1

    Dim TRec As ADODB.Recordset:        Dim RecInv As ADODB.Recordset
    Dim LNarration As String:           Dim MDR As String:              Dim LStmType As String:         Dim VchNo As String
    Dim LExchangeCode As String:        Dim LCType As String:           Dim LBrokType As String:        Dim LTranType  As String
    Dim LFromDate As Date:              Dim LOpenDate As Date:          Dim LRiskMDate  As Date:        Dim LCTTDate As Date
    Dim LOpenTrade As Boolean:          Dim LCurrSauda As String:       Dim LCurrDRate As Double:       Dim LEQ_STAMPRATE As Double
    Dim LOpQnty As Double:              Dim lOpRate As Double:          Dim LTotBuyAmt As Double:       Dim LTotSellAmt  As Double
    Dim LCloseQty As String:            Dim LTotOpAmt As Double:        Dim LTotBuyQty As Double:       Dim LTotSellQty As Double
    Dim LTotBQtyAmt As Double:          Dim LTotSQtyAmt As Double:      Dim LBrokRate As Double:        Dim LBrokRate2 As Double
    Dim LCBrokAmt As Double:            Dim LTranAmt As Double:         Dim LStandingAmt As Double:     Dim LStampDutyRate As Double
    Dim LCBrokAmt2 As Double:
    Dim LTranRate As Double:            Dim LSTTRate As Double:         Dim LTotSTTAmt As Double:       Dim LTotStmAmt As Double
    Dim LNetValue As Double:            Dim LNetValue2 As Double:       Dim LDiffAmt  As Double:        Dim LBrokQty2 As Double
    Dim LRoundAmt As Double:            Dim LCutQty As Double:          Dim LCUTRATE As Double:         Dim LBrokQty As Double:
    Dim LSrvTax As Double:              Dim LSrvTaxAmt As Double:       Dim LTotBrokQty As Double:      Dim LTranAmount As Double
    Dim LTotBrokQty2 As Double:         Dim LNetValue1 As Double:       Dim LRiskMAmt As Double:        Dim LTotSBCAmt As Double
    Dim LBBrokAmt As Double:            Dim LBrokQtyAmt As Double:      Dim LSBCAmt As Double:          Dim LUTTAmt As Double
    Dim LTotSEBITaxAmt As Double:       Dim LSEBITaxAmt As Double:      Dim LSBCTax As Double:          Dim LSGSTRate As Double
    Dim LTotNBrokQtyAmt As Double:      Dim LSEBITax As Double:         Dim LTotBrokQtyAmt As Double:   Dim LCGSTRate As Double
    Dim LBrokAmount As Double:          Dim LUTTRate As Double:         Dim LIGSTRate As Double:        Dim LCGSTAmt As Double
    Dim LBrokAmount2 As Double
    Dim LTotCGSTAmt As Double:          Dim LSGSTAmt As Double:         Dim LTotSGSTAmt As Double:      Dim LIGSTAmt As Double
    Dim LTotIGSTAmt As Double:          Dim LBalQty As Double:          Dim LBuyAmt As Double:          Dim LSellAmt As Double
    Dim LSTDRate As Double:             Dim LMinRate As Double:         Dim LCurrCRate As Double:       Dim LTotUTTAmt As Double
    Dim LMVNo As Long:                  Dim LEQ_STTRATE As Double:
    Dim mbcycle As String
    Dim LExCode As String
    Dim GStampDutyDate As Date
    Dim LbTotBuyqty As Double: Dim LbTotsellqty As Double
    Dim LbTotBqtyamt As Double: Dim LbTotsqtyamt As Double
    Dim lusdinr As Double: Dim lastsettle As Date: Dim msettleday As Date
    lusdinr = 1
    mbcycle = "D"

    mysql = "SELECT BCYCLE FROM ACCOUNTD WHERE COMPCODE = " & GCompCode & " AND AC_CODE = '" & LPParty & "' "
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        mbcycle = TRec!BCYCLE
    End If

    LExCode = ""
    
    mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE >='" & Format((LPUptoDate), "YYYY/MM/DD") & "'"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then msettleday = TRec!SETDATE
    
    mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE <='" & Format((LPUptoDate - 1), "YYYY/MM/DD") & "' ORDER BY SETDATE DESC"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        lastsettle = TRec!SETDATE
    Else
        lastsettle = LPUptoDate - 7
    End If

    GStampDutyDate = DateValue("01/07/2020")
    LOpenTrade = False
    LCTTDate = DateValue("01/07/2013"):
    LRiskMDate = DateValue("15/10/2014")

    LFromDate = GFinBegin:  LCloseQty = 0:      LTotOpAmt = 0:      LOpQnty = 0:        lOpRate = 0:      LTotBuyAmt = 0:     LTotSellAmt = 0:    LBrokQty = 0
    LCutQty = 0:            LCUTRATE = 0:       LBrokType = "T":    LTranType = "T":    LTotBuyQty = 0:   LTotSellQty = 0:    LTotBQtyAmt = 0:    LTotSQtyAmt = 0:
    LBrokAmount = 0:        LSrvTaxAmt = 0:     LTranAmount = 0:    LTotStmAmt = 0:     LTotSTTAmt = 0:   LBrokQtyAmt = 0:    LSGSTAmt = 0
    LTotBrokQty2 = 0:       LSEBITaxAmt = 0:    LTotSEBITaxAmt = 0: LTotBrokQty = 0:    LBrokQty2 = 0:    LRiskMAmt = 0:      LSBCAmt = 0:        LTotSBCAmt = 0
    LBrokAmount2 = 0
    LSEBITax = 0:           LSBCTax = 0:        LCGSTAmt = 0:       LTotCGSTAmt = 0:    LTotSGSTAmt = 0:  LIGSTAmt = 0:       LTotIGSTAmt = 0:    LUTTAmt = 0
    LTotUTTAmt = 0:         LCGSTRate = 0:      LSGSTRate = 0:      LIGSTRate = 0:      LBalQty = 0:      LStmType = LPApplyOn
    
    LbTotBuyqty = 0: LbTotsellqty = 0
    LbTotBqtyamt = 0: LbTotsqtyamt = 0
    ''FOR CALCULATING OP QNTY.    ''FINDING LAST BILL MADE DATE
    LOpenDate = LFromDate:      LExchangeCode = LPExCode
    
    '>>> NEW -- verify system lock date
    If (DateDiff("D", LPUptoDate, GSysLockDt) > 0) Then
        LPUptoDate = GSysLockDt
        LPUptoDate = DateAdd("D", 1, LPUptoDate)
    End If
    mysql = "EXEC CHKINV " & LPAccID & "," & LPSaudaID & ",'" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
   
    Set RecInv = Nothing
    Set RecInv = New ADODB.Recordset
    RecInv.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not RecInv.EOF Then
        RecInv.MoveFirst
        LFromDate = RecInv!STDATE + Val(1):            LOpQnty = Val(RecInv!CLQTY) * Val(-1)
        lOpRate = Val(RecInv!ClRate):                  LOpenDate = RecInv!STDATE:            LTotOpAmt = LOpQnty * lOpRate * GCalVal
    Else
        mysql = "EXEC CHKOP2 " & LPAccID & "," & LPSaudaID & ",'" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
        Set RecInv = Nothing
        Set RecInv = New ADODB.Recordset
        RecInv.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not RecInv.EOF Then
            If Not IsNull(RecInv!opqnty) Then
                 LOpQnty = Val(RecInv!opqnty)
                 LTotOpAmt = RecInv!OPAMT
                 If LTotOpAmt <> 0 And LOpQnty <> 0 Then lOpRate = Abs(Round((LTotOpAmt / GCalVal) / LOpQnty, 4))
                 LOpenDate = DateValue(GFinBegin)
                 'RecInv!Condate
            End If
        End If
        Set RecInv = Nothing
    End If
     If (LSDInstType = "FUT") Or (LSDInstType = "OPT" And GAutoBrok = True) Or (LSDInstType = "CSH" And GEqBill = True) Then
        LCloseQty = LOpQnty
        LBalQty = LOpQnty
    Else
        If FlagMaturity And (LSDInstType = "OPT") Then
            LCloseQty = Get_CloseQty(LPAccID, LPSaudaID, LPUptoDate - 1)
            LBalQty = LCloseQty
            LOpQnty = LCloseQty
            lOpRate = 0
        Else
            LBalQty = Get_CloseQty(LPAccID, LPSaudaID, LPUptoDate - 1)
            LOpQnty = 0: lOpRate = 0: LTotOpAmt = 0
        End If
    End If

    If LOpQnty <> 0 Then
        If LOpQnty > 0 Then
            LTotBuyAmt = LTotBuyAmt + Abs((LOpQnty * lOpRate * GCalVal))
        Else
            LTotSellAmt = LTotSellAmt + Abs((LOpQnty * lOpRate * GCalVal))
        End If
    End If
    ''OPENING QNTY OFF
    ''TOTAL BOUGHT SOLD
    mysql = "EXEC SDBILLREC " & LPAccID & "," & LPSaudaID & ",'" & Format(LFromDate, "YYYY/MM/DD") & "','" & Format(LPUptoDate, "YYYY/MM/DD") & "'," & GOnlyBrok & ""
    Set RecInv = Nothing
    Set RecInv = New ADODB.Recordset
    RecInv.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
     If RecInv.EOF And LOpQnty = 0 And LOpenTrade = False Then
        SDBILL = True
        Exit Function
     End If
    LMinRate = 0
    If GMinBrokYN = "Y" And GFBroktype = "Y" Then
        mysql = "SELECT MINRATE FROM PITBROK WHERE ACCID =" & LPAccID & " "
        mysql = mysql & " AND ITEMID =" & lpitemid & " AND UPTOSTDT>='" & Format(LPUptoDate, "YYYY/MM/DD") & "'AND MBROKTYPE='F' ORDER BY UPTOSTDT"
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            LMinRate = TRec!MinRate
        Else
            mysql = "SELECT MINRATE FROM PEXBROK WHERE ACCID  =" & LPAccID & " "
            mysql = mysql & " AND EXID =" & LPEXID & " AND UPTOSTDT>='" & Format(LPUptoDate, "YYYY/MM/DD") & "'AND MBROKTYPE='F' ORDER BY UPTOSTDT "
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                LMinRate = TRec!MinRate
            End If
            Set TRec = Nothing
        End If
    End If
    
    ''''
    Do While Not RecInv.EOF
        LBrokRate = IIf(IsNull(RecInv!brokrate), 0, RecInv!brokrate):        LBrokType = IIf(IsNull(RecInv!broktype), "P", RecInv!broktype)
        LBrokRate2 = IIf(IsNull(RecInv!BROKRATE2), 0, RecInv!BROKRATE2):     LBrokQty = IIf(IsNull(RecInv!BROKQTY), 0, RecInv!BROKQTY)
        LBrokQty2 = IIf(IsNull(RecInv!BROKQTY2), 0, RecInv!BROKQTY2):        LTotBrokQty2 = LTotBrokQty2 + Val(LBrokQty2)
        If LBrokType = "Z" Then LBrokQty = GBrokLot
        If LBrokType = "R" Then LBrokQty2 = GBrokLot
        If LBrokType = "A" Then LBrokQty2 = GBrokLot
        If LBrokType = "5" Then LBrokQty2 = GBrokLot
        If Not IsNull(RecInv!ORDNO) Then
            If RecInv!ORDNO = "Carry" Then
                LBrokRate = LBrokRate2
            End If
        End If
        If GOnlyBrok = 0 Then
            LTranRate = IIf(IsNull(RecInv!TRANRATE), 0, RecInv!TRANRATE):        LTranType = IIf(IsNull(RecInv!TRANTYPE), "P", RecInv!TRANTYPE)
            LStampDutyRate = IIf(IsNull(RecInv!STMRATE), 0, RecInv!STMRATE):     LSTTRate = IIf(IsNull(RecInv!STTRATE), 0, RecInv!STTRATE)
            LSrvTax = IIf(IsNull(RecInv!SRVTAX), 0, RecInv!SRVTAX):              LSBCTax = IIf(IsNull(RecInv!SBC_TAX), 0, RecInv!SBC_TAX)
            LCGSTRate = RecInv!CGSTRATE:                                         LSGSTRate = RecInv!SGSTRATE
            LIGSTRate = RecInv!IGSTRATE:                                         LUTTRate = RecInv!UTTRATE
            LSEBITax = RecInv!SEBITAX
            LEQ_STTRATE = RecInv!EQ_STT
            LEQ_STAMPRATE = RecInv!EQ_STAMP
        End If

        LCBrokAmt = 0: LTranAmt = 0:        LSEBITaxAmt = 0: LCBrokAmt2 = 0:
        
        If RecInv!CONTYPE = "B" Then
            LBuyAmt = (Val(RecInv!QTY) * Val(RecInv!Rate) * GCalVal)
            LTotBuyAmt = LTotBuyAmt + LBuyAmt
            LTotBuyQty = LTotBuyQty + Val(RecInv!QTY)
            LTotBQtyAmt = LTotBQtyAmt + (LBuyAmt)
            LCloseQty = LCloseQty + Val(RecInv!QTY)
            If RecInv!BROKFLAG = "Y" Then
                LbTotBuyqty = LbTotBuyqty + Val(RecInv!QTY)
                LbTotBqtyamt = LbTotBqtyamt + (LBuyAmt)
                If (LBrokType = "O" Or LBrokType = "C" Or LBrokType = "A" Or LBrokType = "5") Then LBrokQty = Get_BrokQty(LBrokType, LBalQty, "B", RecInv!QTY)
                 LCBrokAmt = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, LBrokQty, RecInv!QTY, RecInv!Rate, GCalVal, LSDInstType, LSDSTrike, LBrokQty2, GTradeableLot, "B", "2", lpitemid)
                If LBrokType = "V" Then
                    LCBrokAmt2 = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, LBrokQty, RecInv!QTY, RecInv!Rate, GCalVal, LSDInstType, LSDSTrike, LBrokQty2, GTradeableLot, "B", "2", lpitemid)
                End If
                If LMinRate <> 0 And (LMinRate * (RecInv!QTY / LPReflot)) > LCBrokAmt Then
                    LCBrokAmt = LMinRate * (RecInv!QTY / LPReflot)
                End If
                LBalQty = LBalQty + RecInv!QTY
            End If
        Else
            LSellAmt = Abs(Val(RecInv!QTY) * Val(RecInv!Rate) * GCalVal)
            LTotSellAmt = LTotSellAmt + LSellAmt
            LTotSellQty = LTotSellQty + Val(RecInv!QTY)
            LTotSQtyAmt = LTotSQtyAmt + LSellAmt
            LCloseQty = LCloseQty - Val(RecInv!QTY)
            If RecInv!BROKFLAG = "Y" Then
                LbTotsellqty = LbTotsellqty + Val(RecInv!QTY)
                LbTotsqtyamt = LbTotsqtyamt + LSellAmt
                If (LBrokType = "O" Or LBrokType = "C" Or LBrokType = "A" Or LBrokType = "5") Then LBrokQty = Get_BrokQty(LBrokType, LBalQty, "S", RecInv!QTY)
                LCBrokAmt = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, LBrokQty, Val(RecInv!QTY), RecInv!Rate, GCalVal, LSDInstType, LSDSTrike, LBrokQty2, GTradeableLot, "S", 2, lpitemid)
                If LBrokType = "V" Then
                    LCBrokAmt2 = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, LBrokQty, Val(RecInv!QTY), RecInv!Rate, GCalVal, LSDInstType, LSDSTrike, LBrokQty2, GTradeableLot, "S", 2, lpitemid)
                End If
                If LMinRate <> 0 And (LMinRate * (RecInv!QTY / LPReflot)) > LCBrokAmt Then
                    LCBrokAmt = LMinRate * (RecInv!QTY / LPReflot)
                End If
                LBalQty = LBalQty - RecInv!QTY
            End If
        End If
        LTotBrokQty = LTotBrokQty + Val(LBrokQty)
        LTotNBrokQtyAmt = LTotNBrokQtyAmt + (Val(RecInv!QTY) - LBrokQty) * (Val(RecInv!Rate) * GCalVal)
        LBrokQtyAmt = LBrokQtyAmt + (Val(LBrokQty) * Val(RecInv!Rate) * GCalVal)
        LBrokAmount = LBrokAmount + LCBrokAmt
        LBrokAmount2 = LBrokAmount2 + LCBrokAmt2
        If GOnlyBrok = 0 Then
            If LPExCode = "EQ" Then
                LTotStmAmt = LTotStmAmt + ((LStampDutyRate / 100) * ((RecInv!QTY - LBrokQty2) * RecInv!Rate * GCalVal))
                LTotStmAmt = LTotStmAmt + ((LEQ_STAMPRATE / 100) * (LBrokQty2 * RecInv!Rate * GCalVal))
                LTotSTTAmt = LTotSTTAmt + ((LSTTRate / 100) * ((RecInv!QTY - LBrokQty2) * RecInv!Rate * GCalVal))
                LTotSTTAmt = LTotSTTAmt + (((LEQ_STTRATE / 100) * (LBrokQty2 * RecInv!Rate * GCalVal)))
            Else
                LTotStmAmt = LTotStmAmt + ((LStampDutyRate / 100) * (RecInv!QTY * RecInv!Rate * GCalVal))
                If LSTTRate <> 0 Then LTotSTTAmt = LTotSTTAmt + ((LSTTRate / 100) * (RecInv!QTY * RecInv!Rate * GCalVal))
            End If
            If LTranType = "T" Then
                LTranAmt = LTranAmt + (LTranRate * RecInv!QTY)
            ElseIf LTranType = "P" Then
                LTranAmt = LTranAmt + ((LTranRate / 100) * RecInv!QTY * RecInv!Rate * GCalVal)
            End If
            LSEBITaxAmt = (LSEBITax / 100) * (RecInv!QTY * RecInv!Rate * GCalVal)
            
            LTotSEBITaxAmt = LTotSEBITaxAmt + LSEBITaxAmt
            LSrvTaxAmt = LSrvTaxAmt + ((LCBrokAmt * LSrvTax) / 100)
            LTotSBCAmt = LTotSBCAmt + ((LCBrokAmt * LSBCTax) / 100)
            LCGSTAmt = LCGSTAmt + ((LCBrokAmt * LCGSTRate) / 100)
            LSGSTAmt = LSGSTAmt + ((LCBrokAmt * LSGSTRate) / 100)
            LIGSTAmt = LIGSTAmt + ((LCBrokAmt * LIGSTRate) / 100)
            LUTTAmt = LUTTAmt + ((LCBrokAmt * LUTTRate) / 100)
            
            If GSrStdYN = "Y" Then
                If LPUptoDate >= DateValue(GSrvDate) Then
                    LSrvTaxAmt = LSrvTaxAmt + ((LTranAmt * LSrvTax) / 100)
                    LTotSBCAmt = LTotSBCAmt + ((LTranAmt * LSBCTax) / 100)
                    LCGSTAmt = LCGSTAmt + ((LTranAmt * LCGSTRate) / 100)
                    LSGSTAmt = LSGSTAmt + ((LTranAmt * LSGSTRate) / 100)
                    LIGSTAmt = LIGSTAmt + ((LTranAmt * LIGSTRate) / 100)
                    LUTTAmt = LUTTAmt + ((LTranAmt * LUTTRate) / 100)
                    If LPUptoDate >= DateValue(GSrvDate2) Then
                        LCGSTAmt = LCGSTAmt + ((LSEBITaxAmt * LCGSTRate) / 100)
                        LSGSTAmt = LSGSTAmt + ((LSEBITaxAmt * LSGSTRate) / 100)
                        LIGSTAmt = LIGSTAmt + ((LSEBITaxAmt * LIGSTRate) / 100)
                    End If
                End If
            End If

            LTranAmount = LTranAmount + LTranAmt
        End If

       RecInv.MoveNext
    Loop
    Set RecInv = Nothing
    LCloseQty = LCloseQty * Val(-1)
    LBillCloseQty = LCloseQty
    
    ''END OF BOUGHT SOLD
    If (LSDInstType = "FUT") Or (LSDInstType = "OPT" And GAutoBrok = False And FlagMaturity = True) Or (LSDInstType = "OPT" And GAutoBrok = True) Or (LSDInstType = "CSH" And GEqBill = True) Then
        If LSDInstType = "OPT" And LSDOptType = "CE" And LPCLOSERATE >= LSDSTrike And GAutoBrok = False And FlagMaturity = True And LPCLOSERATE <> 0 Then
            LPCLOSERATE = LPCLOSERATE - LSDSTrike
        ElseIf LSDInstType = "OPT" And LSDOptType = "CE" And LPCLOSERATE < LSDSTrike And GAutoBrok = False And FlagMaturity = True Then
            LPCLOSERATE = 0
            LCloseQty = 0
        End If
        If LSDInstType = "OPT" And LSDOptType = "PE" And LPCLOSERATE <= LSDSTrike And GAutoBrok = False And FlagMaturity = True And LPCLOSERATE <> 0 Then
            LPCLOSERATE = 0
            LCloseQty = 0

        ElseIf LSDInstType = "OPT" And LSDOptType = "PE" And LPCLOSERATE > LSDSTrike And GAutoBrok = False And FlagMaturity = True Then
            LPCLOSERATE = 0
            LCloseQty = 0
        End If
        
        If LCloseQty <> 0 Then
            If LPCLOSERATE = 0 Then SDBILL = True: Exit Function
            If lpbillby = "B" Then
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                If LCloseQty > 0 Then
                    mysql = "SELECT HGRATE AS CLRATE,CLOSERATE "
                Else
                    mysql = "SELECT LOWRATE AS CLRATE,CLOSERATE "
                End If
                mysql = mysql & " FROM CTR_R  WHERE  CONDATE ='" & Format(LPUptoDate, "YYYY/MM/DD") & "'AND SAUDAID =" & LPSaudaID & ""
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then LPCLOSERATE = IIf(Val(TRec!ClRate) = 0, TRec!CLOSERATE, TRec!ClRate)
            End If
            If lpbillby = "P" Then
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                mysql = "SELECT SETTLERATE FROM CTR_RP WHERE ACCID = '" & LPAccID & "' AND SAUDAID ='" & LPSaudaID & "' AND CONDATE= '" & Format(LPUptoDate, "yyyy/mm/dd") & "'"
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    If TRec!SETTLERATE <> 0 Then LPCLOSERATE = TRec!SETTLERATE
                End If
                Set TRec = Nothing
            End If
            
            If LCloseQty > Val(0) Then
                LTotBuyAmt = LTotBuyAmt + (Abs(LCloseQty) * LPCLOSERATE * GCalVal)
            Else
                LTotSellAmt = LTotSellAmt + (Abs(LCloseQty) * LPCLOSERATE * GCalVal)
            End If
        End If
        
        ' STANDING CHRAGES
        If GStandingYN = "Y" Then
            mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE ='" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                mysql = "SELECT STDRATE FROM PITBROK WHERE ACCID = " & LPAccID & " "
                mysql = mysql & "AND  INSTTYPE ='FUT' AND ITEMID=" & lpitemid & " AND UPTOSTDT>='" & Format(LPUptoDate, "YYYY/MM/DD") & "' ORDER BY UPTOSTDT "
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    LSTDRate = Val(TRec!STDRATE & vbNullString)
                Else
                    Set TRec = Nothing:                Set TRec = New ADODB.Recordset
                    mysql = "SELECT STDRATE FROM PEXBROK WHERE "
                    mysql = mysql & " AC_CODE = '" & LPParty & "' AND INSTTYPE ='FUT'  AND EXID =" & LPEXID & " AND UPTOSTDT>='" & Format(LPUptoDate, "YYYY/MM/DD") & "' ORDER BY UPTOSTDT "
                    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not TRec.EOF Then
                        LSTDRate = Val(TRec!STDRATE & vbNullString)
                    End If
                End If
                LStandingAmt = Abs(LCloseQty) * (LSTDRate * -1)
            End If
        End If
        If FlagMaturity And LCloseQty <> 0 And LBrokType <> "3" Then
            LBrokRate = 0: LBrokType = "P": LTranRate = 0: LTranType = "P"
            If LCloseQty > Val(0) Then
                LTotBQtyAmt = LTotBQtyAmt + (LCloseQty * LPCLOSERATE * GCalVal)
                LbTotBqtyamt = LbTotBqtyamt + (Abs(LCloseQty) * LPCLOSERATE * GCalVal)
            Else
                LTotSQtyAmt = LTotSQtyAmt + (Abs(LCloseQty) * LPCLOSERATE * GCalVal)
                LbTotsqtyamt = LbTotsqtyamt + (Abs(LCloseQty) * LPCLOSERATE * GCalVal)
            End If
            If LSDInstType = "OPT" And GOptCutBrok = "0" Then
               LBrokRate = 0:      LBrokType = "P":    LBrokRate2 = 0
               LTranType = "P":    LTranRate = 0:
            ElseIf LSDInstType = "FUT" And GFutCutBrok = "0" Then
               LBrokRate = 0:      LBrokType = "P":    LBrokRate2 = 0
               LTranType = "P":    LTranRate = 0:
            Else
                Set TRec = Nothing: Set TRec = New ADODB.Recordset                   ''BROKERAGE CALCULATION
                mysql = "EXEC GET_BROKRATE  " & LPAccID & "," & LPEXID & "," & lpitemid & ",'" & Format(LPUptoDate, "yyyy/MM/dd") & "','" & LSDInstType & "'"
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    LTranType = TRec!TRANTYPE:      LTranRate = TRec!TRANRATE:
                    If LPCLOSERATE <= TRec!MinRate Then
                        LBrokRate = TRec!MBROKRATE:      LBrokType = TRec!MBROKTYPE: LBrokRate2 = TRec!MBROKRATE2
                    Else
                        LBrokRate = TRec!brokrate:      LBrokType = TRec!broktype: LBrokRate2 = TRec!BROKRATE2
                    End If
                End If
            End If
            LCBrokAmt = 0
            LCBrokAmt2 = 0
            LBrokQty = Abs(LCloseQty)
            If LBrokType = "Z" Then LBrokQty = GBrokLot
            If LBrokType = "R" Then LBrokQty2 = GBrokLot
            If LBrokType = "O" Then
                LCBrokAmt = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, 0, Abs(LCloseQty), Abs(LPCLOSERATE), GCalVal, LSDInstType, LSDSTrike, 0, GTradeableLot, "B", "2", lpitemid)
            ElseIf LBrokType = "R" Then
                If LPCLOSERATE = 0 Then
                    LCBrokAmt = 0
                Else
                    LCBrokAmt = Abs(LCloseQty) / LBrokQty * LBrokRate
                End If
            Else
                LCBrokAmt = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, LBrokQty, Abs(LCloseQty), Abs(LPCLOSERATE), GCalVal, LSDInstType, LSDSTrike, 0, GTradeableLot, "B", "2", lpitemid)
                If LBrokType = "V" Then
                    LCBrokAmt2 = Calc_Brokerage(LBrokType, LBrokRate, LBrokRate2, LBrokQty, Abs(LCloseQty), Abs(LPCLOSERATE), GCalVal, LSDInstType, LSDSTrike, 0, GTradeableLot, "B", 2, lpitemid)
                End If
                If LMinRate <> 0 And (LMinRate * (Abs(LCloseQty) / LPReflot)) > LCBrokAmt Then
                    LCBrokAmt = LMinRate * (Abs(LCloseQty) / LPReflot)
                End If
            End If
            LBrokAmount = LBrokAmount + LCBrokAmt
            LBrokAmount2 = LBrokAmount2 + LCBrokAmt2
            If LCloseQty >= 0 Then
                LCType = "B"
            Else
                LCType = "S"
            End If
            If GOnlyBrok = 0 Then
                Set TRec = Nothing: Set TRec = New ADODB.Recordset
                mysql = "SELECT SERVICETAX,SBC_TAX,STCTAX,CGSTRATE,SGSTRATE,IGSTRATE,UTTRATE FROM EXTAX WHERE COMPCODE =" & GCompCode & ""
                mysql = mysql & " AND  EXID = " & LPEXID & " AND FROMDT<= '" & Format(LPUptoDate, "YYYY/MM/DD") & "' AND TODT>='" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    LSrvTax = Val(TRec!servicetax & vbNullString):            LSBCTax = Val(TRec!SBC_TAX & vbNullString)
                    LCGSTRate = Val(TRec!CGSTRATE):                 LSGSTRate = Val(TRec!SGSTRATE)
                    LIGSTRate = Val(TRec!IGSTRATE):                 LUTTRate = Val(TRec!UTTRATE):            LSEBITax = Val(TRec!STCTAX)
                Else
                    LSrvTax = 0:         LSBCTax = 0:            LCGSTRate = 0:              LSGSTRate = 0:
                    LIGSTRate = 0:       LUTTRate = 0:           LSEBITax = 0
                End If
                Set TRec = Nothing: Set TRec = New ADODB.Recordset
                mysql = "SELECT SEBITAX FROM ITEM_TAX WHERE COMPCODE =" & GCompCode & " AND ITEMID =" & lpitemid & " "
                mysql = mysql & " AND FROMDT<='" & Format(LBmaturity, "YYYY/MM/DD") & "' AND TODT >='" & Format(LBmaturity, "YYYY/MM/DD") & "'"
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    LSEBITax = Val(TRec!SEBITAX)
                End If
                Set TRec = Nothing
                If LTranType = "T" Then
                    LTranAmt = (LTranRate * Abs(LCloseQty))
                ElseIf LTranType = "P" Then
                    LTranAmt = ((LTranRate / 100) * Abs(LCloseQty) * Abs(LPCLOSERATE) * GCalVal)
                End If
                LSTTRate = 0
                If LSEBITax <> 0 Then
                    Set TRec = Nothing
                    Set TRec = New ADODB.Recordset
                    mysql = "SELECT SEBITYPE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND AC_CODE ='" & LPParty & "'"
                    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not TRec.EOF Then
                        If TRec!SEBITYPE = "R" Then
                            LSEBITax = LSEBITax * -1
                        ElseIf TRec!SEBITYPE = "N" Then
                            LSEBITax = 0
                        End If
                    End If
                    Set TRec = Nothing
                    LSEBITaxAmt = ((LSEBITax / 100) * (Abs(LCloseQty) * Abs(LPCLOSERATE) * GCalVal))
                    LTotSEBITaxAmt = LTotSEBITaxAmt + LSEBITaxAmt
                End If
                If LSTTRate <> 0 Then LTotSTTAmt = LTotSTTAmt + ((LSTTRate / 100) * Abs(LCloseQty) * Abs(LPCLOSERATE) * GCalVal)
                LTranAmount = LTranAmount + LTranAmt

                If GCGSTType = "1" Then LCGSTAmt = LCGSTAmt + (LCBrokAmt * (LCGSTRate / 100))
                If GSGSTType = "1" Then LSGSTAmt = LSGSTAmt + (LCBrokAmt * (LSGSTRate / 100))
                If GIGSTType = "1" Then LIGSTAmt = LIGSTAmt + (LCBrokAmt * (LIGSTRate / 100))
                If GUTTType = "1" Then LUTTAmt = LUTTAmt + (LCBrokAmt * (LUTTRate / 100))
                If GSrTaxApp = "1" Then
                    LSrvTaxAmt = LSrvTaxAmt + (LCBrokAmt * (LSrvTax / 100))
                    LTotSBCAmt = LTotSBCAmt + ((LCBrokAmt * LSBCTax) / 100)
                    If GSrStdYN = "Y" Then
                        If LPUptoDate >= DateValue(GSrvDate) Then
                            LSrvTaxAmt = LSrvTaxAmt + (LTranAmt * (LSrvTax / 100))
                            LTotSBCAmt = LTotSBCAmt + ((LTranAmt * LSBCTax) / 100)
                            If GCGSTType = "1" Then LCGSTAmt = LCGSTAmt + (LTranAmt * (LCGSTRate / 100))
                            If GSGSTType = "1" Then LSGSTAmt = LSGSTAmt + (LTranAmt * (LSGSTRate / 100))
                            If GIGSTType = "1" Then LIGSTAmt = LIGSTAmt + (LTranAmt * (LIGSTRate / 100))
                            If GUTTType = "1" Then LUTTAmt = LUTTAmt + (LTranAmt * (LUTTRate / 100))
                            If LPUptoDate >= DateValue(GSrvDate2) Then
                                If GCGSTType = "1" Then LCGSTAmt = LCGSTAmt + (LSEBITaxAmt * (LCGSTRate / 100))
                                If GSGSTType = "1" Then LSGSTAmt = LSGSTAmt + (LSEBITaxAmt * (LSGSTRate / 100))
                                If GIGSTType = "1" Then LIGSTAmt = LIGSTAmt + (LSEBITaxAmt * (LIGSTRate / 100))
                            End If
                        End If
                    End If
                End If
            End If
            LCutQty = LCloseQty: LCUTRATE = LPCLOSERATE
        End If
    Else
       LCloseQty = 0
    End If
    
    ''''' Calculate correction/divident
    If GOrderEntryYN = "Y" Then
        mysql = "SELECT DR_CR,SUM(AMOUNT) FROM INV_AD WHERE ACCID = MACCID AND SAUDAID = MSAUDAID AND STDATE >- 'MFROMDATE' AND STDATE <= MTODATE"
    End If

    ''
    'CLOSING SAUDA %WISE
    If LBrokType = "3" Then
          LBrokAmount = Calculate_Percentage_BrokAmt(LOpQnty, LPUptoDate, LPAccID, LPSaudaID, LTotOpAmt, LBrokRate, LBmaturity, LPCLOSERATE)
    End If
    ''
    If GOnlyBrok = 0 Then
        If GRiskMType <> "N" And LRiskMDate <= LPUptoDate And GRiskMapp = "Y" Then LRiskMAmt = Calc_RiskMFees(LPSauda, LPExCode, LPParty, LFromDate, LPUptoDate, LBmaturity, GCalVal, lpitemid, LPSaudaID, LPAccID)
        If GRiskMType = "P" Then LRiskMAmt = (LRiskMAmt) * -1
        If GSrTaxApp = "1" Then
            LSrvTaxAmt = LSrvTaxAmt + (LRiskMAmt * -1) * (LSrvTax / 100)
            LTotSBCAmt = LTotSBCAmt + (((LRiskMAmt * -1) * LSBCTax) / 100)
        End If
        If GCGSTType = "1" Then LCGSTAmt = LCGSTAmt + (LRiskMAmt * -1) * (LCGSTRate / 100)
        If GSGSTType = "1" Then LSGSTAmt = LSGSTAmt + (LRiskMAmt * -1) * (LSGSTRate / 100)
        If GIGSTType = "1" Then LIGSTAmt = LIGSTAmt + (LRiskMAmt * -1) * (LIGSTRate / 100)
        If GUTTType = "1" Then LUTTAmt = LUTTAmt + (LRiskMAmt * -1) * (LUTTRate / 100)
    End If

    If GRoundOff = "Y" Then
        LTranAmount = Round(LTranAmount) * -1:        LBrokAmount = Round(LBrokAmount) * -1
        LTotStmAmt = Round(LTotStmAmt) * -1:          LTotSTTAmt = Round(LTotSTTAmt) * -1
        LSrvTaxAmt = Round(LSrvTaxAmt) * -1:          LTotSBCAmt = Round(LTotSBCAmt) * -1
        LTotSEBITaxAmt = Round(LTotSEBITaxAmt) * -1:  LRiskMAmt = Round(LRiskMAmt)
        LBrokAmount2 = Round(LBrokAmount2) * -1
        LDiffAmt = Round(LTotSellAmt - LTotBuyAmt)
        If (LTotBuyAmt < 0) Or (LTotSellAmt < 0) Then
            If LTotSellAmt > 0 And LTotBuyAmt < 0 Then
                LDiffAmt = Round(LTotSellAmt + (LTotBuyAmt * -1)):
            Else
                LDiffAmt = Round(LTotSellAmt - LTotBuyAmt):
            End If
        End If

        LCGSTAmt = Round(LCGSTAmt, 2) * -1
        LSGSTAmt = Round(LSGSTAmt, 2) * -1:           LIGSTAmt = Round(LIGSTAmt, 2) * -1
        LUTTAmt = Round(LUTTAmt, 2) * -1
        If LPUptoDate >= GSTMDate And LPUptoDate < GStampDutyDate And (LStmType = "R" Or LStmType = "P") Then
            LTotStmAmt = 0
        End If
        LNetValue = LDiffAmt + LBrokAmount + LTranAmount + LStandingAmt + LSrvTaxAmt + LTotStmAmt + LTotSTTAmt + LRiskMAmt + LTotSEBITaxAmt + LTotSBCAmt + LCGSTAmt + LSGSTAmt + LIGSTAmt + LUTTAmt
    Else
        LSrvTaxAmt = (-1) * LSrvTaxAmt:        LTranAmount = LTranAmount * -1
        LBrokAmount = LBrokAmount * -1:        LTotStmAmt = LTotStmAmt * -1
        LBrokAmount2 = LBrokAmount2 * -1
        LTotSTTAmt = LTotSTTAmt * -1:          LTotSBCAmt = LTotSBCAmt * -1
        LCGSTAmt = LCGSTAmt * -1:              LSGSTAmt = LSGSTAmt * -1
        LIGSTAmt = LIGSTAmt * -1:              LUTTAmt = LUTTAmt * -1
        LRiskMAmt = LRiskMAmt:                 LTotSEBITaxAmt = LTotSEBITaxAmt * -1
        LDiffAmt = (LTotSellAmt - LTotBuyAmt)

        If (LTotBuyAmt < 0) Or (LTotSellAmt < 0) Then
            If LTotSellAmt > 0 Then
                LDiffAmt = (LTotSellAmt + (LTotBuyAmt * -1)):
            Else
                LDiffAmt = (LTotSellAmt - LTotBuyAmt):
            End If
        End If
        If LPUptoDate >= GSTMDate And LPUptoDate < GStampDutyDate And (LStmType = "R" Or LStmType = "P") Then LTotStmAmt = 0
        LNetValue = LDiffAmt + LBrokAmount + LTranAmount + LStandingAmt + LSrvTaxAmt + LTotStmAmt + LTotSTTAmt + LRiskMAmt + LTotSEBITaxAmt + LTotSBCAmt + LCGSTAmt + LSGSTAmt + LIGSTAmt + LUTTAmt
    End If
    VchNo = vbNullString
    GMBillNo = GMBillNo + 1
    
    ''''Currency Type = 1
    lusdinr = 1
    If gcurrtype = 1 And LPExCode = "CMX" Then

        Dim LLowRate As Double
        Dim LHGRate As Double
        
        Dim RateRec As ADODB.Recordset
        
        If lpbillby = "P" Then
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            mysql = "SELECT LOW,HIGH FROM CTR_RP WHERE ACCID = '" & LPAccID & "' AND SAUDA ='USDINR' AND CONDATE= '" & Format(LPUptoDate, "yyyy/mm/dd") & "'"
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                LLowRate = TRec!LOW
                LHGRate = TRec!HIGH
            Else
                LLowRate = 1
                LHGRate = 1
            End If
        Else
            mysql = "SELECT CLOSERATE,HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LPUptoDate, "yyyy/mm/dd") & "' "
            Set RateRec = Nothing
            Set RateRec = New ADODB.Recordset
            RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not RateRec.EOF Then
                If lpbillby = "S" Then
                    LLowRate = RateRec!CLOSERATE
                    LHGRate = RateRec!CLOSERATE
                Else
                    LLowRate = RateRec!LOWRATE
                    LHGRate = RateRec!HGRATE
                End If
            Else
                LLowRate = 1
                LHGRate = 1
            End If
        End If
        Set TRec = Nothing
        ''''
        Dim MPARTYTYPE As String
        mysql = "SELECT PARTYTYPE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND AC_CODE = '" & LPParty & "'"
        Set RateRec = Nothing
        Set RateRec = New ADODB.Recordset
        RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not RateRec.EOF Then
            MPARTYTYPE = RateRec!PARTYTYPE
        End If

                If LNetValue > 0 Then
                    lusdinr = LLowRate
                Else
                    lusdinr = LHGRate
                End If
    End If
    
    If gcurrtype = 0 Or lusdinr <= 1 Or LExchangeCode <> "CMX" Then
        lusdinr = 1
    End If
    
    If Abs(LNetValue) + Abs(LDiffAmt) + Abs(LBrokAmount) <> 0 Then
         mysql = " EXEC INSERT_INV_D " & GCompCode & "," & Val(GMBillNo) & ", '" & Format(LPUptoDate, "yyyy/MM/dd") & "', '" & LPParty & "', '" & LPSauda & "', '" & LPItemCode & "', " & LOpQnty & ", " & lOpRate & ", " & LCloseQty & ", " & LPCLOSERATE & ", " & Val(LDiffAmt) & ",  " & LBrokAmount & ",  " & LStandingAmt & ",  " & LTranAmount & ", '" & VchNo & "', " & LNetValue & ", 0, 0," & LCutQty & "," & LCUTRATE & ",'" & Format(LOpenDate, "yyyy/MM/dd") & "'," & LSrvTaxAmt & ", " & GCalVal & "," & LTotBuyQty & "," & LTotBQtyAmt & "," & LTotSellQty & "," & LTotSQtyAmt & "," & LTotStmAmt & "," & LTotSTTAmt & ",'" & Format(LFromDate, "YYYY/MM/DD") & "'," & LRiskMAmt & "," & LTotSEBITaxAmt & "," & LTotSBCAmt & "," & LCGSTAmt & "," & LSGSTAmt & "," & LIGSTAmt & "," & LUTTAmt & ",'" & LExchangeCode & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & LPAccID & "," & lusdinr & ", " & Val(LBrokAmount2) & ""
        Cnn.Execute mysql
    Else
        mysql = " EXEC INSERT_INV_D " & GCompCode & "," & Val(GMBillNo) & ", '" & Format(LPUptoDate, "yyyy/MM/dd") & "', '" & LPParty & "', '" & LPSauda & "', '" & LPItemCode & "', " & LOpQnty & ", " & lOpRate & ", " & LCloseQty & ", " & LPCLOSERATE & ", " & Val(LDiffAmt) & ",  " & LBrokAmount & ",  " & LStandingAmt & ",  " & LTranAmount & ", '" & vbNullString & "', " & LNetValue & ", 0, 0," & LCutQty & "," & LCUTRATE & ",'" & Format(LOpenDate, "yyyy/MM/dd") & "'," & LSrvTaxAmt & ", " & GCalVal & "," & LTotBuyQty & "," & LTotBQtyAmt & "," & LTotSellQty & "," & LTotSQtyAmt & "," & LTotStmAmt & "," & LTotSTTAmt & ",'" & Format(LFromDate, "YYYY/MM/DD") & "'," & LRiskMAmt & "," & LTotSEBITaxAmt & "," & LTotSBCAmt & "," & LCGSTAmt & "," & LSGSTAmt & "," & LIGSTAmt & "," & LUTTAmt & ",'" & LExchangeCode & "'," & LPEXID & "," & lpitemid & "," & LPSaudaID & "," & LPAccID & "," & lusdinr & ", " & Val(LBrokAmount2) & ""
        Cnn.Execute mysql
    End If

     If GUniqClientId = "MYR-RJT" Then
        Call Post_ShareVou2(LNetValue, LDiffAmt, LBrokAmount, LPParty, LPItemCode, LPUptoDate, LPExCode, LSDInstType, LbTotBqtyamt, LbTotsqtyamt, LbTotBuyqty, LbTotsellqty, LTotBrokQty, LTotNBrokQtyAmt, LBrokQtyAmt, GMBillNo, LBrokQty2, LPSauda, LPPartyName, LPEXID, lpitemid, LPSaudaID, LPAccID)
     Else
        Call Post_ShareVou(LNetValue, LDiffAmt, LBrokAmount, LPParty, LPItemCode, LPUptoDate, LPExCode, LSDInstType, LbTotBqtyamt, LbTotsqtyamt, LbTotBuyqty, LbTotsellqty, LTotBrokQty, LTotNBrokQtyAmt, LBrokQtyAmt, GMBillNo, LBrokQty2, LPSauda, LPPartyName, LPEXID, lpitemid, LPSaudaID, LPAccID, LBrokAmount2, lpbillby)
     End If
    SDBILL = True
    Exit Function
err1:

    MsgBox err.Description, vbCritical, "Error Number : " & err.Number
    SDBILL = False
    
End Function

Function BILL_GENERATION(ByVal LBPFromDate As Date, ByVal LBToDate As Date, ByVal LBSaudas As String, ByVal LBParties As String, ByVal LBExCodes As String) As Boolean
    ''BILL POSTING
    On Error GoTo err1
    Dim TRec As ADODB.Recordset:            Dim DateRec As ADODB.Recordset:     Dim LMVNo As Long:              Dim PartyRec As ADODB.Recordset
    Dim ExchangeRec As ADODB.Recordset:     Dim LBFromDate As Date:             Dim MSetNo As Long:             Dim LPostCode As String
    Dim LInstType As String:                Dim LPartyType As String:           Dim LRiskMApp As String:        Dim LBItemCode As String
    Dim MPCode As String:                   Dim MSCode As String:               Dim LMdate As String:           Dim LBApplycOn As String
    Dim LPartyCode  As String:              Dim LSaudaCode As String:           Dim LPartyName As String:       Dim LPMinDate As String
    Dim LBBrokqty As Double:                Dim LCloseRate As Double:           Dim LTQty As Double:            Dim LStrike As Double
    Dim LMaxCondate  As Date:               Dim LMinCondate As Date:            Dim LFromDate As Date:          Dim LNext_Date As String
    Dim LExchangeCode As String:            Dim LStmVou As Boolean:             Dim Chk_Invoice As Boolean:     Dim LStmpAmt As Double
    Dim TRec1 As ADODB.Recordset:           Dim LPartyAc As String:             Dim LStmAc As String:           Dim VchNo As String
    Dim LNarration As String:               Dim LBillNo As Long:                Dim MDR As String:              Dim MCR As String
    Dim LBilling As Boolean:                Dim LBillBy As String:              Dim LBidAsk As Boolean:         Dim LSaudaID As Long
    Dim LLastBillDate As Date:              Dim LSettlePost As Boolean:         Dim SaudaRec As ADODB.Recordset
    Dim LBillParties As String:             Dim LBillExIds As String:           Dim LOPattan  As String
    Dim LExID As Integer:                   Dim LItemID As Integer:             Dim LRefLot As Double
    Dim LStampDutyDate As Date:             Dim LMinInvdDate As Date
    Dim LGAccID As Long:                    Dim Lpartyrate As Boolean:
    Dim LCLRATE As Double
    Dim mbcycle As String
    Dim LExCode As String
    
    Dim LExRec As ADODB.Recordset
    Dim LVou_Ids As String
    Dim SVNO As Long
    
    
    LBFromDate = DateValue(LBPFromDate):

    LStampDutyDate = DateValue("01/07/2020")
    GFBroktype = "N"
    
    If GSysLockDt >= LBPFromDate Then LBPFromDate = GSysLockDt + 1
    
    LBillParties = vbNullString
    LBillExIds = vbNullString
    mysql = "UPDATE SAUDAMAST SET REFLOT =1 WHERE REFLOT =0"
    Cnn.Execute mysql
    
    mysql = "SELECT TOP 1 BROKTYPE FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND MBROKTYPE='F'"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then GFBroktype = "Y"
    
    LBilling = False
    LSettlePost = False
    
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    mysql = "SELECT POSTSETTLE FROM ACCFMLY WHERE COMPCODE =" & GCompCode & " AND POSTSETTLE ='Y' "
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not TRec.EOF Then LSettlePost = True
    
    LBSaudas = Trim(LBSaudas):              LBExCodes = Trim(LBExCodes):            LBParties = Trim(LBParties):
    
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    mysql = " SELECT TOP 1 COMPCODE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONDATE >='" & Format(LBPFromDate, "YYYY/MM/DD") & "' AND INVNO <> 0 "
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        Chk_Invoice = True
    Else
        Chk_Invoice = False
    End If
    
    '''Party Rate ujjwal
    LBidAsk = False
    Lpartyrate = False
    
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    mysql = " SELECT BILLBY FROM ACCT_EX WHERE COMPCODE =" & GCompCode & " AND BILLBY= 'B' "
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then LBidAsk = True
    If LBidAsk = False Then
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        mysql = " SELECT BILLBY FROM ACCT_EX WHERE COMPCODE =" & GCompCode & " AND BILLBY= 'P' "
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then Lpartyrate = True
   End If
    
    LFromDate = LBFromDate
    LLastBillDate = LFromDate
    DoEvents
    GETMAIN.Label1.Caption = " Starting Bill Generation......."
    LMinInvdDate = Date
    
    Call Delete_Inv_D(LBParties, LBExCodes, LBSaudas, LBFromDate)
    
    LBParties = GBillParties
    
    LBFromDate = GMinBillDate
    If GOnlyBrok = 0 Then
        mysql = "DELETE FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_DT  >='" & Format(LBFromDate, "yyyy/mm/dd") & "'"
        mysql = mysql & "AND VOU_TYPE='S' AND VOU_NO LIKE 'STMP%' AND INVNO = 0"
        If LenB(LBExCodes) > 0 Then mysql = mysql & " AND EXID IN ( " & LBExCodes & ")"
        'If LenB(LBParties) > 0 Then MYSQL = MYSQL & " AND NARRATION  IN (" & LBParties & ")"
        Cnn.Execute mysql
    End If
    
    'Stop Billing For Particular SAuda
   'LBSaudas = ""

    mysql = "SELECT DISTINCT AD.ACCID,AD.AC_CODE,AD.NAME,AD.PARTYTYPE,AD.SRTAXAPP,AD.CTTTYPE,AD.RISKMTYPE,AD.APPLYON,AD.CGST,AD.SGST,AD.BCYCLE,"
    mysql = mysql & " AD.IGST,AD.UTT,AD.OPTCUTBROK,AD.FUTCUTBROK,SU.SAUDAID FROM ACCOUNTD AS AD,CTR_D AS CD ,SAUDAMAST AS SU "
    mysql = mysql & " WHERE AD.COMPCODE= " & GCompCode & " AND AD.ACCID = CD.ACCID  "
    mysql = mysql & " AND SU.MATURITY>='" & Format(LBFromDate, "YYYY/MM/DD") & "' AND SU.SAUDAID =CD.SAUDAID "
    If LenB(LBSaudas) <> 0 Then mysql = mysql & " AND CD.SAUDAID IN (" & LBSaudas & ") "
    If LenB(LBExCodes) <> 0 Then mysql = mysql & " AND CD.EXID IN(" & LBExCodes & ") "
    If LenB(LBParties) <> 0 Then mysql = mysql & " AND CD.PARTY IN (" & LBParties & ") "
    mysql = mysql & " ORDER BY AD.AC_CODE,SU.SAUDAID "
    Set PartyRec = Nothing:    Set PartyRec = New ADODB.Recordset
    PartyRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If PartyRec.EOF Then
        BILL_GENERATION = True
       ' Exit Function
    End If

    '-Party Loop
    'Exchange Records
    mysql = "SELECT I.ITEMID,EX.EXID,S.SAUDAID ,S.SAUDACODE,S.MATURITY,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,I.RISKMAPP,I.ITEMCODE, I.LOT,S.TRADEABLELOT,S.BROKLOT, EX.EXID,EX.EXCODE,I.SCGROUP,S.REFLOT,EX.EXCODE,"
    mysql = mysql & " EX.LOTWISE,EX.TRADINGACC,EX.STANDAC,EX.BROKAC,EX.BANKACC,EX.TRANTAX,EX.STCACC,EX.ROUNDACC,EX.SRVTAXACC,EX.SDUTYTAXACC,EX.RISKMACC,"
    mysql = mysql & " EX.SBCACC,EX.TRANAC,EX.CGSTACC,EX.SGSTACC,EX.IGSTACC,EX.UTTACC,EX.SHREEAC FROM SAUDAMAST AS S, ITEMMAST AS I,EXMAST AS EX "
    mysql = mysql & " WHERE EX.COMPCODE =" & GCompCode & " AND EX.EXID =I.EXID AND S.ITEMID = I.ITEMID "
    mysql = mysql & " AND S.MATURITY>='" & Format(LBFromDate, "YYYY/MM/DD") & "'"
    If LenB(LBSaudas) > 0 Then mysql = mysql & " AND S.SAUDAID IN (" & LBSaudas & ")"
    If LenB(LBExCodes) > 0 Then mysql = mysql & " AND EX.EXID IN(" & LBExCodes & ")"
    mysql = mysql & " ORDER BY S.SAUDACODE "
    Set SaudaRec = Nothing: Set SaudaRec = New ADODB.Recordset:
    SaudaRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
    If SaudaRec.EOF Then
        '>>>  - 17 JAN 2021 -- Bhavcopy download if not exists -- STARTUK
        If Not FlagLoggedIn Then
            MsgBox "No Contracts Exists"
        End If
        '>>>  - 17 JAN 2021 -- Bhavcopy download if not exists -- ENDUK
        GETMAIN.Label1.Caption = "Bill Generation Complete"
        BILL_GENERATION = True
        Exit Function
    End If
    
    'Rate Records
    GMaxVouNo = Val(Right$(Get_VouNo("SETL", GFinYear), 7))
    
    GETMAIN.ProgressBar1.Visible = True
    GETMAIN.ProgressBar1.Max = PartyRec.RecordCount + 1
    GETMAIN.ProgressBar1.Value = 0
    mysql = "SELECT DISTINCT EXID,EXCODE,CONDATE FROM CTR_M WHERE COMPCODE=" & GCompCode & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' "
    If LenB(LBSaudas) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSaudas & ")"
    If LenB(LBExCodes) <> 0 Then mysql = mysql & " AND EXID IN (" & LBExCodes & ")"
    mysql = mysql & " ORDER BY CONDATE "
    Set DateRec = Nothing
    Set DateRec = New ADODB.Recordset
    DateRec.Open mysql, Cnn, adOpenStatic, adLockOptimistic
    
    GMBillNo = Get_MaxBillNo + 1
    
    Do While Not PartyRec.EOF
        LBillBy = "S":        LBilling = True:        LTQty = 0
        LBFromDate = LFromDate:                                                 LPartyCode = PartyRec!AC_CODE:
        LGAccID = PartyRec!ACCID
        
        mbcycle = PartyRec!BCYCLE
        If LenB(LBillParties) < 1 Then
            LBillParties = "'" & LPartyCode & "'"
        Else
            If InStr(LBillParties, "'" & LPartyCode & "'") = 0 Then
                LBillParties = LBillParties & ",'" & LPartyCode & "'"
            End If
        End If

        LPartyName = PartyRec!NAME:
        GSrTaxApp = IIf(IsNull(PartyRec!SRTAXAPP), "1", PartyRec!SRTAXAPP):     GCTTType = IIf(IsNull(PartyRec!CTTTYPE), "N", PartyRec!CTTTYPE)
        GRiskMType = IIf(IsNull(PartyRec!RISKMTYPE), "N", PartyRec!RISKMTYPE):  LBApplycOn = IIf(IsNull(PartyRec!APPLYON), "N", PartyRec!APPLYON)
        LPartyType = IIf(IsNull(PartyRec!PARTYTYPE), 1, PartyRec!PARTYTYPE):    GCGSTType = IIf(IsNull(PartyRec!CGST), "N", PartyRec!CGST):
        GSGSTType = IIf(IsNull(PartyRec!SGST), "N", PartyRec!SGST):             GIGSTType = IIf(IsNull(PartyRec!IGST), "N", PartyRec!IGST)
        GUTTType = IIf(IsNull(PartyRec!UTT), "N", PartyRec!UTT):                GOptCutBrok = IIf(IsNull(PartyRec!OptCutBrok), "1", PartyRec!OptCutBrok)
        GFutCutBrok = IIf(IsNull(PartyRec!FUTCutBrok), "1", PartyRec!FUTCutBrok): LSaudaID = PartyRec!SAUDAID
        
        LPostCode = LPartyCode
        If LSettlePost = True Then
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            mysql = "SELECT A.FMLYHEAD FROM ACCFMLY AS A, ACCFMLYD AS B  WHERE  A.POSTSETTLE ='Y' "
            mysql = mysql & " AND B.ACCID =" & LGAccID & ""
            TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
            If Not TRec.EOF Then LPostCode = TRec!FMLYHEAD
        End If
            
        GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
        Call PERCENTAGE(GETMAIN.ProgressBar1.Max, GETMAIN.ProgressBar1.Value)
        GETMAIN.Label1.Caption = LPartyName & " of " & LSaudaCode & " "
        DoEvents
        SaudaRec.Filter = adFilterNone
        SaudaRec.MoveFirst
        SaudaRec.Find "SaudaID =" & LSaudaID & " ", , adSearchForward
        If Not SaudaRec.EOF Then
            LSaudaCode = SaudaRec!saudacode
            LBmaturity = SaudaRec!MATURITY:                         LBItemCode = SaudaRec!ITEMCODE
            GCalVal = SaudaRec!lot:                                 GBrokLot = IIf(IsNull(SaudaRec!BROKLOT), 1, SaudaRec!BROKLOT)
            GRiskMapp = SaudaRec!RISKMAPP:                          GSTDAc = SaudaRec!standac & vbNullString
            GShree = SaudaRec!shreeac & vbNullString:               GTrading = SaudaRec!TRADINGACC & vbNullString
            GBrokrage = SaudaRec!BROKAC & vbNullString:             GTrFeesAc = SaudaRec!tranac & vbNullString
            GNBOTBank = SaudaRec!BANKACC & vbNullString:            GRoundAcc = SaudaRec!ROUNDACC & vbNullString
            GSTaxAcc = SaudaRec!SrvTaxACC & vbNullString:           GStampAcc = SaudaRec!SDutyTaxAcc & vbNullString
            GCTTAcc = SaudaRec!TRANTAX & vbNullString:              GRiskMAcc = SaudaRec!RISKMACC & vbNullString
            GSEBITaxAcc = SaudaRec!STCACC & vbNullString:           GSBCAcc = SaudaRec!SBCACC & vbNullString
            LExchangeCode = SaudaRec!excode:                        LSDInstType = SaudaRec!INSTTYPE
            LSDSTrike = SaudaRec!STRIKEPRICE:                       GTradeableLot = SaudaRec!TRADEABLELOT
            GCGSTAcc = SaudaRec!CGSTACC & vbNullString:             GSGSTAcc = SaudaRec!SGSTACC & vbNullString
            GIGSTAcc = SaudaRec!IGSTACC & vbNullString:             GUTTAcc = SaudaRec!UTTACC & vbNullString
            LExID = SaudaRec!EXID:                                  LSDOptType = SaudaRec!OPTTYPE
            LItemID = SaudaRec!itemid:                              LRefLot = SaudaRec!REFLOT
            LExCode = SaudaRec!excode
            GScGroup = IIf(IsNull(SaudaRec!SCGROUP), "X", SaudaRec!SCGROUP)
            If LenB(LBillExIds) < 1 Then
                LBillExIds = CStr(LExID)
            Else
                If InStr(LBillExIds, LExID) = 0 Then
                    LBillExIds = LBillExIds & "," & LExID & ""
                End If
            End If
            If SaudaRec!LOTWISE = "Y" Then If LExchangeCode = "NSE" Or LExchangeCode = "MCX" Then GCalVal = Val(IIf(IsNull(SaudaRec!TRADEABLELOT), 0, SaudaRec!TRADEABLELOT)) & ""
        Else
            MsgBox "Invalid Sauda in Trades Pls contact Support Staff"
            If CNNERR = True Then Cnn.RollbackTrans
            Exit Function
        End If
        LOPattan = "N"
        LMaxCondate = LBmaturity
        
        ''' Party Rate ujjwal
        If LBidAsk = True Or Lpartyrate = True Then
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            mysql = "SELECT BILLBY FROM ACCT_EX WHERE ACCID =" & LGAccID & " AND EXID =" & LExID & ""
            TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
            If Not TRec.EOF Then LBillBy = TRec!billby
        End If

        'LTQty = Get_CloseQty(LPartyCode, LSaudaID, CDate(LBMaturity))
        If LMaxCondate = LBmaturity Then
            LMdate = Get_MaxCondate_CTRM(LSaudaID, CDate(LMaxCondate))
            If LenB(LMdate) <> 0 Then LMaxCondate = DateValue(LMdate)
        End If
        If Chk_Invoice = True Then
            mysql = "SELECT MAX(STDATE) AS SDATE FROM INV_D WHERE  ACCID  =" & LGAccID & " AND SAUDAID =" & LSaudaID & " AND INVNO <>0 "
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                If Not IsNull(TRec!SDATE) Then LBFromDate = TRec!SDATE + 1
            End If
            Set TRec = Nothing
        End If
        LMdate = Get_MinCondate(LGAccID, LSaudaID, LBmaturity)
        
        If LenB(LMdate) <> 0 Then

            '''
            If LExCode = "CMX" And mbcycle = "S" Then
                mysql = "SELECT MAX(STDATE) AS SDATE FROM INV_D WHERE  ACCID  =" & LGAccID & " AND SAUDAID =" & LSaudaID & ""
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    If Not IsNull(TRec!SDATE) Then LBFromDate = TRec!SDATE + 1
                End If
                Set TRec = Nothing
           End If
            
            LPMinDate = DateValue(LMdate)
            LMinCondate = LPMinDate
            If LMinCondate > LBFromDate Then LBFromDate = LMinCondate
            If LMinInvdDate > LBFromDate Then
                LMinInvdDate = LBFromDate
            End If
            
            If LExCode = "CMX" And mbcycle = "S" Then
                DateRec.Filter = adFilterNone
                DateRec.Filter = "EXID=" & LExID & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(LMaxCondate, "YYYY/MM/DD") & "'"
                If Not DateRec.EOF Then
                    DateRec.MoveFirst
                    Do While Not DateRec.EOF
                        If DateRec!Condate = LBmaturity Then
                            FlagMaturity = True
                        Else
                            FlagMaturity = False
                        End If
                        LCloseRate = 0
                        'If LBillCloseQty <> 0 Then
                            LCloseRate = SDCLRATE(LSaudaID, DateRec!Condate, "C")
                            If SDBILL(LPartyCode, LPartyName, LSaudaCode, DateRec!Condate, CStr(IIf(IsNull(PartyRec!PARTYTYPE), "1", PartyRec!PARTYTYPE)), LBItemCode, Val(LCloseRate), LExchangeCode, LBApplycOn, LPostCode, LBillBy, LSaudaID, LOPattan, LExID, LItemID, LRefLot, LGAccID) Then
                            Else
                                Exit Function
                            End If
                       ' End If
                        If DateRec.EOF Then Exit Do
                        DateRec.MoveNext
                    Loop
              End If
            Else
                DateRec.Filter = adFilterNone
                DateRec.Filter = "EXID=" & LExID & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(LMaxCondate, "YYYY/MM/DD") & "'"
                If Not DateRec.EOF Then
                    DateRec.MoveFirst
                
                    LBillCloseQty = Get_CloseQty(LGAccID, LSaudaID, DateRec!Condate)
                    Do While Not DateRec.EOF
                        If DateRec!Condate = LBmaturity Then
                            FlagMaturity = True
                        Else
                            FlagMaturity = False
                        End If
                        LCloseRate = 0
                        LCloseRate = SDCLRATE(LSaudaID, DateRec!Condate, "C")
                        If SDBILL(LPartyCode, LPartyName, LSaudaCode, DateRec!Condate, CStr(IIf(IsNull(PartyRec!PARTYTYPE), "1", PartyRec!PARTYTYPE)), LBItemCode, Val(LCloseRate), LExchangeCode, LBApplycOn, LPostCode, LBillBy, LSaudaID, LOPattan, LExID, LItemID, LRefLot, LGAccID) Then
                        Else
                            Exit Function
                        End If
                        If DateRec.EOF Then Exit Do
                        DateRec.MoveNext
                    Loop
               End If
            End If
        End If
        
LFlag_Next_Party:
        PartyRec.MoveNext
    Loop
    
    GETMAIN.ProgressBar1.Visible = False
    If LBilling = True Then
        If GDailyBill = False Then
            Call Post_Inv_d5(GBillParties, LBSaudas, GExIDs, GMinBillDate)
        Else
            Call Post_Inv_d(GBillParties, LBSaudas, GExIDs, GMinBillDate)
        End If
    End If
    Set PartyRec = Nothing
    If LBilling = True Then
        GETMAIN.PERLBL.Caption = vbNullString
        If GOnlyBrok = 0 Then
            Dim LACCID     As Long
            Dim LStmAccID As Long
            DoEvents
            GETMAIN.Label1.Caption = "Updateing Stamp Duty "
            mysql = "SELECT DISTINCT AD.ACCID,AD.AC_CODE ,A.STDATE,EX.EXID,EX.EXCODE,EX.SDutyTaxACC "
            mysql = mysql & " FROM INV_D AS A, SAUDAMAST AS S,ACCOUNTD AS AD,EXMAST AS EX WHERE AD.COMPCODE =" & GCompCode & ""
            mysql = mysql & " AND  EX.EXID =A.EXID "
            mysql = mysql & " AND A.ACCID=AD.ACCID AND AD.APPLYON IN('R','P') AND A.SAUDAID=S.SAUDAID  AND A.INVNO=0 "
            mysql = mysql & " AND A.STDATE >='" & Format(LBPFromDate, "YYYY/MM/DD") & "' AND A.STDATE<='" & Format(LBToDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND A.STDATE >='" & Format(GSTMDate, "yyyy/mm/dd") & "'"
            mysql = mysql & " AND A.STDATE <'" & Format(LStampDutyDate, "yyyy/mm/dd") & "'"
            If LenB(LBExCodes) <> 0 Then mysql = mysql & " AND EX.EXID  IN (" & LBExCodes & ") "
            If LenB(LBParties) <> 0 Then mysql = mysql & " AND AD.AC_CODE IN (" & LBParties & ") "
            mysql = mysql & " ORDER BY AD.AC_CODE ,A.STDATE,EX.EXCODE "
            Set PartyRec = Nothing
            Set PartyRec = New ADODB.Recordset
            PartyRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            Do While Not PartyRec.EOF
                LPartyAc = PartyRec!AC_CODE
                LACCID = PartyRec!ACCID
                LStmpAmt = 0
                LExID = PartyRec!EXID
                LStmpAmt = Calc_StampDuty(PartyRec!STDATE, LACCID, LExID)
                If LStmpAmt <> 0 Then
                    LStmAc = PartyRec!SDutyTaxAcc
                    LStmAccID = Get_AccID(LStmAc)
                    LBillNo = 0
                    VchNo = Get_VouNo("STMP", GFinYear)
                    LMVNo = PInsert_Voucher(VchNo, DateValue(PartyRec!STDATE), "S", "P", 0, "ADD", PartyRec!excode, 0, LPartyAc, PartyRec!excode, "0", LExID, 0)
                    LNarration = "StampDuty Charges for " & PartyRec!excode & ""
                    mysql = " EXEC UPDATE_INV_D_STAMPAMT '" & Format(PartyRec!STDATE, "YYYY/MM/DD") & "'," & LACCID & "," & PartyRec!EXID & "," & LStmpAmt & ",'" & VchNo & "'"
                    Cnn.Execute mysql
                    If LStmpAmt <> 0 Then
                        If LStmpAmt < 0 Then
                            MDR = "D": MCR = "C"
                        Else
                            MDR = "C": MCR = "D"
                        End If
                        Call PInsert_Vchamt(VchNo, "S", PartyRec!STDATE, MDR, LPartyAc, Abs(LStmpAmt), vbNullString, PartyRec!STDATE, LNarration, vbNullString, PartyRec!excode, 0, PartyRec!excode, LMVNo, LExID, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "S", PartyRec!STDATE, MCR, LStmAc, Abs(LStmpAmt), vbNullString, PartyRec!STDATE, LNarration, vbNullString, PartyRec!excode, 0, PartyRec!excode, LMVNo, LExID, 0, LStmAccID)
                    End If
                End If
                PartyRec.MoveNext
            Loop
        End If
        Set PartyRec = Nothing
    
        mysql = "EXEC UPD_INV_D_SETNO " & GCompCode & ",'" & Format(LBFromDate, "YYYY/MM/DD") & "',0"
        Cnn.Execute mysql
        GETMAIN.Label1.Caption = "Updateing Settlement "
        DoEvents
        mysql = "SELECT DISTINCT STDATE FROM INV_D WHERE COMPCODE = " & GCompCode & " AND STDATE>='" & Format(LBPFromDate, "YYYY/MM/DD") & "' ORDER BY STDATE"
        Set DateRec = Nothing
        Set DateRec = New ADODB.Recordset
        DateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not DateRec.EOF Then MSetNo = Get_MaxSetNo()
        Do While Not DateRec.EOF
            MSetNo = MSetNo + 1
            mysql = "EXEC UPD_INV_D_SETNO " & GCompCode & ",'" & Format(DateRec!STDATE, "YYYY/MM/DD") & "'," & MSetNo & ""
            Cnn.Execute mysql
            DateRec.MoveNext
        Loop
        GETMAIN.Label1.Caption = "Settlement updated "
        DoEvents
        Set DateRec = Nothing
    End If
    GETMAIN.Label1.Caption = "Bill Generation Complete"
    BILL_GENERATION = True
    Exit Function
err1: If err.Number <> 0 Then

          MsgBox err.Description
         Cnn.RollbackTrans
       End If
End Function
Sub PERMISSIONS(MENUNAME As String) ''''THIS ROUTINE IS CALLED FROM THE PAINT EVENT OF EVERY FORM
    On Error GoTo Error1
    Dim TRec As ADODB.Recordset
    mysql = "SELECT * FROM USER_RIGHTS WHERE USER_NAME='" & GUserName & "' AND MENUNAME='" & MENUNAME & "'"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not TRec.EOF Then
        AddPerm = TRec!M_ADDITION: ModiPerm = TRec!M_MODIFICATION: DelPerm = TRec!M_DELETION: PrintPerm = TRec!M_PRINT
    Else
        AddPerm = True: ModiPerm = True: DelPerm = True: PrintPerm = True
    End If
    Set TRec = Nothing
Error1:    If err.Number <> 0 Then
            MsgBox "Permissions - " & err.Description
    End If
End Sub
Sub Menu_Check(Menu_Name As String, Optional Group As String)
    Dim TRec As ADODB.Recordset
    Dim LADD As Boolean
    LADD = False
    If Not ADOUser.EOF Then ADOUser.MoveFirst
    With ADOUser
        If Not ADOUser.EOF Then .MoveFirst
        .Find "MENUNAME='" & Menu_Name & "'", , adSearchForward
        If .EOF Then
            mysql = "INSERT INTO USER_RIGHTS (USER_NAME,MENUNAME,SW,M_PRINT,M_VISIBLE,M_ADDITION,M_DELETION,M_MODIFICATION)"
            mysql = mysql & " VALUES ('" & GUserName & "','" & Menu_Name & "','SBOT',1,1,1,1,1)"
            Cnn.Execute mysql
            LADD = True
        End If
    End With
    If LADD = True Then
        Set ADOUser = Nothing
        Set ADOUser = New ADODB.Recordset
        mysql = "SELECT * FROM USER_RIGHTS WHERE USER_NAME='" & GUserName & "'"
        ADOUser.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    End If
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open "SELECT * FROM USER_MENU WHERE MENUNAME='" & Menu_Name & "'", Cnn, adOpenForwardOnly, adLockReadOnly
    If TRec.EOF Then
        mysql = "INSERT INTO USER_MENU(MENUNAME, SW, GROUP_MENU) VALUES('" & Menu_Name & "','" & SW & "','" & Group & "')"
        Cnn.Execute mysql
    End If
    Set TRec = Nothing
End Sub
Sub LogIn()
    Dim TRec As ADODB.Recordset
    If InvGen = False Then
        mysql = "UPDATE USER_RIGHTS SET M_VISIBLE=0 WHERE (MENUNAME= 'MENUINVGEN' OR  MENUNAME='mnuinvset' or  MENUNAME='mnuINVLIST')"
        Cnn.Execute mysql
    End If
    On Error GoTo err1
    
    mysql = "SELECT M_VISIBLE, MENUNAME FROM USER_RIGHTS WHERE USER_NAME='" & GUserName & "' ORDER BY MENUNAME"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockBatchOptimistic
    If Not TRec.EOF Then
        Do While Not TRec.EOF
            GETMAIN.Controls(TRec!MENUNAME).Visible = TRec!M_VISIBLE
            TRec.MoveNext
        Loop
    End If
    Set TRec = Nothing
        
    Dim tempGCtrType As String
    tempGCtrType = ";" + GCtrType + ";"
           
    GETMAIN.CONTRACTENTRY.Visible = False
    GETMAIN.CONTRACTENTRY7.Visible = False
    If (InStr(1, tempGCtrType, ";1;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (1)"
    End If
    If (InStr(1, tempGCtrType, ";2;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (2)"
    End If
    If (InStr(1, tempGCtrType, ";3;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (3)"
    End If
    If (InStr(1, tempGCtrType, ";4;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (4)"
    End If
    If (InStr(1, tempGCtrType, ";5;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (5)"
    End If
    If (InStr(1, tempGCtrType, ";6;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (6)"
    End If
    If InStr(1, tempGCtrType, ";7;") > 0 Then
        GETMAIN.CONTRACTENTRY7.Visible = True
    End If
        
    Exit Sub
err1:
    If err.Number = Val(730) Then   ''IF CONTROL NOT FOUND @ MDIFORM
        TRec.Delete
        TRec.MoveNext
        If TRec.EOF Then TRec.MoveLast
    ElseIf err.Number = Val(387) Then ''IF MAIN NODE GETTING VISIBLE TRUE/FALSE
        Resume Next
    Else
        MsgBox err.Description, vbCritical, err.HelpFile
    End If
End Sub
Sub CompanySelection(LCompCode As Integer)
    Dim MRec1 As ADODB.Recordset:    Dim MLRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset:    Dim CnnString As String
    GCompanyName = vbNullString: Set TRec = Nothing: Set TRec = New ADODB.Recordset
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString
    
    Dim TABLE_NAME  As String
    
    
    If MCnn.State = 0 Then ' 0=closed
        Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
        MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
        MCnn.Open
    End If
    
    TRec.Open "SELECT * FROM COMPANY WHERE COMPCODE=" & LCompCode & "", Cnn, adOpenKeyset, adLockReadOnly
    If Not TRec.EOF Then
        With TRec
            GCompCode = LCompCode
            TABLE_NAME = "SYSCOMP"
            mysql = "SELECT * FROM dbo.sysobjects WHERE ID = object_id(N'[dbo].[" & TABLE_NAME & "]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1"
            Set MLRec = Nothing: Set MLRec = New ADODB.Recordset
            MLRec.Open mysql, MCnn, adOpenForwardOnly, adLockReadOnly
            If Not MLRec.EOF Then
                mysql = "SELECT * FROM SYSCOMP WHERE DATABASENAME='" & GDatabaseName & "' AND COMPCODE=" & GCompCode & ""
                Set MLRec = Nothing
                Set MLRec = New ADODB.Recordset
                MLRec.Open mysql, MCnn, adOpenStatic, adLockReadOnly
                If Not MLRec.EOF Then
                    GFinBegin = IIf(IsNull(MLRec!finbegin), Date, MLRec!finbegin)
                    MFinBeg = Right$(CStr(MLRec!finbegin), 2)
                    GFinEnd = MLRec!finend
                    MFinEnd = Right$(CStr(MLRec!finend), 2)
                    GReportPath = DecryptNEW(MLRec!Rpt_Path, 13)
                    GBackPath = DecryptNEW(MLRec!D_PATH, 13)
                    GSysLockDt = MLRec!SYSLOCKDT
                Else
                    GFinBegin = IIf(IsNull(!finbegin), GFinBegin, !finbegin)
                    GFinEnd = IIf(IsNull(!finend), GFinEnd, !finend)
                    GReportPath = (!Rpt_Path & vbNullString)
                    GBackPath = (!DPATH & vbNullString)
                    GSysLockDt = IIf(IsNull(!SYSLOCKDT), GFinBegin, !SYSLOCKDT)
                End If
            Else
                GFinBegin = !finbegin
                MFinBeg = Right$(CStr(!finbegin), 2)
                GFinEnd = !finend
                MFinEnd = Right$(CStr(!finend), 2)
                GReportPath = !Rpt_Path
                GBackPath = !DPATH
                GSysLockDt = !SYSLOCKDT
            End If
            If GHDNO = LHDNo Then '>>> set report path on home system
                GReportPath = "D:\reports\"
            End If
            
            Set MLRec = Nothing
            GCompanyName = !NAME
            GETMAIN.Caption = GCompanyName
            GCompanyAdd1 = (!ADD1 & vbNullString):                        GCompanyAdd2 = vbNullString
            GCCity = (!City & vbNullString):                              GState = (!State & vbNullString)
            GCompPhoneO = (!PhoneO & vbNullString):                       GUniqClientId = (!UNIQCLIENTID & vbNullString)
            GCompPhoneR = (!PhoneR & vbNullString):                       GCompMobile = (!Mobile & vbNullString)
            GEmail = (!Email & vbNullString):                             GFax = (!Fax & vbNullString)
            GGSTIN = (!GSTIN & vbNullString):                             GPANNo = (!PANNO & vbNullString):
            GSrvRegNo = (!Regno1 & vbNullString):
            GShowLot = !showlot: GShowLotEntry = !showlotentry:                     GAppSpread = IIf(IsNull(!APPSPREAD), "N", !APPSPREAD)
            GBrBrok = IIf(IsNull(!BrBrok), "N", !BrBrok):
            GDailyBill = !BILLINGCYCLE
            GSEBIRegNo = !SEBIREGNO & vbNullString:
            GShowStd = !SHOWSTD
            GSTMDate = !STMDT:
            GAcOrder = IIf(IsNull(!ACORDER), "C", !ACORDER):              GAutoBrok = IIf(IsNull(!autobrok), "0", !autobrok)
            GSrStdYN = IIf(IsNull(!SHARE), "N", !SHARE):
            FlagDataImport = !FlagDataImport
            FlagDataBackup = !FlagDataBackup
            gcurrtype = !CURRTYPE
            Ginttype = !INTTYPE
            GEXECODE = !ECODE
            Gintt1 = !INTT1
            Gautoupdlot = !AUTOUPDLOT
            
            FlagLiveRate = !FlagLiveRate
            
            GStSrvDate = DateValue("2008/01/01")
            GRoundOff = IIf(!ROUNDOFF = 1, "Y", "N"):
            GSetInvNo = IIf(IsNull(!SETINVNO), "S", !SETINVNO):
            GAppCnote = IIf(IsNull(!APPCNOTE), "0", !APPCNOTE):           GCheckRt = IIf(IsNull(!CHECKRT), "N", !CHECKRT)
            GMinBrok = IIf(IsNull(!MINBROK), "0", !MINBROK):
            GCtrType = !CTRTYPE:
            
            GSrvTaxYN = IIf(IsNull(!SRVTAX), "N", !SRVTAX):               GTranFeesYN = IIf(IsNull(!TRANFEES), "N", !TRANFEES)
            GStampDutyYN = IIf(IsNull(!STAMPDUTY), "N", !STAMPDUTY):      GSTTYN = IIf(IsNull(!STT), "N", !STT)
            GSubBrokYN = IIf(IsNull(!SUBBROK), "N", !SUBBROK):            GValueWiseYN = IIf(IsNull(!VALUEWISE), "N", !VALUEWISE)
            GMinBrokYN = IIf(IsNull(!MINBROKYN), "N", !MINBROKYN):        GOrderEntryYN = "N": GVoucherFormat = IIf(IsNull(!OrderEntry), "N", !OrderEntry):
            GStandingYN = IIf(IsNull(!standing), "N", !standing):         GMarginYN = IIf(IsNull(!MARGIN), "N", !MARGIN)
            GEqBill = IIf(IsNull(!EQ), False, IIf(!EQ = 0, False, True)): GGenQuery = IIf(IsNull(!GENQUERY), "1", !GENQUERY)
            InvGen = IIf(IsNull(!INVOICE), 1, !INVOICE):
            MAdd1 = !ADD1 & vbNullString:                                 GCCity = !City & vbNullString
            GFinYear = Right$(GFinBegin, 2) & Right$(GFinEnd, 2):         GAcCodeType = IIf(IsNull(!PARTYCODETYPE), "A", !PARTYCODETYPE)
            MNarr = True
            GAmtDivide = !AMTDIVIDE
            GQty_Decimal = !QTY_DECIMAL
            GOnlyBrok = !ONLYBROK
            GConNoType = !CONNOTYPE
            GETMAIN.SLE05.Visible = InvGen
            
            mysql = "SELECT * FROM SYSTNO WHERE CUSTID='" & GUniqClientId & "'"
            Set MRec1 = Nothing
            Set MRec1 = New ADODB.Recordset
            MRec1.Open mysql, MCnn, adOpenStatic, adLockReadOnly
            If Not MRec1.EOF Then GTillDate = MRec1!TDATE
            Set MRec1 = Nothing
            GETMAIN.TRANS.Enabled = True: GETMAIN.Report.Enabled = True: GETMAIN.master.Enabled = True: GETMAIN.Database.Enabled = True: GETMAIN.utilities.Enabled = True
            Call LogIn
            
            
        End With
    End If
    Set TRec = Nothing
    If FlagVerAdj Then
        Cnn.Execute "INSERT INTO SELCOMP (COMPCODE ) VALUES (" & GCompCode & ")"
    Else
        Cnn.Execute "UPDATE SELCOMP SET  COMPCODE = " & GCompCode & ""
    End If
    GETMAIN.mnuptyclose.Visible = True
    
    Dim tempGCtrType As String
    tempGCtrType = ";" + GCtrType + ";"
           
    GETMAIN.CONTRACTENTRY.Visible = False
    GETMAIN.CONTRACTENTRY7.Visible = False
    If (InStr(1, tempGCtrType, ";1;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (1)"
    End If
    If (InStr(1, tempGCtrType, ";2;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (2)"
    End If
    If (InStr(1, tempGCtrType, ";3;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (3)"
    End If
    If (InStr(1, tempGCtrType, ";4;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (4)"
    End If
    If (InStr(1, tempGCtrType, ";5;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (5)"
    End If
    If (InStr(1, tempGCtrType, ";6;") > 0) Then
        GETMAIN.CONTRACTENTRY.Visible = True
        GETMAIN.CONTRACTENTRY.Caption = "&Contract Entry (6)"
    End If
    If InStr(1, tempGCtrType, ";7;") > 0 Then
        GETMAIN.CONTRACTENTRY7.Visible = True
    End If
            
    MenuOptfrm.Command2.Visible = False
    MenuOptfrm.Command23.Visible = False
        
    If (InStr(1, tempGCtrType, ";1;") > 0) Or (InStr(1, tempGCtrType, ";2;") > 0) Or (InStr(1, tempGCtrType, ";3;") > 0) Or (InStr(1, tempGCtrType, ";4;") > 0) Or (InStr(1, tempGCtrType, ";5;") > 0) Or (InStr(1, tempGCtrType, ";6;") > 0) Then
        MenuOptfrm.Command2.Visible = True
        MenuOptfrm.Command2.Height = 720
    End If
    If InStr(1, tempGCtrType, ";7;") > 0 Then
        If MenuOptfrm.Command2.Visible Then
            MenuOptfrm.Command2.Height = 360
            MenuOptfrm.Command23.Visible = True
            MenuOptfrm.Command23.Height = 360
            If MenuOptfrm.Command2.Visible Then
                MenuOptfrm.Command23.Top = 1815
            Else
                MenuOptfrm.Command23.Top = 1440
            End If
                
            MenuOptfrm.Command23.Caption = "Contract Entry (7)"
        Else
            MenuOptfrm.Command23.Visible = True
            MenuOptfrm.Command23.Height = 720
            If MenuOptfrm.Command2.Visible Then
                MenuOptfrm.Command23.Top = 1815
            Else
                MenuOptfrm.Command23.Top = 1440
            End If
            MenuOptfrm.Command23.Caption = "Contract Entry (7)"
        End If
    End If
    If (MenuOptfrm.Command2.Visible) And (Not MenuOptfrm.Command23.Visible) Then
        MenuOptfrm.Command2.FontSize = 12
    ElseIf (Not MenuOptfrm.Command2.Visible) And (MenuOptfrm.Command23.Visible) Then
        MenuOptfrm.Command23.FontSize = 12
    End If
    MenuOptfrm.Show
End Sub

Public Function NewParty(ByVal LPExCode As String, ByVal LPAcExCode As String, ByVal LPPartyName As String, ByVal LUserId As String, ByVal LPNEW As Boolean) As String
Dim TRec As ADODB.Recordset:            Dim TRec2 As ADODB.Recordset:   Dim LExhangeCode As String:             Dim LPAcCode As String:
Dim LExCode As String:                  Dim LDuplicate As Boolean:      Dim LSRYN As String:                    Dim LNo As Integer
Dim LCac_code As String:                Dim LXAc_Code As String:        Dim LExID  As Integer:                  Dim LACCID As Long
   
    LExID = Get_ExID(LPExCode)
    LSRYN = "0"
    LPAcCode = Get_ACCT_EX(LExID, LPAcExCode)
    If LenB(LPAcCode) > 0 Then
        NewParty = LPAcCode
        Exit Function
    Else
        If LPNEW = False Then
            NewParty = vbNullString
            Exit Function
        End If
    End If
    Set TRec = Nothing
    If UCase(GAcCodeType) = "N" Then            ''IF SET PARTYCODE=NUMERIC IN COMPANY SETUP
        mysql = "SELECT MAX(CAST(AC_CODE AS INT)) AS AC_CODE FROM ACCOUNTM WHERE COMPCODE=" & GCompCode & ""
        Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        LPAcCode = Val(TRec!AC_CODE & "") + Val(1)
    Else
        LCac_code = Get_AccountMCode(Left(LPAcExCode, 15))
        If LenB(LCac_code) > 0 Then
            mysql = "SELECT COUNT(*) AS LNO  FROM ACCOUNTM WHERE COMPCODE=" & GCompCode & ""
            Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            LNo = (TRec!LNo & vbNullString)
            LPAcCode = Left$(Trim$(CStr(LNo + 1)), 15)
        Else
            LPAcCode = Left(LPAcExCode, 15)
        End If
        LDuplicate = True
        Do While LDuplicate
            LCac_code = vbNullString
            LCac_code = Get_AccountMCode(Left(LPAcCode, 15))
            If LenB(LCac_code) > 0 Then
                LDuplicate = True
                LNo = LNo + 1
                LPAcCode = Left$(Trim$(CStr(LNo)), 15)
            Else
                LDuplicate = False
            End If
        Loop
    End If
    LCac_code = vbNullString
    LCac_code = Get_AccountMCode(Left(LPAcCode, 15))
            
    If LenB(LCac_code) > 0 Then
       MsgBox "Please Create Account for " & LPAcCode & " Manually as Account Code Already Assigned to " & TRec!NAME & ""
        'ImportIssues (LMsgBox)
        NewParty = vbNullString
       Exit Function
    End If
    Set TRec = Nothing
    LSRYN = "0"
    If Chk_Name_Duplicate(LPPartyName) Then
        MsgBox "Please Create Account For " & LPPartyName & " manually as Name Already Assigned"
        'ImportIssues (LMsgBox)
        NewParty = vbNullString
        Exit Function
    End If
    Call PInsert_AccountM(LPAcCode, LPPartyName, 14, 14, 0, 1, 0)
    mysql = "UPDATE ACCOUNTM SET PTYHEAD =2 WHERE COMPCODE =" & GCompCode & " AND AC_CODE ='" & LPAcCode & "'"
    Cnn.Execute mysql
    
    LACCID = Get_AccID(LPAcCode)
    Call PInsert_Accountd(LPAcCode, 14, LPPartyName, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, "N", "0", "0", _
    vbNullString, vbNullString, "P", 0, "P", 0, 0, "D", "1", "D", vbNullString, 0, "N", Date, "N", 1, "N", "N", 0, vbNullString, "0", "0", "0", "0", "0", vbNullString, vbNullString, "W", "1", "1", "0", 0, 0, "S", LACCID, 0)
    
    mysql = "SELECT DISTINCT EXID ,EXCODE,OPTIONS  FROM EXMAST WHERE COMPCODE =" & GCompCode & " ORDER BY EXCODE "
    Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
    LXAc_Code = vbNullString
    While Not TRec.EOF
        If TRec!excode = "EQ" Or TRec!excode = "BEQ" Then
            Call PInsert_PExBrok(LPAcCode, TRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, DateValue(GFinEnd), "CSH", 0, 0, TRec!EXID, LACCID)
        Else
            If TRec!Options = "Y" Then
                    Call PInsert_PExBrok(LPAcCode, TRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, GFinEnd, "OPT", 0, 0, TRec!EXID, LACCID)
            End If
                Call PInsert_PExBrok(LPAcCode, TRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, GFinEnd, "FUT", 0, 0, TRec!EXID, LACCID)
        End If
        TRec.MoveNext
    Wend
    Set TRec2 = Nothing
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open "SELECT EXCODE,EXID FROM EXMAST WHERE COMPCODE=" & GCompCode & "", Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        Do While Not TRec.EOF
            LExCode = TRec!excode
            Call PINSERT_ACCT_EX(LPAcCode, LExCode, Trim(LPAcExCode), "S", TRec!EXID, LACCID)
            TRec.MoveNext
        Loop
    End If
    Set TRec = Nothing
    NewParty = LPAcCode
End Function
Public Function Chk_Name_Duplicate(LPMPartyName As String) As Boolean
Dim TRec As ADODB.Recordset
Chk_Name_Duplicate = False
Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = "SELECT AC_CODE FROM ACCOUNTM WHERE COMPCODE =" & GCompCode & " AND NAME ='" & LPMPartyName & "'"
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then Chk_Name_Duplicate = True
End Function

Sub UpdateBrokRateType(lbparty As String, LBItemCode As String, LBFromDate As Date, LBToDate As Date, LBSauda As String, LBEXCODE As String)
    'Call ProfStart
    Dim LFromDate As Date:          Dim LToDate As Date:    Dim TRec As ADODB.Recordset
    Dim LAC_CODE As String:         Dim LEndDate  As Date
    On Error GoTo err1
    
    If LenB(LBFromDate) <> 0 Then
        LFromDate = DateValue(LBFromDate)
    Else
        LFromDate = GFinBegin
    End If
    If LenB(LBToDate) <> 0 Then
        LToDate = DateValue(LBToDate)
    Else
        LToDate = GFinEnd
    End If
    Dim TRec1 As ADODB.Recordset

    GETMAIN.Label1.Caption = "Update Brokerage Rate Complete"
Exit Sub
err1:
    If CNNERR = True Then
      MsgBox err.Description, vbCritical, "Error Number : " & err.Number
      Cnn.RollbackTrans
    End If

End Sub
Sub DataBackUp()
    
    Screen.MousePointer = 11
    Dim BkpDevName As String:    Dim DBname As String:    Dim CnnString As String:    Dim MDt As Date
    Dim LTime As String: Dim MRec As ADODB.Recordset: Dim mclietid As String
    GETMAIN.Label1.Caption = " Please Wait Backing Up....."
    MDt = Date
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString
    

    Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
    MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
    MCnn.Open

    mysql = "SELECT DISTINCT UNIQCLIENTID FROM COMPANY WHERE UNIQCLIENTID <> ''"
    Set MRec = Nothing: Set MRec = New ADODB.Recordset
    MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not MRec.EOF Then
        mclietid = Trim(MRec!UNIQCLIENTID)
    End If
    
    BkpDevName = "B" & Left$(CStr(MDt), 2) & Mid(CStr(MDt), 4, 2) & Right$(CStr(MDt), 4)
    LTime = Time
    LTime = Replace(LTime, ":", "_", 1, Len(LTime))
    LTime = Replace(LTime, " ", "_", 1, Len(LTime))
    DBname = Mid(MServer, Val(InStr(MServer, "database")) + 9)
    BkpDevPath = GBackPath & DBname & "-" & BkpDevName & "_" & mclietid & "_" & LTime & ".dat"
    BkpDevPath = InputBox("Please Confirm Backup File", "Backup File", BkpDevPath)
    MCnn.CommandTimeout = 6000
    If LenB(BkpDevPath) <> 0 Then
        mysql = "EXECUTE BkpDATABASE '" & DBname & "','" & BkpDevPath & "'"
        MCnn.Execute mysql
        MsgBox "Data backup at " & BkpDevPath
        Screen.MousePointer = 0
    Else
        MsgBox "Retry"
    End If
    mysql = "EXECUTE LShrinkData '" & DBname & "'"
    MCnn.Execute mysql
    MsgBox "Database Shrunk succesfully "
    Screen.MousePointer = 0
   ' Set MCnn = Nothing
    GETMAIN.Label1.Caption = " Ready"
End Sub
Sub DataBackUp_OnLogOff(showmsg As String)
    On Error GoTo err1
        '>>> DB backup after login 25 Jan 2021
        'Screen.MousePointer = 11
        Dim BkpDevName As String: Dim YBkpDevName As String:    Dim YBkpDevPath As String:   Dim DBname As String:
        Dim CnnString As String:    Dim MDt As Date:   Dim YMDt As Date
        Dim LTime As String: Dim MRec As ADODB.Recordset: Dim mclietid As String
        Dim LFileSystemObject As FileSystemObject
        
        DoEvents
        GETMAIN.Label1.Caption = "Database Backup in progress ...Please Wait"
        DoEvents
        
        
        mysql = "SELECT DISTINCT UNIQCLIENTID FROM COMPANY WHERE UNIQCLIENTID <> ''"
        Set MRec = Nothing: Set MRec = New ADODB.Recordset
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            mclietid = Trim(MRec!UNIQCLIENTID)
        End If

        
        MDt = Date
        YMDt = Date - 1
        
        ServerString = MServer
        ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
            
        CnnString = ServerString
        
        Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
        MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
        MCnn.Open
        
        BkpDevName = "B" & Left$(CStr(MDt), 2) & Mid(CStr(MDt), 4, 2) & Right$(CStr(MDt), 4)
        YBkpDevName = "B" & Left$(CStr(YMDt), 2) & Mid(CStr(YMDt), 4, 2) & Right$(CStr(YMDt), 4)
            
        DBname = Mid(MServer, Val(InStr(MServer, "database")) + 9)
            
        '>>> Create DB backup path, if not exists -- 29 Jan 2021
        Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
        
        If GBackPath = "" Then
            GBackPath = App.Path & "\DB_Backup\"
        End If
        If Not LFileSystemObject.FolderExists(GBackPath) Then
            Dim VFolder As String
            Dim VDrive As String
            Dim VTemp As String
            Dim Vpath As String
            Vpath = ""
            VTemp = GBackPath
            VDrive = Left(VTemp, InStr(1, VTemp, ":") - 1)
            VTemp = Replace(VTemp, VDrive + ":\", "")
            While (InStr(1, VTemp, "\") > 0)
                VFolder = Left(VTemp, InStr(1, VTemp, "\") - 1)
                If Vpath = "" Then
                    Vpath = VDrive + ":\" + VFolder
                Else
                    Vpath = Vpath + "\" + VFolder
                End If
                VTemp = Replace(VTemp, VFolder + "\", "")
                
                If Not LFileSystemObject.FolderExists(Vpath) Then
                    LFileSystemObject.CreateFolder (Vpath)
                End If
            Wend
        End If
            
        BkpDevPath = GBackPath & DBname & "-" & BkpDevName & "_" & mclietid & "_OnLogOff" & ".bak"
        YBkpDevPath = GBackPath & DBname & "-" & YBkpDevName & "_OnLogOff" & ".bak"
        
        If FileExist(YBkpDevPath) Then
            Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
            LFileSystemObject.DeleteFile (YBkpDevPath)
        End If
        
        If FileExist(BkpDevPath) Then
            Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
            LFileSystemObject.DeleteFile (BkpDevPath)
        End If
                       
        MCnn.CommandTimeout = 6000
        
        mysql = "EXECUTE BkpDATABASE '" & DBname & "','" & BkpDevPath & "'"
        MCnn.Execute mysql
    
        mysql = "EXECUTE LShrinkData '" & DBname & "'"
        MCnn.Execute mysql
        
        'Screen.MousePointer = 0
        Set MCnn = Nothing
        'GETMAIN.Label1.Caption = " Ready"
            
err1:
    If err.Number <> 0 Then
        If err.Description = "Path not found" Then
           MsgBox "Database backup : " & err.Description & " - " & Vpath
        ElseIf err.Description = "File not found" Then
            err.Number = 0
        Else
        
            MsgBox "Database backup : " & err.Description
        End If
    Else
        If (showmsg = "Y") Then
            MsgBox "Database backup done. Backup path : " & BkpDevPath
        End If
    End If
End Sub
Sub IntigrityCheck()
    Dim NewRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset:    Dim TRec1 As ADODB.Recordset:    Dim AccRec As ADODB.Recordset
    Dim ExRec As ADODB.Recordset:     Dim MCount As Long:             Dim LLOT As Double:              Dim LLConSno  As Long
    Dim MNo As Integer:               Dim LCompCode As Integer:       Dim LParty As String:         Dim LExCode As String
    Dim LACCID As Long
    
    Cnn.BeginTrans: CNNERR = True
    On Error GoTo err
    DoEvents
    GETMAIN.Label1.Caption = "Insert Menus "
    Call INSERT_MENU
    
    DoEvents
    GETMAIN.Label1.Caption = "Updating SAUDAMAST EXCODE"
    mysql = "UPDATE SAUDAMAST SET EXCODE = (SELECT EXCHANGECODE FROM ITEMMAST  AS I WHERE I.COMPCODE =SAUDAMAST.COMPCODE AND I.ITEMCODE =SAUDAMAST.ITEMCODE) WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    DoEvents
    GETMAIN.Label1.Caption = "Updating SAUDAMAST EXCODE"
    
    mysql = "TRUNCATE TABLE CTR_M"
    Cnn.Execute mysql
    Call Chk_ItemMast
    Call UPDATE_CTR_R
    DoEvents
    GETMAIN.Label1.Caption = "Updating CTR_R Complete"
        
    mysql = "SELECT COMPCODE FROM COMPANY"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    Do While Not TRec.EOF
        LLConSno = 0
        LCompCode = TRec!CompCode
        DoEvents
        GETMAIN.Label1.Caption = "Updating ConSno "
        mysql = "EXEC UPDATE_CTR_DR_CONSNO " & LCompCode & ""
        Cnn.Execute mysql
        mysql = "SELECT DISTINCT C.COMPCODE,C.CONSNO,C.SAUDA,S.SAUDAID,C.CONDATE,C.PATTAN,I.LOT,S.TRADEABLELOT,EX.LOTWISE,EX.EXCODE,EX.EXID ,I.ITEMID ,I.ITEMCODE "
        mysql = mysql & " FROM CTR_D AS C,ITEMMAST AS I,SAUDAMAST AS S,EXMAST AS EX "
        mysql = mysql & " WHERE C.COMPCODE =" & LCompCode & " AND C.COMPCODE =I.COMPCODE AND C.COMPCODE =S.COMPCODE AND S.SAUDAID=C.SAUDAID "
        mysql = mysql & " AND C.COMPCODE =EX.COMPCODE AND I.EXCHANGECODE = EX.EXCODE AND I.ITEMCODE =S.ITEMCODE  ORDER BY CONDATE,EX.EXID,I.ITEMID,S.SAUDAID"
        Set NewRec = Nothing: Set NewRec = New ADODB.Recordset
        NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not NewRec.EOF Then
            Do While Not NewRec.EOF
                LLConSno = LLConSno + 1
                DoEvents
                GETMAIN.Label1.Caption = "Generating ConSNo " & LLConSno & " of Date " & NewRec!Condate & ""
                If NewRec!excode = "NSE" And NewRec!LOTWISE = "Y" Then
                    LLOT = NewRec!TRADEABLELOT
                ElseIf NewRec!excode = "MCX" And NewRec!LOTWISE = "Y" Then
                    LLOT = NewRec!TRADEABLELOT
                Else
                    LLOT = NewRec!lot
                End If
                mysql = "EXEC UPDATE_CTR_DR_ALL " & LCompCode & "," & LLConSno & ",'" & NewRec!excode & "'," & LLOT & ",'" & NewRec!ITEMCODE & "'," & NewRec!SAUDAID & ",'" & Format(NewRec!Condate, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
                
                mysql = "EXEC INSERT_CTR_M " & LCompCode & "," & LLConSno & ",'" & Format(NewRec!Condate, "YYYY/MM/DD") & "','" & NewRec!Sauda & "','" & NewRec!ITEMCODE & "','" & NewRec!PATTAN & "','" & NewRec!excode & "'," & NewRec!EXID & "," & NewRec!itemid & "," & NewRec!SAUDAID & ""
                Cnn.Execute mysql
                NewRec.MoveNext
            Loop
        End If
        TRec.MoveNext
    Loop
    mysql = "SELECT COMPCODE FROM COMPANY"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    Do While Not TRec.EOF
        LLConSno = 0
        LCompCode = TRec!CompCode
        mysql = "SELECT MAX(CONSNO)AS LNO FROM CTR_M WHERE COMPCODE=" & LCompCode & ""
        Set TRec1 = Nothing
        Set TRec1 = New ADODB.Recordset
        TRec1.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        If TRec1.EOF Then
            LLConSno = 0
        Else
            LLConSno = IIf(IsNull(TRec1!LNo), 0, TRec1!LNo)
        End If
        mysql = "SELECT DISTINCT C.SAUDA,C.CONDATE,I.LOT,S.TRADEABLELOT,EX.LOTWISE,EX.EXCODE,EX.EXID,I.ITEMID,S.SAUDAID,I.ITEMCODE FROM CTR_R AS C,ITEMMAST AS I,SAUDAMAST AS S,EXMAST AS EX "
        mysql = mysql & " WHERE C.COMPCODE =" & LCompCode & " AND C.COMPCODE =I.COMPCODE AND C.COMPCODE =S.COMPCODE AND S.SAUDAID=C.SAUDAID "
        mysql = mysql & " AND C.COMPCODE =EX.COMPCODE AND I.EXID =EX.EXID "
        mysql = mysql & " AND I.ITEMID =S.ITEMID  AND C.CONSNO=0  ORDER BY CONDATE,SAUDA"
        Set NewRec = Nothing: Set NewRec = New ADODB.Recordset
        NewRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        If Not NewRec.EOF Then
            Do While Not NewRec.EOF
                DoEvents
                LLConSno = LLConSno + 1
                GETMAIN.Label1.Caption = "Generating CTR_M " & LLConSno & " of Date " & NewRec!Condate & ""
                If NewRec!excode = "NSE" And NewRec!LOTWISE = "Y" Then
                    LLOT = NewRec!TRADEABLELOT
                ElseIf NewRec!excode = "MCX" And NewRec!LOTWISE = "Y" Then
                    LLOT = NewRec!TRADEABLELOT
                Else
                    LLOT = NewRec!lot
                End If
                mysql = "UPDATE CTR_R SET CONSNO =" & LLConSno & " WHERE COMPCODE =" & LCompCode & " AND SAUDA= '" & NewRec!Sauda & "' AND CONDATE ='" & Format(NewRec!Condate, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
                mysql = "EXEC INSERT_CTR_M " & LCompCode & "," & LLConSno & ",'" & Format(NewRec!Condate, "YYYY/MM/DD") & "','" & NewRec!Sauda & "','" & NewRec!ITEMCODE & "','C','" & NewRec!excode & "'," & NewRec!EXID & "," & NewRec!itemid & "," & NewRec!SAUDAID & ""
                Cnn.Execute mysql
                NewRec.MoveNext
            Loop
        End If
        TRec.MoveNext
    Loop

    '>>> RE-SET CTR_D.CONNO sequence -- 20 mARCH 2021
    Dim LCondate As Date
    mysql = "SELECT COMPCODE FROM COMPANY"
    Set NewRec = Nothing
    Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    Do While Not NewRec.EOF
        LCompCode = NewRec!CompCode
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        mysql = "SELECT DISTINCT CONDATE,ROWNO FROM CTR_D WHERE COMPCODE =" & LCompCode & " ORDER BY CONDATE,ROWNO"
        TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        Do While Not TRec.EOF
            DoEvents
            MCount = 0
            GETMAIN.Label1.Caption = "Generating ConNo " & TRec!Condate & ""
            LCondate = TRec!Condate
            Do While LCondate = TRec!Condate
                DoEvents
                GETMAIN.Label1.Caption = "Generating ConNo " & TRec!Condate & " " & MCount & ""
                MCount = MCount + 1
                                               
                mysql = " UPDATE CTR_D SET CONNO = " & MCount & " WHERE COMPCODE=" & LCompCode & " "
                mysql = mysql & " AND CONDATE ='" & Format(LCondate, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND ROWNO =" & TRec!ROWNO & " "
                Cnn.Execute mysql
                
                TRec.MoveNext
                If TRec.EOF Then Exit Do
                
                mysql = " UPDATE CTR_D SET CONNO = " & MCount & "  WHERE COMPCODE=" & LCompCode & " "
                mysql = mysql & " AND CONDATE ='" & Format(LCondate, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND ROWNO =" & TRec!ROWNO & " "
                Cnn.Execute mysql
                
                TRec.MoveNext
               If TRec.EOF Then Exit Do
               
            Loop
            If TRec.EOF Then Exit Do
        Loop
        NewRec.MoveNext
    Loop
'
'   ' Reset Settlement No

    mysql = "UPDATE CTR_D SET SAUDAID =0 WHERE SAUDAID IS NULL "
    Cnn.Execute mysql
 
    mysql = "UPDATE CTR_D SET SAUDAID = (SELECT SAUDAMAST.SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =" & GCompCode & " AND SAUDAMAST.SAUDACODE=CTR_D.SAUDA ) WHERE CTR_D.SAUDAID =0 "
    Cnn.Execute mysql

    mysql = "UPDATE CTR_M SET SAUDAID =0 WHERE SAUDAID IS NULL "
    Cnn.Execute mysql

     mysql = "UPDATE CTR_M SET SAUDAID = (SELECT SAUDAMAST.SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =" & GCompCode & " AND SAUDAMAST.SAUDACODE=CTR_M.SAUDA ) WHERE CTR_M.SAUDAID =0"
     Cnn.Execute mysql

    mysql = "UPDATE CTR_R SET SAUDAID =0 WHERE SAUDAID IS NULL "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_R SET SAUDAID = (SELECT SAUDAMAST.SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =" & GCompCode & " AND SAUDAMAST.SAUDACODE=CTR_R.SAUDA) WHERE CTR_R.SAUDAID=0 "
    Cnn.Execute mysql
    mysql = "SELECT DISTINCT SAUDA FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND SAUDAID NOT IN (SELECT SAUDAID FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & ") "
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly
    Do While Not TRec.EOF
        mysql = "UPDATE CTR_D SET SAUDAID = (SELECT SAUDAMAST.SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =" & GCompCode & " AND SAUDAMAST.SAUDACODE='" & TRec!Sauda & "') WHERE CTR_D.SAUDA='" & TRec!Sauda & "'"
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
    
    mysql = "SELECT DISTINCT SAUDA FROM CTR_M WHERE COMPCODE =" & GCompCode & " AND SAUDAID NOT IN (SELECT SAUDAID FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & ") "
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly
    Do While Not TRec.EOF
        mysql = "UPDATE CTR_M SET SAUDAID = (SELECT SAUDAMAST.SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =" & GCompCode & " AND SAUDAMAST.SAUDACODE='" & TRec!Sauda & "') WHERE CTR_M.SAUDA='" & TRec!Sauda & "'"
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
    
    mysql = "SELECT DISTINCT SAUDA FROM CTR_R WHERE COMPCODE =" & GCompCode & " AND SAUDAID NOT IN (SELECT SAUDAID FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & ") "
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly
    Do While Not TRec.EOF
        mysql = "UPDATE CTR_R SET SAUDAID = (SELECT SAUDAMAST.SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =" & GCompCode & " AND SAUDAMAST.SAUDACODE='" & TRec!Sauda & "') WHERE CTR_R.SAUDA='" & TRec!Sauda & "'"
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
    
     
    MNo = 1
    
    mysql = "SELECT DISTINCT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " ORDER BY SETDATE"
    Set NewRec = Nothing: Set NewRec = New ADODB.Recordset: NewRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    MNo = 1
    Do While Not NewRec.EOF
        DoEvents
        GETMAIN.Label1.Caption = "Updating Settlement No  " & MNo & " of Date " & NewRec!SETDATE & ""
        mysql = "EXEC UPD_INV_D_SETNO " & GCompCode & ",'" & Format(NewRec!SETDATE, "YYYY/MM/DD") & "'," & MNo & ""
        Cnn.Execute mysql
    
        MNo = MNo + 1
        NewRec.MoveNext
    Loop

    DoEvents
    'GETMAIN.Label1.Caption = "Updating SaudaMast Excode"
                
    DoEvents
    GETMAIN.Label1.Caption = "Updating DlyMgn ItemCode and ExCode"
    

    DoEvents
    GETMAIN.Label1.Caption = "Updating DlyMgn ItemCode and ExCode"
    
    mysql = "UPDATE DLYMGN SET ITEMCODE = (SELECT DISTINCT ITEMCODE FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =DLYMGN.COMPCODE AND SAUDAMAST.SAUDACODE=DLYMGN.SAUDA) WHERE ITEMCODE IS NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYMGN SET EXCODE = (SELECT DISTINCT EXCODE FROM SAUDAMAST  WHERE SAUDAMAST.COMPCODE =DLYMGN.COMPCODE AND SAUDAMAST.SAUDACODE=DLYMGN.SAUDA)WHERE EXCODE  IS NULL "
    Cnn.Execute mysql
    
    FlagBrok = True
    'CHECK ENTRY IN ACCT_EX
    mysql = "SELECT AC_CODE ,ACCID FROM ACCOUNTD WHERE ACCOUNTD.COMPCODE = " & GCompCode & ""
    Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
    Set ExRec = Nothing: Set ExRec = New ADODB.Recordset
    mysql = "SELECT EXCODE,EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & ""
    ExRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    Do While Not AccRec.EOF
        LParty = AccRec!AC_CODE
        LACCID = AccRec!ACCID
        ExRec.MoveFirst
        Do While Not ExRec.EOF
            DoEvents
            GETMAIN.Label1.Caption = "Updating Party Excode    " & " for " & LParty & ""
            LExCode = ExRec!excode
            mysql = "SELECT COMPCODE FROM ACCT_EX WHERE  AC_CODE ='" & LParty & "' AND EXID=" & ExRec!EXID & ""
            Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
            If TRec.EOF Then
                Call PINSERT_ACCT_EX(LParty, LExCode, LParty, "S", ExRec!EXID, LACCID)
            End If
            ExRec.MoveNext
        Loop
        AccRec.MoveNext
    Loop
    'UPDATE FamilyId in AccountD
    Cnn.CommitTrans
    CNNERR = False
    Exit Sub
err:
    
    MsgBox err.Description, vbCritical, "Error Number : " & err.Number
    If CNNERR = True Then
       Cnn.RollbackTrans: CNNERR = False
    End If
End Sub

Public Sub UpdateMargin(LMItemCodes As String, LMParties As String, LMFromDate As Date, LMToDate As Date, LMExCodes As String)

On Error GoTo err1
If GAppSpread = "Y" Then Call UpdateStanding2(LMParties, LMItemCodes, LMFromDate, LMExCodes)

    mysql = "DELETE FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND "
    mysql = mysql & " VOU_NO IN (SELECT DISTINCT VT.VOU_NO FROM VCHAMT AS VT WHERE VT.COMPCODE=" & GCompCode & " "
    mysql = mysql & " AND VT.VOU_TYPE='M'"
    If LenB(LMParties) > 0 Then mysql = mysql & " AND VT.AC_CODE IN (" & LMParties & ")"
    If LenB(LMFromDate) > 0 Then mysql = mysql & " AND VT.VOU_DT >='" & Format(CDate(LMFromDate), "YYYY/MM/DD") & "'"
    If LenB(LMExCodes) > 0 Then mysql = mysql & " AND VT.EXID IN (" & LMExCodes & ")"
    mysql = mysql & " )"
    Cnn.Execute mysql
    mysql = "UPDATE DMARGIN SET MARGINAMT = 0 WHERE COMPCODE =" & GCompCode & " "
    If LenB(LMParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LMParties & ")"
    If LenB(LMFromDate) > 0 Then mysql = mysql & " AND CONDATE >='" & Format(CDate(LMFromDate), "YYYY/MM/DD") & "'"
    If LenB(LMExCodes) > 0 Then mysql = mysql & " AND EXID IN (" & LMExCodes & ")"
    Cnn.Execute mysql
    Call Update_Import_MarginAmt(LMParties, LMFromDate, LMExCodes)
    Call Update_ValueWise_MarginAmt(LMParties, LMFromDate, LMExCodes)
    Call Update_Qtywise_MarginAmt(LMParties, LMFromDate, LMExCodes)
    
    Call Post_Margin_Import(LMFromDate, LMParties, LMExCodes)
 '  Call Post_Margin_ClientWise(LMFromDate, LMParties, LMExCodes)

Exit Sub

err1: If err.Number <> 0 Then
         MsgBox err.Description
        
      End If
End Sub
Public Function GetDriveSerialNumber(Optional ByVal DriveLetter As String) As Long
    Dim fso As Object, Drv As Object
    Dim DriveSerial As Long
    'Create a FileSystemObject object
    Set fso = CreateObject("Scripting.FileSystemObject")
    'Assign the current drive letter if not specified
    If LenB(DriveLetter) <> 0 Then
        Set Drv = fso.GetDrive(DriveLetter)
    Else
        Set Drv = fso.GetDrive(fso.GetDriveName(App.Path))
    End If
    With Drv
        If .IsReady Then
            DriveSerial = Abs(.SerialNumber)
        Else    '"Drive Not Ready!"
            DriveSerial = -1
        End If
    End With
    'Clean up
    Set Drv = Nothing
    Set fso = Nothing
    GetDriveSerialNumber = DriveSerial
End Function
Sub Update_Contract_No(LFromDate As String)

Dim ExRec As ADODB.Recordset:   Dim TRec As ADODB.Recordset:    Dim LCondate  As Date
Dim LFrmDate As Date:           Dim LParty  As String:          Dim LCNoteNo As Long:
Dim LContractAcc As String:     Dim LMemId As String:           Dim LExCode As String
Dim LExID As Integer

On Error GoTo err1
mysql = "UPDATE ACCOUNTD SET PERSONNELAC='N' WHERE PERSONNELAC IS NULL"
Cnn.Execute mysql

If LenB(LFromDate) = 0 Then
    LFrmDate = DateValue(GSysLockDt)
    Cnn.Execute "UPDATE CTR_D SET NOTENO=0 WHERE COMPCODE =" & GCompCode & " AND CONDATE>'" & Format(GSysLockDt, "YYYY/MM/DD") & "'"
Else
    If GSysLockDt >= DateValue(LFromDate) Then LFromDate = CDate(GSysLockDt)
End If


mysql = "SELECT EXID,EXCODE FROM EXMAST WHERE COMPCODE =" & GCompCode & ""
Set ExRec = Nothing: Set ExRec = New ADODB.Recordset
ExRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
Do While Not ExRec.EOF
    LExCode = ExRec!excode:
    LExID = ExRec!EXID
    If LenB(LFromDate) > 0 Then LFrmDate = DateValue(LFromDate)
    mysql = "SELECT MAX(NOTENO) AS CNOTENO FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND EXID =" & LExID & " AND CONDATE <'2017/06/30'"
    If LenB(LFromDate) > 0 Then mysql = mysql & " AND CONDATE<'" & Format(LFrmDate, "YYYY/MM/DD") & "'"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not TRec.EOF Then LCNoteNo = IIf(IsNull(TRec!CNOTENO), 0, TRec!CNOTENO)
    
    mysql = "SELECT DISTINCT B.CONDATE,B.PARTY FROM CTR_D AS B, ACCOUNTD AS A WHERE B.COMPCODE  = " & GCompCode & " AND B.COMPCODE =A.COMPCODE AND B.PARTY =A.AC_CODE "
    mysql = mysql & " AND  A.PARTYTYPE ='1' AND B.PATTAN<>'O' AND B.EXID =" & LExID & " AND CONDATE <='2017/06/30'"
    If LenB(LFromDate) <> 0 Then mysql = mysql & " AND B.CONDATE>='" & Format(LFrmDate, "YYYY/MM/DD") & "'"
    mysql = mysql & " ORDER BY B.CONDATE, B.PARTY"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset:
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        LCNoteNo = LCNoteNo + 1
        LParty = TRec!PARTY
        LCondate = TRec!Condate
        mysql = "EXEC UPD_CNOTE " & GCompCode & ",'" & LParty & "'," & LExID & ",'" & Format(LCondate, "YYYY/MM/DD") & "'," & LCNoteNo & ""
        Cnn.Execute mysql
        GETMAIN.Label1.Caption = "Updateing of Contract No Date  " & TRec!Condate & " OF " & LExCode & ""
        TRec.MoveNext
        DoEvents
    Loop
    Set TRec = Nothing
    ExRec.MoveNext
Loop
    Set ExRec = Nothing
    If LenB(LFromDate) <> 0 Then LFrmDate = DateValue(LFromDate)
    mysql = "SELECT MAX(NOTENO) AS CNOTENO FROM CTR_D WHERE COMPCODE =" & GCompCode & " "
    If LenB(LFromDate) <> 0 Then mysql = mysql & " AND CONDATE<'" & Format(LFrmDate, "YYYY/MM/DD") & "'"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then LCNoteNo = IIf(IsNull(TRec!CNOTENO), 0, TRec!CNOTENO)
    
    mysql = "SELECT DISTINCT B.CONDATE,B.PARTY FROM CTR_D AS B,ACCOUNTD AS A WHERE B.COMPCODE  = " & GCompCode & " AND B.COMPCODE =A.COMPCODE AND B.PARTY =A.AC_CODE "
    mysql = mysql & " AND A.PARTYTYPE ='1' AND B.PATTAN<>'O' AND CONDATE >'2017/06/30'"
    If LenB(LFromDate) <> 0 Then mysql = mysql & " AND B.CONDATE>='" & Format(LFrmDate, "YYYY/MM/DD") & "'"
    mysql = mysql & " ORDER BY B.CONDATE, B.PARTY"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset:
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        LCNoteNo = LCNoteNo + 1
        LParty = TRec!PARTY
        LCondate = TRec!Condate
        mysql = "EXEC UPD_CNOTE01072017 " & GCompCode & ",'" & LParty & "','" & Format(LCondate, "YYYY/MM/DD") & "'," & LCNoteNo & ""
        Cnn.Execute mysql
        GETMAIN.Label1.Caption = "Updateing of Contract No Date  " & TRec!Condate & " OF " & LExCode & ""
        TRec.MoveNext
        DoEvents
    Loop
    Set TRec = Nothing
Exit Sub
err1: If err.Number <> 0 Then
        MsgBox err.Description
        Cnn.RollbackTrans
        
    End If
End Sub
Sub INSERT_MENU()
    Dim LCaption As String:      Dim LPCode As Integer
    Dim LMenu_Name As String:    Dim LGroup As String
    
    mysql = "TRUNCATE TABLE USER_MENU"
    Cnn.Execute mysql
'Enteries
    LMenu_Name = "CONTRACTENTRY": LGroup = "E": LCaption = "Contract Entry": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "ACTYPE": LGroup = "S": LCaption = "GROUP SETUP": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    
    LMenu_Name = "CLOSERATE":    LGroup = "E": LCaption = "Closing Rate Entry": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "dcm":          LGroup = "E": LCaption = "Daily Contract Modify": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnutrdconfirm":    LGroup = "E": LCaption = "Daily Trade Confirmation": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "VCHENT":    LGroup = "E": LCaption = "Voucher Entry": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuinvset":    LGroup = "E": LCaption = "Invoice Generation ": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnudata":    LGroup = "E": LCaption = "Data Import": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuptyclose":    LGroup = "E": LCaption = "Partywise Closing Rate Entry": LPCode = 1
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'QUERY
    LMenu_Name = "mnuQTB":    LGroup = "Q": LCaption = "Query on Trial Balance": LPCode = 2
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "GenQry":    LGroup = "Q": LCaption = "General Query": LPCode = 2
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuopening":    LGroup = "Q": LCaption = "Opening Balance": LPCode = 2
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "QonBlst":    LGroup = "Q": LCaption = "Query on Bill List": LPCode = 2
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuqstand":    LGroup = "Q": LCaption = "Query on Standing": LPCode = 2
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuqtrade":    LGroup = "Q": LCaption = "Query on Trade": LPCode = 2
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    
'CONTRACT REPORTS
    LMenu_Name = "mnucnote":    LGroup = "R": LCaption = "Contract Note": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "CONTRACTREG":    LGroup = "R": LCaption = "Contract Register": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql:
    LMenu_Name = "mnutrdreg":    LGroup = "R": LCaption = "Trade Register": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "DATEWSCONTLIST":    LGroup = "R": LCaption = "DateWise Contract List": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnutrurnover":    LGroup = "R": LCaption = "Turnover Report": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "SAUDAWSSTND":    LGroup = "R": LCaption = "Standing Statement": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "MST":    LGroup = "R": LCaption = "Maturity Wise Report": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnudtst":    LGroup = "R": LCaption = "Datewise Standing Report": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnutrade":    LGroup = "R": LCaption = "Trade File Generation": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuTradeDelete":    LGroup = "R": LCaption = "Trade Deletion": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnudeposit":    LGroup = "R": LCaption = "ODIN Deposit Upload": LPCode = 3
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'MARGIN REPORTS
    LMenu_Name = "mnumrgnrt":    LGroup = "R": LCaption = "Margin Rate List": LPCode = 4
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnudclmgn":    LGroup = "R": LCaption = "Daily Client Wise Margin": LPCode = 4
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "dtmrgnrpt":    LGroup = "R": LCaption = "Date Wise Margin Report": LPCode = 4
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "Marsry":    LGroup = "R": LCaption = "Margin Report": LPCode = 4
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'Invoice Reports
    LMenu_Name = "mnuINVLIST":    LGroup = "R": LCaption = "Invoice List": LPCode = 5
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "MenuInvPrint":    LGroup = "R": LCaption = "Invoice Printing": LPCode = 5
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnublist":    LGroup = "R": LCaption = "Invoice Summary": LPCode = 5
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
' Billwise  Reports
    LMenu_Name = "mnuacsttsumm":    LGroup = "R": LCaption = "Billwise Account Statement Summary": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    
' Settlement Reports
    LMenu_Name = "MENUACCSTT":    LGroup = "R": LCaption = "Account Statement": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuaccsmry":    LGroup = "R": LCaption = "Account Statement Summary": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnudaily":    LGroup = "R": LCaption = "Daily Activity Statement": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnudass":    LGroup = "R": LCaption = "Bill Summary With Sharing": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnubillsmry":    LGroup = "R": LCaption = "Bill Summary": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnusetbsmry":    LGroup = "R": LCaption = "Branch Wise Account Statement Summary": LPCode = 6
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'Branch Wise Reports
    LMenu_Name = "mnubrshare":    LGroup = "R": LCaption = "Branchwise Sharing Report": LPCode = 7
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnubrbal":    LGroup = "R": LCaption = "branch Wise Balances": LPCode = 7
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'Brokerage Reports
    LMenu_Name = "mnubrbrok":    LGroup = "R": LCaption = "Branch Wise Brokerage Report": LPCode = 8
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "RPTBROKSMRY":    LGroup = "R": LCaption = "Brokerage Summary": LPCode = 8
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "BrokLst":    LGroup = "R": LCaption = "Brokerage List": LPCode = 8
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'Other Reports
    LMenu_Name = "SAUDASUMRY":    LGroup = "R": LCaption = "Generate Reports": LPCode = 9
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "RtLst":    LGroup = "R": LCaption = "Rate List": LPCode = 9
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "Sdatrf":    LGroup = "R": LCaption = "Sauda Transfer": LPCode = 9
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "swmrt":    LGroup = "R": LCaption = "Sauda Wise Missing Rates": LPCode = 9
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql

'Financial Reports
    LMenu_Name = "voulist":    LGroup = "R": LCaption = "Voucher List": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "cashbook_f2":    LGroup = "R": LCaption = "Cash Book": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "bankbook_f2":   LGroup = "R": LCaption = "Bank Book": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "genled":    LGroup = "R": LCaption = "General Ledger": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuoutstanding":    LGroup = "R": LCaption = "Party Wise OutStanding": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "MNUInvWsLedg":    LGroup = "R": LCaption = "Invoice Wise Ledger": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnidetldg":    LGroup = "R": LCaption = "Detailed Ledger": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "chqreg":    LGroup = "R": LCaption = "Cheque Register": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "udtb":   LGroup = "R": LCaption = "Trial Balance": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "PANDLMENU":    LGroup = "R": LCaption = "Profit & Loss Statement": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnutrialdt":    LGroup = "R": LCaption = "MTM Summary": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "balancesht":    LGroup = "R": LCaption = "Balance Sheet": LPCode = 10
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
'SetUp
    LMenu_Name = "COMPSETUP":    LGroup = "S": LCaption = "Company Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "ACTYPE":    LGroup = "S": LCaption = "Group Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "ACCOUNTHEAD":    LGroup = "S": LCaption = "Account Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "FmlyStup":    LGroup = "S": LCaption = "Branch Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "ITEMSETUP":    LGroup = "S": LCaption = "Item Master Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "SAUDAMAST":    LGroup = "S": LCaption = "Sauda Master Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "SETMASTER":    LGroup = "S": LCaption = "Settlement Master": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "MnuNarr":    LGroup = "S": LCaption = "Narration Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "UrSetup":    LGroup = "S": LCaption = "User Master Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "Exstp":    LGroup = "S": LCaption = "Exchange Master Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuweb":    LGroup = "S": LCaption = "Web User Master Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuexbrok":    LGroup = "S": LCaption = "Exchange Wise Brokerage Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "mnuexsbrok":    LGroup = "S": LCaption = "Exchnage Wise SubBrokerage and Sharing Setup": LPCode = 11
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    
'Tools
    LMenu_Name = "DBkp":    LGroup = "T": LCaption = "Database Backup": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "Reindex":    LGroup = "T": LCaption = "Reindexing": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "PackUpData":    LGroup = "T": LCaption = "Packup Data": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "Notepad":    LGroup = "T": LCaption = "Notepad": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "MnuCalc":    LGroup = "T": LCaption = "Calculator": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    LMenu_Name = "rwb":    LGroup = "T": LCaption = "Correcting Book": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    
    LMenu_Name = "YrUpdate":    LGroup = "T": LCaption = "Year Updation": LPCode = 12
    mysql = "EXEC INSERT_MENU  '" & LMenu_Name & "','" & SW & "','" & LGroup & "','" & LCaption & "'," & LPCode & ""
    Cnn.Execute mysql
    
    mysql = "SELECT * FROM USER_MENU": LCaption = "Company Setup": LPCode = 11
    Dim NRec, NREC2 As ADODB.Recordset
    Set NRec = Nothing
    Set NRec = New ADODB.Recordset
    NRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not NRec.EOF Then
        Do While Not NRec.EOF
            LMenu_Name = NRec!MENUNAME
            Set NREC2 = Nothing
            Set NREC2 = New ADODB.Recordset
            mysql = "SELECT * FROM USER_RIGHTS WHERE MENUNAME ='" & LMenu_Name & "' AND USER_NAME ='" & GUserName & "'"
            NREC2.Open mysql, Cnn, adOpenStatic, adLockReadOnly
            If NREC2.EOF Then
                mysql = "INSERT INTO USER_RIGHTS (SW, USER_NAME, MENUNAME, M_VISIBLE, M_ADDITION, M_MODIFICATION, M_DELETION, M_PRINT)"
                mysql = mysql & " VALUES('" & SW & "','" & GUserName & "','" & LMenu_Name & "',1,1,1,1,1 )"
                Cnn.Execute mysql
            End If
            NRec.MoveNext
        Loop
    End If
End Sub
Public Function SYSTEMLOCK(ldate As Date) As Boolean
    If GSysLockDt >= ldate Then
        SYSTEMLOCK = True
    Else
        SYSTEMLOCK = False
    End If
End Function
Sub Registration()
    Dim B As String:                 Dim CustId As String:    Dim SNo2, SNo3, SNo4, SNo5, SNo6 As String
    Dim MDt As Date:                 Dim CnnString As String:    Dim LField_Name As String:    Dim LData_Type As String
    Dim LField_length As Integer:    Dim LTable_Name As String
        
    Dim MRec As ADODB.Recordset
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: SNo4 = vbNullString: SNo5 = vbNullString: SNo6 = vbNullString
    MDt = Date
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString
    If MCnn.State = 0 Then ' 0=closed
        Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
        MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
        MCnn.Open
    End If
    
    MCnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE = 'P' AND NAME='INSERT_SYSTNO') DROP PROCEDURE INSERT_SYSTNO"
    mysql = "CREATE PROCEDURE INSERT_SYSTNO @SNO VARCHAR(50),@CUSTID VARCHAR(50),@SNO2 VARCHAR(50),@SNO3 VARCHAR(50),@SNO4 VARCHAR(50),@SNO5 VARCHAR(50),"
    mysql = mysql & " @SNO6 VARCHAR(50),@OPTIONS VARCHAR(1),@TDATE SMALLDATETIME,@LDATE SMALLDATETIME,@CCODE INT  AS "
    mysql = mysql & " INSERT INTO SYSTNO (SERIALNO,CUSTID,REGNO2,REGNO3,REGNO4,REGNO5,REGNO6,OPTIONS,TDATE,LDATE,CCODE) "
    mysql = mysql & " VALUES ( @SNO, @CUSTID,@SNO2,@SNO3,@SNO4,@SNO5,@SNO6,@OPTIONS,@TDATE,@LDATE,@CCODE) "
    MCnn.Execute mysql
    
    
    LTable_Name = "SYSTNO"
    mysql = "SELECT * FROM dbo.sysobjects WHERE ID = object_id(N'[dbo].[" & LTable_Name & "]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1"
    Set MRec = Nothing
    Set MRec = New ADODB.Recordset
    MRec.Open mysql, MCnn, adOpenForwardOnly, adLockReadOnly
    If MRec.EOF Then
        mysql = "CREATE TABLE SYSTNO (SNO INT  IDENTITY(1,1),SERIALNO VARCHAR(50) NOT NULL,CUSTID VARCHAR(50),REGNO2 VARCHAR(50),REGNO3 VARCHAR(50),REGNO4 VARCHAR(50),REGNO5 VARCHAR(50),REGNO6 VARCHAR(50),OPTIONS VARCHAR(1),TDATE SMALLDATETIME,LDATE smalldatetime,CCODE int)"
        MCnn.Execute mysql: B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: SNo4 = vbNullString: SNo5 = vbNullString: SNo6 = vbNullString
    Else
        LTable_Name = "SYSTNO":        LField_Name = "CUSTID":        LData_Type = "VARCHAR":        LField_length = 50
        mysql = "IF  col_length('" & LTable_Name & "','" & LField_Name & "') IS NULL"
        mysql = mysql & " ALTER  TABLE " & LTable_Name & " ADD " & LField_Name & " " & LData_Type & "(" & LField_length & ") NULL "
        MCnn.Execute mysql: B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: SNo4 = vbNullString: SNo5 = vbNullString: SNo6 = vbNullString
        LTable_Name = "SYSTNO":        LField_Name = "REGNO2":        LData_Type = "VARCHAR":        LField_length = 50
        mysql = "IF  col_length('SYSTNO','REGNO2') IS  NULL "
        mysql = mysql & "ALTER TABLE SYSTNO  ADD REGNO2 VARCHAR(50),REGNO3 VARCHAR(50),REGNO4 VARCHAR(50),REGNO5 VARCHAR(50),REGNO6 VARCHAR(50)"
        MCnn.Execute mysql
        LTable_Name = "SYSTNO":        LField_Name = "OPTIONS":        LData_Type = "VARCHAR":        LField_length = 1
        
        mysql = "IF  col_length('SYSTNO','OPTIONS') IS  NULL "
        mysql = mysql & "ALTER TABLE SYSTNO  ADD OPTIONS VARCHAR(1) "
        MCnn.Execute mysql
        
        mysql = "IF  col_length('SYSTNO','TDATE') IS  NULL "
        mysql = mysql & "ALTER TABLE SYSTNO  ADD TDATE SMALLDATETIME "
        MCnn.Execute mysql
        
        B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: SNo4 = vbNullString: SNo5 = vbNullString: SNo6 = vbNullString
        mysql = "TRUNCATE TABLE SYSTNO"
        MCnn.Execute mysql
        
        B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: SNo4 = vbNullString: SNo5 = vbNullString: SNo6 = vbNullString
        'Call Reg_1_TO_500       '
        'Call Reg_501_TO_1000    '
        'Call Reg_1001_TO_1500   '
        'Call Y2015:             Call Y2017:                   Call Y2018:
        'Call Y2019:             Call JAN20:                   Call FEB20:
        'Call MAR20:             Call APR20:                   Call MAY20:
        'Call JUN20:             Call JUL20:                   Call AUG20:
        'Call SEP20:             Call oct20:
        
        Call CL_01
        Call CL_02
        Call CL_03
        Call CL_04
        Call CL_05
        Call CL_06
        Call CL_07
        Call CL_08
        Call CL_09
        Call CL_10
        Call CL_11
        Call CL_12
        Call CL_13
        Call CL_100
        Call CL_101 ' June2023
        Call CL_SEP23 '  SEP2023
        
        
        
    End If
    'Set MCnn = Nothing
End Sub
Public Function CHK_REG(hdno As String) As Boolean
    'Dim MCnn As ADODB.Connection
    Dim A As Integer
    
    Dim Rec As ADODB.Recordset:    Dim LNo As Double:    Dim MDt As Date:    Dim CnnString As String:    MDt = Date
    
    CHK_REG = False
    mysql = "SELECT UNIQCLIENTID FROM COMPANY"
    Set Rec = Nothing
    Set Rec = New ADODB.Recordset
    Rec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not Rec.EOF Then
        GUniqClientId = IIf(IsNull(Rec!UNIQCLIENTID), "", Rec!UNIQCLIENTID)
    End If
    'Dim MCnn As ADODB.Connection
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString

'    Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
'    MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
'    MCnn.Open

    'hdno = "1185411769" Or Or hdno = "1713138570"
    GHDNO = "965717024" ' Umesh Machine
    'GHDNO = "111713138570" ' Umesh Indore Machine
    'GHDNO = "721517103" ' Puneesh Machine

    LHDNo = hdno
    If hdno = "721517103" Or hdno = "1266700299" Or hdno = "965717024" Or hdno = "2116881156" Or hdno = "1713138570" Then
        CHK_REG = True
    ElseIf UCase(GUniqClientId) = "NEWSOFT" Then
        LNo = 0
        mysql = "SELECT DISTINCT CONDATE FROM CTR_D "
        Set Rec = Nothing
        Set Rec = New ADODB.Recordset
        Rec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        If Not Rec.EOF Then
            LNo = Rec.RecordCount
        End If
        If LNo > 30 Then
            CHK_REG = False
        Else
            CHK_REG = True
            'MenuOptfrm.Label17.Top = 3000
            'MenuOptfrm.Label17.Height = 1700
            MenuOptfrm.Label17.Visible = True
            MenuOptfrm.Label17.Caption = "Please get your Software Registered . You have " & (30 - LNo) & " Days remaining. Please Contact on 88898-40123, 88897-40123 to get you software Registered to avoid any inconvenience to you "
        End If
    Else
        If MCnn.State = 0 Then
            Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
            MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
            MCnn.Open
        End If
        hdno = Encrypt(hdno)
        mysql = "SELECT ID FROM SYSOBJECTS WHERE NAME ='SYSTNO'"
        Set Rec = Nothing
        Set Rec = New ADODB.Recordset
        Rec.Open mysql, MCnn, adOpenStatic, adLockReadOnly
        If Rec.EOF Then
            CHK_REG = False
        Else
            mysql = "SELECT * FROM SYSTNO WHERE  CUSTID ='" & GUniqClientId & "' AND (SERIALNO='" & hdno & "' OR REGNO2='" & hdno & "' OR REGNO3='" & hdno & "' OR REGNO4='" & hdno & "')"
            Set Rec = Nothing
            Set Rec = New ADODB.Recordset
            Rec.Open mysql, MCnn, adOpenStatic, adLockReadOnly
            If Rec.EOF Then
                CHK_REG = False
            Else
                If Rec!TDATE >= MDt Then
                    CHK_REG = True
                    A = 30
                    A = (Rec!TDATE - MDt)
                    If (Rec!TDATE - MDt) < 3 Then
                        MenuOptfrm.Label17.Top = 3000
                        MenuOptfrm.Label17.Height = 1700
                        MenuOptfrm.Label17.Caption = "Thank you for your continued support and belief in our product. It has already been 11 months that we have been honored to service you, it is time to renew your contract with our company. You have " & A & " Days remaining. Please Contact on 88898-40123,88897-40123 to get Details of Your Maintainence Amount And Bank Details to avoid any inconvenience to you "
                    End If
                End If
            End If
        End If
    End If
    'Set MCnn = Nothing
    
        
End Function
Public Function Encrypt(TXT1 As String) As String
Dim TXT2 As String
Dim TT As String
Dim A As Integer
Dim I As Integer
A = Len(TXT1)

For I = 1 To A
        TT = Mid(TXT1, I, 1)
        Select Case TT
            Case 0
                TXT2 = TXT2 & "3"
            Case 1
                TXT2 = TXT2 & "2"
            Case 2
                TXT2 = TXT2 & "1"
            Case 3
                TXT2 = TXT2 & "5"
            Case 4
                TXT2 = TXT2 & "0"
            Case 5
                TXT2 = TXT2 & "6"
            Case 6
                TXT2 = TXT2 & "7"
            Case 7
                TXT2 = TXT2 & "8"
            Case 8
                TXT2 = TXT2 & "9"
            Case 9
                TXT2 = TXT2 & "4"
        End Select
    Encrypt = TXT2
Next I
End Function

Public Function Decrypt(TXT1 As String) As String
Dim TXT2 As String
Dim TT As String
Dim A As Integer
Dim I As Integer
A = Len(TXT1)
For I = 1 To A
        TT = Mid(TXT1, I, 1)
        Select Case TT
            Case 0
                TXT2 = TXT2 & "4"
            Case 1
                TXT2 = TXT2 & "2"
            Case 2
                TXT2 = TXT2 & "1"
            Case 3
                TXT2 = TXT2 & "0"
            Case 4
                TXT2 = TXT2 & "9"
            Case 5
                TXT2 = TXT2 & "3"
            Case 6
                TXT2 = TXT2 & "5"
            Case 7
                TXT2 = TXT2 & "6"
            Case 8
                TXT2 = TXT2 & "7"
            Case 9
                TXT2 = TXT2 & "8"
        End Select
        Decrypt = TXT2
Next I
End Function
Function Random(Lowerbound As Long, Upperbound As Long)
Randomize
Random = Int(Rnd * Upperbound) + Lowerbound
End Function
Public Sub Shree_Posting(MFromDate As Date)
Dim TRec As ADODB.Recordset:    Dim TRec1 As ADODB.Recordset:       Dim LLOT As Double
Dim MBAmount As Double:         Dim MSAmount As Double:             Dim MDiffAmt As Double:        Dim LExchangeCode As String
Dim MAmount As Double:          Dim MNarration As String:           Dim MCondate As Date:          Dim MDR As String
Dim MConSno As Long:            Dim MSauda As String:               Dim VchNo As String:           Dim MCR As String
Dim LMVNo As Long:              Dim LExID As Integer:               Dim LSaudaID As Long
Dim LShreeAccID As Long
Dim LTradingAccID  As Long
    On Error GoTo err1
    If DateValue(GSysLockDt) > DateValue(MFromDate) Then MFromDate = GSysLockDt
        'SHREE VOUCHER POSTING
        Cnn.Execute "DELETE FROM VOUCHER WHERE COMPCODE = " & GCompCode & " AND VOU_DT>='" & Format(MFromDate, "YYYY/MM/DD") & "' AND VOU_TYPE='O' "
        Set TRec1 = Nothing: Set TRec1 = New ADODB.Recordset
        TRec1.Open "SELECT SHREEAC,TRADINGACC,EXCODE,EXID FROM EXMAST WHERE COMPCODE=" & GCompCode & "", Cnn, adOpenForwardOnly, adLockReadOnly
        LLOT = 1
        mysql = "EXEC Get_SaudaDiffamt " & GCompCode & ",'" & Format(MFromDate, "YYYY/MM/DD") & "'"
        Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        Do While Not TRec.EOF
            MCondate = TRec!Condate
            LSaudaID = TRec!SAUDAID
            
            GETMAIN.Label1.Caption = "Updateing Shree Postings of Date  " & MCondate & " "
            DoEvents
            LExID = TRec!EXID
            MDiffAmt = Round(TRec!DIFFAMT, 2)
            If GRoundOff = "Y" Then
                MDiffAmt = Round(MDiffAmt, 0)
            Else
                MDiffAmt = Round(MDiffAmt, 2)
            End If
            If Val(MDiffAmt) <> 0 Then
                MSauda = Get_SaudaCODE(LSaudaID)
                
                GShree = vbNullString: GTrading = vbNullString
                If TRec1.RecordCount > 0 Then
                    TRec1.MoveFirst: TRec1.Find "EXID=" & LExID & "", , adSearchForward
                    If Not TRec1.EOF Then GShree = TRec1!shreeac & "": GTrading = TRec1!TRADINGACC & ""
                    LShreeAccID = Get_AccID(GShree)
                    LTradingAccID = Get_AccID(GTrading)
                End If
                VchNo = Get_VouNo("CONT", GFinYear)
                LMVNo = PInsert_Voucher(VchNo, MCondate, "O", "P", 0, "ADD", MSauda, 0, "", LExchangeCode, "0", LExID, LSaudaID)
                MAmount = Abs(Val(MDiffAmt))
                If MDiffAmt < 0 Then
                    MCR = "C": MDR = "D":
                Else
                    MCR = "D": MDR = "C":
                End If
                MNarration = "Shree for : " & MSauda
                'SHREE POSTING
                Call PInsert_Vchamt(VchNo, "O", MCondate, MDR, GShree, MAmount, vbNullString, MCondate, MNarration, MSauda, LExchangeCode, 0, LExchangeCode, LMVNo, LExID, LSaudaID, LShreeAccID)
                Call PInsert_Vchamt(VchNo, "O", MCondate, MCR, GTrading, MAmount, vbNullString, MCondate, MNarration, MSauda, LExchangeCode, 0, LExchangeCode, LMVNo, LExID, LSaudaID, LTradingAccID)
            End If
            TRec.MoveNext
        Loop
        GETMAIN.Label1.Caption = "Shree Posting Complete"
        Exit Sub
err1:
    MsgBox err.Description, vbCritical, "Error Number : " & err.Number
    
    If CNNERR = True Then
       Cnn.RollbackTrans: CNNERR = False
    End If
End Sub

Public Sub RATE_TEST(LFromDate As Date, Optional LExCodes As String, Optional LSauda As String, Optional LFNAME As Form)
    Dim TRec2 As ADODB.Recordset:    Dim TRec As ADODB.Recordset:    Dim LHigh As Double: Dim A As Integer
    Dim LLow As Double:              Dim LConNo As String:           Dim LCondate As Date:          Dim LChecked As Boolean
    Dim LSaudaID As Long: Dim Lmsgtxt As String
    If GCheckRt = "Y" Then
    
        DoEvents
        If LFNAME.NAME = "frmdata" Then
            If frmdata.List1.List(0) = "" Then
                frmdata.List1.Clear
            End If
        ElseIf LFNAME.NAME = "frmcont4" Then
            If frmcont4.List1.List(0) = "" Then
                frmcont4.List1.Clear
            End If
        ElseIf LFNAME.NAME = "FrmCloseRate" Then
            If FrmCloseRate.List1.List(0) = "" Then
                FrmCloseRate.List1.Clear
            End If
        ElseIf LFNAME.NAME = "GETCont" Then
            If GETCont.List1.List(0) = "" Then
                GETCont.List1.Clear
            End If
        ElseIf LFNAME.NAME = "Frm_GetContSauda" Then
            If Frm_GetContSauda.List1.List(0) = "" Then
                Frm_GetContSauda.List1.Clear
            End If
        End If
        DoEvents
        
        mysql = "SELECT DISTINCT C.CONDATE,C.SAUDA, C.SAUDAID,C.HGRATE, C.LOWRATE FROM CTR_R AS C, CTR_D AS D  WHERE C.COMPCODE =" & GCompCode & " AND  "
        mysql = mysql & "C.CONDATE>='" & Format(LFromDate, "YYYY/MM/DD") & "' AND C.SAUDAID =D.SAUDAID  AND C.CONDATE=D.CONDATE "
        If LenB(LExCodes) > 0 Then mysql = mysql & " AND C.EXID IN (" & LExCodes & ")"
        If LenB(LSauda) > 0 Then mysql = mysql & " AND C.SAUDAID = " & LSauda & ""
        mysql = mysql & " ORDER BY C.CONDATE, C.SAUDA"
        Set TRec = Nothing:    Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        LHigh = 0:    LLow = 0
        Do While Not TRec.EOF
        
            LHigh = TRec!HGRATE:        LLow = TRec!LOWRATE:        LSauda = TRec!Sauda:        LCondate = TRec!Condate
            DoEvents
            GETMAIN.Label1.Caption = "Checking Rates " & LCondate & ""
            LSaudaID = TRec!SAUDAID
                    
            If (LHigh <> 0 And LLow <> 0) Then
                Set TRec2 = Nothing
                Set TRec2 = New ADODB.Recordset
                mysql = "SELECT DISTINCT CONNO,RATE FROM CTR_D WHERE SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' "
                mysql = mysql & " AND (RATE< " & LLow & " OR RATE > " & LHigh & " )"
                TRec2.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not TRec2.EOF
                    'Lmsgtxt = "Please Check Trade of " & vbTab & LSauda & vbTab & " of " & vbTab & CStr(LCondate) & vbTab & "   TRADE No: " & TRec2!CONNO & vbTab & "Rate: " & TRec2!Rate & ", "
                    A = Len(LSauda)
                    If Len(LSauda) >= 25 Then
                        A = 24
                    End If
                    
                    LSauda = LSauda + Space(25 - A)
                    Lmsgtxt = LSauda & vbTab & vbTab & " of " & CStr(LCondate) & vbTab & "   TRADE No: " & TRec2!CONNO & vbTab & "Rate: " & TRec2!Rate & ", "
                    
                    DoEvents
                    If LFNAME.NAME = "frmdata" Then
                        frmdata.List1.AddItem (Lmsgtxt)
                    ElseIf LFNAME.NAME = "frmcont4" Then
                        frmcont4.List1.AddItem (Lmsgtxt)
                    ElseIf LFNAME.NAME = "FrmCloseRate" Then
                       FrmCloseRate.List1.AddItem (Lmsgtxt)
                    ElseIf LFNAME.NAME = "GETCont" Then
                        GETCont.List1.AddItem (Lmsgtxt)
                    ElseIf LFNAME.NAME = "Frm_GetContSauda" Then
                        Frm_GetContSauda.List1.AddItem (Lmsgtxt)
                    Else
                        MsgBox Lmsgtxt
                    End If
                    TRec2.MoveNext
            Loop
           End If
           TRec.MoveNext
           
           Loop
           
    If Lmsgtxt <> "" Then
         If LFNAME.NAME = "frmdata" Then
             frmdata.Frame8.Visible = True
        ElseIf LFNAME.NAME = "frmcont4" Then
             frmcont4.Frame12.Visible = True
         ElseIf LFNAME.NAME = "FrmCloseRate" Then
             FrmCloseRate.Frame8.Visible = True
         ElseIf LFNAME.NAME = "GETCont" Then
             GETCont.Frame13.Visible = True
         ElseIf LFNAME.NAME = "Frm_GetContSauda" Then
            Frm_GetContSauda.Frame12.Visible = True
         End If
    End If
   DoEvents
    
    GETMAIN.Label1.Caption = "Rate Test Complete"
    Set TRec = Nothing
    Set TRec2 = Nothing
    'MsgBox "All Rates checked"
    End If
End Sub

Public Sub BROK_CHECK()
On Error GoTo err1
Dim AccRec As ADODB.Recordset:      Dim ItemRec As ADODB.Recordset: Dim TRec As ADODB.Recordset:        Dim LExCode As String:
Dim LSettlementDt As Date:          Dim LAC_CODE As String:         Dim LFmlyCode  As String
Dim LCOMP As Integer:               Dim CompRec  As ADODB.Recordset

Cnn.BeginTrans
CNNERR = True

mysql = "SELECT COMPCODE,FINEND FROM COMPANY ORDER BY COMPCODE "
Set CompRec = Nothing
Set CompRec = New ADODB.Recordset
CompRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly

Do While Not CompRec.EOF
    LCOMP = CompRec!CompCode
    mysql = "SELECT ACCID ,AC_CODE,BROKTYPE,BROKRATE,TRANRATE,TRANTYPE FROM ACCOUNTD WHERE ACCOUNTD.COMPCODE = " & LCOMP & ""
    Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
    If Not AccRec.EOF Then
        LSettlementDt = DateValue(CompRec!finend)
        While Not AccRec.EOF
            DoEvents
            GETMAIN.Label1.Caption = "Updating PEXBROK  " & " for " & AccRec!AC_CODE & ""
            mysql = "SELECT EXID,EXCODE,OPTIONS FROM EXMAST WHERE COMPCODE  = " & LCOMP & " "
            Set ItemRec = Nothing: Set ItemRec = New ADODB.Recordset: ItemRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
            Do While Not ItemRec.EOF
                DoEvents
                If (ItemRec!excode = "EQ" Or ItemRec!excode = "BEQ") Then
                    LAC_CODE = Get_PEXBROK_AC_CODE(AccRec!ACCID, ItemRec!EXID, LSettlementDt, "CSH")
                    If LenB(LAC_CODE) < 1 Then Call PInsert_COMP_PExBrok(LCOMP, AccRec!AC_CODE, ItemRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, Format(LSettlementDt, "YYYY/MM/DD"), "CSH", 0, 0, ItemRec!EXID)
                ElseIf ItemRec!excode = "CME OP" Then
                    If ItemRec!Options = "Y" Then
                        LAC_CODE = Get_PEXBROK_AC_CODE(AccRec!ACCID, ItemRec!EXID, LSettlementDt, "OPT")
                        If LenB(LAC_CODE) < 1 Then Call PInsert_COMP_PExBrok(LCOMP, AccRec!AC_CODE, ItemRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, Format(LSettlementDt, "YYYY/MM/DD"), "OPT", 0, 0, ItemRec!EXID)
                    End If
                ElseIf ItemRec!excode = "NSE" Then
                    If ItemRec!Options = "Y" Then
                        LAC_CODE = Get_PEXBROK_AC_CODE(AccRec!ACCID, ItemRec!EXID, LSettlementDt, "OPT")
                        If LenB(LAC_CODE) < 1 Then Call PInsert_COMP_PExBrok(LCOMP, AccRec!AC_CODE, ItemRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, Format(LSettlementDt, "YYYY/MM/DD"), "OPT", 0, 0, ItemRec!EXID)
                    End If
                    LAC_CODE = Get_PEXBROK_AC_CODE(AccRec!ACCID, ItemRec!EXID, LSettlementDt, "FUT")
                    If LenB(LAC_CODE) < 1 Then Call PInsert_COMP_PExBrok(LCOMP, AccRec!AC_CODE, ItemRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, Format(LSettlementDt, "YYYY/MM/DD"), "FUT", 0, 0, ItemRec!EXID)
                Else
                    LAC_CODE = Get_PEXBROK_AC_CODE(AccRec!ACCID, ItemRec!EXID, LSettlementDt, "FUT")
                    If LenB(LAC_CODE) < 1 Then Call PInsert_COMP_PExBrok(LCOMP, AccRec!AC_CODE, ItemRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, Format(LSettlementDt, "YYYY/MM/DD"), "FUT", 0, 0, ItemRec!EXID)
                    If ItemRec!Options = "Y" Then
                        LAC_CODE = Get_PEXBROK_AC_CODE(AccRec!ACCID, ItemRec!EXID, LSettlementDt, "OPT")
                        If LenB(LAC_CODE) < 1 Then Call PInsert_COMP_PExBrok(LCOMP, AccRec!AC_CODE, ItemRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, Format(LSettlementDt, "YYYY/MM/DD"), "OPT", 0, 0, ItemRec!EXID)
                    End If
                End If
                ItemRec.MoveNext
            Loop
            AccRec.MoveNext
        Wend
    End If
    CompRec.MoveNext
Loop
Cnn.CommitTrans

Cnn.BeginTrans
CNNERR = True
Dim LFmlyID As Long
 Dim LACCID As Long
mysql = "SELECT FMLYID,ACCID,FMLYCODE,PARTY FROM ACCFMLYD WHERE COMPCODE = " & GCompCode & " ORDER BY FMLYCODE,PARTY"
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not AccRec.EOF Then
    LSettlementDt = GFinEnd
    While Not AccRec.EOF
        DoEvents
        GETMAIN.Label1.Caption = "Updating PEXSBROK  " & " for " & AccRec!FMLYCODE & "  PARTY " & AccRec!PARTY & ""
        
        mysql = "SELECT EXID,EXCODE,OPTIONS FROM EXMAST WHERE COMPCODE  = " & GCompCode & " ORDER BY EXCODE  "
        Set ItemRec = Nothing: Set ItemRec = New ADODB.Recordset: ItemRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        Do While Not ItemRec.EOF
            DoEvents
            LFmlyID = AccRec!FMLYID
            LACCID = AccRec!ACCID
            If (ItemRec!excode = "EQ" Or ItemRec!excode = "BEQ") Then
                LAC_CODE = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, ItemRec!EXID, LSettlementDt, "CSH")
                If LenB(LAC_CODE) < 1 Then Call PINSERT_PEXSBROK(AccRec!PARTY, AccRec!FMLYCODE, ItemRec!excode, "P", 0, "N", 0, LSettlementDt, "CSH", 0, ItemRec!EXID, LFmlyID, LACCID)
            ElseIf ItemRec!excode = "CME OP" Then
                If ItemRec!Options = "Y" Then
                    LAC_CODE = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, ItemRec!EXID, LSettlementDt, "OPT")
                    If LenB(LAC_CODE) < 1 Then Call PINSERT_PEXSBROK(AccRec!PARTY, AccRec!FMLYCODE, ItemRec!excode, "P", 0, "N", 0, LSettlementDt, "OPT", 0, ItemRec!EXID, LFmlyID, LACCID)
                End If
            ElseIf ItemRec!excode = "NSE" Then
                If ItemRec!Options = "Y" Then
                    LAC_CODE = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, ItemRec!EXID, LSettlementDt, "OPT")
                    If LenB(LAC_CODE) < 1 Then Call PINSERT_PEXSBROK(AccRec!PARTY, AccRec!FMLYCODE, ItemRec!excode, "P", 0, "N", 0, LSettlementDt, "OPT", 0, ItemRec!EXID, LFmlyID, LACCID)
                End If
                LAC_CODE = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, ItemRec!EXID, LSettlementDt, "FUT")
                If LenB(LAC_CODE) < 1 Then Call PINSERT_PEXSBROK(AccRec!PARTY, AccRec!FMLYCODE, ItemRec!excode, "P", 0, "N", 0, LSettlementDt, "FUT", 0, ItemRec!EXID, LFmlyID, LACCID)
            Else
                
                LAC_CODE = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, ItemRec!EXID, LSettlementDt, "FUT")
                If LenB(LAC_CODE) < 1 Then Call PINSERT_PEXSBROK(AccRec!PARTY, AccRec!FMLYCODE, ItemRec!excode, "P", 0, "N", 0, LSettlementDt, "FUT", 0, ItemRec!EXID, LFmlyID, LACCID)
                If ItemRec!Options = "Y" Then
                    LAC_CODE = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, ItemRec!EXID, LSettlementDt, "OPT")
                    If LenB(LAC_CODE) < 1 Then Call PINSERT_PEXSBROK(AccRec!PARTY, AccRec!FMLYCODE, ItemRec!excode, "P", 0, "N", 0, LSettlementDt, "OPT", 0, ItemRec!EXID, LFmlyID, LACCID)
                End If
            End If
            ItemRec.MoveNext
        Loop
        AccRec.MoveNext
    Wend
End If
Cnn.CommitTrans
CNNERR = False
Exit Sub
err1:
If err.Number <> 0 Then
    MsgBox err.Description
    
    Cnn.RollbackTrans
    CNNERR = False
End If


End Sub

Public Sub UPDATE_ACTIVE()
Dim Rec As ADODB.Recordset
Set Rec = Nothing
Set Rec = New ADODB.Recordset
mysql = "SELECT EXCHANGECODE , ITEMCODE FROM ITEMMAST WHERE COMPCODE =" & GCompCode & ""
Rec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
Do While Not Rec.EOF
    mysql = "UPDATE SCRIPTMASTER SET ACTIVE = 'Y' WHERE EXCODE='" & Rec!EXCHANGECODE & "' AND ITEMCODE ='" & Rec!ITEMCODE & "'"
    Cnn.Execute mysql
    Rec.MoveNext
Loop
End Sub

Public Sub NEW_STORED()

    Dim MasterConn As ADODB.Connection:    Dim CnnString As String
    
    On Error GoTo err1
    Set MasterConn = Nothing:    Set MasterConn = New ADODB.Connection
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString
    
    MasterConn.Open CnnString
    GETMAIN.Label1.Caption = " Creating Store Procedures "
    DoEvents
    
    MasterConn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE = 'P' AND NAME='BKPDATABASE') DROP PROCEDURE BKPDATABASE"
    mysql = "CREATE PROCEDURE BkpDATABASE @DBNAME VARCHAR(25),@FILENAME VARCHAR(200) "
    mysql = mysql & " AS BACKUP DATABASE @DBNAME TO DISK =@FILENAME"
    MasterConn.Execute mysql
    
    MasterConn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE = 'P' AND NAME='LShrinkData') DROP PROCEDURE LShrinkData"
    mysql = "CREATE PROCEDURE LShrinkData @DBNAME VARCHAR(50)"
    mysql = mysql & " AS DBCC SHRINKDATABASE ( @DBNAME ) "
    MasterConn.Execute mysql
    
    MasterConn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE = 'P' AND NAME='INSERT_SYSTNO') DROP PROCEDURE INSERT_SYSTNO"
    mysql = "CREATE PROCEDURE INSERT_SYSTNO @SNO VARCHAR(50),@CUSTID VARCHAR(50),@SNO2 VARCHAR(50),@SNO3 VARCHAR(50),@SNO4 VARCHAR(50),@SNO5 VARCHAR(50),"
    mysql = mysql & " @SNO6 VARCHAR(50),@OPTIONS VARCHAR(1),@TDATE SMALLDATETIME,@LDATE SMALLDATETIME,@CCODE INT  AS "
    mysql = mysql & " INSERT INTO SYSTNO (SERIALNO,CUSTID,REGNO2,REGNO3,REGNO4,REGNO5,REGNO6,OPTIONS,TDATE,LDATE,CCODE) "
    mysql = mysql & " VALUES ( @SNO, @CUSTID,@SNO2,@SNO3,@SNO4,@SNO5,@SNO6,@OPTIONS,@TDATE,@LDATE,@CCODE) "
    MasterConn.Execute mysql
    
    MasterConn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE = 'P' AND NAME='RESTOREDB') DROP PROCEDURE RESTOREDB"
    mysql = "CREATE PROCEDURE RESTOREDB @DBNAME NVARCHAR(100),@PATH NVARCHAR(500) "
    mysql = mysql & " AS "
    mysql = mysql & " DECLARE @VEXE NVARCHAR(2000) "
    mysql = mysql & " SET @VEXE = 'ALTER DATABASE [' + @DBNAME + '] SET SINGLE_USER WITH ROLLBACK IMMEDIATE' "
    mysql = mysql & " EXECUTE (@VEXE) "
    mysql = mysql & " SET @VEXE = 'RESTORE DATABASE [' + @DBNAME + '] FROM DISK = ''' + @PATH + ''' WITH REPLACE' "
    mysql = mysql & " EXECUTE (@VEXE) "
    mysql = mysql & " SET @VEXE = 'ALTER DATABASE [' + @DBNAME + '] SET MULTI_USER' "
    mysql = mysql & " EXECUTE (@VEXE) "
    MasterConn.Execute mysql
    
    MasterConn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE = 'P' AND NAME='DbGenerate') DROP PROCEDURE DbGenerate"
    mysql = "CREATE PROCEDURE DbGenerate @DBNAME NVARCHAR(100) "
    mysql = mysql & " AS "
    mysql = mysql & " Declare @path nvarchar(500) "
    mysql = mysql & " select top 1 @path= physical_name from sys.database_files "
    mysql = mysql & " set @path = replace(@path,'\master.mdf','') "
    mysql = mysql & " DECLARE @VEXE NVARCHAR(2000) "
    mysql = mysql & " SET @VEXE = 'CREATE DATABASE [' + @dbname + '] ON PRIMARY ' "
    mysql = mysql & " SET @VEXE = @VEXE + '(NAME = [' + @dbname + '_data] ,' "
    mysql = mysql & " SET @VEXE = @VEXE + 'FILENAME = ''' + @path + '\' + @dbname + '.mdf'', ' "
    mysql = mysql & " SET @VEXE = @VEXE + 'SIZE = 10MB, MAXSIZE = 250MB, FILEGROWTH = 10%) ' "
    mysql = mysql & " SET @VEXE = @VEXE + 'LOG ON (NAME = [' + @dbname + '_Log], ' "
    mysql = mysql & " SET @VEXE = @VEXE + 'FILENAME = ''' + @path + '\' + @dbname + '.ldf'', ' "
    mysql = mysql & " SET @VEXE = @VEXE + 'SIZE = 1MB, ' "
    mysql = mysql & " SET @VEXE = @VEXE + 'MAXSIZE = 5MB, ' "
    mysql = mysql & " SET @VEXE = @VEXE + 'FILEGROWTH = 10%)' "
    mysql = mysql & " EXECUTE (@VEXE) "
    MasterConn.Execute mysql

              
    Call INSERT_PROC
    'Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_BILLSUMMARY') DROP PROCEDURE INSERT_BILLSUMMARY"
    'Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='SHREE_POST') DROP PROCEDURE SHREE_POST"
        
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SaudaRec') DROP PROCEDURE Get_SaudaRec"
    mysql = " CREATE PROCEDURE Get_SaudaRec @COMPCODE INT ,@ITEMID INT, @MATURITY VARCHAR(10), @LMONTH INT, @LYEAR INT ,@INST VARCHAR(3),@OPT VARCHAR(2),@STRIKE INT AS SET NOCOUNT ON "
    mysql = mysql & " IF LEN(@MATURITY)>0 BEGIN DECLARE @MDT SMALLDATETIME SET @MDT=CONVERT(SMALLDATETIME,103)"
    mysql = mysql & " SELECT SAUDAID,SAUDACODE,MATURITY FROM SAUDAMAST WHERE  ITEMID =@ITEMID "
    mysql = mysql & " AND MATURITY =@MATURITY AND INSTTYPE =@INST AND OPTTYPE =@OPT AND STRIKEPRICE =@STRIKE ORDER BY MATURITY DESC  "
    mysql = mysql & " END ELSE  BEGIN "
    mysql = mysql & " SELECT SAUDAID,SAUDACODE,MATURITY FROM SAUDAMAST WHERE  ITEMID =@ITEMID "
    mysql = mysql & " AND MONTH(MATURITY)=@LMONTH AND YEAR(MATURITY)=@LYEAR AND INSTTYPE =@INST AND OPTTYPE =@OPT AND STRIKEPRICE = @STRIKE ORDER BY MATURITY DESC "
    mysql = mysql & " END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ITEMREC' ) DROP PROCEDURE Get_ITEMREC"
    mysql = " CREATE PROCEDURE Get_ITEMREC @COMPCODE INT ,@ITEMCODE VARCHAR(50),@EXCODE VARCHAR(10) AS SET NOCOUNT ON "
    mysql = mysql & " IF LEN(@EXCODE)>0 BEGIN "
    mysql = mysql & " SELECT ITEMID,ITEMCODE,EXCHANGECODE,EXID,EXHCODE,LOT FROM ITEMMAST WHERE  COMPCODE =@COMPCODE "
    mysql = mysql & " AND EXCHANGECODE =@EXCODE AND (EXHCODE =@ITEMCODE OR ITALIAS_1=@ITEMCODE or ITALIAS_2=@ITEMCODE or ITALIAS_3=@ITEMCODE or ITALIAS_4=@ITEMCODE or ITALIAS_5=@ITEMCODE)   "
    mysql = mysql & " END ELSE  BEGIN "
    mysql = mysql & " SELECT ITEMID,ITEMCODE,EXCHANGECODE,EXID,EXHCODE,LOT FROM ITEMMAST WHERE  COMPCODE =@COMPCODE "
    mysql = mysql & " AND (EXHCODE =@ITEMCODE OR ITALIAS_1=@ITEMCODE or ITALIAS_2=@ITEMCODE or ITALIAS_3=@ITEMCODE or ITALIAS_4=@ITEMCODE or ITALIAS_5=@ITEMCODE)   "
    mysql = mysql & " END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ITEMREC2' ) DROP PROCEDURE Get_ITEMREC2"
    mysql = " CREATE PROCEDURE Get_ITEMREC2 @COMPCODE INT ,@ITEMCODE VARCHAR(50),@EXCODE VARCHAR(10) AS SET NOCOUNT ON "
    mysql = mysql & " IF LEN(@EXCODE)>0 BEGIN "
    mysql = mysql & " SELECT ITEMID,ITEMCODE,EXCHANGECODE,EXID,EXHCODE,LOT FROM ITEMMAST WHERE  COMPCODE =@COMPCODE "
    mysql = mysql & " AND EXCHANGECODE =@EXCODE AND (ITEMCODE =@ITEMCODE OR ITALIAS_1=@ITEMCODE or ITALIAS_2=@ITEMCODE or ITALIAS_3=@ITEMCODE or ITALIAS_4=@ITEMCODE or ITALIAS_5=@ITEMCODE)   "
    mysql = mysql & " END ELSE  BEGIN "
    mysql = mysql & " SELECT ITEMID,ITEMCODE,EXCHANGECODE,EXID,EXHCODE,LOT FROM ITEMMAST WHERE  COMPCODE =@COMPCODE "
    mysql = mysql & " AND (ITEMCODE =@ITEMCODE OR ITALIAS_1=@ITEMCODE or ITALIAS_2=@ITEMCODE or ITALIAS_3=@ITEMCODE or ITALIAS_4=@ITEMCODE or ITALIAS_5=@ITEMCODE)    "
    mysql = mysql & " END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ITEMREC3' ) DROP PROCEDURE Get_ITEMREC3"
    mysql = " CREATE PROCEDURE Get_ITEMREC3 @COMPCODE INT ,@ITEMCODE VARCHAR(50),@EXCODE VARCHAR(10) AS SET NOCOUNT ON "
    mysql = mysql & " IF LEN(@EXCODE)>0 BEGIN "
    mysql = mysql & " SELECT ITEMID,ITEMCODE,EXCHANGECODE,EXID,EXHCODE,LOT FROM ITEMMAST WHERE  COMPCODE =@COMPCODE "
    mysql = mysql & " AND EXCHANGECODE =@EXCODE AND (ITEMNAME =@ITEMCODE OR ITALIAS_1=@ITEMCODE or ITALIAS_2=@ITEMCODE or ITALIAS_3=@ITEMCODE or ITALIAS_4=@ITEMCODE or ITALIAS_5=@ITEMCODE)    "
    mysql = mysql & " END ELSE  BEGIN "
    mysql = mysql & " SELECT ITEMID,ITEMCODE,EXCHANGECODE,EXID,EXHCODE,LOT FROM ITEMMAST WHERE  COMPCODE =@COMPCODE "
    mysql = mysql & " AND (ITEMNAME =@ITEMCODE OR ITALIAS_1=@ITEMCODE or ITALIAS_2=@ITEMCODE or ITALIAS_3=@ITEMCODE or ITALIAS_4=@ITEMCODE or ITALIAS_5=@ITEMCODE)    "
    mysql = mysql & " END"
    Cnn.Execute mysql
                        
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_FLATQTY') DROP PROCEDURE UPDATE_FLATQTY "
    mysql = "CREATE PROCEDURE UPDATE_FLATQTY @PARTY INT ,@ITEMID INT ,@CONDATE SMALLDATETIME AS SET NOCOUNT ON  BEGIN "
    mysql = mysql & " UPDATE DMARGIN SET FLATQTY =CLOSEQTY  WHERE ACCID =@PARTY AND ITEMID =@ITEMID AND CONDATE =@CONDATE END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='DELETE_INV_D') DROP PROCEDURE DELETE_INV_D "
    mysql = "CREATE PROCEDURE DELETE_INV_D @COMPCODE INT,@FROMDATE SMALLDATETIME AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " DELETE FROM INV_D WHERE COMPCODE =@COMPCODE AND STDATE >=@FROMDATE AND INVNO =0 "
    mysql = mysql & " DELETE FROM INV_D1 WHERE COMPCODE =@COMPCODE AND STDATE >=@FROMDATE   "
    mysql = mysql & " DELETE FROM VOUCHER WHERE COMPCODE =@COMPCODE AND VOU_DT  >=@FROMDATE AND VOU_TYPE IN ('S','H','B')  END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_INVD1_VNO') DROP PROCEDURE UPD_INVD1_VNO "
    mysql = "CREATE PROC UPD_INVD1_VNO (@FMLYID  INT ,@PARTY INT ,@STDATE SMALLDATETIME,@EXID INT ,@BVNO INT,@SVNO INT,  @BVOU_NO VARCHAR(25), @SVOU_NO VARCHAR(25) )"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " UPDATE INV_D1 SET BVOU_ID =@BVNO,SVOU_ID = @SVNO,VOU_NO  =@BVOU_NO, SVOU_NO =@SVOU_NO,POST =1 "
    mysql = mysql & " WHERE STDATE =@STDATE AND FMLYID  =@FMLYID AND ACCID  =@PARTY AND  EXID=@EXID END "
    Cnn.Execute mysql
    
    

    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_INVD_VNO') DROP PROCEDURE UPD_INVD_VNO "
    mysql = "CREATE PROC UPD_INVD_VNO ( @PARTY INT ,@STDATE SMALLDATETIME,@EXID INT ,@VNO INT , @VOU_NO VARCHAR(25) )"
    mysql = mysql & "  AS SET NOCOUNT ON BEGIN UPDATE INV_D SET VOU_ID  = @VNO, VCHNO = @VOU_NO ,POST =1 WHERE STDATE =@STDATE AND ACCID  =@PARTY AND  EXID = @EXID END"
    Cnn.Execute mysql
    '
    

    'MYSQL = "CREATE PROC INSERT_BILLSUM (@PARTY VARCHAR(6),@NAME VARCHAR(100),@SAUDA VARCHAR(50),@NETQTY FLOAT,@NETRATE FLOAT,@LTP FLOAT,@GROSS FLOAT,@MARGIN FLOAT) "
    'MYSQL = MYSQL & " AS SET NOCOUNT ON BEGIN "
    'MYSQL = MYSQL & "INSERT INTO BILLSUM (PARTY,NAME,CONTRACT,NETQTY,NETRATE,LTP,GROSSMTM,BROKAMT,MARGIN) "
    'MYSQL = MYSQL & " VALUES (@PARTY,@NAME,@SAUDA,@NETQTY,@NETRATE,LTP,GROSSMTM,BROKAMT,MARGIN) END"
    'Cnn.Execute MYSQL
    
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_CTR_DR_CONSNO') DROP PROCEDURE UPDATE_CTR_DR_CONSNO"
    mysql = "CREATE PROCEDURE UPDATE_CTR_DR_CONSNO @COMPCODE INT  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " UPDATE CTR_D SET CONSNO=0 WHERE COMPCODE = @CompCode "
    mysql = mysql & " UPDATE CTR_R SET CONSNO=0 WHERE COMPCODE = @CompCode  END "
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_CTR_DR_ALL') DROP PROCEDURE UPDATE_CTR_DR_ALL"
    mysql = "CREATE PROCEDURE UPDATE_CTR_DR_ALL @COMPCODE INT,@CONSNO INT,@EXCODE VARCHAR(10),@LOT FLOAT,@ITEMCODE VARCHAR(30),@SAUDAID INT,@CONDATE SMALLDATETIME "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @EXID AS INT "
    mysql = mysql & " SELECT @EXID=EXID FROM EXMAST WHERE COMPCODE =@COMPCODE AND EXCODE=@EXCODE "
    mysql = mysql & " UPDATE CTR_D SET CONSNO =@ConSno ,EXCODE =@EXCODE ,CALVAL = @Lot ,ITEMCODE =@ITEMCODE ,EXID =@EXID "
    mysql = mysql & " WHERE  SAUDAID = @SaudaID  AND CONDATE =@Condate  "
    mysql = mysql & " UPDATE CTR_R SET CONSNO =@ConSno, EXCODE =@EXCODE,EXID = @EXID WHERE SAUDAID = @SaudaID AND CONDATE =@Condate END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Fill_Parties') DROP PROCEDURE Fill_Parties"
    mysql = "CREATE PROCEDURE Fill_Parties  @COMPCODE INT,@FROMDT SMALLDATETIME ,@TODT SMALLDATETIME,@LEXIDS VARCHAR(MAX),@LOPT AS CHAR(1)"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN  "
    mysql = mysql & " IF LEN(@LEXIDS)>0 BEGIN "
    mysql = mysql & " DECLARE @SEPERATOR as VARCHAR(1)"
    mysql = mysql & " DECLARE @SP int"
    mysql = mysql & " DECLARE @LEXIDS2 INT"
    mysql = mysql & " SET @SEPERATOR = ','"
    mysql = mysql & " CREATE TABLE #tempTab1 (EXID INT  not null)"
    mysql = mysql & " SET @SP = PATINDEX('%' + @SEPERATOR + '%',@LEXIDS)"
    mysql = mysql & " IF @SP=0 BEGIN "
    mysql = mysql & " SELECT  @LEXIDS2 = CONVERT(INT,@LEXIDS )"
    mysql = mysql & " INSERT INTO #tempTab1 (EXID) VALUES (@LEXIDS2) END "
    mysql = mysql & " ELSE BEGIN "
    mysql = mysql & " WHILE @SP <> 0"
    mysql = mysql & " BEGIN"
    mysql = mysql & " SELECT  @SP = PATINDEX('%' + @SEPERATOR + '%',@LEXIDS)"
    mysql = mysql & " IF @SP=0 BEGIN "
    mysql = mysql & " SELECT  @LEXIDS2 = CONVERT(INT,@LEXIDS ) END "
    mysql = mysql & " ELSE BEGIN "
    mysql = mysql & " SELECT  @LEXIDS2 = CONVERT(INT,LEFT(@LEXIDS , @SP - 1))  "
    mysql = mysql & " SELECT  @LEXIDS = STUFF(@LEXIDS, 1, @SP, '') END "
    mysql = mysql & " INSERT INTO #tempTab1 (EXID) VALUES (@LEXIDS2)"
    mysql = mysql & " End END END  "
    mysql = mysql & " IF @LOPT='2' AND LEN(@LEXIDS)>0 BEGIN "
    mysql = mysql & " SELECT DISTINCT AM.ACCID,AM.OP_BAL,AD.AC_CODE,AD.NAME,AD.PARTYTYPE FROM ACCOUNTM AS AM ,ACCOUNTD AS AD, CTR_D AS C, SAUDAMAST AS S "
    mysql = mysql & " WHERE AM.COMPCODE= @CompCode AND AM.ACCID =AD.ACCID  AND C.SAUDAID=S.SAUDAID AND S.MATURITY>=@FROMDT"
    mysql = mysql & " AND C.ACCID =AM.ACCID  AND C.CONDATE<=@TODT AND S.EXID IN (SELECT EXID FROM #temptab1) ORDER BY AD.NAME END  "
    mysql = mysql & " ELSE IF @LOPT='2' AND LEN(@LEXIDS)<1 BEGIN "
    mysql = mysql & " SELECT DISTINCT AM.ACCID,AM.OP_BAL,AD.AC_CODE,AD.NAME,AD.PARTYTYPE FROM ACCOUNTM AS AM ,ACCOUNTD AS AD, CTR_D AS C, SAUDAMAST AS S "
    mysql = mysql & " WHERE AM.COMPCODE= @CompCode AND AM.ACCID  = AD.ACCID  AND C.SAUDAID = S.SAUDAID  AND S.MATURITY>=@FROMDT AND C.ACCID =AM.ACCID  "
    mysql = mysql & " AND C.CONDATE<=@TODT ORDER BY AD.NAME END "
    mysql = mysql & " ELSE IF @LOPT='1' AND LEN(@LEXIDS)>0 BEGIN "
    mysql = mysql & " SELECT DISTINCT AM.ACCID,AM.OP_BAL,AD.AC_CODE,AD.NAME,AD.PARTYTYPE FROM ACCOUNTM AS AM ,ACCOUNTD AS AD, CTR_D AS C, SAUDAMAST AS S "
    mysql = mysql & " WHERE AM.COMPCODE= @CompCode  AND AM.ACCID = AD.ACCID "
    mysql = mysql & " AND C.SAUDAID = S.SAUDAID  AND S.MATURITY>=@FROMDT AND C.ACCID =AM.ACCID  "
    mysql = mysql & " AND C.CONDATE<=@FROMDT AND S.EXID IN (SELECT EXID FROM #temptab1) ORDER BY AD.NAME END "
    mysql = mysql & " ELSE IF @LOPT='1' AND LEN(@LEXIDS)<1 BEGIN "
    mysql = mysql & " SELECT DISTINCT AM.ACCID,AM.OP_BAL,AD.AC_CODE,AD.NAME,AD.PARTYTYPE FROM ACCOUNTM AS AM ,ACCOUNTD AS AD, CTR_D AS C, SAUDAMAST AS S "
    mysql = mysql & " WHERE AM.COMPCODE= @COMPCODE  AND   AM.ACCID  = AD.ACCID  "
    mysql = mysql & " AND C.SAUDAID = S.SAUDAID  AND S.MATURITY>=@FROMDT AND C.ACCID =AM.ACCID  "
    mysql = mysql & " AND C.CONDATE<=@FROMDT ORDER BY AD.NAME  END IF LEN(@LEXIDS)>0 BEGIN DROP TABLE #temptab1 END  END "
    Cnn.Execute mysql
    
    
                
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_INV_D_STAMPAMT') DROP PROCEDURE UPDATE_INV_D_STAMPAMT"
    mysql = "CREATE PROCEDURE UPDATE_INV_D_STAMPAMT  @STDATE SMALLDATETIME,@PARTY INT ,@EXID INT ,@STAMPAMT FLOAT,@SVOUNO VARCHAR(20) AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " DECLARE @BILLNO INT "
    mysql = mysql & " SELECT TOP 1 @BILLNO = BILLNO FROM INV_D WHERE STDATE = @STDATE AND ACCID  = @PARTY AND EXID = @EXID "
    mysql = mysql & " UPDATE INV_D SET STAMPAMT = @STAMPAMT, STMVOU = @SVOUNO WHERE ACCID = @PARTY AND BILLNO =@BillNo AND STDATE =@STDATE END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_MaxSetNo') DROP PROCEDURE Get_MaxSetNo"
    mysql = "CREATE PROCEDURE Get_MaxSetNo  @COMPCODE INT, @SetNo INT OUTPUT AS SET NOCOUNT ON BEGIN DECLARE @PSetNo AS INT "
    mysql = mysql & "  SELECT @PSetNo = MAX(SETNO) FROM INV_D WHERE COMPCODE =@CompCode "
    mysql = mysql & " IF (@PSetNo IS NOT NULL) SET @SetNo = @PSetNo ELSE SET  @SETNO =1 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Upd_MarginAmt') DROP PROCEDURE Upd_MarginAmt"
    mysql = "CREATE PROCEDURE Upd_MarginAmt  @PARTY INT ,@SAUDAID INT ,@CONDATE SMALLDATETIME, @LMarginAmt FLOAT,@LMARGINRATE  FLOAT AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " UPDATE DMARGIN SET MARGINAMT = @LMarginAmt,MARGINRATE =@LMARGINRATE WHERE ACCID  =@Party AND SAUDAID =@SaudaID AND CONDATE =@Condate END"
    Cnn.Execute mysql
                
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_FLATQTYBUY') DROP PROCEDURE UPDATE_FLATQTYBUY "
    mysql = "CREATE PROCEDURE UPDATE_FLATQTYBUY @PARTY INT ,@ITEMID INT ,@CONDATE SMALLDATETIME AS SET NOCOUNT ON  BEGIN  "
    mysql = mysql & " UPDATE DMARGIN SET FLATQTY =CLOSEQTY WHERE ACCID  =@PARTY AND ITEMID = @ITEMID AND CONDATE =@CONDATE AND CLOSEQTY > 0 END "
    Cnn.Execute mysql
        
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_FLATQTYSELL') DROP PROCEDURE UPDATE_FLATQTYSELL "
    mysql = "CREATE PROCEDURE UPDATE_FLATQTYSELL @PARTY INT ,@ITEMID INT ,@CONDATE SMALLDATETIME AS SET NOCOUNT ON  BEGIN "
    mysql = mysql & " UPDATE DMARGIN SET FLATQTY =CLOSEQTY  WHERE ACCID =@PARTY AND ITEMID  =@ITEMID AND CONDATE =@CONDATE AND CLOSEQTY < 0 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Balance') DROP PROCEDURE Get_Balance "
    mysql = "CREATE PROCEDURE Get_Balance @AC_CODE INT ,@TODATE SMALLDATETIME,@LBALANCE FLOAT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LOPBAL AS FLOAT"
    mysql = mysql & " SELECT @LOPBAL=OP_BAL FROM ACCOUNTM WHERE  ACCID =@AC_CODE"
    mysql = mysql & " IF @LOPBAL IS NULL SET @LOPBAL =0"
    mysql = mysql & " SELECT @LBALANCE =SUM(Case DR_CR WHEN 'D' THEN AMOUNT * -1 WHEN 'C' THEN AMOUNT * 1  END) FROM VCHAMT"
    mysql = mysql & " WHERE ACCID  = @AC_CODE AND VOU_DT<=@TODATE AND VOU_TYPE<>'M'"
    mysql = mysql & " IF (@LBALANCE IS NULL) SET @LBALANCE=0"
    mysql = mysql & " SET @LBALANCE=@LBALANCE+@LOPBAL"
    mysql = mysql & " End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Multi') DROP PROCEDURE Get_Multi "
    mysql = "CREATE PROCEDURE GET_MULTI @PARTY INT ,@EXID INT,@ITEMID INT,@LRATE FLOAT OUTPUT"
    mysql = mysql & " AS BEGIN SET NOCOUNT ON  DECLARE @LLRATE AS FLOAT "
    mysql = mysql & " SELECT @LLRATE = RATE FROM PARTYMULTI WHERE ACCID = @PARTY AND ITEMID =@ITEMID "
    mysql = mysql & " If @LLRATE IS NULL BEGIN  "
    mysql = mysql & " SELECT @LLRATE =RATE FROM PARTYMULTI WHERE ACCID = @Party AND EXID=@EXID AND ITEMCODE ='' End"
    mysql = mysql & " If @LLRATE IS NULL  BEGIN  "
    mysql = mysql & " SET @LRATE =0 END "
    mysql = mysql & " ELSE BEGIN SET @LRATE =@LLRATE  END END "
    Cnn.Execute mysql
    
    
    '>>> TRADE FINDER
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='TradeFinder') DROP PROCEDURE TradeFinder"
    mysql = "CREATE procedure TradeFinder @COMPANYCODE VARCHAR(15), @FDATE SMALLDATETIME, @TDATE SMALLDATETIME,"
    mysql = mysql & " @FTIME VARCHAR(8),@TTIME VARCHAR(8), @EXCODE VARCHAR(15),@SAUDA VARCHAR(50),@CONTYPE CHAR(1),@FRATE MONEY=0, @TRATE MONEY=0"
    mysql = mysql & " as BEGIN"
    mysql = mysql & " SELECT C.PARTY,A.NAME,C.excode,C.sauda,C.contype,C.QTY,C.RATE,C.contime "
    mysql = mysql & " FROM ctr_d AS C, AccountM A "
    mysql = mysql & " WHERE C.COMPCODE=@COMPANYCODE AND C.condate between @FDATE AND @TDATE "
    mysql = mysql & " AND ((@FTIME='' and @TTIME='') or (C.contime between @FTIME AND @TTIME)) "
    mysql = mysql & " AND C.excode = @EXCODE  AND C.SAUDAID = @SAUDA "
    mysql = mysql & " AND ((@FRATE=0 AND @TRATE=0) OR (C.rate between @FRATE and @TRATE)) "
    mysql = mysql & " AND C.contype = @CONTYPE AND c.compcode = a.compcode and C.PARTY=A.AC_CODE order by C.contime END "
    Cnn.Execute mysql
    
    'Credit_Utilisaction
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Credit_Utilisaction') DROP PROCEDURE Credit_Utilisaction"
    mysql = " CREATE PROCEDURE Credit_Utilisaction @AccCode nvarchar(1000), @TODATE SMALLDATETIME, @Type char(1), @FROMDATE SMALLDATETIME='01/01/1900', @RPTType char(1)='L',@COMPCODE INT AS SET NOCOUNT ON "
    mysql = mysql & " DECLARE @LAccCode NVARCHAR(50) "
    mysql = mysql & " CREATE TABLE #TEMPACCODE (AC_CODE NVARCHAR(50)) "
    mysql = mysql & " while charindex('^',@AccCode) > 0 "
    mysql = mysql & " begin "
    mysql = mysql & " SET @LAccCode = rtrim(ltrim(substring(@AccCode,1,charindex('^',@AccCode)-1))) "
    mysql = mysql & " INSERT INTO #TEMPACCODE (AC_CODE) VALUES (@LAccCode) "
    mysql = mysql & " set @AccCode=rtrim(ltrim(substring(@AccCode,charindex('^',@AccCode)+1,len(@AccCode)))) "
    mysql = mysql & " IF @AccCode = '^' "
    mysql = mysql & " SET @AccCode = '' "
    mysql = mysql & " end "
    mysql = mysql & " Create table #temp (AC_CODE nvarchar(50), ACCID INT , NAME NVARCHAR(200), LEDGERBALANCE money, LBDC NVARCHAR(2), CrLimit money, CrLDC NVARCHAR(2), BALANCE MONEY)   "
    mysql = mysql & " DECLARE @OPBAL MONEY "
    mysql = mysql & " DECLARE @ACCID INT "
    mysql = mysql & " DECLARE @ACCODE NVARCHAR(50) "
    mysql = mysql & " DECLARE @CRLIMIT MONEY "
    mysql = mysql & " DECLARE @DRAMT MONEY "
    mysql = mysql & " DECLARE @CRAMT MONEY "
    mysql = mysql & " DECLARE @LEDGERBALANCE MONEY "
    mysql = mysql & " DECLARE @NAME NVARCHAR(200) "
    mysql = mysql & " DECLARE CURCART CURSOR FOR "
    mysql = mysql & " select ISNULL(M.op_bal,0) AS 'op_bal',M.ACCID, M.NAME,M.AC_CODE,ISNULL(D.CRLIMIT,0) AS 'CRLIMIT'  "
    mysql = mysql & " from AccountM M, ACCOUNTD D  "
    mysql = mysql & " where M.CompCode = D.CompCode AND M.CompCode=@COMPCODE  AND d.crlimit <> 0  and M.ac_code=D.ac_code AND M.AC_Code IN (SELECT AC_CODE FROM #TEMPACCODE) "
    mysql = mysql & " OPEN CURCART "
    mysql = mysql & " FETCH FROM CURCART INTO  @OPBAL,@ACCID, @NAME,@ACCODE, @CRLIMIT "
    mysql = mysql & " WHILE @@FETCH_STATUS = 0  "
    mysql = mysql & " BEGIN  "
    mysql = mysql & " SET @DRAMT=0   SET @CRAMT=0 "
    mysql = mysql & " if @RPTType = 'L' "
    mysql = mysql & " begin "
    mysql = mysql & " select @DRAMT=sum (isnull(amount,0))  FROM VCHAMT AS VT, VOUCHER AS V WHERE VT.CompCode = V.CompCode AND VT.COMPCODE=@COMPCODE AND  VT.ACCID = @ACCID  AND V.VOU_ID = VT.VOU_ID  and dr_cr='D' AND V.VOU_DT <= @TODATE "
    mysql = mysql & " select @CRAMT=sum (isnull(amount,0))  FROM VCHAMT AS VT, VOUCHER AS V WHERE VT.CompCode = V.CompCode AND VT.COMPCODE=@COMPCODE AND  VT.ACCID = @ACCID  AND V.VOU_ID = VT.VOU_ID  and dr_cr='C' AND V.VOU_DT <= @TODATE "
    mysql = mysql & " SET @LEDGERBALANCE = @OPBAL + (@CRAMT - @DRAMT) "
    mysql = mysql & " End"
    mysql = mysql & " else "
    mysql = mysql & " begin "
    mysql = mysql & " select @CRAMT=sum(ISNULL(diffamt,0)+ISNULL(brokamt,0)) from inv_d D, AccountM M where D.CompCode=M.CompCode AND D.CompCode=@COMPCODE AND D.party=M.AC_CODE AND M.ACCID=@ACCID AND D.STDATE >=  @FROMDATE "
    mysql = mysql & " SET @DRAMT=0 "
    mysql = mysql & " SET @LEDGERBALANCE = @CRAMT - @DRAMT "
    mysql = mysql & " End "

    mysql = mysql & " if @Type = '0' "
    mysql = mysql & " INSERT INTO #temp (AC_CODE,ACCID, NAME,LEDGERBALANCE,LBDC,CrLimit,CrLDC,BALANCE) VALUES (@ACCODE,@ACCID, @NAME,@LEDGERBALANCE,'',@CRLIMIT,'',(@LEDGERBALANCE + @CRLIMIT)) "
    mysql = mysql & " else "
    mysql = mysql & " begin "
    mysql = mysql & " if @LEDGERBALANCE < 0 "
    mysql = mysql & " begin "
    mysql = mysql & " if abs(@LEDGERBALANCE) > @CRLIMIT "
    mysql = mysql & " INSERT INTO #temp (AC_CODE,ACCID, NAME,LEDGERBALANCE,LBDC,CrLimit,CrLDC,BALANCE) VALUES (@ACCODE,@ACCID, @NAME,@LEDGERBALANCE,'',@CRLIMIT,'', (@LEDGERBALANCE + @CRLIMIT)) "
    mysql = mysql & " end  "
    mysql = mysql & " end "
    mysql = mysql & " FETCH FROM CURCART INTO @OPBAL,@ACCID, @NAME, @ACCODE, @CRLIMIT "
    mysql = mysql & " END  "
    mysql = mysql & " CLOSE CURCART  "
    mysql = mysql & " DEALLOCATE CURCART "
    mysql = mysql & " SELECT AC_CODE,ACCID, NAME,LEDGERBALANCE,(CASE WHEN LEDGERBALANCE>0 THEN 'Cr' ELSE 'Dr' END) AS 'LBDC',CrLimit,(CASE WHEN CrLimit>0 THEN 'Cr' ELSE 'Dr' END) AS  'CrLDC',BALANCE FROM #temp "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_RiskMRate') DROP PROCEDURE Get_RiskMRate "
    mysql = "CREATE PROCEDURE Get_RiskMRate @COMPCODE INT,@EXID INT,@ITEMID INT ,@FROMDATE SMALLDATETIME ,@TODATE SMALLDATETIME ,@PRATE FLOAT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPRATE AS FLOAT"
    mysql = mysql & " SELECT TOP 1 @LPRATE=RISKMRATE FROM ITEM_TAX WHERE ITEMID =@ItemID AND FROMDT<= @FROMDATE  AND TODT>=@TODATE AND RISKMRATE <> 0 ORDER BY FROMDT"
    mysql = mysql & " IF @LPRATE IS NULL BEGIN "
    mysql = mysql & " SELECT TOP 1 @LPRATE = STMPRATE FROM EXTAX WHERE EXID =@ExID AND FROMDT<=@FROMDATE AND TODT>=@TODATE  ORDER BY FROMDT END  "
    mysql = mysql & " IF @LPRATE IS NULL SET @PRATE =0  ELSE SET @PRATE=@LPRATE  END  "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Calc_StampDuty') DROP PROCEDURE Calc_StampDuty "
    mysql = " CREATE PROCEDURE Calc_StampDuty ( @AmtDivide  INT, @LSDate SMALLDATETIME, @LSParty INT ,@LSExID INT , @RetVal FLOAT OUTPUT)"
    mysql = mysql & " AS SET NOCOUNT ON  "
    mysql = mysql & " BEGIN DECLARE @LStampAmt FLOAT "
    mysql = mysql & " DECLARE @NEWDATE SMALLDATETIME "
    mysql = mysql & " SET  @NEWDATE ='2020/07/01'"
    mysql = mysql & " SET @LStampAmt = 0 "
    mysql = mysql & " SELECT @LStampAmt=SUM(QTY * RATE * CALVAL *(STMRATE/100)) From CTR_D WHERE ACCID = @LSParty AND CONDATE = @LSDate AND PATTAN <> 'O' AND EXID = @LSExID AND CONDATE <@NEWDATE "
    mysql = mysql & " IF (@AmtDivide = 1)BEGIN "
    mysql = mysql & " IF (@LStampAmt > 0.50) SET @LStampAmt = 0.50 "
    mysql = mysql & " IF (@LStampAmt < -0.50) SET @LStampAmt = -0.50 END "
    mysql = mysql & " ELSE BEGIN  "
    mysql = mysql & " IF (@LStampAmt > 50)  SET @LStampAmt = 50 "
    mysql = mysql & " IF (@LStampAmt < -50) SET @LStampAmt = -50 END"
    mysql = mysql & " IF @LStampAmt IS NULL SET @LStampAmt=0;"
    mysql = mysql & " SET @RetVal = @LStampAmt*-1;"
    mysql = mysql & " RETURN @RetVal End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_AC_NAME') DROP PROCEDURE Get_AC_NAME "
    mysql = "CREATE PROCEDURE Get_AC_NAME @AC_CODE INT ,@LNAME VARCHAR(100) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " SELECT @LNAME =NAME FROM ACCOUNTM WHERE ACCID =@AC_CODE"
    mysql = mysql & " End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PEXBROK_AC_CODE') DROP PROCEDURE Get_PEXBROK_AC_CODE "
    mysql = " CREATE PROCEDURE Get_PEXBROK_AC_CODE @INSTTYPE VARCHAR(3),@AC_CODE INT ,@EXID INT,@UPTOSTDT SMALLDATETIME ,@LPAC_CODE VARCHAR(6) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LCODE VARCHAR(6) "
    mysql = mysql & " SELECT @LCODE = AC_CODE FROM PEXBROK WHERE INSTTYPE = @INSTTYPE AND ACCID = @AC_CODE AND EXID = @EXID AND UPTOSTDT = @UPTOSTDT "
    mysql = mysql & " IF @LCODE IS NOT NULL SET @LPAC_CODE =@LCODE ELSE SET @LPAC_CODE ='' END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_BROKRATE') DROP PROCEDURE GET_BROKRATE "
    mysql = " CREATE PROCEDURE GET_BROKRATE @ACCID INT ,@EXID INT,@ITEMID INT, @UPTOSTDT SMALLDATETIME,@INSTTYPE VARCHAR(3) AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " IF EXISTS (SELECT TOP 1 COMPCODE FROM PITBROK WHERE ACCID=@ACCID AND ITEMID=@ITEMID AND INSTTYPE= @INSTTYPE AND UPTOSTDT >= @UPTOSTDT  )"
    mysql = mysql & "  BEGIN "
    mysql = mysql & "SELECT TOP 1 BROKTYPE,BROKRATE,BROKRATE2,TRANRATE,TRANTYPE,MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2 FROM PITBROK WHERE ACCID =@ACCID AND ITEMID= @ITEMID AND INSTTYPE=@INSTTYPE AND UPTOSTDT >= @UPTOSTDT  ORDER BY UPTOSTDT "
    mysql = mysql & " End"
    mysql = mysql & " Else BEGIN"
    mysql = mysql & " SELECT TOP 1 BROKTYPE,BROKRATE,BROKRATE2,TRANRATE,TRANTYPE,MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2 FROM PEXBROK WHERE ACCID= @ACCID AND EXID =@EXID AND INSTTYPE=@INSTTYPE  AND UPTOSTDT >= @UPTOSTDT  ORDER BY UPTOSTDT END END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_SHARERATE') DROP PROCEDURE GET_SHARERATE "
    mysql = " CREATE PROCEDURE GET_SHARERATE @FMLYID INT ,@PARTY INT ,@EXID INT,@ITEMID INT,@INSTTYPE VARCHAR(3), @TODATE SMALLDATETIME AS SET NOCOUNT ON BEGIN  "
    mysql = mysql & " IF EXISTS (SELECT TOP 1 PARTY FROM PITSBROK WHERE FMLYID= @FMLYID AND ACCID =@PARTY AND ITEMID =@ITEMID AND INSTTYPE=@INSTTYPE AND UPTOSTDT>=@TODATE) "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT TOP 1 BROKTYPE,BROKRATE,BROKRATE2,SHTYPE,SHRATE FROM PITSBROK WHERE FMLYID = @FMLYID AND ACCID =@PARTY  "
    mysql = mysql & " AND  ITEMID =@ITEMID AND INSTTYPE=@INSTTYPE AND UPTOSTDT>=@TODATE ORDER BY UPTOSTDT "
    mysql = mysql & " End"
    mysql = mysql & " Else"
    mysql = mysql & " BEGIN"
    mysql = mysql & " SELECT TOP 1 BROKTYPE,BROKRATE,BROKRATE2,SHTYPE,SHRATE FROM PEXSBROK WHERE FMLYID =@FMLYID  AND ACCID =@PARTY  "
    mysql = mysql & " AND EXID  = @EXID AND INSTTYPE=@INSTTYPE AND UPTOSTDT>=@TODATE ORDER BY UPTOSTDT"
    mysql = mysql & " End END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PEXSBROK_AC_CODE') DROP PROCEDURE Get_PEXSBROK_AC_CODE "
    mysql = " CREATE PROCEDURE Get_PEXSBROK_AC_CODE  @INSTTYPE VARCHAR(3),@FMLYID INT ,@PARTY INT ,@EXID INT ,@UPTOSTDT SMALLDATETIME,"
    mysql = mysql & " @LPAC_CODE VARCHAR(6) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN  DECLARE @LCODE VARCHAR(6) "
    mysql = mysql & " SELECT @LCODE = PARTY FROM PEXSBROK WHERE INSTTYPE = @INSTTYPE AND FMLYID =@FMLYID AND ACCID =@PARTY AND EXID = @EXID "
    mysql = mysql & " AND UPTOSTDT = @UPTOSTDT "
    mysql = mysql & " IF @LCODE IS NOT NULL SET @LPAC_CODE =@LCODE ELSE SET @LPAC_CODE ='' END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_INV_D_SETNO') DROP PROCEDURE UPD_INV_D_SETNO "
    mysql = " CREATE PROCEDURE UPD_INV_D_SETNO (@COMPCODE INT,@STDATE SMALLDATETIME,@SETNO INT) AS SET NOCOUNT ON BEGIN"
    mysql = mysql & " IF @SETNO=0 "
    mysql = mysql & " UPDATE INV_D SET SETNO = 0 WHERE COMPCODE = @CompCode AND STDATE>=@STDATE "
    mysql = mysql & " ELSE"
    mysql = mysql & " UPDATE INV_D SET SETNO = @SETNO WHERE COMPCODE = @CompCode AND STDATE = @STDATE "
    mysql = mysql & " END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_BROKQTY_ROWNO') DROP PROCEDURE UPD_BROKQTY_ROWNO "
    mysql = " CREATE PROCEDURE UPD_BROKQTY_ROWNO (@LQTY FLOAT ,@LROWNO INT) AS SET NOCOUNT ON BEGIN"
    mysql = mysql & " UPDATE CTR_D SET BROKQTY= @LQTY ,UPDBQTY =1 WHERE ROWNO = @LROWNO END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_BROKQTY_CONDATE') DROP PROCEDURE UPD_BROKQTY_CONDATE "
    mysql = " CREATE PROCEDURE UPD_BROKQTY_CONDATE (@COMPCODE INT,@PARTY VARCHAR(15),@SAUDAID INT, @CONDATE SMALLDATETIME ,@CONTYPE AS VARCHAR(1)) AS SET NOCOUNT ON BEGIN"
    mysql = mysql & "  IF LEN(@CONTYPE)>0 UPDATE CTR_D SET BROKQTY= QTY ,UPDBQTY =1 WHERE PARTY=@PARTY AND SAUDAID =@SAUDAID AND CONDATE =@CONDATE AND CONTYPE =@CONTYPE "
    mysql = mysql & "  ELSE UPDATE CTR_D SET BROKQTY= QTY ,UPDBQTY =1 WHERE  PARTY=@PARTY AND SAUDAID =@SAUDAID AND CONDATE =@CONDATE END "
    Cnn.Execute mysql
        
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_CloseQty') DROP PROCEDURE Get_CloseQty"
    mysql = " CREATE PROCEDURE Get_CloseQty @MC_CODE INT, @MPARTY INT , @MSAUDAID INT , @TODATE SMALLDATETIME, @LBALANCE FLOAT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN SELECT @LBALANCE = SUM(Case CONTYPE WHEN 'S' THEN  QTY * -1 WHEN 'B' THEN  QTY  END) FROM CTR_D WHERE "
    mysql = mysql & " ACCID  = @MPARTY AND  SAUDAID = @MSAUDAID AND CONDATE<= @TODATE "
    mysql = mysql & " IF (@LBALANCE IS NULL) SET @LBALANCE=0; RETURN @LBALANCE; End "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_CloseQty_Inv_D') DROP PROCEDURE Get_CLOSEQTY_INV_D"
    mysql = " CREATE PROCEDURE GET_CLOSEQTY_INV_D  @MC_CODE INT, @PARTY VARCHAR(15), @SAUDAID INT, @TODATE SMALLDATETIME, @LBALANCE FLOAT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @MDT SMALLDATETIME SELECT @MDT=MAX(STDATE) FROM INV_D WHERE "
    mysql = mysql & " PARTY =@PARTY AND SAUDAID=@SAUDAID AND STDATE < @TODATE"
    mysql = mysql & " IF @MDT IS NULL SET @LBALANCE =0 ELSE  "
    mysql = mysql & " SELECT @LBALANCE = CLQTY FROM INV_D WHERE "
    mysql = mysql & " PARTY = @PARTY AND SAUDAID = @SAUDAID AND STDATE = @MDT "
    mysql = mysql & " IF (@LBALANCE IS NULL) SET @LBALANCE=0; RETURN @LBALANCE; End "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_NEXTDATE') DROP PROCEDURE GET_NEXTDATE"
    
    mysql = " CREATE PROCEDURE GET_NEXTDATE @COMPCODE INT,@PARTY INT ,@SAUDAID INT,@CONDATE SMALLDATETIME,@LNDATE VARCHAR(20) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LNEXT SMALLDATETIME"
    mysql = mysql & " SELECT @LNEXT=MIN(CONDATE) FROM CTR_D WHERE ACCID =@PARTY AND SAUDAID =@SAUDAID AND CONDATE >=@CONDATE"
    mysql = mysql & " IF @LNEXT IS NULL SET @LNDATE  = ''"
    mysql = mysql & " Else  SET @LNDATE =CONVERT(VARCHAR(20),@LNEXT)End "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Post_BillVchAmt') DROP PROCEDURE Post_BillVchAmt"
    mysql = " CREATE PROCEDURE Post_BillVchAmt (@COMPCODE INT,@VOUNO VARCHAR(20),@AMOUNT FLOAT,@ACC VARCHAR(6),@STDATE SMALLDATETIME,@EXCODE VARCHAR(10),@PARTY VARCHAR(15),"
    mysql = mysql & " @NARR VARCHAR(100),@MVNO INT,@EXID INT ,@SAUDAID INT,@VOUTIME SMALLDATETIME  )"
    mysql = mysql & " AS BEGIN SET NOCOUNT ON DECLARE @LDRCR VARCHAR(1) "
    mysql = mysql & " IF @AMOUNT >0 SET @LDRCR='D'"
    mysql = mysql & " Else BEGIN SET @LDRCR='C' SET @AMOUNT =ABS(@AMOUNT) END  IF LEN(ISNULL(@ACC,''))<>0  "
    mysql = mysql & " EXEC INSERT_VCHAMT @CompCode,@VouNo,'S',@STDATE,@LDrCR,@ACC ,@AMOUNT ,'',@STDATE,@NARR,@PARTY,@EXCODE,0,@EXCODE,@MVNO,@EXID ,@SAUDAID,@VOUTIME END "
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SHAREAMT') DROP PROCEDURE Get_SHAREAMT"
    mysql = "CREATE PROCEDURE GET_SHAREAMT @COMPCODE INT, @AC_CODE VARCHAR(15),@SAUDAID INT ,@FROMDATE SMALLDATETIME,@TODATE SMALLDATETIME, @LSHAREAMT FLOAT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON  DECLARE @LSAMT FLOAT SET @LSAMT =0 "
    mysql = mysql & " SELECT @LSAMT = SUM(SAMOUNT)  FROM INV_D1 AS I,ACCFMLY AS A "
    mysql = mysql & " WHERE  I.FMLYCODE=A.FMLYCODE AND I.PARTY=A.FMLYHEAD AND PARTY =@AC_CODE AND STDATE > =@FROMDATE AND STDATE < =@TODATE "
    mysql = mysql & " AND SAUDAID =@SAUDAID "
    mysql = mysql & " IF @LSAMT IS NULL SET @LSHAREAMT =0 ELSE SET @LSHAREAMT = @LSAMT"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SHAREBAMT') DROP PROCEDURE Get_SHAREBAMT"
    mysql = "CREATE PROCEDURE GET_SHAREBAMT @COMPCODE INT, @AC_CODE VARCHAR(15),@SAUDAID INT ,@FROMDATE SMALLDATETIME,@TODATE SMALLDATETIME, @LSHAREAMT FLOAT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON  DECLARE @LSAMT FLOAT SET @LSAMT =0 "
    mysql = mysql & " SELECT @LSAMT = SUM(AMOUNT)  FROM INV_D1 AS I "
    mysql = mysql & " WHERE PARTY =@AC_CODE AND STDATE > =@FROMDATE AND STDATE < =@TODATE "
    mysql = mysql & " AND SAUDAID =@SAUDAID "
    mysql = mysql & " IF @LSAMT IS NULL SET @LSHAREAMT =0 ELSE SET @LSHAREAMT = @LSAMT"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SHAREPAMT') DROP PROCEDURE Get_SHAREPAMT"
    mysql = "CREATE PROCEDURE GET_SHAREPAMT @COMPCODE INT, @AC_CODE VARCHAR(15),@SAUDAID INT ,@FROMDATE SMALLDATETIME,@TODATE SMALLDATETIME, @LSHAREAMT FLOAT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON  DECLARE @LSAMT FLOAT SET @LSAMT =0 "
    mysql = mysql & " SELECT @LSAMT = SUM(SAMOUNT)  FROM INV_D1 AS I"
    mysql = mysql & " WHERE PARTY =@AC_CODE AND STDATE > =@FROMDATE AND STDATE < =@TODATE "
    mysql = mysql & " AND SAUDAID =@SAUDAID "
    mysql = mysql & " IF @LSAMT IS NULL SET @LSHAREAMT =0 ELSE SET @LSHAREAMT = @LSAMT"
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PartyNetQty') DROP PROCEDURE Get_PartyNetQty "
    mysql = " CREATE PROCEDURE Get_PartyNetQty @COMPCODE INT,@LMATURITY SMALLDATETIME,@LEXID INT AS SET NOCOUNT ON "
    mysql = mysql & " IF @LEXID <>0  SELECT A.Name,B.Sauda,SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) AS NetQty "
    mysql = mysql & " FROM ACCOUNTD AS A,CTR_D AS B, SAUDAMAST AS S WHERE A.COMPCODE= @CompCode   "
    mysql = mysql & " AND S.MATURITY>=@LMATURITY AND B.SAUDAID=S.SAUDAID "
    mysql = mysql & " AND A.ACCID =B.ACCID  AND B.CONDATE <=@LMATURITY "
    mysql = mysql & " AND S.EXID= @LExID GROUP BY A.NAME,B.SAUDA "
    mysql = mysql & " HAVING SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) <> 0 ORDER BY A.NAME,B.SAUDA "
    mysql = mysql & " ELSE SELECT A.Name,B.Sauda,SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) AS NetQty "
    mysql = mysql & " FROM ACCOUNTD AS A,CTR_D AS B, SAUDAMAST AS S WHERE A.COMPCODE= @CompCode "
    mysql = mysql & " AND S.MATURITY>=@LMATURITY AND B.SAUDAID=S.SAUDAID "
    mysql = mysql & " AND A.ACCID =B.ACCID  AND B.CONDATE <=@LMATURITY "
    mysql = mysql & " GROUP BY A.NAME,B.SAUDA HAVING SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) <> 0 "
    mysql = mysql & " ORDER BY A.NAME,B.SAUDA "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PartyNetQtyPARTY') DROP PROCEDURE Get_PartyNetQtyPARTY "
    mysql = " CREATE PROCEDURE Get_PartyNetQtyPARTY @COMPCODE INT,@LMATURITY SMALLDATETIME,@LEXID INT,@PARTY VARCHAR(15) AS SET NOCOUNT ON "
    mysql = mysql & " IF @LEXID <>0  SELECT A.Name,B.Sauda,SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) AS NetQty "
    mysql = mysql & " FROM ACCOUNTD AS A,CTR_D AS B, SAUDAMAST AS S WHERE A.COMPCODE= @CompCode  "
    mysql = mysql & " AND S.MATURITY>=@LMATURITY AND B.SAUDAID=S.SAUDAID AND A.AC_CODE =@PARTY "
    mysql = mysql & " AND A.ACCID =B.ACCID  AND B.CONDATE <=@LMATURITY "
    mysql = mysql & " AND S.EXID= @LExID GROUP BY A.NAME,B.SAUDA "
    mysql = mysql & " HAVING SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) <> 0 ORDER BY A.NAME,B.SAUDA "
    mysql = mysql & " ELSE SELECT A.Name,B.Sauda,SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) AS NetQty "
    mysql = mysql & " FROM ACCOUNTD AS A,CTR_D AS B, SAUDAMAST AS S WHERE A.COMPCODE= @CompCode "
    mysql = mysql & " AND  S.MATURITY>=@LMATURITY AND B.SAUDAID=S.SAUDAID AND A.AC_CODE =@PARTY"
    mysql = mysql & " AND A.ACCID =B.ACCID  AND B.CONDATE <=@LMATURITY "
    mysql = mysql & " GROUP BY A.NAME,B.SAUDA HAVING SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) <> 0 "
    mysql = mysql & " ORDER BY A.NAME,B.SAUDA "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PartySaudaStd') DROP PROCEDURE Get_PartySaudaStd "
    mysql = " CREATE PROCEDURE Get_PartySaudaStd @PCOMPCODE INT, @PConDate SMALLDATETIME,@PSaudaID INT, @PAMOUNT MONEY AS SET NOCOUNT ON "

    mysql = mysql & " DECLARE @VACCID INT;DECLARE @VSAUDAID INT;DECLARE @VNetQty FLOAT;DECLARE @CLRATE FLOAT; DECLARE @LCONSNO INT; DECLARE @VCONCODE VARCHAR(50) "
    mysql = mysql & " DECLARE @COMPCODE INT; DECLARE @BCLCODE VARCHAR(20); DECLARE @SCLCODE VARCHAR(20); DECLARE @CONSNO FLOAT; DECLARE @CONDATE SMALLDATETIME; DECLARE @CONNO FLOAT; DECLARE @SAUDA VARCHAR(50); DECLARE  @ITEMCODE VARCHAR(20); DECLARE  @BPARTY VARCHAR(15); "
    mysql = mysql & " DECLARE @BQTY FLOAT; DECLARE  @BRATE FLOAT; DECLARE @PERCONT VARCHAR(1); DECLARE @SPARTY VARCHAR(15); DECLARE @SQTY FLOAT; DECLARE @SRATE FLOAT; DECLARE @DATAIMPORT bit; DECLARE  @CONTIME VARCHAR(15); DECLARE @USERID VARCHAR(50); DECLARE @ORDNO VARCHAR(25); "
    mysql = mysql & " DECLARE @ROWNO1 VARCHAR(50); DECLARE @EXCODE VARCHAR(10); DECLARE @PATTAN VARCHAR(1); DECLARE @CONCODE VARCHAR(15); DECLARE  @LCALVAL FLOAT; DECLARE  @BCONFIRM INT; DECLARE @SCONFIRM INT; DECLARE @ORDTIME VARCHAR(50); DECLARE  @INSTTYPE VARCHAR(3); "
    mysql = mysql & " DECLARE @OPTTYPE VARCHAR(2); DECLARE @STRIKE FLOAT; DECLARE @FILETYPE VARCHAR(3); DECLARE @BROKFLAG VARCHAR(1); DECLARE @EXID INT ; DECLARE @ITEMID INT; DECLARE @SAUDAID INT; DECLARE @BCODE INT "

    mysql = mysql & " DECLARE CURCART CURSOR FOR "
        mysql = mysql & " SELECT A.ACCID,S.SAUDAID ,CONCODE,SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) AS NetQty , R.CLOSERATE "
        mysql = mysql & " FROM ACCOUNTD AS A WITH (NOLOCK) ,CTR_D AS B WITH (NOLOCK) ,CTR_R AS R WITH (NOLOCK) , SAUDAMAST AS S  WITH (NOLOCK) "
        mysql = mysql & " WHERE S.MATURITY>=@PConDate and S.SAUDAID=@PSaudaID  AND B.SAUDAID=S.SAUDAID  AND A.ACCID =B.ACCID  AND B.CONDATE <=@PConDate "
        mysql = mysql & " AND R.SAUDAID = S.SAUDAID AND R.CONDATE = @PConDate AND PARTY = CLCODE "
        mysql = mysql & " GROUP BY A.ACCID,S.SAUDAID,CONCODE,  R.CLOSERATE HAVING SUM(CASE B.CONTYPE WHEN 'B' THEN B.QTY * 1 WHEN 'S' THEN B.QTY*-1 END) <> 0 "
        mysql = mysql & " ORDER BY A.ACCID,S.SAUDAID,CONCODE "
    mysql = mysql & " OPEN CURCART "
    mysql = mysql & " FETCH FROM CURCART INTO  @VACCID,@VSAUDAID, @VCONCODE,@VNetQty, @CLRATE "
    mysql = mysql & " WHILE @@FETCH_STATUS = 0 "
    mysql = mysql & " BEGIN "
        
        mysql = mysql & " SELECT @EXID=EXID,@SAUDA=SAUDACODE,@EXCODE=EXCODE,@ITEMCODE=ITEMCODE,@ITEMID=ITEMID,@INSTTYPE=INSTTYPE, @OPTTYPE=OPTTYPE "
        mysql = mysql & " FROM SAUDAMAST WITH (NOLOCK) WHERE SAUDAID=@VSAUDAID "
        mysql = mysql & " SELECT @LCALVAL=LOT FROM ITEMMAST WHERE ITEMID=@ITEMID "

        mysql = mysql & " IF (@VNetQty < 0) "
        mysql = mysql & " BEGIN "
            mysql = mysql & " SET @SPARTY=@VCONCODE "
            mysql = mysql & " SELECT @BCLCODE=AC_Code, @BPARTY=AC_Code, @SCLCODE=AC_Code FROM AccountM WITH (NOLOCK) WHERE ACCID = @VACCID "
        mysql = mysql & " End "
        mysql = mysql & " Else "
        mysql = mysql & " BEGIN "
            mysql = mysql & " SET @BPARTY=@VCONCODE "
            mysql = mysql & " SELECT @BCLCODE=AC_Code,@SPARTY=AC_Code ,@SCLCODE=AC_CodE FROM AccountM WITH (NOLOCK) WHERE ACCID = @VACCID "
        mysql = mysql & " End "

        mysql = mysql & " SET @BQTY = ABS(@VNetQty); SET @BRATE = @CLRATE "
        mysql = mysql & " SET @SQTY = ABS(@VNetQty); SET @SRATE = @CLRATE "

        mysql = mysql & " SET @DATAIMPORT = 0 "
        mysql = mysql & " SET @USERID='CorrDiv'; SET @BCODE=''; SET @BROKFLAG='N'; SET @FILETYPE='0'; SET @STRIKE=0; SET @CONTIME=''; SET @ORDTIME=''; SET @SCONFIRM=0; SET @BCONFIRM=0 "
        mysql = mysql & " SET @CONDATE = @PConDate; SET @PATTAN='C'; "
        
        mysql = mysql & " set @LCONSNO=0 "
        mysql = mysql & " EXEC SP_GET_CONSNO @PCOMPCODE,@PConDate,@SAUDA,@ITEMCODE,@EXCODE,@VSAUDAID,@ITEMID,@EXID,@LCONSNO OUTPUT "
        mysql = mysql & " SET @LCONSNO=@LCONSNO "

        mysql = mysql & " set @CONNO=0 "
        mysql = mysql & " EXEC Get_Max_Conno @PCOMPCODE,@PConDate,@CONNO OUTPUT "
        mysql = mysql & " SET @CONNO=@CONNO + 1 "
        mysql = mysql & " SET @ROWNO1=@CONNO "
        
        mysql = mysql & " EXEC INSERT_CTR_D @PCOMPCODE,@BCLCODE,@SCLCODE,@LCONSNO,@CONDATE,@CONNO,@SAUDA,@ITEMCODE, @BPARTY,@BQTY, @BRATE,@PERCONT,@SPARTY,@SQTY,@SRATE,'3', "
        mysql = mysql & " @CONTIME,@USERID,@ORDNO,@ROWNO1,@EXCODE,@PATTAN,@VCONCODE, @LCALVAL, @BCONFIRM,@SCONFIRM,@ORDTIME, @INSTTYPE,@OPTTYPE,@STRIKE,@FILETYPE,@BROKFLAG,@EXID , "
        mysql = mysql & " @ITEMID,@VSAUDAID,@BCODE "
        
        
        mysql = mysql & " IF (@VNetQty < 0) "
        mysql = mysql & " BEGIN "
        mysql = mysql & " SET @BPARTY=@VCONCODE "
        mysql = mysql & " SELECT @SCLCODE=AC_Code, @SPARTY=AC_Code, @BCLCODE=AC_Code FROM AccountM WITH (NOLOCK) WHERE ACCID = @VACCID "
        mysql = mysql & " End "
        mysql = mysql & " Else "
        mysql = mysql & " BEGIN "
        mysql = mysql & " SET @SPARTY=@VCONCODE "
        mysql = mysql & " SELECT @SCLCODE=AC_Code,@BPARTY=AC_Code ,@BCLCODE=AC_CodE FROM AccountM WITH (NOLOCK) WHERE ACCID = @VACCID "
        mysql = mysql & " End "

        mysql = mysql & " SET @BQTY = ABS(@VNetQty); SET @BRATE = @CLRATE-@PAMOUNT "
        mysql = mysql & " SET @SQTY = ABS(@VNetQty); SET @SRATE = @BRATE "

        mysql = mysql & " SET @DATAIMPORT = 0 "
        mysql = mysql & " SET @USERID='CorrDiv'; SET @BCODE=''; SET @BROKFLAG='N'; SET @FILETYPE='0'; SET @STRIKE=0; SET @CONTIME=''; SET @ORDTIME=''; SET @SCONFIRM=0; SET @BCONFIRM=0 "
        mysql = mysql & " SET @CONDATE = @PConDate; SET @PATTAN='C'; "
        
        mysql = mysql & " set @LCONSNO=0 "
        mysql = mysql & " EXEC SP_GET_CONSNO @PCOMPCODE,@PConDate,@SAUDA,@ITEMCODE,@EXCODE,@VSAUDAID,@ITEMID,@EXID,@LCONSNO OUTPUT "
        mysql = mysql & " SET @LCONSNO=@LCONSNO "

        mysql = mysql & " set @CONNO=0 "
        mysql = mysql & " EXEC Get_Max_Conno @PCOMPCODE,@PConDate,@CONNO OUTPUT "
        mysql = mysql & " SET @CONNO=@CONNO + 1;      SET @ROWNO1=@CONNO "
                
        mysql = mysql & " EXEC INSERT_CTR_D @PCOMPCODE,@BCLCODE,@SCLCODE,@LCONSNO,@CONDATE,@CONNO,@SAUDA,@ITEMCODE, @BPARTY,@BQTY, @BRATE,@PERCONT,@SPARTY,@SQTY,@SRATE,'3', "
        mysql = mysql & " @CONTIME,@USERID,@ORDNO,@ROWNO1,@EXCODE,@PATTAN,@VCONCODE, @LCALVAL, @BCONFIRM,@SCONFIRM,@ORDTIME, @INSTTYPE,@OPTTYPE,@STRIKE,@FILETYPE,@BROKFLAG,@EXID , "
        mysql = mysql & " @ITEMID,@VSAUDAID,@BCODE "

    mysql = mysql & " FETCH FROM CURCART INTO @VACCID,@VSAUDAID,@VCONCODE, @VNetQty, @CLRATE "
    mysql = mysql & " End "
    mysql = mysql & " Close CURCART "
    mysql = mysql & " DEALLOCATE CURCART "

    mysql = mysql & " SELECT D.PARTY,M.Name,D.CONTYPE, D.QTY,D.RATE,D.CONCODE , A.NAME "
    mysql = mysql & " FROM CTR_D D WITH(NOLOCK) , AccountM M, AccountM A "
    mysql = mysql & " WHERE D.CONDATE = @PConDate AND D.PARTY=D.CLCODE and D.USERID='CorrDiv' AND D.PARTY=M.AC_Code  AND D.CONCODE=A.AC_Code "
    
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Diffamt') DROP PROCEDURE Get_Diffamt "
    mysql = " CREATE PROCEDURE Get_Diffamt @COMPCODE INT,@PDATE SMALLDATETIME, @LEXID INT AS SET NOCOUNT ON "
    mysql = mysql & " IF @LEXID <> 0  SELECT SUM(CASE CONTYPE WHEN 'B' THEN (Qty*Rate*CALVAL) WHEN 'S'THEN (Qty*Rate*CALVAL)*-1 END) AS DIFFAMT FROM CTR_D  "
    mysql = mysql & " WHERE EXID  =@LExID AND CONDATE =@PDATE "
    mysql = mysql & " ELSE SELECT SUM(CASE CONTYPE WHEN 'B' THEN (Qty*Rate*CALVAL) WHEN 'S'THEN (Qty*Rate*CALVAL)*-1 END) AS DIFFAMT FROM CTR_D  "
    mysql = mysql & " WHERE COMPCODE= @CompCode AND CONDATE =@PDATE "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SaudaDiffamt') DROP PROCEDURE Get_SaudaDiffamt "
    mysql = " CREATE PROCEDURE Get_SaudaDiffamt @COMPCODE INT,@PDATE SMALLDATETIME AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " SELECT CONDATE,EXID,SAUDAID,SUM(CASE CONTYPE WHEN 'B' THEN (Qty*Rate*CALVAL) WHEN 'S'THEN (Qty*Rate*CALVAL)*-1 END) AS DIFFAMT FROM CTR_D  "
    mysql = mysql & " WHERE COMPCODE= @CompCode AND CONDATE> =@PDATE "
    mysql = mysql & " GROUP BY CONDATE,EXID,SAUDAID "
    mysql = mysql & " HAVING SUM(CASE CONTYPE WHEN 'B' THEN (Qty*Rate*CALVAL)"
    mysql = mysql & " WHEN 'S'THEN (Qty*Rate*CALVAL)*-1 END)<>0"
    mysql = mysql & " ORDER BY CONDATE,EXID ,SAUDAID END "
    Cnn.Execute mysql

    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PACKDATA') DROP PROCEDURE Get_PACKDATA "
    mysql = "CREATE PROCEDURE Get_PACKDATA @COMPCODE INT,@FROMDATE SMALLDATETIME AS SET NOCOUNT ON  "
    mysql = mysql & " DELETE FROM CTR_M WHERE COMPCODE =@COMPCODE AND CONDATE <@FROMDATE "
    mysql = mysql & " UPDATE CTR_M SET PATTAN ='O' WHERE COMPCODE =@COMPCODE AND CONDATE = @FROMDATE "
    mysql = mysql & " DELETE FROM CTR_D WHERE COMPCODE =@COMPCODE AND CONDATE <= @FROMDATE "
    mysql = mysql & " DELETE FROM INV_D WHERE COMPCODE =@COMPCODE "
    mysql = mysql & " DELETE FROM INV_D1 WHERE COMPCODE =@COMPCODE "
    mysql = mysql & " DELETE FROM SAUDAMAST WHERE COMPCODE =@COMPCODE AND MATURITY < @FROMDATE "
    mysql = mysql & " DELETE FROM PITBROK WHERE COMPCODE =@COMPCODE AND UPTOSTDT < @FROMDATE "
    mysql = mysql & " DELETE FROM PITSBROK WHERE COMPCODE =@COMPCODE AND UPTOSTDT < @FROMDATE "
    mysql = mysql & " DELETE FROM PEXBROK WHERE COMPCODE =@COMPCODE AND UPTOSTDT < @FROMDATE "
    mysql = mysql & " DELETE FROM DLYMGN WHERE COMPCODE =@COMPCODE AND CONDATE <= @FROMDATE "
    mysql = mysql & " DELETE FROM DLYCLMGN WHERE COMPCODE =@COMPCODE AND CONDATE <= @FROMDATE "
    mysql = mysql & " DELETE FROM CTR_R WHERE COMPCODE =@COMPCODE AND CONDATE  < @FROMDATE "
    mysql = mysql & " DELETE FROM EXTAX WHERE COMPCODE =@COMPCODE AND TODT < @FROMDATE "
    mysql = mysql & " DELETE FROM SETTLE WHERE COMPCODE =@COMPCODE AND SETDATE  < @FROMDATE "
    mysql = mysql & " DELETE FROM SCRIPTMASTER WHERE MATURITY  < @FROMDATE "
    Cnn.Execute mysql
    
            
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_MinCondate') DROP PROCEDURE Get_MinCondate"
    mysql = " CREATE PROCEDURE GET_MinCondate  @MC_CODE INT, @MPARTY INT, @MSAUDAID INT , @TODATE SMALLDATETIME, @LDATE VARCHAR(20) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LDT SMALLDATETIME SELECT @LDT =MIN(CONDATE)  FROM CTR_D WHERE "
    mysql = mysql & "  ACCID = @MPARTY AND SAUDAID = @MSAUDAID AND CONDATE<= @TODATE  "
    mysql = mysql & "  IF (@LDT IS NULL) SET @LDATE='' ELSE SET @LDATE = CONVERT(VARCHAR(20),@LDT) END"
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Min_Sauda_Condate') DROP PROCEDURE Get_Min_Sauda_Condate"
    mysql = " CREATE PROCEDURE Get_Min_Sauda_Condate  @MC_CODE INT,  @MSAUDAID INT ,  @LDATE VARCHAR(20) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LDT SMALLDATETIME SELECT @LDT =MIN(CONDATE)  FROM CTR_D WHERE "
    mysql = mysql & "  SAUDAID = @MSAUDAID "
    mysql = mysql & "  IF (@LDT IS NULL) SET @LDATE='' ELSE SET @LDATE = CONVERT(VARCHAR(20),@LDT) END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_MaxCondate') DROP PROCEDURE Get_MaxCondate"
    mysql = " CREATE PROCEDURE GET_MaxCondate  @MC_CODE INT,@MPARTY VARCHAR(6),@MSAUDA VARCHAR(50),@TODATE SMALLDATETIME,@LDATE VARCHAR(20) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LDT SMALLDATETIME SELECT @LDT=MAX(CONDATE) FROM CTR_D WHERE "
    mysql = mysql & " COMPCODE = @MC_CODE AND PARTY = @MPARTY AND SAUDA = @MSAUDA AND CONDATE<= @TODATE "
    mysql = mysql & " IF (@LDT IS NULL) SET @LDATE='' ELSE SET @LDATE = CONVERT(VARCHAR(20),@LDT) END"
    Cnn.Execute mysql
    
'''    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ScriptContract') DROP PROCEDURE Get_ScriptContract"
'''    mysql = " CREATE PROCEDURE Get_ScriptContract @MC_CODE INT,@LMATURITY SMALLDATETIME,@LEXCODE VARCHAR(10) "
'''    mysql = mysql & " AS SET NOCOUNT ON "
'''    mysql = mysql & " BEGIN "
'''    mysql = mysql & " IF LEN(@LEXCODE)> 0  BEGIN"
'''    mysql = mysql & " SELECT S.SAUDACODE,S.SAUDANAME,S.ITEMCODE,C.ITEMNAME,S.MATURITY,S.EXCODE,S.INSTTYPE,"
'''    mysql = mysql & " S.OPTTYPE,S.STRIKEPRICE,C.LOT, S.LOT AS TRADEABLELOT,S.BROKLOT,S.REFLOT,EX.LOTWISE,S.EX_SYMBOL "
'''    mysql = mysql & " FROM SCRIPTMASTER AS S,EXMAST AS EX ,CONTRACTMASTER AS C WHERE EX.EXCODE =S.EXCODE AND EX.COMPCODE =@MC_CODE "
'''    mysql = mysql & " AND C.EX_SYMBOL =S.EX_SYMBOL  AND C.EXCODE=S.EXCODE AND S.MATURITY>=@LMATURITY "
'''    mysql = mysql & " AND EX.EXCODE =@LExCode  "
'''    mysql = mysql & " ORDER BY S.ITEMCODE ,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.MATURITY END "
'''    mysql = mysql & " ELSE IF LEN(@LEXCODE)> 0  BEGIN "
'''    mysql = mysql & " SELECT S.SAUDACODE,S.SAUDANAME,S.ITEMCODE,C.ITEMNAME,S.MATURITY,S.EXCODE,S.INSTTYPE,"
'''    mysql = mysql & " S.OPTTYPE,S.STRIKEPRICE,C.LOT, S.LOT AS TRADEABLELOT,S.BROKLOT,S.REFLOT,EX.LOTWISE,S.EX_SYMBOL "
'''    mysql = mysql & " FROM SCRIPTMASTER AS S,EXMAST AS EX ,CONTRACTMASTER AS C WHERE EX.EXCODE =S.EXCODE AND EX.COMPCODE =@MC_CODE "
'''    mysql = mysql & " AND C.EX_SYMBOL =S.EX_SYMBOL AND C.EXCODE=S.EXCODE AND S.MATURITY>=@LMATURITY "
'''    mysql = mysql & " AND EX.EXCODE =@LExCode ORDER BY S.ITEMCODE ,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.MATURITY END "
'''    mysql = mysql & " ELSE IF LEN(@LEXCODE)<1   BEGIN "
'''    mysql = mysql & " SELECT S.SAUDACODE,S.SAUDANAME,S.ITEMCODE,C.ITEMNAME,S.MATURITY,S.EXCODE,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,C.LOT,"
'''    mysql = mysql & " S.LOT AS TRADEABLELOT,S.BROKLOT,S.REFLOT,EX.LOTWISE,S.EX_SYMBOL "
'''    mysql = mysql & " FROM SCRIPTMASTER AS S,EXMAST AS EX ,CONTRACTMASTER AS C WHERE EX.EXCODE =S.EXCODE AND EX.COMPCODE =@MC_CODE "
'''    mysql = mysql & " AND C.EX_SYMBOL =S.EX_SYMBOL AND C.EXCODE=S.EXCODE AND S.MATURITY>=@LMATURITY "
'''    mysql = mysql & " ORDER BY S.ITEMCODE, S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.MATURITY  END END "
'''    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ScriptContract') DROP PROCEDURE Get_ScriptContract"
    mysql = " CREATE PROCEDURE Get_ScriptContract @MC_CODE INT,@LMATURITY SMALLDATETIME,@LEXCODE VARCHAR(10),@InstCombo varchar(3)='ALL', @TxtOptType  varchar(25)='CE',@TxtStrike float=0 "
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT S.SAUDACODE,S.SAUDANAME,S.ITEMCODE,C.ITEMNAME,S.MATURITY,S.EXCODE,S.INSTTYPE, S.OPTTYPE,S.STRIKEPRICE,C.LOT, S.LOT AS TRADEABLELOT,S.BROKLOT,S.REFLOT,EX.LOTWISE,S.EX_SYMBOL "
    mysql = mysql & " FROM SCRIPTMASTER AS S,EXMAST AS EX ,CONTRACTMASTER AS C "
    mysql = mysql & " WHERE EX.EXCODE =S.EXCODE AND EX.COMPCODE =@MC_CODE  AND C.EX_SYMBOL =S.EX_SYMBOL AND C.EXCODE=S.EXCODE AND S.MATURITY>=@LMATURITY "
    mysql = mysql & " AND (@LEXCODE='' or EX.EXCODE =@LExCode) "
    mysql = mysql & " AND (@InstCombo = 'All' OR ISNULL(S.INSTTYPE,'')=@InstCombo) "
    mysql = mysql & " AND (@InstCombo = 'All' OR (@TxtOptType <> '' and @InstCombo='OPT' and OPTTYPE=@TxtOptType)) "
    mysql = mysql & " AND (@TxtStrike = 0 OR (@InstCombo='OPT' and STRIKEPRICE=@TxtStrike)) "
    mysql = mysql & " ORDER BY S.ITEMCODE ,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.MATURITY "
    mysql = mysql & " END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SaudaContract') DROP PROCEDURE Get_SaudaContract"
    mysql = " CREATE PROCEDURE Get_SaudaContract @MC_CODE INT,@LMATURITY SMALLDATETIME,@LEXID INT  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " IF @LEXID<>0 SELECT S.SAUDACODE,S.SAUDANAME,S.ITEMCODE,S.MATURITY,S.EXCODE,S.INSTTYPE,S.OPTTYPE,"
    mysql = mysql & " S.STRIKEPRICE,S.TRADEABLELOT,C.LOT,S.BROKLOT,S.REFLOT,EX.LOTWISE,S.SAUDAID,EX.EXID,C.ITEMID "
    mysql = mysql & " FROM SAUDAMAST AS S,EXMAST AS EX ,ITEMMAST AS C WHERE EX.EXID =S.EXID  AND EX.COMPCODE =@MC_CODE AND EX.COMPCODE =C.COMPCODE AND EX.COMPCODE =S.COMPCODE "
    mysql = mysql & " AND C.ITEMID=S.ITEMID AND C.EXID = S.EXID AND S.MATURITY>=@LMATURITY  AND EX.EXID =@LExID  "
    mysql = mysql & " ORDER BY S.ITEMCODE, S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.MATURITY  "
    mysql = mysql & " ELSE "
    mysql = mysql & " SELECT S.SAUDACODE,S.SAUDANAME,S.ITEMCODE,S.MATURITY,S.EXCODE,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.TRADEABLELOT,C.LOT,S.BROKLOT,S.REFLOT,EX.LOTWISE,S.SAUDAID,EX.EXID,C.ITEMID "
    mysql = mysql & " FROM SAUDAMAST AS S,EXMAST AS EX ,ITEMMAST AS C WHERE EX.EXID =S.EXID AND EX.COMPCODE =@MC_CODE AND EX.COMPCODE =C.COMPCODE AND EX.COMPCODE =S.COMPCODE"
    mysql = mysql & " AND C.ITEMID=S.ITEMID AND C.EXID =S.EXID AND S.MATURITY>=@LMATURITY  "
    mysql = mysql & " ORDER BY S.ITEMCODE,S.INSTTYPE,S.OPTTYPE,S.STRIKEPRICE,S.MATURITY  END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_PartyCtr_d') DROP PROCEDURE Get_PartyCtr_D"
    mysql = " CREATE PROCEDURE Get_PartyCtr_d @COMPCODE INT,@LDATE SMALLDATETIME,@LEXID INT  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " IF @LEXID<>0 SELECT DISTINCT A.AC_CODE,A.NAME FROM ACCOUNTD AS A, CTR_D AS B WHERE A.COMPCODE =@CompCode "
    mysql = mysql & " AND A.ACCID =B.ACCID  AND  B.CONDATE =@Ldate AND B.EXid= @LExID AND PERCONT='P' ORDER BY A.NAME "
    mysql = mysql & " ELSE SELECT DISTINCT A.AC_CODE,A.NAME FROM ACCOUNTD AS A,CTR_D AS B WHERE A.COMPCODE =@CompCode "
    mysql = mysql & " AND A.ACCID =B.ACCID  AND  B.CONDATE =@Ldate AND PERCONT='P'  ORDER BY A.NAME END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_GRIDDATA') DROP PROCEDURE GET_GRIDDATA"
    mysql = " CREATE PROCEDURE GET_GRIDDATA @COMPCODE INT,@LDATE SMALLDATETIME,@LEXID INT  "
    mysql = mysql & " AS  SET NOCOUNT ON "
    mysql = mysql & " IF @LExID <> 0  BEGIN "
    mysql = mysql & " IF @LExID = -1    BEGIN "
    mysql = mysql & " SELECT M.Party,B.Name,D.Sauda,D.CONTYPE AS BS ,convert(decimal(18,4),D.Qty) as 'Lot',D.Qty, D.Rate,'' AS Code,'' AS Broker,0 AS ConRate,0 AS DiffRate,M.ORDNO AS ConNo,'0' AS ConTime,0 AS TradeNo,'' AS DATAIMPORT,0 AS EXCODE, '' as 'ContractType'  "
    mysql = mysql & " FROM ORD_M M, ORD_D D, ACCOUNTD B "
    mysql = mysql & " WHERE M.COMPCODE=D.COMPCODE AND M.ORDNO=D.ORDNO AND M.COMPCODE=@CompCode AND M.COMPCODE = B.COMPCODE AND M.PARTY = B.AC_CODE AND M.ORDDT=@LDATE ORDER BY M.ORDNO DESC "
    mysql = mysql & " End "
    mysql = mysql & " ELSE "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT A.Party,B.Name,A.Sauda,A.CONTYPE AS BS ,IIF(A.EXCODE='NSE',convert(decimal(18,4),A.QTY/S.REFLOT),convert(decimal(18,4),A.Qty)) as 'Lot',A.Qty, A.Rate,A.CONCODE AS Code,C.NAME AS Broker,A.BROKAMT AS ConRate,CASE A.CONTYPE WHEN 'B' THEN A.RATE-A.BROKAMT WHEN 'S'  THEN A.BROKAMT-A.RATE END AS DiffRate,A.ConNo,A.ConTime,A.ROWNO1 AS TradeNo,A.DATAIMPORT,A.EXCODE, ISNULL(A.ContractType,'0') AS 'ContractType' "
    mysql = mysql & " FROM CTR_D A, ACCOUNTD B, ACCOUNTD AS C, SAUDAMAST S  "
    mysql = mysql & " WHERE A.COMPCODE=@CompCode AND A.COMPCODE = C.COMPCODE AND A.SAUDAID = S.SAUDAID AND A.CONCODE =C.AC_CODE  AND A.COMPCODE = B.COMPCODE AND A.PARTY=B.AC_CODE AND A.EXID =@LExID  AND CONDATE =@LDATE AND PERCONT='P' ORDER BY CONNO DESC "
    mysql = mysql & " END "
    mysql = mysql & " End "
    mysql = mysql & " Else "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT A.Party,B.Name,A.Sauda,A.CONTYPE AS BS ,IIF(A.EXCODE='NSE',convert(decimal(18,4),A.QTY/S.REFLOT),convert(decimal(18,4),A.Qty)) AS 'Lot',A.Qty, A.Rate,A.CONCODE AS Code,C.NAME AS Broker,A.BROKAMT AS ConRate,CASE A.CONTYPE WHEN 'B' THEN A.RATE-A.BROKAMT WHEN 'S'  THEN A.BROKAMT-A.RATE END AS DiffRate,A.ConNo,A.ConTime,A.ROWNO1 AS TradeNo,A.DATAIMPORT,A.EXCODE, ISNULL(A.ContractType,'0') AS 'ContractType'  "
    mysql = mysql & " FROM CTR_D A, ACCOUNTD B, ACCOUNTD AS C ,SAUDAMAST S"
    mysql = mysql & " WHERE A.COMPCODE=@CompCode AND A.COMPCODE = C.COMPCODE AND A.SAUDAID=S.SAUDAID AND A.CONCODE =C.AC_CODE  AND A.COMPCODE = B.COMPCODE AND A.PARTY=B.AC_CODE AND CONDATE =@LDATE AND PERCONT='P' ORDER BY CONNO DESC "
    mysql = mysql & " End "
    Cnn.Execute mysql
        
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_SaudaCtr_d') DROP PROCEDURE Get_SaudaCtr_D"
    mysql = " CREATE PROCEDURE Get_SaudaCtr_d @COMPCODE INT,@LDATE SMALLDATETIME,@LEXID INT ,@LParty VARCHAR(15) AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " IF @LEXID<>0 AND LEN(@LPARTY)>0 BEGIN SELECT DISTINCT A.SAUDACODE,A.SAUDANAME"
    mysql = mysql & " FROM SAUDAMAST AS A, CTR_D AS B WHERE A.COMPCODE =@CompCode AND A.COMPCODE =B.COMPCODE "
    mysql = mysql & " AND A.SAUDAID =B.SAUDAID AND B.CONDATE =@LDATE "
    mysql = mysql & " AND B.EXID= @LExID AND B.PARTY =@LParty  ORDER BY A.SAUDACODE  END "
    mysql = mysql & " ELSE IF @LEXID<>0 "
    mysql = mysql & " BEGIN SELECT DISTINCT A.SAUDACODE,A.SAUDANAME"
    mysql = mysql & " FROM SAUDAMAST AS A, CTR_D AS B WHERE A.COMPCODE =@CompCode AND A.COMPCODE =B.COMPCODE "
    mysql = mysql & " AND A.SAUDAID =B.SAUDAID AND B.CONDATE =@LDATE "
    mysql = mysql & " AND B.EXID = @LExID ORDER BY A.SAUDACODE  END "
    mysql = mysql & " ELSE IF LEN(@LPARTY)>0"
    mysql = mysql & " BEGIN SELECT DISTINCT A.SAUDACODE,A.SAUDANAME"
    mysql = mysql & " FROM SAUDAMAST AS A, CTR_D AS B WHERE A.COMPCODE =@CompCode AND A.COMPCODE =B.COMPCODE "
    mysql = mysql & " AND A.SAUDACODE =B.SAUDA AND B.CONDATE =@LDATE "
    mysql = mysql & " AND B.PARTY= @LPARTY ORDER BY A.SAUDACODE  END "
    mysql = mysql & " ELSE "
    mysql = mysql & " BEGIN SELECT DISTINCT A.SAUDACODE,A.SAUDANAME"
    mysql = mysql & " FROM SAUDAMAST AS A, CTR_D AS B WHERE A.COMPCODE =@CompCode AND A.COMPCODE =B.COMPCODE "
    mysql = mysql & " AND A.SAUDAID =B.SAUDAID AND B.CONDATE =@LDATE ORDER BY A.SAUDACODE  END END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Trade') DROP PROCEDURE Get_Trade "
    mysql = " CREATE PROCEDURE Get_Trade @COMPCODE INT,@LDATE SMALLDATETIME,@LEXID INT ,@LZCONNO INT AS SET NOCOUNT ON "
    mysql = mysql & " IF @LEXID<>0 "
    mysql = mysql & " BEGIN "
    mysql = mysql & " IF @LEXID = -1 "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT 0 AS CONSNO,M.ORDNO AS CONNO,D.QTY,D.RATE,M.PARTY,D.CONTYPE,D.SAUDA,D.ITEMCODE,'' AS EXCODE,0 AS CALVAL,'' AS CONCODE, 0 AS BROKAMT,'' AS FILETYPE,'N' AS BROKFLAG,D.ROWNO AS ROWNO1,'' AS CONFIRM,0 AS SAUDAID,D.STATUS AS EXID "
    mysql = mysql & " FROM ORD_M M, ORD_D D "
    mysql = mysql & " WHERE M.COMPCODE=D.COMPCODE AND M.ORDNO=D.ORDNO AND M.COMPCODE=@CompCode AND M.ORDDT =@LDATE AND M.ORDNO = @LZConNo "
    mysql = mysql & " END "
    mysql = mysql & " ELSE "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT CONSNO,CONNO,QTY,RATE,PARTY,CONTYPE,SAUDA,ITEMCODE,EXCODE,CALVAL,CONCODE,BROKAMT,FILETYPE,BROKFLAG,ROWNO1,CONFIRM,SAUDAID,EXID "
    mysql = mysql & " FROM CTR_D "
    mysql = mysql & " WHERE COMPCODE =@CompCode AND CONDATE =@LDATE AND PARTY <> CONCODE  AND EXID = @LExID AND CONNO= @LZConNo "
    mysql = mysql & " END "
    mysql = mysql & " END "
    mysql = mysql & " ELSE "
    mysql = mysql & " SELECT CONSNO,CONNO,QTY,RATE,PARTY,CONTYPE,SAUDA,ITEMCODE,EXCODE,CALVAL,CONCODE,BROKAMT,FILETYPE,BROKFLAG,ROWNO1,CONFIRM,SAUDAID,EXID "
    mysql = mysql & " FROM CTR_D "
    mysql = mysql & " WHERE COMPCODE =@CompCode AND CONDATE =@LDATE AND PARTY <> CONCODE  AND CONNO= @LZConNo "
    
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_MaxExCondate') DROP PROCEDURE Get_MaxExCondate"
    mysql = " CREATE PROCEDURE GET_MaxExCondate @MC_CODE INT,@EXID INT ,@TODATE SMALLDATETIME,@LDATE VARCHAR(20) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LDT SMALLDATETIME SELECT @LDT=MAX(CONDATE) FROM CTR_M WHERE "
    mysql = mysql & " EXID = @EXID AND CONDATE<= @TODATE "
    mysql = mysql & " IF (@LDT IS NULL) SET @LDATE='' ELSE SET @LDATE = CONVERT(VARCHAR(20),@LDT) END"
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_MaxBillNo') DROP PROCEDURE Get_MaxBillNo"
    mysql = " CREATE PROCEDURE GET_MaxBillNo  @MC_CODE INT, @MBILLNO INT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @MBILL INT SELECT @MBILL = MAX(BILLNO) FROM INV_D WHERE "
    mysql = mysql & " COMPCODE = @MC_CODE "
    mysql = mysql & " IF (@MBILL IS NULL) SET @MBILLNO=0 ELSE SET @MBILLNO = @MBILL END"
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ClosingRate') DROP PROCEDURE Get_ClosingRate"
    mysql = "CREATE PROCEDURE GET_CLOSINGRATE @MC_CODE INT,@LCONDATE SMALLDATETIME, @SAUDAID INT ,@LOTYPE VARCHAR(1),@LRATE FLOAT OUTPUT  "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN IF @LOTYPE='C'  SELECT @LRATE =CLOSERATE FROM CTR_R WHERE  "
    mysql = mysql & " CONDATE =@LCONDATE AND SAUDAID = @SAUDAID  "
    mysql = mysql & " ELSE  SELECT TOP 1 @LRATE =CLOSERATE FROM CTR_R WHERE  "
    mysql = mysql & " CONDATE <= @LCONDATE AND SAUDAID = @SAUDAID ORDER BY CONDATE DESC IF @LRATE IS NULL SET @LRATE = 0 RETURN @LRATE END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_MaxCondate_CTRM') DROP PROCEDURE Get_MaxCondate_CTRM"
    mysql = " CREATE PROCEDURE GET_MaxCondate_CTRM  @MC_CODE INT, @MSAUDAID INT , @TODATE SMALLDATETIME, @LDATE VARCHAR(20) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LDT SMALLDATETIME SELECT @LDT = Max(CONDATE)  FROM CTR_M WHERE "
    mysql = mysql & " CONDATE<= @TODATE AND SAUDAID = @MSAUDAID   "
    mysql = mysql & " IF (@LDT IS NULL) SET @LDATE='' ELSE SET @LDATE = CONVERT(VARCHAR(20),@LDT) END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_DisCondate') DROP PROCEDURE Get_DisCondate"
    mysql = " CREATE PROCEDURE GET_DisCondate  @MC_CODE INT,@FROMDATE AS SMALLDATETIME,@LMATURITY SMALLDATETIME,@EXID INT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN SELECT DISTINCT CONDATE AS BDATE FROM CTR_M WHERE   "
    mysql = mysql & " CONDATE <=@LMaturity AND EXID =@EXID "
    mysql = mysql & " ORDER BY CONDATE END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Max_ConNo') DROP PROCEDURE Get_Max_ConNo "
    mysql = " CREATE PROCEDURE GET_MAX_CONNO @MC_CODE INT,@LCONDATE SMALLDATETIME, @LCONNO INT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " SELECT @LCONNO=MAX(CONNO)  FROM CTR_D WHERE COMPCODE =@MC_CODE AND CONDATE =@LCONDATE"
    mysql = mysql & " IF (@LCONNO IS NULL) SET @LCONNO = 0  "
    mysql = mysql & "  End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_Max_ConNoEX') DROP PROCEDURE Get_Max_ConNoEX "
    mysql = " CREATE PROCEDURE GET_MAX_CONNOEX @MC_CODE INT,@LCONDATE SMALLDATETIME,@LEXID INT , @LCONNO INT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " SELECT @LCONNO=MAX(CONNO) FROM CTR_D WHERE CONDATE =@LCONDATE AND EXID =@LEXID "
    mysql = mysql & " IF (@LCONNO IS NULL) SET @LCONNO = 0  "
    mysql = mysql & "  End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_CONTRACTMASTER') DROP PROCEDURE GET_CONTRACTMASTER "
    mysql = "CREATE PROCEDURE GET_CONTRACTMASTER @EXCODE VARCHAR(10),@EX_SYMBOL VARCHAR(20),@LITEMCODE VARCHAR(20) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LITEM AS VARCHAR(20) SET @LITEMCODE =''"
    mysql = mysql & " SELECT @LITEM =ITEMCODE FROM CONTRACTMASTER WHERE EXCODE =@EXCODE AND EX_SYMBOL = @EX_SYMBOL"
    mysql = mysql & " IF @LITEM IS NOT NULL SET @LITEMCODE =@LITEM End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_CONTRACTMASTERREC') DROP PROCEDURE GET_CONTRACTMASTERREC "
    mysql = "CREATE PROCEDURE GET_CONTRACTMASTERREC @EXCODE VARCHAR(10),@EX_SYMBOL VARCHAR(20) "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " IF LEN(@EXCODE)> 0 BEGIN "
    mysql = mysql & " SELECT EXCODE,ITEMCODE,LOT FROM CONTRACTMASTER WHERE EXCODE =@EXCODE AND EX_SYMBOL = @EX_SYMBOL END"
    mysql = mysql & " ELSE  BEGIN "
    mysql = mysql & " SELECT EXCODE,ITEMCODE,LOT FROM CONTRACTMASTER WHERE EX_SYMBOL = @EX_SYMBOL END END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_SCRIPTMASTER') DROP PROCEDURE GET_SCRIPTMASTER "
    mysql = "CREATE  PROCEDURE GET_SCRIPTMASTER @EX_SYMBOL VARCHAR(20),@MATURITY SMALLDATETIME,@EXCODE VARCHAR(10),"
    mysql = mysql & " @INSTTYPE VARCHAR(3),@OPTTYPE VARCHAR(2),@STRIKEPRICE FLOAT, @LPSAUDACODE VARCHAR(50) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPSAUDA VARCHAR(50)"
    mysql = mysql & " SELECT @LPSAUDA= SAUDACODE FROM SCRIPTMASTER"
    mysql = mysql & " WHERE EX_SYMBOL =@EX_SYMBOL AND MATURITY=@MATURITY AND EXCODE =@EXCODE AND INSTTYPE =@INSTTYPE AND OPTTYPE=@OPTTYPE AND STRIKEPRICE = @STRIKEPRICE"
    mysql = mysql & " IF @LPSAUDA IS NULL SET @LPSAUDACODE='' ELSE SET @LPSAUDACODE =@LPSAUDA"
    mysql = mysql & " End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_ACCOUNTD_CODE') DROP PROCEDURE GET_ACCOUNTD_CODE "
    mysql = "CREATE PROCEDURE GET_ACCOUNTD_CODE @COMPCODE INT, @AC_CODE VARCHAR(15),@PAC_CODE VARCHAR(15) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPAC AS VARCHAR(15) SET @PAC_CODE =''"
    mysql = mysql & " SELECT @LPAC =AC_CODE FROM ACCOUNTD WHERE COMPCODE =@COMPCODE AND AC_CODE  =@AC_CODE "
    mysql = mysql & " IF @LPAC IS NOT NULL SET @PAC_CODE  =@LPAC End"
    Cnn.Execute mysql
    
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_SAUDAID') DROP PROCEDURE GET_SAUDAID"
    mysql = "CREATE PROCEDURE GET_SAUDAID  @COMPCODE INT, @SAUDACODE VARCHAR(50),@OSAUDAID INT  OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPSAUDAID AS INT  SET @OSAUDAID =0 "
    mysql = mysql & " SELECT @LPSAUDAID =SAUDAID  FROM SAUDAMAST  WHERE COMPCODE =@COMPCODE AND SAUDACODE =@SAUDACODE"
    mysql = mysql & " IF @LPSAUDAID IS NOT NULL SET @OSAUDAID = @LPSAUDAID  End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_ITEMID') DROP PROCEDURE GET_ITEMID"
    mysql = "CREATE PROCEDURE GET_ITEMID  @COMPCODE INT, @ITEMCODE  VARCHAR(20),@OITEMID INT  OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPITEMID AS INT  SET @OITEMID =0 "
    mysql = mysql & " SELECT @LPITEMID =ITEMID  FROM ITEMMAST WHERE COMPCODE =@COMPCODE AND ITEMCODE =@ITEMCODE"
    mysql = mysql & " IF @LPITEMID IS NOT NULL SET @OITEMID = @LPITEMID  End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_SAUDACODE') DROP PROCEDURE GET_SAUDACODE"
    mysql = "CREATE PROCEDURE GET_SAUDACODE  @COMPCODE INT, @SAUDAID INT, @OSAUDACODE VARCHAR(50)  OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPSAUDACODE  AS VARCHAR(50)  SET @OSAUDACODE =''"
    mysql = mysql & " SELECT @LPSAUDACODE  =SAUDACODE FROM SAUDAMAST  WHERE  SAUDAID  =@SAUDAID "
    mysql = mysql & " IF @LPSAUDACODE IS NOT NULL SET @OSAUDACODE = @LPSAUDACODE   End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_EXID') DROP PROCEDURE GET_EXID"
    mysql = "CREATE PROCEDURE GET_EXID  @COMPCODE INT, @EXCODE VARCHAR(10),@OEXID INT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPEXID AS INT  SET @OEXID = 0 "
    mysql = mysql & " SELECT @LPEXID =EXID  FROM EXMAST WHERE COMPCODE =@COMPCODE AND EXCODE =@EXCODE"
    mysql = mysql & " IF @LPEXID IS NOT NULL SET @OEXID = @LPEXID  End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_ACCID') DROP PROCEDURE GET_ACCID"
    mysql = "CREATE PROCEDURE GET_ACCID  @COMPCODE INT, @AC_CODE VARCHAR(15),@OACCID INT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPACCID  AS INT  SET @OACCID  = 0 "
    mysql = mysql & " SELECT @LPACCID  =ACCID FROM ACCOUNTM  WHERE COMPCODE =@COMPCODE AND AC_CODE  =@AC_CODE "
    mysql = mysql & " IF @LPACCID IS NOT NULL SET @OACCID  = @LPACCID  End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_FMLYID') DROP PROCEDURE GET_FMLYID "
    mysql = "CREATE PROCEDURE GET_FMLYID   @COMPCODE INT, @FMLYCODE  VARCHAR(6),@OFMLYID INT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPFMLYID  AS INT  SET @OFMLYID   = 0 "
    mysql = mysql & " SELECT @LPFMLYID =FMLYID  FROM ACCFMLY WHERE COMPCODE =@COMPCODE AND FMLYCODE  =@FMLYCODE  "
    mysql = mysql & " IF @LPFMLYID IS NOT NULL SET @OFMLYID   = @LPFMLYID   End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_USERNAME') DROP PROCEDURE GET_USERNAME "
    mysql = "CREATE PROCEDURE GET_USERNAME @USERNAME VARCHAR(12), @PASSWD VARCHAR(12),@PUSERNAME VARCHAR(12) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPUSERNAME AS VARCHAR(12) SET @PUSERNAME =''"
    mysql = mysql & " SELECT @LPUSERNAME =USER_NAME FROM USERMASTER WHERE USER_NAME =@USERNAME AND PASSWD = @PASSWD "
    mysql = mysql & " IF @LPUSERNAME IS NOT NULL SET @PUSERNAME   =@LPUSERNAME  End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_ACCOUNTM_CODE') DROP PROCEDURE GET_ACCOUNTM_CODE "
    mysql = "CREATE PROCEDURE GET_ACCOUNTM_CODE @COMPCODE INT, @AC_CODE VARCHAR(15),@PAC_CODE VARCHAR(15) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPAC AS VARCHAR(15) SET @PAC_CODE =''"
    mysql = mysql & " SELECT @LPAC =AC_CODE FROM ACCOUNTM WHERE COMPCODE =@COMPCODE AND AC_CODE  =@AC_CODE "
    mysql = mysql & " IF @LPAC IS NOT NULL SET @PAC_CODE  =@LPAC End"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_ITEMMASTER') DROP PROCEDURE GET_ITEMMASTER "
    mysql = "CREATE PROCEDURE GET_ITEMMASTER @COMPCODE INT, @EXID  INT ,@EX_SYMBOL VARCHAR(20),@LITEMCODE VARCHAR(20) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LITEM AS VARCHAR(20) SET @LITEMCODE =''"
    mysql = mysql & " SELECT @LITEM =ITEMCODE FROM ITEMMAST WHERE  EXID =@EXID AND EXHCODE = @EX_SYMBOL"
    mysql = mysql & " IF @LITEM IS NOT NULL SET @LITEMCODE =@LITEM End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_SAUDAMASTER') DROP PROCEDURE GET_SAUDAMASTER"
    mysql = "CREATE PROCEDURE GET_SAUDAMASTER @COMPCODE INT, @EXID INT ,@ITEMID INT ,@MATURITY SMALLDATETIME,@INSTTYPE VARCHAR(3),"
    mysql = mysql & " @OPTTYPE VARCHAR(2),@STRIKEPRICE FLOAT, @PSAUDACODE VARCHAR(50) OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LSAUDA  AS VARCHAR(50) SET @PSAUDACODE =''"
    mysql = mysql & " SELECT @LSAUDA =SAUDACODE FROM SAUDAMAST WHERE  EXID=@EXID AND ITEMID = @ITEMID "
    mysql = mysql & " AND MATURITY =@MATURITY AND INSTTYPE=@INSTTYPE AND OPTTYPE =@OPTTYPE AND STRIKEPRICE=@STRIKEPRICE"
    mysql = mysql & " IF @LSAUDA IS NOT NULL SET @PSAUDACODE =@LSAUDA End"
    Cnn.Execute mysql
    
    'Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_SAUDAID') DROP PROCEDURE GET_SAUDAID"
    'MYSQL = "CREATE PROCEDURE GET_SAUDAID @COMPCODE INT, @SAUDA VARCHAR(50)"
    'MYSQL = MYSQL & " ,@PSAUDAID INT OUTPUT"
    'MYSQL = MYSQL & " AS SET NOCOUNT ON BEGIN DECLARE @LSAUDAID AS INT SET @PSAUDAID =0 "
    'MYSQL = MYSQL & " SELECT @LSAUDAID =SAUDAID FROM SAUDAMAST WHERE COMPCODE=@COMPCODE AND SAUDACODE =@SAUDA "
    'MYSQL = MYSQL & " IF @LSAUDAID IS NOT NULL SET @PSAUDAID = @LSAUDAID ELSE SET @PSAUDAID = 0  End"
    'Cnn.Execute MYSQL
        
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_EX_BROKTRAN') DROP PROCEDURE UPDATE_EX_BROKTRAN"
    mysql = " CREATE PROCEDURE UPDATE_EX_BROKTRAN (@EXID INT,@ACCID INT ,@INSTTYPE VARCHAR(3),@BROKTYPE VARCHAR(1),@BROKRATE FLOAT,@BROKRATE2 FLOAT "
    mysql = mysql & " ,@TRANTYPE VARCHAR(1),@TRANRATE FLOAT,@FROMDATE SMAlLDATETIME,@UPTODATE SMALLDATETIME )"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " UPDATE CTR_D SET TRANRATE=@TRANRATE,TRANTYPE=@TRANTYPE "
    mysql = mysql & " WHERE  TRANTYPE = '0' AND CONDATE >= @FromDate AND ACCID  = @ACCID "
    mysql = mysql & " AND INVNO = 0 AND CONDATE <=@UPTODATE AND EXID =@EXID AND INSTTYPE=@INSTTYPE "
    mysql = mysql & " UPDATE CTR_D SET BrokRate=@BROKRATE,BrokType = @BrokType,BrokRate2=@BROKRATE2 "
    mysql = mysql & " WHERE BROKTYPE = '0' AND CONDATE >= @FromDate AND ACCID = @ACCID "
    mysql = mysql & " AND INVNO = 0 AND CONDATE <=@UPTODATE AND EXID  =@EXID  AND INSTTYPE=@INSTTYPE AND BROKFLAG='Y' "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDATE_IT_BROKTRAN') DROP PROCEDURE UPDATE_IT_BROKTRAN"
    mysql = " CREATE PROCEDURE UPDATE_IT_BROKTRAN (@ITEMID INT ,@ACCID INT,@INSTTYPE VARCHAR(3),@BROKTYPE VARCHAR(1),@BROKRATE FLOAT,@BROKRATE2 FLOAT "
    mysql = mysql & " ,@TRANTYPE VARCHAR(1),@TRANRATE FLOAT,@FROMDATE SMAlLDATETIME,@UPTODATE SMALLDATETIME )"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " UPDATE CTR_D SET TRANRATE=@TRANRATE,TRANTYPE=@TRANTYPE"
    mysql = mysql & " WHERE  TRANTYPE = '0' AND CONDATE >= @FromDate AND ACCID = @ACCID "
    mysql = mysql & " AND INVNO = 0 AND CONDATE <=@UPTODATE AND ITEMID =@ITEMID AND INSTTYPE=@INSTTYPE AND BROKFLAG='Y'  "
    mysql = mysql & " UPDATE CTR_D SET BrokRate=@BROKRATE,BrokType = @BrokType,BrokRate2=@BROKRATE2 "
    mysql = mysql & " WHERE  BROKTYPE = '0' AND CONDATE >= @FromDate AND ACCID = @ACCID "
    mysql = mysql & " AND INVNO = 0 AND CONDATE <=@UPTODATE AND ITEMID =@ITEMID AND INSTTYPE=@INSTTYPE AND BROKFLAG='Y' "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_LOT') DROP PROCEDURE GET_LOT"
    mysql = "CREATE PROCEDURE GET_LOT @COMPCODE INT,@SAUDAID INT ,@ITEMID INT ,@EXID INT  "
    mysql = mysql & " ,@LXLOT FLOAT OUTPUT AS SET NOCOUNT ON BEGIN DECLARE @LLOT FLOAT DECLARE @LOTWISE VARCHAR(1) SET @LXLOT=1 DECLARE @EXCODE VARCHAR(10)"
    mysql = mysql & " SELECT @LOTWISE =LOTWISE ,@EXCODE=EXCODE FROM EXMAST WHERE  EXID =@EXID"
    mysql = mysql & " IF (@ExCode = 'NSE' And @Lotwise = 'Y') "
    mysql = mysql & " SELECT @LLOT=TRADEABLELOT FROM SAUDAMAST WHERE  SAUDAID=@SAUDAID  "
    mysql = mysql & " ELSE IF  @ExCode = 'MCX' And @Lotwise = 'Y' "
    mysql = mysql & " SELECT @LLOT = TRADEABLELOT FROM SAUDAMAST WHERE  SAUDAID =@SAUDAID  "
    mysql = mysql & " Else "
    mysql = mysql & " SELECT @LLOT = LOT FROM ITEMMAST WHERE  ITEMID =@ITEMID "
    mysql = mysql & " IF @LLOT IS NOT NULL SET @LXLOT =@LLOT End "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_ACCT_EX')DROP PROCEDURE GET_ACCT_EX"
    mysql = "CREATE PROCEDURE GET_ACCT_EX @COMPCODE INT, @EXID INT ,@ACEXCODE VARCHAR(30),@PAC_CODE VARCHAR(15) OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LPCODE VARCHAR(15) "
    mysql = mysql & " SELECT @LPCODE = AC_CODE FROM ACCT_EX WHERE  EXID =@EXID AND ACEXCODE= @ACEXCODE "
    mysql = mysql & " IF @LPCODE IS NOT NULL SET @PAC_CODE = @LPCODE ELSE SET @PAC_CODE = '' END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='DELETE_CTR_R') DROP PROCEDURE DELETE_CTR_R"
    mysql = "CREATE PROCEDURE DELETE_CTR_R @COMPCODE INT,@CONDATE SMALLDATETIME, @EXID INT  AS SET NOCOUNT ON"
    mysql = mysql & " DELETE FROM CTR_R WHERE CONDATE =@CONDATE AND EXID =@EXID "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='DELETE_CTR_D') DROP PROCEDURE DELETE_CTR_D"
    mysql = "CREATE PROCEDURE [DELETE_CTR_D] @COMPCODE INT,@CONDATE SMALLDATETIME, @EXCODE VARCHAR(10),"
    mysql = mysql & " @DATAIMPORT AS BIT ,@FILETYPE VARCHAR(3) AS"
    mysql = mysql & " SET NOCOUNT ON BEGIN DECLARE @STRSQL NVARCHAR(MAX)"
    mysql = mysql & " SET @STRSQL='DELETE FROM CTR_D WHERE COMPCODE =' + CONVERT(VARCHAR(50),@COMPCODE)+ ' AND CONDATE ='''+CONVERT(VARCHAR(50),@CONDATE) + ''' AND DATAIMPORT = 1'"
    mysql = mysql & " IF LEN(@EXCODE) > 1   SET @STRSQL = @STRSQL + ' AND EXCODE='''+ @EXCODE +''''"
    mysql = mysql & " IF LEN(@FILETYPE) >1  SET @STRSQL = @STRSQL + ' AND FILETYPE=''' + @FILETYPE+''''"
    mysql = mysql & " EXEC SP_EXECUTESQL @STRSQL End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Chk_DuplicateContractItem') DROP PROCEDURE Chk_DuplicateContractItem "
    mysql = " CREATE PROCEDURE Chk_DuplicateContractItem @ITEMCODE VARCHAR(20),@LEXIST INT OUTPUT  "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LITEM VARCHAR(20) "
    mysql = mysql & " SELECT @LITEM =ITEMCODE FROM CONTRACTMASTER WHERE ITEMCODE =@ITEMCODE "
    mysql = mysql & " IF @LITEM IS NOT NULL SET @LEXIST =1 ELSE SET @LEXIST =0 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Chk_DuplicateScriptSauda') DROP PROCEDURE Chk_DuplicateScriptSauda "
    mysql = " CREATE PROCEDURE Chk_DuplicateScriptSauda @SAUDACODE VARCHAR(50),@LEXIST INT OUTPUT  "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LSAUDA VARCHAR(50) "
    mysql = mysql & " SELECT @LSAUDA =SAUDACODE FROM SCRIPTMASTER  WHERE SAUDACODE  =@SAUDACODE "
    mysql = mysql & " IF @LSAUDA IS NOT NULL SET @LEXIST =1 ELSE SET @LEXIST =0 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Chk_ItemCode') DROP PROCEDURE Chk_ItemCode "
    mysql = " CREATE PROCEDURE Chk_ItemCode @COMPCODE INT,@ITEMCODE VARCHAR(20),@LPITEMCODE VARCHAR(20) OUTPUT  "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LITEM VARCHAR(20) "
    mysql = mysql & " SELECT @LITEM =ITEMCODE FROM ITEMMAST WHERE COMPCODE =@COMPCODE AND ITEMCODE =@ITEMCODE  "
    mysql = mysql & " IF @LITEM IS NOT NULL SET @LPITEMCODE  =@LITEM ELSE SET @LPITEMCODE  ='' END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='CHK_SAUDACODE') DROP PROCEDURE CHK_SAUDACODE"
    mysql = " CREATE PROCEDURE CHK_SAUDACODE @COMPCODE INT,@SAUDACODE VARCHAR(50),@LPSAUDACODE VARCHAR(50) OUTPUT  "
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @LSAUDA VARCHAR(50) "
    mysql = mysql & " SELECT @LSAUDA =SAUDACODE FROM SAUDAMAST WHERE COMPCODE =@COMPCODE AND SAUDACODE  =@SAUDACODE "
    mysql = mysql & " IF @LSAUDA IS NOT NULL SET @LPSAUDACODE=@LSAUDA  ELSE SET @LPSAUDACODE='' END "
    Cnn.Execute mysql
    
    
    
    
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_BROKQTY') DROP PROCEDURE UPD_BROKQTY "
    mysql = " CREATE PROCEDURE UPD_BROKQTY @MC_CODE INT, @ROWNO INT, @BROKQTY FLOAT  AS SET NOCOUNT ON "
    mysql = mysql & " UPDATE CTR_D SET BROKQTY = @BrokQty,UPDBQTY =1 WHERE  ROWNO = @ROWNO  "
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Op_Qty') DROP PROCEDURE Op_Qty"
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='SPOp_Qty') DROP PROCEDURE SPOp_Qty"
    mysql = " CREATE PROCEDURE SPOp_Qty @MC_CODE INT,@PARTY VARCHAR(15),@SAUDAID INT, @UPTODATE SMALLDATETIME, @NETQTY FLOAT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN DECLARE @NQTY FLOAT "
    mysql = mysql & " SELECT @NQTY=SUM(CASE CONTYPE WHEN 'B' THEN QTY*1 WHEN 'S' THEN QTY*-1 END) FROM CTR_D "
    mysql = mysql & " WHERE PARTY= @PARTY AND SAUDAID= @SAUDAID AND CONDATE < @UPTODATE "
    mysql = mysql & " IF (@NQTY IS NULL) SET @NETQTY =0 ELSE SET @NETQTY =@NQTY END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ContypeQty') DROP PROCEDURE Get_ContypeQty "
    mysql = "CREATE PROCEDURE Get_ContypeQty @MC_CODE INT,@PARTY VARCHAR(15),@SAUDAID INT ,@FROMDATE SMALLDATETIME"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " SELECT CONDATE,CONTYPE,SUM(QTY) AS TOTQTY FROM CTR_D WHERE  "
    mysql = mysql & " SAUDAID = @SAUDAID AND PARTY =@PARTY AND CONDATE>=@FromDate "
    mysql = mysql & " GROUP BY CONDATE,CONTYPE ORDER BY CONDATE,CONTYPE "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_ExDMargin') DROP PROCEDURE Get_ExDMargin"
    mysql = "CREATE PROCEDURE Get_ExDMargin @MC_CODE INT, @PARTY VARCHAR(15),@EXID INT ,@FROMDATE SMALLDATETIME  "
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " SELECT D.CONDATE,D.EXID,D.EXCODE,D.PARTY,E.MARGINACC,SUM(D.MARGINAMT) AS MAMOUNT FROM DMARGIN AS D, EXMAST AS E "
    mysql = mysql & " WHERE D.EXID =E.EXID "
    mysql = mysql & " AND D.CONDATE >=@FromDate "
    mysql = mysql & " AND D.PARTY = @PARTY AND E.EXID = @EXID "
    mysql = mysql & " GROUP BY D.CONDATE, D.EXID,D.EXCODE, D.PARTY,E.MARGINACC  "
    mysql = mysql & " ORDER BY D.CONDATE,D.EXID,D.EXCODE,D.PARTY,E.MARGINACC"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='DELETE_ITEMS') DROP PROCEDURE DELETE_ITEMS"
    mysql = " CREATE PROCEDURE DELETE_ITEMS "
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " DELETE FROM CTR_M WHERE SAUDA NOT IN (SELECT DISTINCT SAUDA FROM CTR_D)"
    mysql = mysql & " DELETE FROM CTR_R WHERE SAUDA NOT IN (SELECT DISTINCT SAUDA  FROM CTR_D)"
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_CONSNO') DROP PROCEDURE GET_CONSNO"
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='SP_GET_CONSNO') DROP PROCEDURE SP_GET_CONSNO"
    mysql = " CREATE PROCEDURE SP_GET_CONSNO @MC_CODE INT,@CONDATE SMALLDATETIME,@LSAUDA VARCHAR(50),@ITEMCODE VARCHAR(20),@EXCODE VARCHAR(10),@SAUDAID INT,@ITEMID INT,@EXID INT,@LCONSNO INT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " SELECT @LCONSNO = CONSNO FROM CTR_M WHERE CONDATE = @CONDATE AND SAUDAID = @SAUDAID  "
    mysql = mysql & " IF @LCONSNO IS NULL  "
    mysql = mysql & " BEGIN "
    mysql = mysql & " SELECT @LCONSNO=MAX(CONSNO) FROM CTR_M WHERE COMPCODE = @MC_CODE "
    mysql = mysql & " IF  @LCONSNO IS NULL  SET @LCONSNO=1 ELSE SET @LCONSNO = @LCONSNO + 1"
    mysql = mysql & " INSERT INTO CTR_M(COMPCODE,CONSNO,CONDATE,SAUDA,ITEMCODE,PATTAN,EXCODE,SAUDAID,EXID,ITEMID ) "
    mysql = mysql & "            VALUES(@MC_CODE,@LCONSNO,@CONDATE,@LSAUDA,@ITEMCODE,'C',@EXCODE,@SAUDAID,@EXID,@ITEMID) "
    mysql = mysql & "  End  "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_CTR_M') DROP PROCEDURE INSERT_CTR_M "
    mysql = "CREATE PROCEDURE INSERT_CTR_M @MC_CODE INT,@CONSNO INT,@CONDATE SMALLDATETIME,@SAUDA VARCHAR(50),@ITEMCODE VARCHAR(20),@PATTAN VARCHAR(1),@EXCODE VARCHAR(10),@EXID INT,@ITEMID INT,@SAUDAID INT "
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " INSERT INTO CTR_M(COMPCODE,CONSNO,CONDATE,SAUDA,ITEMCODE,PATTAN,EXCODE,SAUDAID,EXID,ITEMID)"
    mysql = mysql & " VALUES(@MC_CODE,@CONSNO,@CONDATE,@SAUDA,@ITEMCODE,@PATTAN,@EXCODE,@SAUDAID,@EXID,@ITEMID)"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_MENU') DROP PROCEDURE INSERT_MENU "
    mysql = "CREATE PROCEDURE INSERT_MENU @MENU_NAME VARCHAR(100),@SW VARCHAR(50),@LGROUP VARCHAR(100), @LCAPTION VARCHAR(100), @LPCODE INT AS SET NOCOUNT ON  "
    mysql = mysql & " INSERT INTO USER_MENU(MENUNAME,SW,GROUP_MENU,MCAPTION,PCODE) VALUES "
    mysql = mysql & "(@MENU_NAME,@SW,@LGROUP,@LCAPTION,@LPCODE )"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='VOU_NO') DROP PROCEDURE VOU_NO "
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Max_VouNo') DROP PROCEDURE Max_VouNo"
    mysql = "CREATE PROCEDURE Max_VouNo @COMPCODE INT, @VCHSERIES VARCHAR(20), @FINYEAR VARCHAR(15) ,@MVOUNO INT OUTPUT AS SET NOCOUNT ON BEGIN "
    mysql = mysql & "DECLARE @MVN INT SELECT @MVN=MAX(CAST(SUBSTRING(VOU_NO,10,7) AS INT)) FROM VOUCHER WHERE COMPCODE= @COMPCODE "
    mysql = mysql & " AND SUBSTRING(VOU_NO,1,9)= @VCHSERIES + @FINYEAR + '-'"
    mysql = mysql & " IF (@MVN IS NULL) SET @MVOUNO =0 ELSE SET @MVOUNO =@MVN END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_CNOTE') DROP PROCEDURE UPD_CNOTE "
    mysql = "CREATE PROCEDURE UPD_CNOTE @COMPCODE INT,@LPARTY VARCHAR(6),@LEXID INT  , @LCONDATE SMALLDATETIME,@LNOTENO INT"
    mysql = mysql & " AS SET NOCOUNT ON UPDATE CTR_D SET NOTENO=@LNOTENO WHERE  PARTY=@LPARTY AND EXCODE =@LEXID AND CONDATE =@LCONDATE"
    Cnn.Execute mysql
    
    Cnn.Execute "  IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_CNOTE01072017') DROP PROCEDURE UPD_CNOTE01072017 "
    mysql = "CREATE PROCEDURE UPD_CNOTE01072017 @COMPCODE INT,@LPARTY VARCHAR(6), @LCONDATE SMALLDATETIME,@LNOTENO INT"
    mysql = mysql & " AS SET NOCOUNT ON UPDATE CTR_D SET NOTENO=@LNOTENO WHERE COMPCODE =  @COMPCODE AND PARTY=@LPARTY AND CONDATE =@LCONDATE"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INTIGRITY_CHECK') DROP PROCEDURE INTIGRITY_CHECK"
    mysql = "CREATE PROCEDURE INTIGRITY_CHECK @COMPCODE INT,@LFINBEG SMALLDATETIME,@LFINEND SMALLDATETIME"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " DELETE FROM CTR_D WHERE CONSNO IS NULL "
    mysql = mysql & " DELETE FROM CTR_M WHERE CONSNO IS NULL "
    mysql = mysql & " DELETE FROM VOUCHER WHERE COMPCODE = @COMPCODE AND VOU_NO='' "
    mysql = mysql & " DELETE FROM VCHAMT WHERE COMPCODE = @COMPCODE  AND VOU_NO='' "
    mysql = mysql & " DELETE FROM VCHAMT WHERE COMPCODE =@COMPCODE AND VOU_NO NOT IN (SELECT VOU_NO FROM VOUCHER WHERE COMPCODE =@COMPCODE) "
    mysql = mysql & " UPDATE PITBROK  SET TRANTYPE = 'P' WHERE COMPCODE  = @COMPCODE  AND (TRANTYPE IS NULL OR TRANTYPE  = '') "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='COMPANYLIST') DROP PROCEDURE COMPANYLIST"
    mysql = "CREATE PROCEDURE CompanyList AS SELECT COMPCODE,Name from Company "
    Cnn.Execute mysql
    
    
'    MYSQL = "CREATE PROCEDURE [dbo].[INSERT_CTR_D]  (@COMPCODE INT,@BCLCODE VARCHAR(20),@SCLCODE VARCHAR(20),@CONSNO FLOAT,"
'    MYSQL = MYSQL & " @CONDATE SMALLDATETIME,@CONNO FLOAT,@SAUDA VARCHAR(50),@ITEMCODE VARCHAR(20), @BPARTY VARCHAR(6),@BQTY FLOAT,"
'    MYSQL = MYSQL & " @BRATE FLOAT,@PERCONT VARCHAR(1),@SPARTY VARCHAR(6),@SQTY FLOAT,@SRATE FLOAT,@DATAIMPORT VARCHAR(1),"
'    MYSQL = MYSQL & " @CONTIME VARCHAR(15),@USERID VARCHAR(50),@ORDNO VARCHAR(25),@ROWNO1 VARCHAR(50),@EXCODE VARCHAR(10),"
'    MYSQL = MYSQL & " @PATTAN VARCHAR(1),@CONCODE VARCHAR(6), @LCALVAL FLOAT,@BCONFIRM INT,@SCONFIRM INT,@ORDTIME VARCHAR(50),"
'    MYSQL = MYSQL & " @INSTTYPE VARCHAR(3),@OPTTYPE VARCHAR(2),@STRIKE FLOAT,@FILETYPE VARCHAR(2),@BROKFLAG VARCHAR(1),@EXID INT ,@ITEMID INT,@SAUDAID INT,@BCODE INT)"
'    MYSQL = MYSQL & " AS SET NOCOUNT ON"
'    MYSQL = MYSQL & " BEGIN"
'    MYSQL = MYSQL & " DECLARE @LBROKAMT AS FLOAT"
'    MYSQL = MYSQL & " DECLARE @LPERCONT AS VARCHAR(1)"
'    MYSQL = MYSQL & " DECLARE @LBROKTYPE AS VARCHAR(1)"
'    MYSQL = MYSQL & " DECLARE @LBROKRATE AS FLOAT"
'    MYSQL = MYSQL & " DECLARE @LBROKRATE2 AS FLOAT"
'    MYSQL = MYSQL & " DECLARE @LTRANTYPE AS VARCHAR(1)"
'    MYSQL = MYSQL & " DECLARE @LTRANRATE AS FLOAT"
'    MYSQL = MYSQL & " IF @BCODE =0 BEGIN"
'    MYSQL = MYSQL & " SELECT TOP 1 @LTRANTYPE=TRANTYPE, @LTRANRATE = TRANRATE "
'    MYSQL = MYSQL & " From PITBROK WHERE AC_CODE =@BPARTY AND INSTTYPE=@INSTTYPE "
'    MYSQL = MYSQL & " AND UPTOSTDT >=@CONDATE AND ITEMID= @ITEMID  ORDER BY UPTOSTDT END"
'    MYSQL = MYSQL & " ELSE BEGIN  SET @LTRANTYPE='P'SET @LTRANRATE=0 END"
'    MYSQL = MYSQL & " IF @LTRANTYPE IS NULL"
'    MYSQL = MYSQL & "   BEGIN"
'    MYSQL = MYSQL & "   SELECT TOP 1 @LTRANTYPE=TRANTYPE, @LTRANRATE = TRANRATE "
'    MYSQL = MYSQL & "   From PEXBROK WHERE  AC_CODE =@BPARTY AND INSTTYPE=@INSTTYPE AND EXID=@EXID "
'    MYSQL = MYSQL & "   AND uptostdt>=@CONDATE ORDER BY UPTOSTDT"
'    MYSQL = MYSQL & "   End"
'    MYSQL = MYSQL & " IF @BROKFLAG<>'Y'"
'    MYSQL = MYSQL & "     BEGIN"
'    MYSQL = MYSQL & "         SET @LBROKTYPE='P'"
'    MYSQL = MYSQL & "         SET @LBROKRATE=0"
'    MYSQL = MYSQL & "         SET @LBROKRATE2=0"
'    MYSQL = MYSQL & "     End"
'    MYSQL = MYSQL & " Else"
'    MYSQL = MYSQL & "   BEGIN"
'    MYSQL = MYSQL & "   SELECT TOP 1 "
'    MYSQL = MYSQL & "   @LBROKTYPE=(CASE WHEN MinRate<@BRATE AND MBROKTYPE<>'F' THEN BROKTYPE WHEN MinRate>=@BRATE AND MBROKTYPE<>'F' THEN MBROKTYPE WHEN MBROKTYPE='F' THEN BROKTYPE END ),"
'    MYSQL = MYSQL & "   @LBROKRATE=(CASE WHEN MinRate<@BRATE AND MBROKTYPE<>'F' THEN BROKRATE WHEN MinRate>= @BRATE AND MBROKTYPE<>'F' THEN MBROKRATE WHEN MBROKTYPE='F' THEN BROKRATE END ),"
'    MYSQL = MYSQL & "   @LBROKRATE2=(CASE WHEN MinRate<@BRATE AND MBROKTYPE<>'F' THEN BROKRATE2 WHEN MinRate>=@BRATE AND MBROKTYPE<>'F' THEN MBROKRATE2 WHEN MBROKTYPE='F' THEN BROKRATE2 END )"
'    MYSQL = MYSQL & "   FROM PITBROK WHERE AC_CODE =@BPARTY AND INSTTYPE=@INSTTYPE AND ITEMID= @ITEMID AND uptostdt>=@CONDATE"
'    MYSQL = MYSQL & "   ORDER BY uptostdt"
'    MYSQL = MYSQL & "   IF @LBROKTYPE IS NULL"
'    MYSQL = MYSQL & "       BEGIN"
'    MYSQL = MYSQL & "       SELECT TOP 1  "
'    MYSQL = MYSQL & "       @LBROKTYPE = (CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKTYPE WHEN MinRate >=@BRATE AND MBROKTYPE<>'F' THEN MBROKTYPE WHEN MBROKTYPE='F' THEN BROKTYPE END ),"
'    MYSQL = MYSQL & "       @LBROKRATE = (CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKRATE WHEN MinRate >=@BRATE AND MBROKTYPE<>'F' THEN MBROKRATE WHEN MBROKTYPE='F' THEN BROKRATE END ),"
'    MYSQL = MYSQL & "       @LBROKRATE2 =(CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKRATE2 WHEN MinRate >=@BRATE AND MBROKTYPE<>'F' THEN MBROKRATE2 WHEN MBROKTYPE='F' THEN BROKRATE2 END )"
'    MYSQL = MYSQL & "       From PEXBROK WHERE AC_CODE =@BPARTY AND INSTTYPE=@INSTTYPE AND EXID=@EXID AND uptostdt>=@CONDATE order by uptostdt"
'    MYSQL = MYSQL & "   End"
'    MYSQL = MYSQL & " End"
'    MYSQL = MYSQL & " IF @BPARTY=@CONCODE"
'    MYSQL = MYSQL & "   SET @LPERCONT ='C'"
'    MYSQL = MYSQL & " Else"
'    MYSQL = MYSQL & "   SET @LPERCONT ='P'"
'    MYSQL = MYSQL & " IF @BPARTY<>@CONCODE"
'    MYSQL = MYSQL & "   SET @LBROKAMT=@SRATE"
'    MYSQL = MYSQL & " Else"
'    MYSQL = MYSQL & "   SET @LBROKAMT=0"
'    MYSQL = MYSQL & " INSERT INTO CTR_D (COMPCODE,CLCODE,CONSNO,CONDATE,CONNO,SAUDA,ITEMCODE,PARTY,QTY,RATE,CONTYPE,PERCONT,DATAIMPORT,CONTIME,USERID,ORDNO,ROWNO1,EXCODE,PATTAN,CONCODE,CALVAL,CONFIRM,ORDTIME,INSTTYPE,OPTTYPE,STRIKE,BROKAMT,BrokType,BROKRATE,BROKRATE2,TranType,TRANRATE,FILETYPE,BROKFLAG,SAUDAID,EXID,ITEMID )"
'    MYSQL = MYSQL & " VALUES(@COMPCODE,@BCLCODE,@CONSNO,@CONDATE,@CONNO,@SAUDA,@ITEMCODE,@BPARTY,@BQTY,@BRATE,'B',@LPERCONT,@DATAIMPORT,@CONTIME,@USERID,@ORDNO,@ROWNO1,@EXCODE,@PATTAN,@CONCODE,@LCALVAL,@BCONFIRM,@ORDTIME,@INSTTYPE,@OPTTYPE,@STRIKE,@LBROKAMT,@LBROKTYPE,@LBROKRATE,@LBROKRATE2,@LTRANTYPE,@LTRANRATE,@FILETYPE,@BROKFLAG,@SAUDAID,@EXID,@ITEMID )"
'    MYSQL = MYSQL & " IF @BCODE =0 BEGIN "
'    MYSQL = MYSQL & "         SET @LTRANTYPE= NULL "
'    MYSQL = MYSQL & "         SELECT TOP 1 @LTRANTYPE=TRANTYPE, @LTRANRATE = TRANRATE "
'    MYSQL = MYSQL & "         From PITBROK WHERE CompCode =@COMPCODE AND AC_CODE =@SPARTY AND INSTTYPE=@INSTTYPE "
'    MYSQL = MYSQL & "         AND UPTOSTDT >=@CONDATE AND ITEMID= @ITEMID  ORDER BY UPTOSTDT END "
'    MYSQL = MYSQL & "         IF @LTRANTYPE IS NULL"
'    MYSQL = MYSQL & "         BEGIN"
'    MYSQL = MYSQL & "           SELECT TOP 1 @LTRANTYPE=TRANTYPE, @LTRANRATE = TRANRATE "
'    MYSQL = MYSQL & "           From PEXBROK WHERE CompCode =@COMPCODE AND AC_CODE =@SPARTY AND INSTTYPE=@INSTTYPE AND EXID=@EXID AND uptostdt>=@CONDATE ORDER BY UPTOSTDT"
'    MYSQL = MYSQL & "         End"
'    MYSQL = MYSQL & " SET @LBROKTYPE='0'"
'    MYSQL = MYSQL & " IF @BROKFLAG<>'Y'"
'    MYSQL = MYSQL & "   BEGIN"
'    MYSQL = MYSQL & "   SET @LBROKTYPE='P'"
'    MYSQL = MYSQL & "   SET @LBROKRATE=0"
'    MYSQL = MYSQL & "   SET @LBROKRATE2=0"
'    MYSQL = MYSQL & "   End"
'    MYSQL = MYSQL & " IF @LBROKTYPE ='0'"
'    MYSQL = MYSQL & "   BEGIN"
'    MYSQL = MYSQL & "   SELECT TOP 1 "
'    MYSQL = MYSQL & "   @LBROKTYPE=(CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKTYPE WHEN MinRate>=@BRATE AND MBROKTYPE<>'F' THEN MBROKTYPE WHEN MBROKTYPE='F' THEN BROKTYPE END),"
'    MYSQL = MYSQL & "   @LBROKRATE=(CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKRATE WHEN MinRate>=@BRATE AND MBROKTYPE<>'F' THEN MBROKRATE WHEN MBROKTYPE='F' THEN BROKRATE  END ),"
'    MYSQL = MYSQL & "   @LBROKRATE2=(CASE  WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKRATE2 WHEN MinRate>=@BRATE AND MBROKTYPE<>'F' THEN MBROKRATE2 WHEN MBROKTYPE='F' THEN BROKRATE2 END)"
'    MYSQL = MYSQL & "   FROM PITBROK WHERE  AC_CODE =@SPARTY AND INSTTYPE=@INSTTYPE AND ITEMID = @ITEMID AND UPTOSTDT >=@CONDATE"
'    MYSQL = MYSQL & "   ORDER BY UPTOSTDT"
'    MYSQL = MYSQL & "   IF @LBROKTYPE ='0'"
'    MYSQL = MYSQL & "       BEGIN"
'    MYSQL = MYSQL & "       SELECT TOP 1 "
'    MYSQL = MYSQL & "       @LBROKTYPE=(CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKTYPE WHEN MinRate>=@SRATE AND MBROKTYPE<>'F' THEN MBROKTYPE WHEN MBROKTYPE='F' THEN BROKTYPE END),"
'    MYSQL = MYSQL & "       @LBROKRATE=(CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKRATE WHEN  MinRate >=@SRATE  AND MBROKTYPE<>'F' THEN MBROKRATE WHEN MBROKTYPE='F' THEN BROKRATE END),"
'    MYSQL = MYSQL & "       @LBROKRATE2 = (CASE WHEN MinRate <@BRATE AND MBROKTYPE<>'F' THEN BROKRATE2 WHEN MinRate >=@SRATE  AND MBROKTYPE<>'F' THEN MBROKRATE2 WHEN MBROKTYPE='F' THEN BROKRATE2 END)"
'    MYSQL = MYSQL & "       FROM PEXBROK WHERE AC_CODE =@SPARTY AND INSTTYPE=@INSTTYPE AND EXID=@EXID AND UPTOSTDT >=@CONDATE"
'    MYSQL = MYSQL & "       ORDER BY UPTOSTDT"
'    MYSQL = MYSQL & "       End"
'    MYSQL = MYSQL & "   End "
'    MYSQL = MYSQL & " IF @SPARTY=@CONCODE"
'    MYSQL = MYSQL & "   SET @LPERCONT ='C'"
'    MYSQL = MYSQL & " Else"
'    MYSQL = MYSQL & "   SET @LPERCONT ='P'"
'    MYSQL = MYSQL & " IF @SPARTY<>@CONCODE"
'    MYSQL = MYSQL & "   SET @LBROKAMT=@BRATE"
'    MYSQL = MYSQL & " Else"
'    MYSQL = MYSQL & "   SET @LBROKAMT=0"
'    MYSQL = MYSQL & " INSERT INTO CTR_D (COMPCODE,CLCODE,CONSNO,CONDATE,CONNO,SAUDA,ITEMCODE,PARTY,QTY,RATE,CONTYPE,PERCONT,DATAIMPORT,CONTIME,USERID,ORDNO,ROWNO1,EXCODE,PATTAN,CONCODE,CALVAL,CONFIRM,ORDTIME,INSTTYPE,OPTTYPE,STRIKE,BROKAMT,BrokType,BROKRATE,BROKRATE2,TranType,TRANRATE,FILETYPE,BROKFLAG,SAUDAID,EXID,ITEMID )"
'    MYSQL = MYSQL & " VALUES(@COMPCODE,@SCLCODE,@CONSNO,@CONDATE,@CONNO,@SAUDA,@ITEMCODE,@SPARTY,@SQTY,@SRATE,'S',@LPERCONT,@DATAIMPORT,@CONTIME,@USERID,@ORDNO,@ROWNO1,@EXCODE,@PATTAN,@CONCODE,@LCALVAL,@SCONFIRM,@ORDTIME,@INSTTYPE,@OPTTYPE,@STRIKE,@LBROKAMT,@LBROKTYPE,@LBROKRATE,@LBROKRATE2,@LTRANTYPE,@LTRANRATE,@FILETYPE,@BROKFLAG,@SAUDAID,@EXID,@ITEMID )"
'    MYSQL = MYSQL & " End"
'    Cnn.Execute MYSQL
'
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_CTR_DBS') DROP PROCEDURE INSERT_CTR_DBS"
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_CTR_R') DROP PROCEDURE INSERT_CTR_R"
    mysql = " CREATE PROCEDURE INSERT_CTR_R (@COMPCODE INT,@CONSNO FLOAT,@SAUDA VARCHAR(50),@CONDATE SMALLDATETIME,@OPRATE  FLOAT,@HGRATE FLOAT,"
    mysql = mysql & " @LOWRATE FLOAT,@CLOSERATE FLOAT,@CLRATE FLOAT,@EXCODE VARCHAR(10),@ITEMCODE VARCHAR(20),@SAUDAID INT,@ITEMID INT,@EXID INT,@PRATE FLOAT,@CONTIME VARCHAR(50) ) AS SET NOCOUNT ON "
    mysql = mysql & " INSERT INTO CTR_R (COMPCODE,CONSNO,SAUDA,CONDATE,OPRATE,HGRATE,LOWRATE,CLOSERATE,CLRATE,EXCODE,ITEMCODE,SAUDAID,EXID,ITEMID,PRATE,CONTIME ) "
    mysql = mysql & " VALUES(@COMPCODE,@CONSNO,@SAUDA,@CONDATE,@OPRATE,@HGRATE,@LOWRATE,@CLOSERATE,@CLRATE, @EXCODE,@ITEMCODE,@SAUDAID,@EXID,@ITEMID,@PRATE,@CONTIME ) "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='SearchUser') DROP PROCEDURE SearchUser "
    mysql = "CREATE PROCEDURE SearchUser(@CompCode smallint,@UserCode varchar(6),@Password varchar(7))"
    mysql = mysql & " as begin select count(UserCode) from WEBUSER where  CompCode=@CompCode and  UserCode=@UserCode and Pwd=@Password End"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='DELETE_VOUCHER') DROP PROCEDURE DELETE_VOUCHER"
    mysql = "CREATE PROCEDURE DELETE_VOUCHER @COMPCODE INT, @FDATE SMALLDATETIME,@TDATE SMALLDATETIME AS SET NOCOUNT ON "
    mysql = mysql & " UPDATE CTR_D SET BILLNO = 0 WHERE COMPCODE  = @COMPCODE AND CONDATE >= @FDATE AND INVNO = 0  "
    mysql = mysql & " DELETE FROM INV_D WHERE COMPCODE = @COMPCODE AND STDATE >=@FDATE  AND INVNO = 0 "
    mysql = mysql & " DELETE FROM INV_D1 WHERE COMPCODE =@COMPCODE AND STDATE >=@FDATE "
    mysql = mysql & " DELETE FROM VOUCHER WHERE COMPCODE =@COMPCODE AND VOU_DT >=@FDATE AND VOU_TYPE IN ('S','H','B') AND INVNO = 0 "
    mysql = mysql & " DELETE FROM VCHAMT WHERE COMPCODE =@COMPCODE  AND VOU_DT >=@FDATE AND VOU_TYPE IN ('S','H','B') AND INVNO = 0 "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='TR' AND NAME='DEL_VCHAMT') DROP TRIGGER DEL_VCHAMT "
    mysql = "CREATE TRIGGER DEL_VCHAMT ON VOUCHER AFTER DELETE  AS SET NOCOUNT ON BEGIN  "
    mysql = mysql & " DELETE FROM VCHAMT WHERE VOU_ID IN (SELECT DISTINCT VOU_ID FROM DELETED ) END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='TR' AND NAME='DEL_CTR_D') DROP TRIGGER DEL_CTR_D "
    'MYSQL = " CREATE TRIGGER DEL_CTR_D ON CTR_D AFTER DELETE AS SET NOCOUNT ON BEGIN"
    'MYSQL = MYSQL & " DELETE FROM INV_D WHERE COMPCODE IN (SELECT DISTINCT COMPCODE FROM DELETED) AND"
    'MYSQL = MYSQL & " PARTY IN (SELECT DISTINCT PARTY FROM DELETED ) AND"
    'MYSQL = MYSQL & " SAUDAID IN (SELECT DISTINCT SAUDAID FROM DELETED ) AND"
    'MYSQL = MYSQL & " STDATE >= (SELECT MIN(CONDATE) FROM DELETED ) End"
    'Cnn.Execute MYSQL
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_COMP') DROP PROCEDURE UPD_COMP"
    mysql = "CREATE PROCEDURE UPD_COMP  @LCOMPCODE INT AS  SET NOCOUNT ON "
    mysql = mysql & "UPDATE CTR_D SET COMPCODE =@LCOMPCODE  WHERE COMPCODE =@LCOMPCODE + 99 "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_COMP9') DROP PROCEDURE UPD_COMP9"
    mysql = "CREATE PROCEDURE UPD_COMP9  @LCOMPCODE INT AS  SET NOCOUNT ON "
    mysql = mysql & "UPDATE CTR_D SET COMPCODE =COMPCODE + 99   "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='TR' AND NAME='DEL_INV_D1_VOUCHER') DROP TRIGGER DEL_INV_D1_VOUCHER"
    mysql = "CREATE TRIGGER DEL_INV_D1_VOUCHER ON INV_D1 AFTER DELETE  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " UPDATE INV_D1 SET SVOU_ID =0 ,SVOU_NO='',POST  =0 WHERE SVOU_ID IN (SELECT DISTINCT SVOU_ID FROM DELETED WHERE SVOU_ID <>0 )"
    mysql = mysql & " UPDATE INV_D1 SET BVOU_ID =0 ,VOU_NO='',POST = 0 WHERE BVOU_ID IN (SELECT DISTINCT BVOU_ID FROM DELETED  WHERE BVOU_ID <>0 ) END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='TR' AND NAME='DEL_INV_VOUCHER') DROP TRIGGER DEL_INV_VOUCHER"
    mysql = "CREATE TRIGGER DEL_INV_VOUCHER ON INV_D AFTER DELETE  AS  SET NOCOUNT ON BEGIN "
    mysql = mysql & " UPDATE INV_D SET VOU_ID =0, VCHNO='',POST =0 WHERE VOU_ID IN (SELECT DISTINCT VOU_ID FROM DELETED WHERE VOU_ID <>0 ) END "
    'MYSQL = MYSQL & " DELETE FROM VOUCHER WHERE VOU_TYPE='S' AND SAUDA IN (SELECT DISTINCT PARTY FROM DELETED )"
    'MYSQL = MYSQL & " AND VOU_DT >= (SELECT MIN(STDATE) FROM DELETED ) AND EXID IN  (SELECT DISTINCT EXID FROM DELETED )"
    'MYSQL = MYSQL & " UPDATE CTR_D SET BILLNO =0 WHERE BILLNO IN (SELECT DISTINCT BILLNO  FROM DELETED) AND COMPCODE IN (SELECT TOP 1 COMPCODE FROM DELETED )"
    ''MYSQL = MYSQL & " DELETE FROM VOUCHER WHERE VOU_NO IN (SELECT DISTINCT STMVOU FROM DELETED) AND COMPCODE IN (SELECT DISTINCT COMPCODE FROM DELETED )"
    'MYSQL = MYSQL & " END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='TR' AND NAME='DEL_INV_D1') DROP TRIGGER DEL_INV_D1"
    'MYSQL = "CREATE TRIGGER DEL_INV_D1  ON INV_D1 AFTER DELETE AS SET NOCOUNT ON BEGIN "
    'MYSQL = MYSQL & " DELETE FROM VOUCHER WHERE VOU_NO IN (SELECT DISTINCT VOU_NO FROM DELETED) AND COMPCODE IN (SELECT DISTINCT COMPCODE FROM DELETED ) "
    'MYSQL = MYSQL & " DELETE FROM VOUCHER WHERE VOU_NO IN (SELECT DISTINCT SVOU_NO FROM DELETED) AND COMPCODE IN (SELECT DISTINCT COMPCODE FROM DELETED )"
    'MYSQL = MYSQL & " END"
    'Cnn.Execute MYSQL
    
    
    
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='ACST') DROP PROCEDURE ACST "
    mysql = "CREATE PROCEDURE AcSt @MCCODE INT,@FROMDATE SMALLDATETIME,@TODATE SMALLDATETIME,@SAUDAID INT ,@PARTY VARCHAR(15),@BCODE INT AS SET NOCOUNT ON "
    mysql = mysql & " IF @BCODE =0 "
    mysql = mysql & " SELECT STTRATE,STMRATE,SrvTax,TranRATE,TranTYPE,BROKRATE,BROKTYPE,BROKRATE2,CONNO,CONTIME,CGSTRATE,SGSTRATE,IGSTRATE,UTTRATE,"
    mysql = mysql & " CONDATE, QTY, RATE, CONTYPE, BROKQTY, PATTAN, ROWNO1,BROKQTY2,SEBITAX,SBC_TAX,ORDNO,EQ_STT,EQ_STAMP,ISNULL(INSTTYPE ,'') AS 'INSTTYPE',BROKFLAG FROM CTR_D"
    mysql = mysql & " WHERE COMPCODE=@MCCODE AND CONDATE >=@FROMDATE AND CONDATE <=@TODATE AND SAUDAID =@SAUDAID AND PARTY =@PARTY"
    If GAcOrder = "C" Then
        mysql = mysql & " ORDER BY CONDATE,CONNO "
    Else
        mysql = mysql & " ORDER BY CONDATE,RATE "
    End If
    mysql = mysql & " ELSE "
    mysql = mysql & " SELECT SAUDA,BROKRATE,BROKTYPE,BROKRATE2,CONNO,CONTIME,CONDATE,QTY,RATE,CONTYPE,BROKQTY,PATTAN,ROWNO1,BROKQTY2,ORDNO,ISNULL(INSTTYPE ,'') AS 'INSTTYPE' FROM CTR_D "
    mysql = mysql & " WHERE COMPCODE=@MCCODE AND CONDATE >=@FROMDATE AND CONDATE <=@TODATE AND SAUDAID = @SAUDAID AND PARTY =@PARTY "
    If GAcOrder = "C" Then
        mysql = mysql & " ORDER BY CONDATE,CONNO "
    Else
        mysql = mysql & " ORDER BY CONDATE,RATE  "
    End If
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='CHKINV')DROP PROCEDURE CHKINV"
    mysql = "CREATE PROCEDURE CHKINV @MPARTY INT ,@MSAUDAID INT ,@MUPTODATE SMALLDATETIME AS SET NOCOUNT ON SELECT TOP 1 STDATE,CLQTY, CLRATE "
    mysql = mysql & " FROM INV_D WHERE STDATE <=  @MUPTODATE AND ACCID =@MPARTY AND SAUDAID = @MSAUDAID ORDER BY STDATE DESC"
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='CHKOP')  DROP PROCEDURE CHKOP"
    mysql = "CREATE PROCEDURE CHKOP @MPARTY INT , @MSAUDAID  INT,@MUPTODATE AS SMALLDATETIME AS SET NOCOUNT ON "
    mysql = mysql & " SELECT CONDATE,CONTYPE, SUM(QTY) AS OPQNTY, SUM(QTY * RATE) AS OPAMT FROM CTR_D "
    mysql = mysql & " WHERE CONDATE <= @MUPTODATE AND ACCID  = @MPARTY "
    mysql = mysql & " AND SAUDAID=@MSAUDAID AND PATTAN='O'  "
    mysql = mysql & " GROUP BY CONDATE,CONTYPE "
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='CHKOP2')  DROP PROCEDURE CHKOP2"
    mysql = "CREATE PROCEDURE CHKOP2 @MPARTY INT , @MSAUDAID  INT,@MUPTODATE AS SMALLDATETIME AS SET NOCOUNT ON "
    mysql = mysql & " SELECT SUM(CASE CONTYPE WHEN 'B' THEN QTY WHEN 'S' THEN QTY*-1 END ) AS OPQNTY, "
    mysql = mysql & " SUM(CASE CONTYPE WHEN 'B' THEN (QTY * RATE*CALVAL)  WHEN 'S' THEN (QTY*RATE*CALVAL) *-1 END ) AS OPAMT FROM CTR_D"
    mysql = mysql & " WHERE ACCID=@MPARTY AND SAUDAID=@MSAUDAID AND PATTAN='O' AND CONDATE <= @MUPTODATE "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='SDBILLREC') DROP PROCEDURE SDBILLREC"
    mysql = "CREATE PROCEDURE SDBILLREC @MPARTY INT,@MSAUDAID INT ,@MFROMDATE SMALLDATETIME,@MUPTODATE SMALLDATETIME,@BCODE INT AS SET NOCOUNT ON"
    mysql = mysql & " IF @BCODE =0 "
    mysql = mysql & " SELECT CALVAL,TRANTAX,STTRATE,STMRATE,SRVTAX,TRANRATE,TRANTYPE,BROKRATE,BROKQTY,BROKTYPE,BROKRATE2,"
    mysql = mysql & " CONTYPE, QTY, RATE,BROKQTY2,SEBITAX,SBC_TAX,CGSTRATE,SGSTRATE,IGSTRATE,UTTRATE,ORDNO,EQ_STT,EQ_STAMP,BROKFLAG"
    mysql = mysql & " From  CTR_D WHERE ACCID =@MPARTY AND SAUDAID= @MSAUDAID "
    mysql = mysql & " AND PATTAN<>'O' AND CONDATE >= @MFROMDATE AND CONDATE<= @MUPTODATE "
    mysql = mysql & " ELSE "
    mysql = mysql & " SELECT CALVAL, BROKRATE,BROKQTY, BROKTYPE, BROKRATE2,CONTYPE,QTY,RATE,BROKQTY2,ORDNO,BROKFLAG "
    mysql = mysql & " From  CTR_D WHERE ACCID =@MPARTY AND SAUDAID= @MSAUDAID "
    mysql = mysql & " AND PATTAN<>'O' AND CONDATE >= @MFROMDATE AND CONDATE<= @MUPTODATE "
    
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UpdQty')  DROP PROCEDURE UPDQTY"
    mysql = "CREATE PROCEDURE UPDQTY @MPARTY INT,@SAUDAID INT,@CONDATE SMALLDATETIME,@FLATQTY FLOAT,@SPREADQTY FLOAT AS SET NOCOUNT ON "
    mysql = mysql & " UPDATE DMARGIN SET FLATQTY = @FLATQTY,SPREADQTY=@SPREADQTY WHERE ACCID =@MPARTY AND SAUDAID= @SAUDAID AND CONDATE=@CONDATE "
    Cnn.Execute mysql
        
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='Get_AccBal') DROP PROCEDURE Get_AccBal "
    mysql = " CREATE PROCEDURE Get_AccBal  @MC_CODE INT, @MPARTY VARCHAR(15),  @TODATE SMALLDATETIME, @LBALANCE FLOAT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN SELECT @LBALANCE =SUM(Case DR_CR WHEN 'D' THEN  AMOUNT * -1 WHEN 'C' THEN  AMOUNT * 1  END) "
    mysql = mysql & " From VCHAMT WHERE COMPCODE = @MC_CODE AND AC_CODE = @MPARTY AND VOU_TYPE<>'M' AND VOU_DT< @TODATE  "
    mysql = mysql & " IF (@LBALANCE IS NULL) SET @LBALANCE=0  End "
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='ACSUMVCHS') DROP PROCEDURE ACSUMVCHS"
    mysql = "CREATE PROCEDURE ACSUMVCHS @MC_CODE INT,@MPARTY VARCHAR(15),@FROMDATE SMALLDATETIME,@TODATE SMALLDATETIME AS SET NOCOUNT ON "
    mysql = mysql & " SELECT SUM(Case DR_CR WHEN 'D' THEN AMOUNT * -1 WHEN 'C' THEN  AMOUNT * 1  END) AS AMT FROM VCHAMT "
    mysql = mysql & " WHERE COMPCODE=@MC_CODE AND AC_CODE=@MPARTY AND VOU_TYPE NOT IN ( 'M','S','I' ) AND VOU_DT>= @FROMDATE AND VOU_DT<= @TODATE"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='REINDEXTABLE') DROP PROCEDURE REINDEXTABLE "
    mysql = "CREATE PROCEDURE REINDEXTABLE AS "
    mysql = mysql & " DBCC DBREINDEX (ACCOUNTM) "
    mysql = mysql & " ALTER INDEX ALL ON ACCOUNTM REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON ACCOUNTD REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON ACCFMLY  REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON ACCFMLYD REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON CTR_M    REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON CTR_D    REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON CTR_R    REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON VOUCHER  REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON VCHAMT   REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON ITEMMAST REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON SAUDAMAST REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON DLYCLMGN REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON DLYMGN   REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON DMARGIN  REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON INV_D    REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON INV_D1   REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON VOUCHER  REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON VCHAMT   REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON PITBROK  REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON PEXBROK  REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON PEXSBROK REBUILD WITH (FILLFACTOR = 80)"
    mysql = mysql & " ALTER INDEX ALL ON PITSBROK REBUILD WITH (FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDBROK') DROP PROCEDURE UPDBROK"
    'MYSQL = "CREATE PROCEDURE UPDBROK @MC_CODE INT AS SET NOCOUNT ON"
    'MYSQL = MYSQL & " UPDATE CTR_D SET BROKRATE=0,BrokRate2 =0 ,TranRate = 0,BrokType = '0', STMRATE = 0, TranType = '0',  "
    'MYSQL = MYSQL & " BROKQTY2 = 0, UPDBQTY = 0, SRVTAX = 0, SEBITAX = 0, SBC_TAX = 0, BROKQTY=0, CGSTRATE=0, SGSTRATE=0, IGSTRATE=0, UTTRATE=0  "
    'MYSQL = MYSQL & " WHERE COMPCODE=@MC_CODE AND INVNO = 0"
    'Cnn.Execute MYSQL
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPDBROKDT')  DROP PROCEDURE UPDBROKDT"
    'MYSQL = "CREATE PROCEDURE UPDBROKDT @MC_CODE INT, @SDATE SMALLDATETIME"
    'MYSQL = MYSQL & " AS SET NOCOUNT ON "
    'MYSQL = MYSQL & " UPDATE CTR_D SET BROKRATE=0,BrokRate2=0,TranRate = 0,BrokType = '0', STMRATE = 0, TranType = '0', "
    'MYSQL = MYSQL & " BROKQTY2 = 0, UPDBQTY = 0, SRVTAX = 0, SEBITAX = 0, SBC_TAX = 0, BROKQTY=0, CGSTRATE=0, SGSTRATE=0, IGSTRATE=0, UTTRATE=0 "
    'MYSQL = MYSQL & " WHERE COMPCODE=@MC_CODE AND INVNO = 0 AND CONDATE >@SDATE "
    'Cnn.Execute MYSQL
   '
   Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_ACCFMLYD')  DROP PROCEDURE INSERT_ACCFMLYD "
   mysql = "CREATE PROCEDURE INSERT_ACCFMLYD  @MC_CODE INT, @FMLYCODE VARCHAR(6),@PARTY VARCHAR(15),@FMLYID INT ,@ACCID INT "
   mysql = mysql & " AS SET NOCOUNT ON BEGIN"
   mysql = mysql & " INSERT INTO ACCFMLYD (COMPCODE,FMLYCODE,PARTY,FMLYID,ACCID ) VALUES "
   mysql = mysql & "(@MC_CODE ,@FmlyCode ,@Party  ,@FMLYID,@ACCID ) END "
   Cnn.Execute mysql
            
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_SCRIPT_MASTER') DROP PROCEDURE INSERT_SCRIPT_MASTER"
    mysql = "CREATE PROCEDURE INSERT_SCRIPT_MASTER @EXCODE VARCHAR(10),@EX_SYMBOL VARCHAR(20),@ITEMCODE VARCHAR(20),@LOT FLOAT,@SAUDACODE VARCHAR(50),@SAUDANAME VARCHAR(50),@MATURITY SMALLDATETIME,@STRIKEPRICE FLOAT,@OPTTYPE VARCHAR(2),@INST_TYPE VARCHAR(3),@NOCODE INT,@BrokLot FLOAT,@REFLOT FLOAT "
    mysql = mysql & " AS  SET NOCOUNT ON"
    mysql = mysql & " INSERT INTO SCRIPTMASTER ( EXCODE, EX_SYMBOL, ITEMCODE, LOT, SAUDACODE, SAUDANAME, MATURITY, STRIKEPRICE, OPTTYPE, INSTTYPE,  NOCODE, BROKLOT,REFLOT) "
    mysql = mysql & " VALUES                   (@EXCODE,@EX_SYMBOL,@ITEMCODE,@LOT,@SAUDACODE,@SAUDANAME,@MATURITY,@STRIKEPRICE,@OPTTYPE,@INST_TYPE,@NOCODE,@BROKLOT,@REFLOT) "
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_CONTRACTMASTER') DROP PROCEDURE INSERT_CONTRACTMASTER"
    mysql = "CREATE PROCEDURE INSERT_CONTRACTMASTER @EXCODE VARCHAR(10),@ITEMCODE VARCHAR(20),@ITEMNAME VARCHAR(50),@EX_SYMBOL VARCHAR(20),@LOT FLOAT,@SC_GROUP VARCHAR(10), @PRICEUNIT VARCHAR(50),@QTYUNIT VARCHAR(50),@DELIVERYUNIT VARCHAR(50),@REGULARLOT FLOAT"
    mysql = mysql & " AS  SET NOCOUNT ON"
    mysql = mysql & " INSERT INTO CONTRACTMASTER (EXCODE,ITEMCODE,ITEMNAME,EX_SYMBOL,LOT,SC_GROUP,PRICEUNIT,QTYUNIT,DELIVERYUNIT,REGULARLOT)"
    mysql = mysql & " VALUES                     (@EXCODE,@ITEMCODE,@ITEMNAME,@EX_SYMBOL,@LOT,@SC_GROUP,@PRICEUNIT,@QTYUNIT,@DELIVERYUNIT,@REGULARLOT)"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_ITEMMAST') DROP PROCEDURE INSERT_ITEMMAST "
    mysql = "CREATE PROCEDURE INSERT_ITEMMAST @COMPCODE INT,@ITEMCODE VARCHAR(20),@ITEMNAME VARCHAR(50),@LOT FLOAT,@EXHCODE VARCHAR(20),@EXCHANGECODE VARCHAR(10),"
    mysql = mysql & " @PRICEUNIT VARCHAR(50),@QTYUNIT VARCHAR(50),@REGULARLOT FLOAT,@SCGROUP VARCHAR(10),@CTTAPP VARCHAR(1),@RISKMAPP VARCHAR(1),@STMAPP VARCHAR(1),@CTTDATE SMALLDATETIME,@EXID AS INT "
    mysql = mysql & " AS  SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO ITEMMAST (COMPCODE,ITEMCODE,ITEMNAME,LOT,EXHCODE,EXCHANGECODE,PRICEUNIT,QTYUNIT,REGULARLOT,SCGROUP,CTTAPP,RISKMAPP,STMAPP,CTTDATE,EXID)"
    mysql = mysql & " VALUES              (@COMPCODE,@ITEMCODE,@ITEMNAME,@LOT,@EXHCODE,@EXCHANGECODE,@PRICEUNIT,@QTYUNIT,@REGULARLOT,@SCGROUP,@CTTAPP,@RISKMAPP,@STMAPP,@CTTDATE,@EXID)"
    mysql = mysql & " UPDATE ITEMMAST SET CITEMID =ITEMID WHERE COMPCODE =@COMPCODE AND ITEMCODE =@ITEMCODE END "
    Cnn.Execute mysql
    
    '>>> STORED PROCEDURE TO GENERATE CONTRACT LOG
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_CTR_D_LOG') DROP PROCEDURE GET_CTR_D_LOG "
    mysql = "CREATE PROCEDURE GET_CTR_D_LOG @COMPCODE INT,@FDATE SMALLDATETIME , @TDATE SMALLDATETIME "
    mysql = mysql & " AS  SET NOCOUNT ON  "
    mysql = mysql & " create table #temp (CompCode varchar(5),CONSNO int,CONNO int,PARTY  varchar(15),SAUDA  varchar(250),ITEMCODE  varchar(250),CONDATE datetime,CONTYPE  varchar(1),QTY float,RATE money,BILLNO  varchar(15),ROWNO1 int,loginuser  varchar(15),datetm datetime,[tran]  varchar(7), rowtype varchar(15)) "
    mysql = mysql & " insert into #temp "
    mysql = mysql & " SELECT CompCode,CONSNO,CONNO,PARTY,SAUDA,ITEMCODE,CONDATE,CONTYPE,QTY,RATE,BILLNO,ROWNO1,loginuser,datetm,(case when [tran]=2 then 'Edit' when [tran]=1 then 'Add' when [tran]=3 then 'Delete' when [tran]=4 then 'Qty. Zero' else '' end)  as 'tran','log' "
    mysql = mysql & " From CTR_D_log "
    mysql = mysql & " WHERE COMPCODE =@COMPCODE  AND CONDATE >= @FDATE AND CONDATE <= @TDATE "
    mysql = mysql & " insert into #temp "
    mysql = mysql & " SELECT CompCode,CONSNO,CONNO,PARTY,SAUDA,ITEMCODE,CONDATE,CONTYPE,QTY,RATE,BILLNO,ROWNO1,'','',condate,'Actual' "
    mysql = mysql & " From CTR_D "
    mysql = mysql & " WHERE COMPCODE =@COMPCODE  AND CONDATE >= @FDATE AND CONDATE <= @TDATE AND CONNO in (select conno from #temp) AND CONSNO in (select CONSNO from #temp)  "
    mysql = mysql & " select CompCode,CONSNO,CONNO,PARTY,SAUDA,ITEMCODE,CONDATE,CONTYPE,QTY,RATE,BILLNO,ROWNO1,loginuser,datetm,[tran],rowtype from #temp "
    mysql = mysql & " order by CONNO,rowtype desc "
    Cnn.Execute mysql
    
    '>>> STORED PROCEDURE TO GENERATE VOUCHER LOG
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_VCHAMT_LOG') DROP PROCEDURE GET_VCHAMT_LOG "
    mysql = "CREATE PROCEDURE GET_VCHAMT_LOG @COMPCODE INT,@FDATE SMALLDATETIME , @TDATE SMALLDATETIME "
    mysql = mysql & " AS  SET NOCOUNT ON "
    mysql = mysql & " create table #temp (CompCode varchar(5),VOU_NO VARCHAR(25),VOU_TYPE VARCHAR(5),VOU_DT datetime, DR_CR  varchar(1),AC_CODE  varchar(150),AMOUNT MONEY,CHEQUE_NO  varchar(25),CHEQUE_DT VARCHAR(20),NARRATION VARCHAR(150),BRANCH varchar(50),BANK_NAME varchar(50),vouid INT,invno INT,EXCODE varchar(15),IAMOUNT MONEY,CURRRATE MONEY,EXID INT,VOU_ID INT,ACCID INT,loginuser varchar(25),datetm DATETIME,[tran] varchar(15),rowtype VARCHAR(10)) "
    mysql = mysql & " insert into #temp "
    mysql = mysql & " SELECT CompCode,VOU_NO,VOU_TYPE,VOU_DT,DR_CR,(select z.name from AccountM z with(nolock) where z.CompCode=@COMPCODE and z.ac_code=V.ac_code),AMOUNT,CHEQUE_NO,CHEQUE_DT,NARRATION,BRANCH,BANK_NAME,vouid,invno,EXCODE,IAMOUNT,CURRRATE,EXID,VOU_ID,ACCID,loginuser,datetm, "
    mysql = mysql & " (case when [tran]=2 then 'Edit' when [tran]=1 then 'Add' when [tran]=3 then 'Delete' when [tran]=4 then 'Qty. Zero' else '' end)  as 'tran','log' "
    mysql = mysql & " From VCHAMT_LOG V WHERE COMPCODE =@COMPCODE  AND VOU_DT >= @FDATE AND VOU_DT <= @TDATE "
    mysql = mysql & " insert into #temp "
    mysql = mysql & " SELECT CompCode,VOU_NO,VOU_TYPE,VOU_DT,DR_CR,(select z.name from AccountM z with(nolock) where z.CompCode=@COMPCODE and z.ac_code=V.ac_code),AMOUNT,CHEQUE_NO,CHEQUE_DT,NARRATION,BRANCH,BANK_NAME,vouid,invno,EXCODE,IAMOUNT,CURRRATE,EXID,VOU_ID,ACCID,'',VOU_DT,'','Actual' "
    mysql = mysql & " From VCHAMT V WHERE COMPCODE =@COMPCODE  AND VOU_DT >= @FDATE AND VOU_DT <= @TDATE AND VOU_NO in (select DISTINCT VOU_NO from #temp) AND invno in (select DISTINCT invno from #temp) "
    mysql = mysql & " select CompCode,VOU_NO,VOU_TYPE,VOU_DT,DR_CR,AC_CODE,AMOUNT,CHEQUE_NO,CHEQUE_DT,NARRATION,BRANCH,BANK_NAME,vouid,invno,EXCODE,IAMOUNT,CURRRATE,EXID,VOU_ID,ACCID,loginuser,datetm,[tran],rowtype from #temp "
    mysql = mysql & " order by VOU_NO,invno,rowtype desc "
    Cnn.Execute mysql
                
    'Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='UPD_BROKERAGE') DROP PROCEDURE UPD_BROKERAGE "
    'MYSQL = "CREATE PROCEDURE UPD_BROKERAGE "
    'MYSQL = MYSQL & " (@COMPCODE INT,@PARTY VARCHAR(6),@CONSNO INT,@CONNO INT,@BROKTYPE VARCHAR(1),@BROKRATE FLOAT,@BROKRATE2 FLOAT,@MBROKTYPE VARCHAR(1),"
    'MYSQL = MYSQL & " @MBROKRATE FLOAT,@MBROKRATE2 FLOAT,@TRANTYPE VARCHAR(1),@TRANRATE FLOAT,@MINRATE FLOAT )"
    'MYSQL = MYSQL & " AS SET NOCOUNT ON BEGIN"
    'MYSQL = MYSQL & " If @MINRATE = 0"
    'MYSQL = MYSQL & " UPDATE CTR_D SET BROKRATE= @BROKRATE,@BROKTYPE =@BROKTYPE, BROKRATE2 = @BROKRATE2,  TRANTYPE = @TRANTYPE ,TRANRATE =@TRANRATE "
    'MYSQL = MYSQL & " WHERE COMPCODE = @COMPCODE AND PARTY =@PARTY AND CONSNO=@CONSNO AND CONNO = @CONNO "
    'MYSQL = MYSQL & " Else "
    'MYSQL = MYSQL & " UPDATE CTR_D SET BROKRATE= @BROKRATE,@BROKTYPE =@BROKTYPE, BROKRATE2 = @BROKRATE2,  TRANTYPE = @TRANTYPE ,TRANRATE =@TRANRATE "
    'MYSQL = MYSQL & " WHERE COMPCODE = @COMPCODE AND PARTY =@PARTY AND CONSNO=@CONSNO AND CONNO = @CONNO AND RATE >@MINRATE "
    'MYSQL = MYSQL & " UPDATE CTR_D SET BROKRATE= @BROKRATE,@BROKTYPE =@BROKTYPE, BROKRATE2 = @BROKRATE2,  TRANTYPE = @TRANTYPE ,TRANRATE =@TRANRATE "
    'MYSQL = MYSQL & " WHERE COMPCODE = @COMPCODE AND PARTY =@PARTY AND CONSNO=@CONSNO AND CONNO = @CONNO AND RATE <=@MINRATE END"
    'Cnn.Execute MYSQL
    Exit Sub
err1:
    If err.Number <> 0 Then
        MsgBox err.Description

        If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
    End If
    
End Sub
Public Function EncryptNEW(NAME As String, key As Long) As String
Dim v As Long, c1 As String, z As String
For v = 1 To Len(NAME)
    c1 = Asc(Mid(NAME, v, 1))
    c1 = Chr(c1 + key)             ' your private goes key here !
    z = z & c1
Next v
EncryptNEW = z
End Function

Public Function DecryptNEW(NAME As String, key As Long) As String

'NAME = "znrr"
Dim v As Long, c1 As String, z As String
For v = 1 To Len(NAME)
    c1 = Asc(Mid(NAME, v, 1))
    c1 = Chr(c1 - key)            'your private goes key here !
    z = z & c1
Next v
DecryptNEW = z
End Function

Public Sub Reg_1_TO_500()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    
    
    
    B = Encrypt("1506667186"): CustId = "MUKUDR": LTDate = DateValue("15/03/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1)

    SNo2 = vbNullString
    
    
End Sub
Public Sub Reg_501_TO_1000()
    Dim B As String:    Dim SNo2 As String:     Dim SNo3 As String:     Dim CustId As String:   Dim LTDate As Date:                 Dim LLDATE As Date
    B = vbNullString:   SNo2 = vbNullString:    SNo3 = vbNullString:    CustId = vbNullString:  LTDate = DateValue("13/04/2018")
    Dim SNo4 As String
    '65
    
    '78 Dinesh Akot
    '79
    SNo2 = vbNullString:  SNo3 = vbNullString
    '81
    
    
    '82
    '84
    '85
    
    
End Sub
Public Sub Reg_1001_TO_1500()
    Dim B As String:      Dim SNo2 As String:   Dim SNo3 As String::  Dim CustId As String: Dim LTDate As Date
    Dim SNo4 As String:   Dim SNo5 As String:   Dim SNo6 As String:   Dim LLDATE As Date:   SNo6 = vbNullString
    B = vbNullString:     SNo2 = vbNullString:  SNo3 = vbNullString:  SNo4 = vbNullString:  SNo5 = vbNullString:
    
    '1
    '14
    '16
    
    '18 Gurmukh
    '19
    'B = Encrypt("777023225"): CustId = "1104AKL": LTDate = DateValue("29/04/2020"): LLDATE = DateValue("29/04/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1104)
    '20
    '21
    '22
    'B = Encrypt("1475235779"):   CustId = "1125CHI": LTDate = DateValue("25/04/2020"): LLDATE = DateValue("16/04/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1125)
    '23
    '24
    'B = Encrypt("1532317812"): CustId = "1166AUR": LTDate = DateValue("30/04/2020"): LLDATE = DateValue("25/04/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1166)
    '25
    '30
    
    '33
    '36
    '37

    '38
    '47
    B = Encrypt("965717024"): CustId = "1375RJN": LTDate = DateValue("25/07/2023"): LLDATE = DateValue("01/01/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1375)
    
    '55
    
    
    'B = Encrypt("1142329621"): CustId = "1379AIND": SNo2 = Encrypt("658790998"): SNo3 = Encrypt("958844525")
    'LTDate = DateValue("29/04/2020"): LLDATE = DateValue("08/04/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1379)
    
    '56
    SNo2 = vbNullString: SNo3 = vbNullString
    '59
    
    '60
    

    '63
    '64
    '71
    
    
End Sub
Public Sub Y2015()
    Dim B As String
    Dim SNo2 As String:  Dim SNo3 As String:  Dim CustId As String:  Dim LTDate As Date
    Dim LLDATE As Date: LLDATE = DateValue("01/01/2000")
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString
    '42
    
    
End Sub

Private Sub Y2017()
    Dim B As String:     Dim SNo2 As String:               Dim SNo3 As String:    Dim CustId As String:    Dim LTDate As Date
    Dim LLDATE As Date:  LLDATE = DateValue("01/01/2000"): B = vbNullString:      SNo2 = vbNullString:     SNo3 = vbNullString:  CustId = vbNullString:
    '1
    '4
    
    
End Sub
Public Sub Y2018()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2018")
    '1
    
    '55
End Sub

Public Sub Y2019()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2018")
    '1
    '12
    'B = Encrypt("1486417114"): CustId = "2209BET": LTDate = DateValue("31/01/2020"): LLDATE = DateValue("09/02/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2209)
    '13
    '14
    SNo2 = vbNullString
    '24
    '25
    '29
    '47
    '48
    '57
    
    
End Sub

Public Sub JAN20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    '1
    

End Sub
Public Sub FEB20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")

    '16
    '17
    B = Encrypt("1174423634"): CustId = "2356IND": LTDate = DateValue("30/04/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2356)
    '18
    '22
    
    

End Sub
Public Sub MAR20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    '23
    
    '24
    '32
    
    '35
    B = Encrypt("543674341"): CustId = "MUKUDR": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2400)
    
End Sub

Public Sub APR20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    
    B = Encrypt(""): CustId = "2556BUL": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2556)
    
    '36
    
    
    
End Sub
    
Public Sub MAY20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    
    
    End Sub
Public Sub JUN20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    
    '46
    
    '47
    
End Sub

Public Sub JUL20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    '62
    '63
    

End Sub
Public Sub AUG20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    '80
    '82
    

End Sub

Public Sub SEP20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")
    
    '97
    
    
    
End Sub

Public Sub oct20()
    Dim B As String:  Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String: Dim LTDate As Date:   Dim LLDATE As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString:   SNo3 = vbNullString:  LTDate = DateValue("31/12/2020")

    
    
    
    
'    B = Encrypt("988323188"): CustId = "MORGAN": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2621)
'
'    B = Encrypt("1353429932"): CustId = "kaizen": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2621)
'
'    SNo2 = Encrypt("659095695")
'    B = Encrypt("1265762545"): CustId = "AARNAV2": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2621)
'
'    B = Encrypt("1265762545"): CustId = "AARNAV": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2621)
'    SNo2 = vbNullString
'    SNo3 = vbNullString
'        B = Encrypt("954441792"): CustId = "DHAWANIT": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2621)
'
'    B = Encrypt("304330446"): CustId = "MAYUR": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2622)
'
'
'    B = Encrypt("304330446"): CustId = "MAYUR": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
'    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2622)
'


    


End Sub
Public Function Calc_StampDuty(ByVal LSDate As Date, ByVal lsparty As Long, ByVal LSEXID As Integer) As Double
Dim TRec As ADODB.Command
Dim LStmAmt As Double
LStmAmt = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Calc_StampDuty"
TRec.Parameters.Append TRec.CreateParameter("AMTDIVIDE", adInteger, adParamInput, , Val(GAmtDivide))
TRec.Parameters.Append TRec.CreateParameter("LSDATE", adDBTimeStamp, adParamInput, , LSDate)
TRec.Parameters.Append TRec.CreateParameter("LSPARTY", adInteger, adParamInput, , lsparty)
TRec.Parameters.Append TRec.CreateParameter("LSEXID", adInteger, adParamInput, , LSEXID)
TRec.Parameters.Append TRec.CreateParameter("RETVAL", adDouble, adParamOutput, , LStmAmt)
TRec.Execute
LStmAmt = TRec("RETVAL")
Calc_StampDuty = LStmAmt
End Function
Public Function Calc_Closing_Percentage() As Double
    Calc_Closing_Percentage = 0
End Function
Public Function Calc_Brokerage(ByVal LPBrokType As String, ByVal LPBrokRate As Double, ByVal LPBrokRate2 As Double, ByVal LPBrokQty As Double, ByVal LPQty As Double, _
ByVal LPRATE As Double, ByVal LPCalval As Double, _
ByVal LPInstType As String, ByVal LPStrike As Double, ByVal LPBrokQty2 As Double, ByVal LPTradeableLot As Double, ByVal LPCconType As String, Optional sno As String, Optional lpitemid As Integer) As Double

If IsNull(sno) Then
    sno = "1"
End If
Dim LPCBrokamt As Double: Dim LNetRate As Double: Dim A As Double: Dim B As Double
LPCBrokamt = 0

Dim TRec2 As ADODB.Recordset
Set TRec2 = Nothing: Set TRec2 = New ADODB.Recordset
mysql = "SELECT EXchangecode,QTYUNIT FROM ITEMMAST WHERE ITEMID = " & lpitemid & ""
TRec2.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If TRec2.EOF Then
    Exit Function
End If

 If LPBrokType <> "D" Then
    If LPBrokType = "T" Then
        LPCBrokamt = LPBrokRate * LPQty
    'ElseIf LPBrokType = "S" Then
    '    LPCBrokamt = LPBrokRate * LPQty
    
    ElseIf LPBrokType = "A" Then
        If LPBrokQty2 = 0 Then
            MsgBox "Please Update Brokerage Qty"
        Else
            LPCBrokamt = LPBrokRate * LPBrokQty / LPBrokQty2
        End If
        
    ElseIf LPBrokType = "5" Then
        If LPBrokQty2 = 0 Then
          '  MsgBox "Please Update Brokerage Qty"
        Else
            LPCBrokamt = LPBrokRate * LPBrokQty / LPBrokQty2
        End If
    ElseIf LPBrokType = "1" Then
        A = (LPBrokRate / 100) * LPRATE
        LPCBrokamt = A * LPQty
    ElseIf LPBrokType = "Z" Then
        If LPBrokQty = 0 Then
            'MsgBox "Please Update Brokerage Qty"
        Else
            If TRec2!EXCHANGECODE = "MCX" And Not IsNull(TRec2!QTYUNIT) Then
                If Val(TRec2!QTYUNIT) >= 1 Then
                    LPCBrokamt = LPBrokRate * LPQty / TRec2!QTYUNIT
                End If
            Else
                LPCBrokamt = LPBrokRate * (LPQty / LPBrokQty)
            End If
        End If
    ElseIf LPBrokType = "R" Then
        If LPBrokQty2 = 0 Then
            MsgBox "Please Update Brokerage Qty "
        Else
            If LPBrokQty <> 0 Then
                LPCBrokamt = LPBrokRate * (LPBrokQty / LPBrokQty2)
            Else
                LPCBrokamt = 0
            End If
        End If
    ElseIf LPBrokType = "F" Then
            If LPTradeableLot <> 0 Then
                If LPTradeableLot < LPQty Then LPTradeableLot = LPQty
                LPCBrokamt = (LPBrokRate * (LPQty / LPTradeableLot))
            End If
    ElseIf LPBrokType = "P" Then
        'If LPInstType = "FUT" Then
            LPCBrokamt = ((LPBrokRate / 100) * LPQty * LPRATE * LPCalval)
        'Else
            'LPCBrokamt = ((LPBrokRate / 100) * LPQty * (LPRATE + LPStrike) * LPCalval)
         '   LPCBrokamt = ((LPBrokRate / 100) * LPQty * (LPRATE + LPStrike) * LPCalval)
        'End If
    ElseIf LPBrokType = "2" Then
        LPCBrokamt = (LPBrokRate / 100) * (LPQty * 100 * LPCalval)
    ElseIf LPBrokType = "U" Then
        LPCBrokamt = LPBrokRate * LPQty * LPTradeableLot
    ElseIf LPBrokType = "O" Or LPBrokType = "C" Then
        LPCBrokamt = LPBrokRate * LPBrokQty
    ElseIf LPBrokType = "N" Then
        LPCBrokamt = LPBrokRate
    ElseIf LPBrokType = "I" Then
        LPCBrokamt = ((LPBrokRate / 100) * LPBrokQty * LPRATE * LPCalval)
        LPCBrokamt = LPCBrokamt + ((LPBrokRate2 / 100) * (LPQty - LPBrokQty) * LPRATE * LPCalval)
    ElseIf LPBrokType = "4" Then
        LPCBrokamt = ((LPBrokRate / 100) * LPBrokQty * LPRATE * LPCalval)
        LPCBrokamt = LPCBrokamt + ((LPBrokRate2 / 100) * LPBrokQty2 * LPRATE * LPCalval)
    ElseIf LPBrokType = "Q" Then
        LPCBrokamt = LPBrokRate * LPBrokQty
    ElseIf LPBrokType = "V" Then
        'If sno <> "2" Then
            LPCBrokamt = ((LPBrokRate / 100) * LPBrokQty * LPRATE * LPCalval)
            LPCBrokamt = LPCBrokamt + ((LPBrokRate2 / 100) * (LPQty - LPBrokQty) * LPRATE * LPCalval)
        'Else
        '    LPCBrokamt = ((LPBrokRate2 / 100) * (LPQty - LPBrokQty) * LPRATE * LPCalval)
        'End If
        
'    ElseIf LPBrokType = "3" Then
'        LPCBrokamt = Calc_Closing_Percentage()
    ElseIf LPBrokType = "S" Then
        LPCBrokamt = ((LPBrokRate) * LPBrokQty)
        LPCBrokamt = LPCBrokamt + ((LPBrokRate2) * (LPQty - LPBrokQty))
    ElseIf LPBrokType = "Y" Then
        LPCBrokamt = (LPBrokRate * LPBrokQty)
        LPCBrokamt = LPCBrokamt + (LPBrokRate2 * (LPQty - LPBrokQty))
    ElseIf LPBrokType = "M" Then
        If LPBrokQty <> 0 Then
            A = LPRATE * LPBrokQty * LPCalval * (LPBrokRate / 100)
            B = A / LPBrokQty
            LPCBrokamt = Round(B, 2) * LPBrokQty
        End If
        If LPQty - LPBrokQty <> 0 Then
            A = (LPQty - LPBrokQty) * LPRATE * LPCalval * (LPBrokRate2 / 100)
            B = A / (LPQty - LPBrokQty)
            LPCBrokamt = LPCBrokamt + (Round(B, 2) * (LPQty - LPBrokQty))
        End If
    ElseIf LPBrokType = "W" Then
        LPCBrokamt = ((LPBrokRate / 100) * (LPQty - LPBrokQty) * LPRATE * LPCalval)
        LPCBrokamt = LPCBrokamt + ((LPBrokRate2 / 100) * (LPBrokQty * LPRATE * LPCalval))
    ElseIf LPBrokType = "X" Then
        LPCBrokamt = (Round((LPRATE * LPBrokRate / 100), 2) * (LPBrokQty) * LPCalval)
    ElseIf LPBrokType = "H" Then
        LPCBrokamt = ((LPBrokRate / 100) * LPBrokQty * LPRATE * LPCalval)
    ElseIf LPBrokType = "L" Then
        LPCBrokamt = (LPBrokRate * LPBrokQty)
    End If
ElseIf LPBrokType = "D" Then
        If GScGroup <> "T" Then
            If LPCconType = "S" Then
                LPCBrokamt = ((LPBrokRate / 100) * (LPQty - LPBrokQty) * LPRATE * LPCalval)
            End If
            LPCBrokamt = LPCBrokamt + ((LPBrokRate2 / 100) * (LPBrokQty) * LPRATE * LPCalval)
        Else
            LPCBrokamt = ((LPBrokRate2 / 100) * (LPQty) * LPRATE * LPCalval)
        End If
End If

Calc_Brokerage = LPCBrokamt
End Function
Public Function Calc_Margin(ByVal LPMarType As String, ByVal LPMarRate As Double, ByVal LPSauda As String, ByVal LPCondate As Date, ByVal LPCLQty As Double, _
ByVal LPCLRATE As Double, ByVal LPParty As String, ByVal LPCalval As Double, ByVal LPExCode As String) As Double

Dim LSpreadQty As Double:         Dim LPQtyLot As Double:       Dim LPMarAmt As Double:           Dim LMIRate  As Double:
Dim LMERate As Double:            Dim LMARate As Double:        Dim LAddLongRate As Double:       Dim LAddShortRate As Double:
Dim LSPCashMGLong As Double:      Dim LSPCashMGShort As Double: Dim LGMarRate As Double:          Dim LFlatQty As Double:
Dim MRate_Rec As ADODB.Recordset: Dim NewRec As ADODB.Recordset:

LMIRate = 0:      LMERate = 0::     LMARate = 0:      LSPCashMGLong = 0
LAddLongRate = 0: LAddShortRate = 0:: LSPCashMGShort = 0

If LPMarType = "I" Then
'''    mysql = "SELECT MARGINAMT FROM DMARGIN WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & LPParty & "'"
'''    mysql = mysql & " AND SAUDA ='" & LPSauda & "' AND CONDATE  ='" & Format(LPCondate, "yyyy/MM/dd") & "' "
'''    Set NewRec = Nothing: Set NewRec = New ADODB.Recordset
'''    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
'''    If Not NewRec.EOF Then LPMarAmt = Val(NewRec!MarginAmt & vbNullString)
'''    Set NewRec = Nothing

        mysql = "SELECT CONDATE,(IMRATE+EMRATE+AMRATE+SPCASHMGLONG+SPCASHMGSHORT) AS MARGINrt,ADDLONG,ADDSHORT FROM DLYMGN WHERE COMPCODE =" & GCompCode & " AND "
        mysql = mysql & " SAUDA ='" & LPSauda & "' AND CONDATE  <='" & Format(LPCondate, "yyyy/MM/dd") & "' ORDER BY CONDATE DESC"
        Set NewRec = Nothing: Set NewRec = New ADODB.Recordset
        NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If LPCLQty > 0 Then
            If Not NewRec.EOF Then LPMarAmt = (Abs(LPCLQty) * LPCLRATE * LPCalval) * ((NewRec!marginrt + NewRec!ADDLONG) / 100)
        Else
            If Not NewRec.EOF Then LPMarAmt = (Abs(LPCLQty) * LPCLRATE * LPCalval) * ((NewRec!marginrt + NewRec!ADDSHORT) / 100)
        End If
            
        Set NewRec = Nothing
ElseIf LPMarType = "V" Then
        LPMarAmt = (Abs(LPCLQty) * LPCLRATE * LPCalval) * (LPMarRate / 100)
ElseIf LPMarType = "Q" Then
    LPMarAmt = Abs(LPCLQty) * LPMarRate
ElseIf LPMarType = "C" Then
    LPMarAmt = 0
ElseIf LPMarType = "L" Then
    LPQtyLot = 0
    Set NewRec = Nothing
    Set NewRec = New ADODB.Recordset
    mysql = "SELECT REFLOT FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & " AND SAUDACODE ='" & LPSauda & "'"
    NewRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not NewRec.EOF Then LPQtyLot = NewRec!REFLOT
    LPMarAmt = (Abs(LPCLQty) / LPQtyLot) * LPMarRate
End If
Calc_Margin = LPMarAmt
End Function
Public Function Create_TItemMast(ByVal LPItemCode As String, ByVal LPItemName As String, ByVal LPExhCode As String, ByVal LPLot As Double, ByVal LPExCode As String) As String
Dim Rec As ADODB.Recordset:         Dim NewItem As Boolean:         Dim ItemRec As ADODB.Recordset:     Dim REC2 As ADODB.Recordset:
Dim Rec3 As ADODB.Recordset:        Dim NRec As ADODB.Recordset:    Dim LTItemCode As String:           Dim LEx_Symbol As String
Dim LExID As Integer
LEx_Symbol = LPExhCode
LExID = Get_ExID(LPExCode)
LTItemCode = Get_ItemMaster(LExID, LPExhCode)
If LenB(LTItemCode) < 1 Then
    If LPExCode = "CME" Or LPExCode = "LME" Or LPExCode = "DGC" Or LPExCode = "DGCX" Or LPExCode = "NDF" Or LPExCode = "shanghai" Or LPExCode = "NYM" Then
        LPItemCode = Trim(LPExCode) & " " & Trim(LPItemCode)
    End If
    If Duplicate_Item_Chk(LPItemCode) Then
        LPItemCode = Trim(LPExCode) & " " & Trim(LPItemCode) & " 2" & ""
        If Duplicate_Item_Chk(LPItemCode) Then
            MsgBox "Please Check Entry for " & LPExhCode & ""
            Create_TItemMast = vbNullString
            Exit Function
        End If
    End If
    Call PInsert_ItemMast(LPItemCode, LPItemName, LPLot, LEx_Symbol, LPExCode, vbNullString, vbNullString, 0, vbNullString, "N", "N", "N", "01/07/2013", LExID)
    Create_TItemMast = LPItemCode
Else
    Create_TItemMast = LTItemCode
End If
End Function
Public Function Create_TSaudaMast(LPItemCode As String, LPMDate As Date, LPExCode As String, LPInstType As String, LPOptType As String, LPStrike As Double) As String
Dim LPExhCode  As String: Dim TRec As ADODB.Recordset: Dim LPSaudaCode As String
Dim LIItemName As String: Dim LPLot As Double:       Dim LPBrokLot As Double
Dim LExID As Integer
Dim LItemID As Integer
Dim LRefLot As Double:
LPLot = 1:      LPBrokLot = 1:      LRefLot = 1
LExID = Get_ExID(LPExCode)
LItemID = Get_ITEMID(LPItemCode)
LPSaudaCode = Get_SaudaMaster(LExID, LItemID, LPMDate, LPInstType, LPOptType, LPStrike)
If LenB(LPSaudaCode) < 1 Then
    mysql = "SELECT ITEMNAME,EXHCODE,EXID FROM ITEMMAST WHERE COMPCODE =" & GCompCode & "  AND ITEMCODE ='" & LPItemCode & "'"
    Set TRec = Nothing:  Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        LIItemName = TRec!ITEMName
        LPExhCode = TRec!EXHCODE
        LExID = TRec!EXID
    Else
        MsgBox "Invalid ItemCode " & LPItemCode & ""
        LPSaudaCode = vbNullString
    End If
    If LPInstType = "FUT" Then
        LPSaudaCode = Trim(LPItemCode) & " " & Left$(CStr(Day(LPMDate)), 2) & UCase(Left$(MonthName(Val(month(LPMDate))), 3)) & Right$(Year(LPMDate), 2)
    ElseIf LPInstType = "OPT" Then
        LPSaudaCode = Trim(LPItemCode) & " " & LPInstType & " " & LPOptType & " " & LPStrike & " " & Left$(CStr(Day(LPMDate)), 2) & UCase(Left$(MonthName(Val(month(LPMDate))), 3)) & Right$(Year(LPMDate), 2)
    Else
        If LPExCode = "BEQ" Then
            LPSaudaCode = Trim(LIItemName) & " " & LPExCode
        ElseIf LPExCode = "EQ" Then
            LPSaudaCode = Trim(LIItemName) & " " & LPInstType
        End If
    End If
        If Duplicate_Sauda_Chk(LPSaudaCode) = True Then
            LPSaudaCode = LPExCode & " " & LPSaudaCode
            If Duplicate_Sauda_Chk(LPSaudaCode) = True Then
                MsgBox "Please Check Entry for " & LPSaudaCode & ""
                Create_TSaudaMast = vbNullString
                Exit Function
            End If
        End If
    LPLot = 1: LRefLot = 1
    mysql = "SELECT LOT,BROKLOT,REFLOT FROM SCRIPTMASTER WHERE EX_SYMBOL='" & LPExhCode & "'"
    mysql = mysql & " AND MATURITY='" & Format(LPMDate, "yyyy/MM/dd") & "' AND EXCODE ='" & LPExCode & "'AND INSTTYPE ='" & LPInstType & "' AND OPTTYPE='" & LPOptType & "' AND STRIKEPRICE = " & LPStrike & ""
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        LPLot = TRec!lot
        LPBrokLot = TRec!BROKLOT
        LRefLot = TRec!REFLOT
    End If
    Call PInsert_Saudamast(LPSaudaCode, LPSaudaCode, LPItemCode, LPMDate, LPLot, LPBrokLot, 0, LPInstType, LPOptType, LPStrike, LPExCode, LRefLot, LExID, LItemID)
End If
Create_TSaudaMast = LPSaudaCode
End Function
Public Sub Updt_SrvTax(ByVal LPParty As String, ByVal LPExCode As String, ByVal LPSauda As String, ByVal LPFromDate As Date, ByVal LPToDate As Date)
Dim ExRec As ADODB.Recordset: Dim TRec As ADODB.Recordset:   Dim MDt As Date
Dim LStampDutyDate  As Date
LStampDutyDate = DateValue("01/07/2020")

On Error GoTo err1
If DateValue(GSysLockDt) > DateValue(LPFromDate) Then LPFromDate = GSysLockDt
DoEvents
GETMAIN.Label1.Caption = "Updateing Various Taxes "
mysql = "UPDATE CTR_D SET STMRATE=0,STTRATE=0,SRVTAX=0,SEBITAX=0,SBC_TAX=0,CGSTRATE=0,SGSTRATE=0,IGSTRATE=0,UTTRATE =0 "
mysql = mysql & " WHERE COMPCODE  = " & GCompCode & " "
If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY  IN (" & LPParty & ") "
If LenB(LPExCode) > 0 Then mysql = mysql & " AND EXID  IN  (" & LPExCode & ") "
If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
mysql = mysql & " AND INVNO = 0"
Cnn.Execute mysql

mysql = "SELECT SEBITAX,ITEMID,FROMDT,TODT FROM ITEM_TAX WHERE COMPCODE =" & GCompCode & " "
If LenB(LPExCode) > 0 Then mysql = mysql & " AND EXID  IN  (" & LPExCode & ") "
mysql = mysql & " AND toDT>='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
mysql = mysql & " ORDER BY EXCODE,FROMDT "
Set ExRec = Nothing: Set ExRec = New ADODB.Recordset: ExRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not ExRec.EOF Then
    Do While Not ExRec.EOF
        DoEvents
        GETMAIN.Label1.Caption = "Updateing SEBITAX "
        If ExRec!SEBITAX <> 0 Then
            
            mysql = "UPDATE CTR_D SET SEBITAX  =" & ExRec!SEBITAX & "  WHERE ITEMID  = " & ExRec!itemid & " "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND SEBITYPE ='P')"
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
            
            mysql = "UPDATE CTR_D SET SEBITAX =" & (ExRec!SEBITAX) * -1 & "  WHERE ITEMID = " & ExRec!itemid & " "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND SEBITYPE ='R')"
            If Len(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        End If
        ExRec.MoveNext
    Loop
End If

mysql = "SELECT EXID,EXCHANGECODE,SERVICETAX,TURNOVERTAX,STAMPDTAX,opt_stampdtax,STCTAX,OPT_TURNOVERTAX,SBC_TAX,CGSTRATE,SGSTRATE,IGSTRATE,UTTRATE,FROMDT,TODT,EQ_STT,EQ_STAMPDTAX FROM EXTAX WHERE COMPCODE =" & GCompCode & " "
If LenB(LPExCode) > 0 Then mysql = mysql & " AND EXID  IN  (" & LPExCode & ") "
mysql = mysql & " AND toDT>='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
mysql = mysql & " ORDER BY EXCHANGECODE,FROMDT"
Set ExRec = Nothing: Set ExRec = New ADODB.Recordset: ExRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not ExRec.EOF Then
    While Not ExRec.EOF
        If ExRec!servicetax <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing SERVICETAX  "
        
            mysql = "UPDATE CTR_D SET SRVTAX  = " & ExRec!servicetax & "  WHERE EXID =" & ExRec!EXID & " AND INVNO = 0"
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE=" & GCompCode & " AND  SRTAXAPP = 1 ) "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & "AND PARTY IN (" & LPParty & ") "
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
            Cnn.Execute mysql
        End If
        If ExRec!CGSTRATE <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing CGST   "
            mysql = "UPDATE CTR_D SET CGSTRATE  = " & ExRec!CGSTRATE & "  WHERE  "
            mysql = mysql & " PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE=" & GCompCode & " AND CGST = '1' ) "
            mysql = mysql & " AND EXID =" & ExRec!EXID & " AND INVNO = 0 "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & "AND PARTY IN (" & LPParty & ") "
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
            Cnn.Execute mysql
        End If
        If ExRec!SGSTRATE <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing SGST   "
            mysql = "UPDATE CTR_D SET SGSTRATE  = " & ExRec!SGSTRATE & "  WHERE  EXID =" & ExRec!EXID & " AND INVNO = 0 "
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE=" & GCompCode & " AND SGST = '1' ) "
            mysql = mysql & " AND EXID =" & ExRec!EXID & ""
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & "AND PARTY IN (" & LPParty & ") "
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
            Cnn.Execute mysql
        End If
        If ExRec!IGSTRATE <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing IGST   "
            mysql = "UPDATE CTR_D SET IGSTRATE  = " & ExRec!IGSTRATE & "  WHERE EXID =" & ExRec!EXID & " AND INVNO = 0"
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE=" & GCompCode & " AND IGST = '1' ) "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & "AND PARTY IN (" & LPParty & ") "
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
            Cnn.Execute mysql
        End If
        If ExRec!UTTRATE <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing  UTTRATE    "
            mysql = "UPDATE CTR_D SET UTTRATE  = " & ExRec!UTTRATE & "  WHERE EXID =" & ExRec!EXID & " AND INVNO = 0 "
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE=" & GCompCode & " AND UTT = '1' ) "
            mysql = mysql & " AND CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & "AND PARTY IN (" & LPParty & ") "
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
            Cnn.Execute mysql
        End If
        If ExRec!SBC_TAX <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing  SBC TAX    "
            mysql = "UPDATE CTR_D SET SBC_TAX  = " & ExRec!SBC_TAX & "  WHERE   "
            mysql = mysql & " PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE=" & GCompCode & " AND  SRTAXAPP=1 )"
            mysql = mysql & " AND EXID  = " & ExRec!EXID & " "
            mysql = mysql & " AND CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & "AND PARTY IN (" & LPParty & ") "
            If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        End If
        If ExRec!TURNOVERTAX <> 0 Then
            GETMAIN.Label1.Caption = "Updateing  CTT "
            DoEvents
            If ExRec!EXCHANGECODE = "NSE" Then
                mysql = "UPDATE CTR_D SET STTRATE  =" & ExRec!TURNOVERTAX & "  WHERE EXID  = " & ExRec!EXID & "  AND INSTTYPE ='FUT' "
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID  = " & ExRec!EXID & " AND CTTAPP='Y' ) "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='S' "
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
            
                mysql = "UPDATE CTR_D SET STTRATE =" & (ExRec!TURNOVERTAX) * -1 & "  WHERE EXID  = " & ExRec!EXID & "  AND INSTTYPE ='FUT' "
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID = " & ExRec!EXID & " AND CTTAPP='Y') "
                mysql = mysql & " AND CONDATE>='" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='B' "
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
            ElseIf ExRec!EXCHANGECODE = "EQ" Then
                
                mysql = "UPDATE CTR_D SET STTRATE  =" & ExRec!TURNOVERTAX & "  WHERE EXID  = " & ExRec!EXID & "  "
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID  = " & ExRec!EXID & " AND CTTAPP='Y' ) "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='S' "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STTRATE  =" & (ExRec!TURNOVERTAX * -1) & "  WHERE EXID  = " & ExRec!EXID & " "
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID  = " & ExRec!EXID & " AND CTTAPP='Y' ) "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='B' "
                Cnn.Execute mysql
            
            
                mysql = "UPDATE CTR_D SET EQ_STT=" & (ExRec!EQ_STT) & "  WHERE EXID  = " & ExRec!EXID & " "
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID  = " & ExRec!EXID & " AND CTTAPP='Y' ) "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
                Cnn.Execute mysql
            
                mysql = "UPDATE CTR_D SET EQ_STT=" & (ExRec!EQ_STT * -1) & "  WHERE EXID  = " & ExRec!EXID & " "
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID  = " & ExRec!EXID & " AND CTTAPP='Y' ) "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'  "
                Cnn.Execute mysql
            
            Else
                GETMAIN.Label1.Caption = "Updateing  CTT "
                mysql = "UPDATE CTR_D SET STTRATE  =" & ExRec!TURNOVERTAX & "  WHERE INSTTYPE ='FUT' "
                mysql = mysql & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE EXID  = " & ExRec!EXID & " AND CTTAPP='Y' AND CTTDATE <='" & Format(GFinBegin, "YYYY/MM/DD") & "') "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='S' "
                Cnn.Execute mysql
            
                mysql = "UPDATE CTR_D SET STTRATE =" & (ExRec!TURNOVERTAX) * -1 & "  WHERE  INSTTYPE ='FUT'"
                mysql = mysql & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE  EXID = " & ExRec!EXID & " AND CTTAPP='Y' AND CTTDATE <='" & Format(GFinBegin, "YYYY/MM/DD") & "') "
                mysql = mysql & " AND CONDATE>='" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='B' "
                Cnn.Execute mysql
                
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                mysql = "SELECT ITEMID,EXID,CTTDATE FROM ITEMMAST WHERE CTTAPP='Y' AND EXID =" & ExRec!EXID & " AND CTTDATE <='" & Format(GFinBegin, "YYYY/MM/DD") & "'"
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    Do While Not TRec.EOF
                        mysql = "UPDATE CTR_D SET STTRATE  =" & ExRec!TURNOVERTAX & "  WHERE INSTTYPE ='FUT' "
                        mysql = mysql & " AND ITEMID =" & TRec!itemid & " AND CONDATE >='" & Format(TRec!CTTDATE, "YYYY/MM/DD") & "'"
                        mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                        If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                        mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                        If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                        mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='S' "
                        Cnn.Execute mysql
            
                        mysql = "UPDATE CTR_D SET STTRATE =" & (ExRec!TURNOVERTAX) * -1 & "  WHERE  INSTTYPE ='FUT'"
                        mysql = mysql & " AND ITEMID =" & TRec!itemid & " AND CONDATE >='" & Format(TRec!CTTDATE, "YYYY/MM/DD") & "'"
                        mysql = mysql & " AND CONDATE>='" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                        If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                        mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                        If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                        mysql = mysql & " AND CONDATE >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='B' "
                        Cnn.Execute mysql
                        TRec.MoveNext
                    Loop
                End If
                
            End If
        End If
        
        If ExRec!OPT_TURNOVERTAX <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing  OPTION CTT "
            If ExRec!EXCHANGECODE = "NSE" Then
                mysql = "UPDATE CTR_D SET STTRATE  =" & ExRec!OPT_TURNOVERTAX & "  WHERE EXID  = " & ExRec!EXID & ""
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID = " & ExRec!EXID & " AND CTTAPP='Y') "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND INSTTYPE='OPT' "
                mysql = mysql & " AND CONDATE>='" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='S' "
                Cnn.Execute mysql
                mysql = "UPDATE CTR_D SET STTRATE =" & (ExRec!OPT_TURNOVERTAX) * -1 & "  WHERE  "
                'MYSQL = MYSQL & " ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID = " & ExRec!EXID & " AND CTTAPP='Y') "
                mysql = mysql & "  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND INSTTYPE='OPT' "
                mysql = mysql & " AND CONDATE>='" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='B' "
                Cnn.Execute mysql
            Else
                mysql = "UPDATE CTR_D SET STTRATE  =" & ExRec!OPT_TURNOVERTAX & "  WHERE EXID  = " & ExRec!EXID & ""
                'MYSQL = MYSQL & " AND ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID = " & ExRec!EXID & " AND CTTAPP='Y') "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND INSTTYPE='OPT' "
                mysql = mysql & " AND CONDATE>='" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='S' "
                Cnn.Execute mysql
                mysql = "UPDATE CTR_D SET STTRATE =" & (ExRec!OPT_TURNOVERTAX) * -1 & "  WHERE  "
                mysql = mysql & " ITEMID IN (SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = " & GCompCode & " AND EXID = " & ExRec!EXID & " AND CTTAPP='Y') "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND CTTTYPE='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND INSTTYPE='OPT' "
                mysql = mysql & " AND CONDATE>='" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' AND CONTYPE='B' "
                Cnn.Execute mysql
            
            End If
        End If
        If ExRec!stampdtax <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing STAMP DUTY "
            If ExRec!EXCHANGECODE = "EQ" Then
                mysql = "UPDATE CTR_D SET STMRATE  =" & ExRec!stampdtax & ",EQ_STAMP=" & ExRec!EQ_STAMPDTAX & " WHERE EXID  = " & ExRec!EXID & " "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE  =" & (ExRec!stampdtax * -1) & " ,EQ_STAMP=" & (ExRec!EQ_STAMPDTAX * -1) & "  WHERE EXID  = " & ExRec!EXID & ""
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                Cnn.Execute mysql
                
            
            Else
                mysql = "UPDATE CTR_D SET STMRATE  =" & ExRec!stampdtax & " WHERE EXID  = " & ExRec!EXID & " "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE < '" & Format(LStampDutyDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE  =" & ExRec!stampdtax & "  WHERE EXID  = " & ExRec!EXID & " AND INSTTYPE ='FUT' "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE >= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE='B'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE  =" & ExRec!OPT_stampdtax & "  WHERE  EXID  = " & ExRec!EXID & " AND INSTTYPE ='OPT'"
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE >=  '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE='B'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE =" & (ExRec!stampdtax) * -1 & " WHERE EXID  = " & ExRec!EXID & " "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE < '" & Format(LStampDutyDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE  =" & ExRec!stampdtax & "  WHERE  EXID  = " & ExRec!EXID & " AND INSTTYPE='FUT' "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE >= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='B'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE =" & (ExRec!stampdtax) * -1 & "  WHERE  EXID  = " & ExRec!EXID & "  AND INSTTYPE='FUT' "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE>= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='S'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE =" & ExRec!OPT_stampdtax * -1 & "  WHERE  EXID  = " & ExRec!EXID & "  AND INSTTYPE='OPT' "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='R')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE>= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='S'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET STMRATE  =" & ExRec!OPT_stampdtax & "  WHERE  EXID  = " & ExRec!EXID & " AND INSTTYPE='OPT' "
                mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
                If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
                mysql = mysql & " AND PARTY IN(SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON='P')"
                If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
                mysql = mysql & " AND CONDATE>= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND CONDATE >= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='B'"
                mysql = mysql & " AND INVNO = 0 "
                Cnn.Execute mysql
            End If
        End If
        If ExRec!STCTAX <> 0 Then
            DoEvents
            GETMAIN.Label1.Caption = "Updateing  SEBI TAX "
            mysql = "UPDATE CTR_D SET SEBITAX  =" & ExRec!STCTAX & "  WHERE SEBITAX=0 AND EXID  = " & ExRec!EXID & " "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND SEBITYPE ='P')"
            If Len(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
            
            mysql = "UPDATE CTR_D SET SEBITAX =" & (ExRec!STCTAX) * -1 & "  WHERE SEBITAX =0 AND EXID  = " & ExRec!EXID & " "
            mysql = mysql & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
            If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
            mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND SEBITYPE ='R')"
            If Len(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
            mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        End If
        ExRec.MoveNext
    Wend
End If
MDt = DateValue("01/07/2013")
mysql = "SELECT ITEMID,EXID,EXCHANGECODE,CTTDATE FROM ITEMMAST WHERE COMPCODE =" & GCompCode & " AND CTTDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "' AND CTTDATE>'" & Format(MDt, "YYYY/MM/DD") & "'"
Set TRec = Nothing: Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        DoEvents
        GETMAIN.Label1.Caption = "Updateing  ITEMWISE CTT"
        mysql = "UPDATE CTR_D SET STTRATE =0 WHERE "
        mysql = mysql & " ITEMID =" & TRec!itemid & " AND CONDATE <'" & Format(TRec!CTTDATE, "YYYY/MM/DD") & "'AND CONDATE >='" & Format(MDt, "YYYY/MM/DD") & "'"
        If LenB(LPParty) > 0 Then mysql = mysql & " AND PARTY IN (" & LPParty & ") "
        If LenB(LPExCode) > 0 Then mysql = mysql & " AND EXID IN  (" & LPExCode & ") "
        If LenB(LPSauda) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LPSauda & ") "
        mysql = mysql & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "' "
        mysql = mysql & " AND INVNO = 0"
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
End If
mysql = "SELECT AC_CODE,APPLYON,STTRATE,FROMDATE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON ='S' "
If LenB(LPParty) > 0 Then mysql = mysql & " AND AC_CODE  IN (" & LPParty & ") "
Set TRec = Nothing: Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        DoEvents
        GETMAIN.Label1.Caption = "Updateing PARTY WISE STAMP DUTY"
        If TRec!FROMDATE > LPFromDate Then LPFromDate = TRec!FROMDATE
        mysql = "UPDATE CTR_D SET STMRATE =" & TRec!STTRATE & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "'"
        mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
        mysql = mysql & " AND CONDATE< '" & Format(LStampDutyDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " AND INVNO = 0 "
        Cnn.Execute mysql
        If TRec!STTRATE > 0 Then
            mysql = "UPDATE CTR_D SET STMRATE =" & TRec!STTRATE & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='FUT'"
            mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE>= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='B'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        
            mysql = "UPDATE CTR_D SET STMRATE =" & Val(0.003) & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='OPT'"
            mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE>= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='B'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        Else
            mysql = "UPDATE CTR_D SET STMRATE =" & TRec!STTRATE & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='FUT'"
            mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE>= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='S'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        
            mysql = "UPDATE CTR_D SET STMRATE =" & (0.003 * -1) & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='OPT'"
            mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE>= '" & Format(LStampDutyDate, "yyyy/MM/dd") & "' AND CONTYPE ='S'"
            mysql = mysql & " AND INVNO = 0 "
            Cnn.Execute mysql
        End If
        TRec.MoveNext
    Loop
End If
mysql = "SELECT AC_CODE,APPLYON,STTRATE,FROMDATE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON ='I' "
If LenB(LPParty) > 0 Then mysql = mysql & " AND AC_CODE  IN (" & LPParty & ") "
Set TRec = Nothing: Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        mysql = "UPDATE CTR_D SET STTRATE =" & TRec!STTRATE & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "'"
        mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
        mysql = mysql & " AND ITEMID IN (SELECT DISTINCT ITEMID FROM ITEMMAST WHERE COMPCODE =" & GCompCode & " AND STMAPP='Y' )"
        mysql = mysql & " AND INVNO = 0 "
        Cnn.Execute mysql
        TRec.MoveNext
    Loop
End If
Dim TRec2 As ADODB.Recordset
Dim LAC_CODE As String
mysql = "SELECT AC_CODE,APPLYON ,FROMDATE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND APPLYON ='B' "
If LenB(LPParty) > 0 Then mysql = mysql & " AND AC_CODE  IN (" & LPParty & ") "
Set TRec = Nothing: Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        LAC_CODE = TRec!AC_CODE
        mysql = "SELECT SELLBROK,INSTTYPE,EXID,UPTOSTDT FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND AC_CODE  ='" & LAC_CODE & "'"
        If LenB(LPExCode) > 0 Then mysql = mysql & " AND EXID  IN  (" & LPExCode & ") "
        Set TRec2 = Nothing
        Set TRec2 = New ADODB.Recordset
        TRec2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not TRec2.EOF
            mysql = "UPDATE CTR_D SET STMRATE =" & TRec2!SELLBROK & " WHERE PARTY ='" & LAC_CODE & "' "
            mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE <='" & Format(TRec2!UPTOSTDT, "YYYY/MM/DD") & "' AND EXID=" & TRec2!EXID & " AND INSTTYPE ='" & TRec2!INSTTYPE & "'"
            Cnn.Execute mysql
            TRec2.MoveNext
        Loop
        TRec.MoveNext
    Loop
End If

mysql = "SELECT AC_CODE,SEBIRATE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND SEBITYPE ='C' "
If LenB(LPParty) > 0 Then mysql = mysql & " AND AC_CODE  IN (" & LPParty & ") "
Set TRec = Nothing: Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        LAC_CODE = TRec!AC_CODE
        mysql = "SELECT SELLBROK2,INSTTYPE,EXID,UPTOSTDT FROM PEXBROK WHERE AC_CODE ='" & LAC_CODE & "' "
        If LenB(LPExCode) > 0 Then mysql = mysql & " AND EXID  IN  (" & LPExCode & ") "
        mysql = mysql & "ORDER BY UPTOSTDT"
        Set TRec2 = Nothing
        Set TRec2 = New ADODB.Recordset
        TRec2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not TRec2.EOF
            mysql = "UPDATE CTR_D SET SEBITAX  =" & TRec2!SELLBROK2 & " WHERE PARTY ='" & LAC_CODE & "' AND SEBITAX = 0 "
            mysql = mysql & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE <='" & Format(TRec2!UPTOSTDT, "YYYY/MM/DD") & "' AND EXID=" & TRec2!EXID & " AND INSTTYPE ='" & TRec2!INSTTYPE & "'"
            Cnn.Execute mysql
            'MYSQL = "UPDATE CTR_D SET SEBITAX  =" & TRec!SEBIRATE & " WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "'"
            'MYSQL = MYSQL & " AND CONDATE >='" & Format(LPFromDate, "YYYY/MM/DD") & "'"
            ''MYSQL = MYSQL & " AND ITEMID IN (SELECT DISTINCT ITEMID FROM ITEMMAST WHERE COMPCODE =" & GCompCode & " AND STMAPP='Y' )"
            'MYSQL = MYSQL & " AND INVNO = 0 "
            TRec2.MoveNext
        Loop
        TRec.MoveNext
    Loop
End If

'MYSQL = "UPDATE CTR_D SET SEBITAX =" & (ExRec!STCTAX) * -1 & "  WHERE COMPCODE  = " & GCompCode & " AND SEBITAX =0 "
'MYSQL = MYSQL & " AND EXID  = " & ExRec!EXID & " "
'MYSQL = MYSQL & " AND  CONDATE  >= '" & Format(ExRec!FROMDT, "yyyy/MM/dd") & "' AND CONDATE  <= '" & Format(ExRec!ToDt, "yyyy/MM/dd") & "' "
'If LenB(LPParty) > 0 Then MYSQL = MYSQL & " AND PARTY IN (" & LPParty & ") "
'MYSQL = MYSQL & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & " AND SEBITYPE ='R')"
'If Len(LPSauda) > 0 Then MYSQL = MYSQL & " AND SAUDAID IN (" & LPSauda & ") "
'MYSQL = MYSQL & " AND CONDATE  >= '" & Format(LPFromDate, "yyyy/MM/dd") & "' AND CONDATE <= '" & Format(LPToDate, "yyyy/MM/dd") & "'"
'MYSQL = MYSQL & " AND INVNO = 0 "
'Cnn.Execute MYSQL


Exit Sub

err1:
    If err.Number <> 0 Then
        MsgBox err.Description
        If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
    End If
        

End Sub
Public Function Duplicate_Item_Chk(LMItemCode As String) As Boolean
Dim TRec As ADODB.Command
Duplicate_Item_Chk = False
Dim LItem As String
LItem = vbNullString
Set TRec = Nothing
Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Chk_ItemCode"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("ITEMCODE", adVarChar, adParamInput, 50, LMItemCode)
TRec.Parameters.Append TRec.CreateParameter("LPITEMCODE", adVarChar, adParamOutput, 50, LItem)
TRec.Execute
LItem = TRec("LPITEMCODE")
If LenB(LItem) > 1 Then Duplicate_Item_Chk = True
End Function
Public Function Duplicate_Sauda_Chk(LMSaudaCode As String) As Boolean
Dim TRec As ADODB.Command
Duplicate_Sauda_Chk = False
Dim LSauda As String
LSauda = vbNullString
Set TRec = Nothing
Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Chk_SAUDACODE"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("SAUDACODE", adVarChar, adParamInput, 50, LMSaudaCode)
TRec.Parameters.Append TRec.CreateParameter("LPSAUDACODE", adVarChar, adParamOutput, 50, LSauda)
TRec.Execute
LSauda = TRec("LPSAUDACODE")
If LenB(LSauda) > 1 Then Duplicate_Sauda_Chk = True
End Function

Public Function Duplicate_SSauda_Chk(LMSaudaCode As String) As Boolean
Dim TRec As ADODB.Command
Duplicate_SSauda_Chk = False
Dim LCHK As Integer
Set TRec = Nothing
Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Chk_DuplicateScriptSauda"
TRec.Parameters.Append TRec.CreateParameter("SAUDACODE", adVarChar, adParamInput, 50, LMSaudaCode)
TRec.Parameters.Append TRec.CreateParameter("LEXIST", adInteger, adParamOutput, , LCHK)
TRec.Execute
LCHK = TRec("LEXIST")
If LCHK <> 0 Then Duplicate_SSauda_Chk = True
End Function

Public Function DUPLICATE_ITEMNAME_CHK(LMITEMNAME As String) As Boolean
    Dim TRec As ADODB.Recordset
    DUPLICATE_ITEMNAME_CHK = False
    mysql = "SELECT ITEMNAME FROM SCRIPTMASTER WHERE ITEMNAME ='" & LMITEMNAME & "'"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then DUPLICATE_ITEMNAME_CHK = True
    
End Function
Public Function DUPLICATE_SAUDACODE_CHK(LMSaudaCode As String) As Boolean
Dim TRec As ADODB.Recordset
    DUPLICATE_SAUDACODE_CHK = False
    mysql = "SELECT SAUDACODE FROM CONTRACTMASTER WHERE SAUDACODE ='" & LMSaudaCode & "'"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        DUPLICATE_SAUDACODE_CHK = True
    Else
        mysql = "SELECT SAUDACODE FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & " AND SAUDACODE ='" & LMSaudaCode & "'"
        Set TRec = Nothing: Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then DUPLICATE_SAUDACODE_CHK = True
    End If
End Function
Public Function Get_Max_OrderNo(LGCondate As Date, LGExID As Integer) As Long
    Dim TRec As ADODB.Command: Dim LCount As Long
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
'    If LGExID <> 0 Then
'        TRec.CommandText = "Get_Max_ConnoEX"
'    Else
        TRec.CommandText = "GET_MAX_ORDERNO"
'    End If
    TRec.Parameters.Append TRec.CreateParameter("mc_code", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("LCONDATE", adDBTimeStamp, adParamInput, , Format(LGCondate, "YYYY/MM/DD"))
    If LGExID <> 0 Then
        TRec.Parameters.Append TRec.CreateParameter("LEXID", adInteger, adParamInput, , LGExID)
    End If
    TRec.Parameters.Append TRec.CreateParameter("LCONNO", adInteger, adParamOutput, , LCount)
    TRec.Execute
    LCount = TRec("LCONNO")
    If LCount = 0 And LGExID = 1 Then LCount = 5000
    If LCount = 0 And LGExID = 2 Then LCount = 8000
    
    Get_Max_OrderNo = LCount
    
End Function
Public Function Get_Max_ConNo(LGCondate As Date, LGExID As Integer) As Long
    Dim TRec As ADODB.Command: Dim LCount As Long
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
    If LGExID <> 0 Then
        TRec.CommandText = "Get_Max_ConnoEX"
    Else
        TRec.CommandText = "Get_Max_Conno"
    End If
    TRec.Parameters.Append TRec.CreateParameter("mc_code", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("LCONDATE", adDBTimeStamp, adParamInput, , Format(LGCondate, "YYYY/MM/DD"))
    If LGExID <> 0 Then
        TRec.Parameters.Append TRec.CreateParameter("LEXID", adInteger, adParamInput, , LGExID)
    End If
    TRec.Parameters.Append TRec.CreateParameter("LCONNO", adInteger, adParamOutput, , LCount)
    TRec.Execute
    LCount = TRec("LCONNO")
    If LCount = 0 And LGExID = 1 Then LCount = 5000
    If LCount = 0 And LGExID = 2 Then LCount = 8000
    
    Get_Max_ConNo = LCount
End Function
Public Function Net_DrCr(LPParty As String, LPToDate As Date) As Double
Dim TRec As ADODB.Command: Dim LBBal As Double: Dim LBal As Double
LBal = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_AccBal"
TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("MPARTY", adVarChar, adParamInput, 15, LPParty)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LPToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LBALANCE", adDouble, adParamOutput, , LBal)
TRec.Execute
LBal = TRec("LBALANCE")
Net_DrCr = LBal
End Function
Public Function Get_CloseQty(LPParty As Long, LPSauda As Long, LPToDate As Date, Optional LCompCnn As String) As Double
Dim TRec As ADODB.Command: Dim LBBal As Double: Dim LBal As Double
LBal = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
If Len(LCompCnn) = 0 Then
    Set TRec.ActiveConnection = Cnn
Else
    Set TRec.ActiveConnection = Cnn
End If

TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_CLOSEQTY"
TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("MPARTY", adInteger, adParamInput, , LPParty)
TRec.Parameters.Append TRec.CreateParameter("MSAUDA", adInteger, adParamInput, , LPSauda)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LPToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LBALANCE", adDouble, adParamOutput, , LBal)
TRec.Execute
LBal = TRec("LBALANCE")
Get_CloseQty = LBal
End Function

Public Function Get_CloseQty_INVD(LPParty As String, LPSaudaID As Long, LPToDate As Date) As Double
Dim TRec As ADODB.Command: Dim LBBal As Double: Dim LBal As Double
LBal = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_CLOSEQTY_INV_D"
TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("PARTY", adVarChar, adParamInput, 15, LPParty)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LPSaudaID)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LPToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LBALANCE", adDouble, adParamOutput, , LBal)
TRec.Execute
LBal = TRec("LBALANCE")
Get_CloseQty_INVD = LBal
End Function

Public Function Get_MaxBillNo() As Long
Dim TRec As ADODB.Command: Dim LBillNo As Long
LBillNo = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_MaxBillNo"
TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("MBILLNO", adInteger, adParamOutput, , LBillNo)
TRec.Execute
LBillNo = TRec("MBILLNO")
Get_MaxBillNo = LBillNo
End Function

Public Function Get_ConSNo(ByVal LCDate As Date, ByVal LCSauda As String, ByVal LCItemCode As String, ByVal LCExCode As String, ByVal LCSaudaID As Long, LCItemID As Integer, LCExID As Integer) As Long
    Dim TRec As ADODB.Command
    Dim LSConSno As Long
    LSConSno = 0
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
    TRec.CommandText = "SP_GET_CONSNO"
    TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("LCONDATE", adDBTimeStamp, adParamInput, , Format(LCDate, "YYYY/MM/DD"))
    TRec.Parameters.Append TRec.CreateParameter("LSAUDA", adVarChar, adParamInput, 50, LCSauda)
    TRec.Parameters.Append TRec.CreateParameter("LITEMCODE", adVarChar, adParamInput, 20, LCItemCode)
    TRec.Parameters.Append TRec.CreateParameter("LEXCODE", adVarChar, adParamInput, 10, LCExCode)
    TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LCSaudaID)
    TRec.Parameters.Append TRec.CreateParameter("ITEMIDID", adInteger, adParamInput, , LCItemID)
    TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LCExID)
    
    TRec.Parameters.Append TRec.CreateParameter("LCONSNO", adInteger, adParamOutput, , LSConSno)
    TRec.Execute
    LSConSno = TRec("LCONSNO")
    Get_ConSNo = LSConSno
End Function
Function GetLastDay(ActualDate As String) As String
Dim DataIntUM, DataIntDOIS, DataIntTRES As String
DataIntUM = DateAdd("m", 1, ActualDate)
DataIntDOIS = "01-" + Right$(DataIntUM, 7)
DataIntTRES = DateAdd("d", -1, DataIntDOIS)
GetLastDay = DataIntTRES
End Function
Public Function RenameFileOrDir(ByVal strSource As String, ByVal strTarget As String, Optional fOverwriteTarget As Boolean = False) As Boolean
  On Error GoTo PROC_ERR
  Dim fRenameOK As Boolean: Dim fRemoveTarget As Boolean: Dim strFirstDrive As String: Dim strSecondDrive As String: Dim fOK As Boolean
  If Not ((Len(strSource) = 0) Or _
         (Len(strTarget) = 0) Or _
         (Not (FileOrDirExists(strSource)))) Then
    ' Check if the target exists
    If FileOrDirExists(strTarget) Then
      If fOverwriteTarget Then
        fRemoveTarget = True
      Else
        If vbYes = MsgBox("Do you wish to overwrite the " & _
           "target file?", vbExclamation + vbYesNo, _
           "Overwrite confirmation") Then
          fRemoveTarget = True
        End If
      End If
      If fRemoveTarget Then
        ' Check that it's not a directory
        If ((GetAttr(strTarget) And vbDirectory)) <> _
           vbDirectory Then
          Kill strTarget
          fRenameOK = True
        Else
          MsgBox "Cannot overwrite a directory", vbOKOnly, _
            "Cannot perform operation"
          'FUTURE CODE FOR DIRECTORIES
        End If
      End If
    Else
      ' The target does not exist
      ' Check if source is a directory
      If ((GetAttr(strSource) And vbDirectory) = _
           vbDirectory) Then
        ' Source is a directory, see if drives are the same
        strFirstDrive = Left$(strSource, InStr(strSource, ":\"))
        strSecondDrive = Left$(strTarget, InStr(strTarget, ":\"))
        If strFirstDrive = strSecondDrive Then
          fRenameOK = True
        Else
          MsgBox "Cannot rename directories across drives", _
            vbOKOnly, "Cannot perform operation"
            'FUTURE CODE FOR DIRECTORIES ON DIFFERENT DRIVES
        End If
      Else
        'It's a file, ok to proceed
        fRenameOK = True
      End If
    End If
     If fRenameOK Then
      Name strSource As strTarget
      fOK = True
    End If
  End If
   RenameFileOrDir = fOK
PROC_EXIT:
  Exit Function
PROC_ERR:
  MsgBox "Error: " & err.Number & ". " & err.Description, , _
         "RenameFileOrDir"
  Resume PROC_EXIT
End Function
Public Function FileOrDirExists(strDest As String) As Boolean
  Dim intLen As Integer: Dim fReturn As Boolean
  fReturn = False
  If strDest <> vbNullString Then
    On Error Resume Next
    intLen = Len(Dir$(strDest, vbDirectory + vbNormal))
    On Error GoTo PROC_ERR
    fReturn = (Not err And intLen > 0)
  End If
PROC_EXIT:
  FileOrDirExists = fReturn
  Exit Function
PROC_ERR:
  MsgBox "Error: " & err.Number & ". " & err.Description, , _
         "FileOrDirExists"
  Resume PROC_EXIT
End Function
Public Function FileExist(sTestFile As String) As Boolean
   Dim lSize As Long
   On Error Resume Next
   lSize = -1
   lSize = FileLen(sTestFile)
   If lSize > -1 Then
      FileExist = True
   Else
      FileExist = False
   End If
End Function
Public Function DownloadFile(sSourceUrl As String, sLocalFile As String) As Boolean
  '//'Download the file. BINDF_GETNEWESTVERSION forces
  '//'the API to download from the specified source.
  '//'Passing 0& as dwReserved causes the locally-cached
  '//'copy to be downloaded, if available. If the API
  '//'returns ERROR_SUCCESS (0), DownloadFile returns True.
   
   DeleteUrlCacheEntry sSourceUrl
   DownloadFile = URLDownloadToFile(0&, sSourceUrl, sLocalFile, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
            
    If DownloadFile Then
        DownloadFile = CheckFileSize(sLocalFile)
    End If
                
    '>>> if file does not downloaded from above source then download from our server c:/saudasoftwarefiles/
    If Not DownloadFile Then
        'Call Connect_Ftp("185.184.70.148", "", "", "/" & Replace(Replace(sLocalFile, App.Path & "\", ""), "\", "/"), sLocalFile)
        'Call Connect_Ftp("5.135.219.225", "", "", "/" & Replace(Replace(sLocalFile, App.Path & "\", ""), "\", "/"), sLocalFile)

        'Call Connect_Ftp("50.62.169.103", "saudasoftware", "Khushi@12345", "/S-BKP/Files/" & Replace(Replace(sLocalFile, App.Path & "\", ""), "\", "/"), sLocalFile)
        Call Connect_Ftp("50.63.8.230", "saudasoftware", "Reet@73284", "/S-BKP/Files/" & Replace(Replace(sLocalFile, App.Path & "\", ""), "\", "/"), sLocalFile)
        DownloadFile = FlagDownloadedFromOurFTP
    End If
   
End Function
Public Function CheckFileSize(Lpath As String) As Boolean
      
    CheckFileSize = True
    'Get file size
    Dim LfileSize As Double
    Dim fso As New FileSystemObject
    Dim f As file
    If fso.FileExists(Lpath) Then
        Set f = fso.GetFile(Lpath)
        LfileSize = f.Size 'displays size of file
        LfileSize = LfileSize / 1024
        
'MsgBox "file Size=" & CStr(LfileSize)
        If LfileSize <= 5 Then
            f.Delete (True)
            CheckFileSize = False
        End If
'MsgBox "Status=" & CheckFileSize
    Else
        CheckFileSize = False
    End If
End Function


Public Sub FIN_UPDATE()
Dim MDt As Date
Dim MDT2 As Date
Dim CnnString As String
    ServerString = MServer
    ServerString = Left$(MServer, (InStr(1, MServer, "database") + 8)) & "MASTER"
    CnnString = ServerString
    
    If MCnn.State = 0 Then ' 0=closed
        Set MCnn = Nothing: Set MCnn = New ADODB.Connection: MCnn.ConnectionString = CnnString
        MCnn.Mode = adModeShareExclusive: MCnn.IsolationLevel = adXactIsolated: MCnn.CursorLocation = adUseClient
        MCnn.Open
    End If
    
MDT2 = DateValue("31/05/2014")
MDt = DateValue("31/03/2014")
On Error GoTo err1
Cnn.BeginTrans
CNNERR = True

If GFinEnd = MDt Then
    mysql = "UPDATE COMPANY SET FINEND='" & Format(MDT2, "YYYY/MM/DD") & "' WHERE COMPCODE=" & GCompCode & ""
    Cnn.Execute mysql
    mysql = "UPDATE SYSCOMP SET FINEND='" & Format(MDT2, "YYYY/MM/DD") & "' WHERE COMPCODE=" & GCompCode & " AND DATABASENAME ='" & GDatabaseName & "' AND FINEND='" & Format(MDt, "YYYY/MM/DD") & "'"
    MCnn.Execute mysql
    mysql = "UPDATE SYSCOMP SET SYSLOCKDT = '2000/01/01' WHERE COMPCODE=" & GCompCode & ""
    MCnn.Execute mysql
    mysql = "UPDATE PITBROK SET UPTOSTDT='" & Format(MDT2, "YYYY/MM/DD") & "' WHERE COMPCODE =" & GCompCode & " AND UPTOSTDT='" & Format(MDt, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    mysql = "UPDATE PITSBROK SET UPTOSTDT='" & Format(MDT2, "YYYY/MM/DD") & "'WHERE COMPCODE =" & GCompCode & " AND UPTOSTDT='" & Format(MDt, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    
    mysql = "UPDATE PEXBROK SET UPTOSTDT='" & Format(MDT2, "YYYY/MM/DD") & "' WHERE COMPCODE =" & GCompCode & " AND UPTOSTDT='" & Format(MDt, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    mysql = "UPDATE PEXSSBROK SET UPTOSTDT='" & Format(MDT2, "YYYY/MM/DD") & "'WHERE COMPCODE =" & GCompCode & " AND UPTOSTDT='" & Format(MDt, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    mysql = "UPDATE SETTLE  SET SETDATE ='" & Format(MDT2, "YYYY/MM/DD") & "'WHERE COMPCODE =" & GCompCode & " AND SETDATE ='" & Format(MDt, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    
End If
Cnn.CommitTrans
CNNERR = False
Call CompanySelection(GCompCode)
Exit Sub
err1:
If err.Number <> 0 Then
    MsgBox err.Description
   
    If CNNERR = True Then
        Cnn.RollbackTrans
        CNNERR = False
    End If
End If
End Sub

Public Sub Updt_BrokEXQty(LOParty As String, LOExCode As String, LOSauda As String, LOFromDate As Date, LOItem As String)
Dim BrokTypeRec As ADODB.Recordset
Dim LPBBrokType As String
Dim TRec As ADODB.Recordset

If GSysLockDt >= LOFromDate Then LOFromDate = LOFromDate + 1

mysql = "UPDATE CTR_D SET BROKQTY2=0,UPDBQTY=0,BROKQTY=0 WHERE COMPCODE =" & GCompCode & " "
mysql = mysql & " AND CONDATE  >='" & Format(LOFromDate, "YYYY/MM/DD") & "'  "
mysql = mysql & " AND BrokType IN('I','Q','V','D','H','W','X','R','4') "
If LenB(LOParty) > 1 Then mysql = mysql & " AND PARTY IN (" & LOParty & ")"
If LenB(LOExCode) > 1 Then mysql = mysql & " AND EXID IN (" & LOExCode & ")"
If LenB(LOSauda) > 1 Then mysql = mysql & " AND SAUDAID IN (" & LOSauda & ")"
If LenB(LOItem) > 1 Then mysql = mysql & " AND ITEMID IN (" & LOItem & ")"
Cnn.Execute mysql
Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = "SELECT EXID  FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND EXCODE ='EQ'"
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    Call Updt_EQBrokQty(LOParty, LOExCode, LOItem, LOSauda, LOFromDate)
End If

mysql = "SELECT DISTINCT BROKTYPE FROM CTR_D WHERE COMPCODE  = " & GCompCode & ""
mysql = mysql & " AND CONDATE  >='" & Format(LOFromDate, "YYYY/MM/DD") & "'"
mysql = mysql & " AND BrokType IN('I','Q','V','D','H','W','X','R','4') "
If LenB(LOParty) > 1 Then mysql = mysql & " AND PARTY IN (" & LOParty & ")"
If LenB(LOExCode) > 1 Then mysql = mysql & " AND EXID IN (" & LOExCode & ")"
If LenB(LOSauda) > 1 Then mysql = mysql & " AND SAUDAID IN (" & LOSauda & ")"
If LenB(LOItem) > 1 Then mysql = mysql & " AND ITEMID IN (" & LOItem & ")"
mysql = mysql & " ORDER BY BROKTYPE "
Set BrokTypeRec = Nothing: Set BrokTypeRec = New ADODB.Recordset
BrokTypeRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not BrokTypeRec.EOF Then
    Do While Not BrokTypeRec.EOF
        DoEvents
        LPBBrokType = BrokTypeRec!broktype
        If LPBBrokType = "I" Or LPBBrokType = "Q" Then
            Call Updt_EXBrokQty_IntraDay(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "4" Then
            Call Updt_EXBrokQty_ValueWise2(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "D" Then
            Call Updt_EXBrokQty_Delivery(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "V" Or LPBBrokType = "M" Or LPBBrokType = "Y" Or LPBBrokType = "S" Then
            Call Updt_EXBrokQty_ValueWise(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "W" Then
           Call Updt_EXBrokQty_WHigher(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "H" Or LPBBrokType = "L" Then
            Call Updt_EXBrokQty_Higher(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "X" Then
            Call Updt_EXBrokQty_XIntraday(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        ElseIf LPBBrokType = "R" Then
            Call Updt_EXBrokQty_RZLotwise_Intraday(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, LPBBrokType)
        End If
        BrokTypeRec.MoveNext
    Loop
End If
'If GOnlyBrok = 0 Then
    Call Updt_EXBrokQty_Opening(LOParty, LOExCode, LOItem, LOSauda, LOFromDate, "O")
'End If
Set BrokTypeRec = Nothing
End Sub

Public Sub Updt_EXBrokQty_Delivery(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPInst As String)
Dim AccRec As ADODB.Recordset: Dim TrdRec As ADODB.Recordset: Dim TRec As ADODB.Recordset
Dim MDt As Date
Dim mparty As String:    Dim MSauda As String
Dim MBalQty As Double:   Dim MOpQty  As Double:    Dim MTBQty As Double:     Dim MTSQty As Double:
Dim MBQty As Double:     Dim msqty As Double:      Dim MBrokQty As Double:   Dim LQTY As Double:
Dim LSaudaID As Long:    Dim LLQty As Double

mysql = "SELECT DISTINCT PARTY,CONDATE,SAUDA,SAUDAID FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "'"
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY  IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID  IN (" & LBEXCODE & ")"
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID  IN  (" & LBItemCode & ")  "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
mysql = mysql & " AND UPDBQTY =0  AND INVNO = 0"
mysql = mysql & " AND BrokType ='D' ORDER BY PARTY,SAUDA,CONDATE"
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        MBalQty = 0: MTBQty = 0: MTSQty = 0: MBQty = 0: msqty = 0
        MBalQty = 0: MBQty = 0: msqty = 0
        Do While LSaudaID = AccRec!SAUDAID And mparty = AccRec!PARTY
            MDt = AccRec!Condate
            MBalQty = 0: MBQty = 0: msqty = 0
            Do While MDt = AccRec!Condate And LSaudaID = AccRec!SAUDAID
                mysql = "SELECT CONTYPE, SUM(QTY) AS TOTQTY FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' GROUP BY CONTYPE "
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not TRec.EOF
                    If TRec!CONTYPE = "B" Then MBQty = TRec!TotQty
                    If TRec!CONTYPE = "S" Then msqty = TRec!TotQty
                    TRec.MoveNext
                Loop
                If MBQty = msqty Then
                    Cnn.Execute "UPDATE CTR_D SET BROKQTY = 0,UPDBQTY =1 WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                Else
                    If MBQty > msqty Then
                        Cnn.Execute "UPDATE CTR_D SET BROKQTY = 0,UPDBQTY =1 WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                        mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'ORDER BY ROWNO "
                        Set TRec = Nothing
                        Set TRec = New ADODB.Recordset
                        TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        LQTY = 0: LLQty = 0
                        Do While Not TRec.EOF
                            LQTY = TRec!QTY
                            If msqty >= LQTY Then
                                LLQty = LQTY
                                msqty = msqty - LQTY
                            ElseIf LQTY > msqty Then
                                LLQty = msqty
                                msqty = 0
                            End If
                            mysql = "UPDATE CTR_D SET BROKQTY= QTY -" & LLQty & ",UPDBQTY =1  WHERE ROWNO = " & TRec!ROWNO & ""
                            Cnn.Execute mysql
                            TRec.MoveNext
                        Loop
                    ElseIf msqty > MBQty Then
                        Cnn.Execute "UPDATE CTR_D SET BROKQTY = 0,UPDBQTY =1 WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONDATE >'" & Format(GSysLockDt, "YYYY/MM/DD") & "' AND  CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' "
                        mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                        Set TRec = Nothing
                        Set TRec = New ADODB.Recordset
                        TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        LQTY = 0: LLQty = 0
                        Do While Not TRec.EOF
                            LQTY = TRec!QTY
                            If MBQty >= LQTY Then
                                LLQty = LQTY
                                MBQty = MBQty - LQTY
                            ElseIf LQTY > MBQty Then
                                LLQty = MBQty
                                MBQty = 0
                            End If
                            mysql = "UPDATE CTR_D SET BROKQTY = QTY -" & LLQty & ",UPDBQTY=1  WHERE ROWNO = " & TRec!ROWNO & ""
                            Cnn.Execute mysql
                            TRec.MoveNext
                        Loop
                    End If
                End If
                AccRec.MoveNext
                If AccRec.EOF Then Exit Do
            Loop
            If AccRec.EOF Then Exit Do
        Loop
        If AccRec.EOF Then Exit Do
    Loop
End If
End Sub

Public Sub Updt_EQBrokQty(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date)
Dim AccRec As ADODB.Recordset: Dim TrdRec As ADODB.Recordset: Dim TRec As ADODB.Recordset
Dim MDt As Date
Dim mparty As String:    Dim MSauda As String
Dim MBalQty As Double:   Dim MOpQty  As Double:    Dim MTBQty As Double:     Dim MTSQty As Double:
Dim MBQty As Double:     Dim msqty As Double:      Dim MBrokQty As Double:   Dim LQTY As Double:
Dim LSaudaID As Long:    Dim LLQty As Double

mysql = "SELECT DISTINCT PARTY,CONDATE,SAUDA,SAUDAID FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "'"
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY  IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID  IN (" & LBEXCODE & ")"
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID  IN  (" & LBItemCode & ")  "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
mysql = mysql & " ORDER BY PARTY,SAUDA,CONDATE"
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        MBalQty = 0: MTBQty = 0: MTSQty = 0: MBQty = 0: msqty = 0
        MBalQty = 0: MBQty = 0: msqty = 0
        Do While LSaudaID = AccRec!SAUDAID And mparty = AccRec!PARTY
            MDt = AccRec!Condate
            MBalQty = 0: MBQty = 0: msqty = 0
            Do While MDt = AccRec!Condate And LSaudaID = AccRec!SAUDAID And mparty = AccRec!PARTY
                mysql = "SELECT CONTYPE, SUM(QTY) AS TOTQTY FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' GROUP BY CONTYPE "
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not TRec.EOF
                    If TRec!CONTYPE = "B" Then MBQty = TRec!TotQty
                    If TRec!CONTYPE = "S" Then msqty = TRec!TotQty
                    TRec.MoveNext
                Loop
                If MBQty = msqty Then
                    Cnn.Execute "UPDATE CTR_D SET BROKQTY2 = 0 WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                Else
                    If MBQty > msqty Then
                        Cnn.Execute "UPDATE CTR_D SET BROKQTY2 = 0 WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                        mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'ORDER BY ROWNO "
                        Set TRec = Nothing
                        Set TRec = New ADODB.Recordset
                        TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        LQTY = 0: LLQty = 0
                        Do While Not TRec.EOF
                            LQTY = TRec!QTY
                            If msqty >= LQTY Then
                                LLQty = LQTY
                                msqty = msqty - LQTY
                            ElseIf LQTY > msqty Then
                                LLQty = msqty
                                msqty = 0
                            End If
                            mysql = "UPDATE CTR_D SET BROKQTY2= QTY -" & LLQty & "  WHERE ROWNO = " & TRec!ROWNO & ""
                            Cnn.Execute mysql
                            TRec.MoveNext
                        Loop
                    ElseIf msqty > MBQty Then
                        Cnn.Execute "UPDATE CTR_D SET BROKQTY2 = 0 WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONDATE >'" & Format(GSysLockDt, "YYYY/MM/DD") & "' AND  CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' "
                        mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                        Set TRec = Nothing
                        Set TRec = New ADODB.Recordset
                        TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        LQTY = 0: LLQty = 0
                        Do While Not TRec.EOF
                            LQTY = TRec!QTY
                            If MBQty >= LQTY Then
                                LLQty = LQTY
                                MBQty = MBQty - LQTY
                            ElseIf LQTY > MBQty Then
                                LLQty = MBQty
                                MBQty = 0
                            End If
                            mysql = "UPDATE CTR_D SET BROKQTY2 = QTY -" & LLQty & "  WHERE ROWNO = " & TRec!ROWNO & ""
                            Cnn.Execute mysql
                            TRec.MoveNext
                        Loop
                    End If
                End If
                AccRec.MoveNext
                If AccRec.EOF Then Exit Do
            Loop
            If AccRec.EOF Then Exit Do
        Loop
        If AccRec.EOF Then Exit Do
    Loop
End If
End Sub

Public Sub Updt_EXBrokQty_IntraDay(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPBrok As String)
Dim AccRec As ADODB.Recordset: Dim TrdRec As ADODB.Recordset
Dim mparty  As String:        Dim MSauda As String
Dim MBQty As Double:          Dim msqty As Double:      Dim MBalQty As Double
Dim MTBQty  As Double:        Dim MTSQty As Double:     Dim MBrokQty As Double:   Dim MDt As Date
Dim LSaudaID As Long

On Error GoTo ERR6
mysql = "SELECT DISTINCT PARTY ,SAUDA,SAUDAID FROM  CTR_D WHERE COMPCODE  = " & GCompCode & " "
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID IN (" & LBEXCODE & ")"
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN (" & LBItemCode & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
mysql = mysql & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' "
mysql = mysql & " AND BrokType ='" & LPBrok & "'AND BROKRATE <> 0 ORDER BY PARTY"
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset
AccRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        DoEvents
        GETMAIN.Label1.Caption = "Updating Intraday Qty for " & mparty & " for " & MSauda & " "
        mysql = " SELECT CONDATE,ROWNO,CONTYPE,QTY FROM CTR_D WHERE COMPCODE  = " & GCompCode & "  AND PARTY  = '" & AccRec!PARTY & "'"
        mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND UPDBQTY =0 AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " AND BROKTYPE='" & LPBrok & "' AND INVNO = 0 "
        mysql = mysql & " ORDER BY CONDATE,CONTYPE"
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset:
        TrdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        MBalQty = 0: MTBQty = 0: MTSQty = 0: MBQty = 0: msqty = 0
        Do While Not TrdRec.EOF
            MBQty = 0: msqty = 0
            MDt = TrdRec!Condate
            MBalQty = 0
            Do While MDt = TrdRec!Condate
                MBrokQty = 0
                If MBalQty = 0 Then
                    MBrokQty = TrdRec!QTY
                ElseIf MBalQty > 0 And TrdRec!CONTYPE = "B" Then
                    MBrokQty = TrdRec!QTY
                ElseIf MBalQty < 0 And TrdRec!CONTYPE = "S" Then
                    MBrokQty = TrdRec!QTY
                ElseIf MBalQty > 0 And TrdRec!CONTYPE = "S" And Abs(MBalQty) <= TrdRec!QTY Then
                    MBrokQty = TrdRec!QTY - Abs(MBalQty)
                ElseIf MBalQty < 0 And TrdRec!CONTYPE = "B" And Abs(MBalQty) <= TrdRec!QTY Then
                    MBrokQty = TrdRec!QTY - Abs(MBalQty)
                End If
                If TrdRec!CONTYPE = "B" Then
                    MBalQty = MBalQty + TrdRec!QTY
                Else
                    MBalQty = MBalQty + (TrdRec!QTY * -1)
                End If
                mysql = " EXEC UPD_BROKQTY " & GCompCode & "," & TrdRec!ROWNO & "," & MBrokQty & ""
                Cnn.Execute mysql
                TrdRec.MoveNext
                If TrdRec.EOF Then Exit Do
            Loop
            If TrdRec.EOF Then Exit Do
        Loop
        AccRec.MoveNext
    Loop
End If
Exit Sub
ERR6:
    If err.Number <> 0 Then
        MsgBox err.Description
        
        If CNNERR = True Then
            Cnn.RollbackTrans: CNNERR = False
        End If
    End If
End Sub


Public Sub Updt_EXBrokQty_ValueWise(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPBrok As String)
Dim AccRec As ADODB.Recordset:    Dim TrdRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset
Dim MBQty As Double:              Dim msqty As Double:              Dim MBalQty As Double
Dim MTBQty  As Double:            Dim MTSQty As Double:             Dim MBrokQty As Double
Dim LLQty  As Double:             Dim LQTY As Double:               Dim mparty As String
Dim LSaudaID As Long:          Dim MSauda As String:             Dim MDt As Date:
Dim QtyRec As ADODB.Recordset:      Dim TREC5 As ADODB.Recordset
On Error GoTo err1

mysql = "SELECT DISTINCT PARTY,SAUDA,CONDATE, SAUDAID  FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND UPDBQTY =0 AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' AND INVNO =0"
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID   IN (" & LBEXCODE & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ")  "
mysql = mysql & " AND BrokType ='" & LPBrok & "' AND BROKRATE <> 0 ORDER BY PARTY,SAUDA,CONDATE "
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset
AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        MBalQty = 0:      MTBQty = 0:   MTSQty = 0:   MBQty = 0:
        msqty = 0:        LLQty = 0:    LQTY = 0
        mparty = AccRec!PARTY
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        Set QtyRec = Nothing
        Set QtyRec = New ADODB.Recordset
        mysql = "Get_ContypeQty " & GCompCode & ",'" & mparty & "'," & LSaudaID & ",'" & Format(LBFromDate, "yyyy/mm/dd") & "'"
        QtyRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        Do While MSauda = AccRec!Sauda And mparty = AccRec!PARTY
            MDt = AccRec!Condate
            MBalQty = 0: MBQty = 0: msqty = 0
            DoEvents
            GETMAIN.Label1.Caption = "Intraday Qty for " & mparty & " for " & MSauda & " " & MDt & ""
            Do While MDt = AccRec!Condate And LSaudaID = AccRec!SAUDAID And mparty = AccRec!PARTY
                QtyRec.Filter = adFilterNone
                QtyRec.Filter = "CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                
                Do While Not QtyRec.EOF
                    If QtyRec!CONTYPE = "B" Then MBQty = QtyRec!TotQty
                    If QtyRec!CONTYPE = "S" Then msqty = QtyRec!TotQty
                    QtyRec.MoveNext
                Loop
                Set TRec = Nothing
                If MBQty = msqty Then
                    mysql = " UPDATE CTR_D SET BROKQTY = QTY, UPDBQTY =1 WHERE  COMPCODE= " & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & ""
                    mysql = mysql & "AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' "
                    Cnn.Execute mysql
                    'MYSQL = "EXEC UPD_BROKQTY_CONDATE " & GCompCode & ",'" & MParty & "','" & MSauda & "','" & Format(MDt, "YYYY/MM/DD") & "',''"
                    'Cnn.Execute MYSQL
                Else
                    If MBQty > msqty Then
                        
                        If msqty <> 0 Then
                            'Cnn.Execute "UPDATE CTR_D SET BROKQTY = QTY ,UPDBQTY =1 WHERE  COMPCODE= " & GCompCode & " AND PARTY='" & MParty & "' AND SAUDA='" & MSauda & "' AND  CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' "
                            mysql = "EXEC UPD_BROKQTY_CONDATE " & GCompCode & ",'" & mparty & "'," & LSaudaID & ",'" & Format(MDt, "YYYY/MM/DD") & "','S'"
                            Cnn.Execute mysql
                        End If
                        If msqty = 0 Then
                            mysql = " UPDATE CTR_D SET BROKQTY = 0  ,UPDBQTY =1 WHERE  COMPCODE= " & GCompCode & " AND PARTY='" & mparty & "'"
                            mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND  CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' "
                            Cnn.Execute mysql
                        Else
                            mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " "
                            mysql = mysql & " AND CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                            Set TRec = Nothing
                            Set TRec = New ADODB.Recordset
                            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                            LQTY = 0: LLQty = 0
                            Do While Not TRec.EOF
                                LQTY = TRec!QTY
                                If msqty >= LQTY Then
                                    LLQty = LQTY
                                    msqty = msqty - LQTY
                                ElseIf LQTY > msqty Then
                                    LLQty = msqty
                                    msqty = 0
                                End If
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql
                                TRec.MoveNext
                            Loop
                        End If
                    ElseIf msqty > MBQty Then
                        
                        If MBQty <> 0 Then
                            'Cnn.Execute "UPDATE CTR_D SET BROKQTY = QTY ,UPDBQTY =1 WHERE  COMPCODE=" & GCompCode & "  AND PARTY='" & MParty & "' AND SAUDA='" & MSauda & "' AND CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                            mysql = "EXEC UPD_BROKQTY_CONDATE " & GCompCode & ",'" & mparty & "'," & LSaudaID & ",'" & Format(MDt, "YYYY/MM/DD") & "','B'"
                            Cnn.Execute mysql
                        End If
                        If MBQty = 0 Then
                            mysql = " UPDATE CTR_D SET BROKQTY = 0  ,UPDBQTY =1 WHERE  COMPCODE= " & GCompCode & " AND PARTY='" & mparty & "'"
                            mysql = mysql & " AND SAUDAID= " & LSaudaID & " AND  CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' "
                            Cnn.Execute mysql
                        Else
                            mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " "
                            mysql = mysql & " AND CONTYPE='S' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' AND INVNO = 0 ORDER BY ROWNO "
                            Set TRec = Nothing
                            Set TRec = New ADODB.Recordset
                            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                            LQTY = 0: LLQty = 0
                            Do While Not TRec.EOF
                                LQTY = TRec!QTY
                                If MBQty >= LQTY Then
                                    LLQty = LQTY
                                    MBQty = MBQty - LQTY
                                ElseIf LQTY > MBQty Then
                                    LLQty = MBQty
                                    MBQty = 0
                                End If
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql
                                TRec.MoveNext
                            Loop
                        End If
                    End If
                    
                End If
                AccRec.MoveNext
                If AccRec.EOF Then Exit Do
            Loop
            If AccRec.EOF Then Exit Do
        Loop
        If AccRec.EOF Then Exit Do
    Loop
End If
Exit Sub
err1:
    MsgBox err.Description, vbCritical, "Error Number : " & err.Number
    If CNNERR = True Then
        
       Cnn.RollbackTrans
    End If
End Sub
Public Sub Updt_EXBrokQty_ValueWise2(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPBrok As String)
Dim AccRec As ADODB.Recordset:    Dim TrdRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset
Dim MTOT_BQty As Double:              Dim MTOT_SQty As Double:              Dim MBalQty As Double
Dim MTBQty  As Double:            Dim MTSQty As Double:             Dim MBrokQty As Double: Dim MTOT_DIFF As Double: Dim MOPENING_B As Double: Dim MOPENING_S As Double
Dim LLQty  As Double:             Dim LQTY As Double:               Dim mparty As String
Dim LSaudaID As Long:          Dim MSauda As String:             Dim MDt As Date:
Dim QtyRec As ADODB.Recordset:      Dim TREC5 As ADODB.Recordset
On Error GoTo err1

mysql = "SELECT DISTINCT PARTY,SAUDA,CONDATE, SAUDAID  FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND UPDBQTY =0 AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' AND INVNO =0"
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID   IN (" & LBEXCODE & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ")  "
mysql = mysql & " AND BrokType ='" & LPBrok & "' AND BROKRATE <> 0 ORDER BY PARTY,SAUDA,CONDATE "
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset
AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    MOPENING_B = 0: MOPENING_S = 0
    Do While Not AccRec.EOF
        DoEvents
        MBalQty = 0:      MTBQty = 0:   MTSQty = 0:   MTOT_BQty = 0: MTOT_SQty = 0:        LLQty = 0:    LQTY = 0
        MOPENING_B = 0: MOPENING_S = 0
        mparty = AccRec!PARTY
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        Set QtyRec = Nothing
        Set QtyRec = New ADODB.Recordset
        mysql = "Get_ContypeQty " & GCompCode & ",'" & mparty & "'," & LSaudaID & ",'" & Format(LBFromDate, "yyyy/mm/dd") & "'"
        QtyRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        Do While MSauda = AccRec!Sauda And mparty = AccRec!PARTY
            MDt = AccRec!Condate
            MBalQty = 0: MTOT_BQty = 0: MTOT_SQty = 0
            MOPENING_B = 0: MOPENING_S = 0
            DoEvents
            GETMAIN.Label1.Caption = "Intraday Qty for " & mparty & " for " & MSauda & " " & MDt & ""
            Do While MDt = AccRec!Condate And LSaudaID = AccRec!SAUDAID And mparty = AccRec!PARTY
                QtyRec.Filter = adFilterNone
                QtyRec.Filter = "CONDATE='" & Format(MDt, "YYYY/MM/DD") & "'"
                
                Do While Not QtyRec.EOF
                    If QtyRec!CONTYPE = "B" Then MTOT_BQty = QtyRec!TotQty
                    If QtyRec!CONTYPE = "S" Then MTOT_SQty = QtyRec!TotQty
                    QtyRec.MoveNext
                Loop
                Set TRec = Nothing
                                
                If MOPENING_B > 0 Then
                    MTOT_BQty = MTOT_BQty + MOPENING_B
                ElseIf MOPENING_S > 0 Then
                    MTOT_SQty = MTOT_SQty + MOPENING_S
                    
                End If
                
                If MTOT_BQty >= MTOT_SQty Then
                    MTOT_DIFF = MTOT_BQty - MTOT_SQty
                    MOPENING_B = MTOT_DIFF: MOPENING_S = 0
                    '>>> GET "B" ROWS
                    mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " "
                    mysql = mysql & " AND CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                    Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    LQTY = 0: LLQty = 0
                    Do While Not TRec.EOF
                        LQTY = TRec!QTY
                        If MTOT_SQty > 0 Then
                            If LQTY = MTOT_SQty Then
                                LLQty = MTOT_SQty
                                '>>> UPDATE QTY1
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql
                                MTOT_SQty = 0
                            ElseIf LQTY > MTOT_SQty Then
                                LLQty = MTOT_SQty
                                '>>> UPDATE QTY1
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql

                                LQTY = LQTY - MTOT_SQty
                                If LQTY >= MTOT_DIFF Then
                                    LLQty = LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                    MTOT_DIFF = LQTY - MTOT_DIFF
                                ElseIf LQTY < MTOT_DIFF Then
                                    LLQty = LQTY
                                    MTOT_DIFF = MTOT_DIFF - LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                End If
                                MTOT_SQty = 0
                            ElseIf LQTY < MTOT_SQty Then
                                LLQty = LQTY
                                MTOT_SQty = MTOT_SQty - LQTY
                                '>>> UPDATE QTY1
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql
                            End If
                        ElseIf MTOT_SQty = 0 Or MTOT_DIFF > 0 Then
                                If LQTY >= MTOT_DIFF Then
                                    LLQty = LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                    MTOT_DIFF = LQTY - MTOT_DIFF
                                ElseIf LQTY < MTOT_DIFF Then
                                    LLQty = LQTY
                                    MTOT_DIFF = MTOT_DIFF - LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                End If
                        End If
                        TRec.MoveNext
                    Loop
                    'GET ROWS OF SAME DATE JUST TO UPDATE "UPDBQTY" THAT ROW IS ALREADY CALCULATED
                    mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " "
                    mysql = mysql & " AND CONTYPE <> 'B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                    Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    Do While Not TRec.EOF
                        If MTOT_SQty = 0 And MTOT_DIFF = 0 Then
                            LLQty = 0
                            '>>> UPDATE QTY1
                            mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                            Cnn.Execute mysql
                        End If
                        TRec.MoveNext
                    Loop
                ElseIf MTOT_BQty < MTOT_SQty Then
                    MTOT_DIFF = MTOT_SQty - MTOT_BQty
                    MOPENING_S = MTOT_DIFF: MOPENING_B = 0

                    mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " "
                    mysql = mysql & " AND CONTYPE='B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                    Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    LQTY = 0: LLQty = 0
                    Do While Not TRec.EOF
                        LQTY = TRec!QTY
                        If MTOT_BQty > 0 Then
                            If LQTY = MTOT_BQty Then
                                LLQty = MTOT_BQty
                                '>>> UPDATE QTY1
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql
                                MTOT_BQty = 0
                            ElseIf LQTY > MTOT_BQty Then
                                LLQty = MTOT_BQty
                                '>>> UPDATE QTY1
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql

                                LQTY = LQTY - MTOT_BQty
                                If LQTY >= MTOT_DIFF Then
                                    LLQty = LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                    MTOT_DIFF = LQTY - MTOT_DIFF
                                ElseIf LQTY < MTOT_DIFF Then
                                    LLQty = LQTY
                                    MTOT_DIFF = MTOT_DIFF - LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                End If
                                MTOT_BQty = 0
                            ElseIf LQTY < MTOT_BQty Then
                                LLQty = LQTY
                                MTOT_BQty = MTOT_BQty - LQTY
                                '>>> UPDATE QTY1
                                mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                Cnn.Execute mysql
                            End If
                        ElseIf MTOT_BQty = 0 Or MTOT_DIFF > 0 Then
                                If LQTY >= MTOT_DIFF Then
                                    LLQty = LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                    MTOT_DIFF = LQTY - MTOT_DIFF
                                ElseIf LQTY < MTOT_DIFF Then
                                    LLQty = LQTY
                                    MTOT_DIFF = MTOT_DIFF - LQTY
                                    '>>> UPDATE QTY2
                                    mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                                    Cnn.Execute mysql
                                End If
                        End If
                        TRec.MoveNext
                    Loop
                    
                    MTOT_BQty = MTOT_BQty + MTOT_DIFF
                    MTOT_DIFF = 0
                    
                    mysql = "SELECT CONSNO, CONNO,ROWNO,QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " "
                    mysql = mysql & " AND CONTYPE<>'B' AND CONDATE='" & Format(MDt, "YYYY/MM/DD") & "' ORDER BY ROWNO "
                    Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    Do While Not TRec.EOF
                        LQTY = TRec!QTY
                        If MTOT_BQty = 0 And MTOT_DIFF = 0 Then
                            LLQty = 0 '>>> JUST TO UPDATE "UPDBQTY" THAT ROW IS ALREADY CALCULATED
                            '>>> UPDATE QTY1
                            mysql = " EXEC UPD_BROKQTY_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                            Cnn.Execute mysql
                        ElseIf LQTY >= MTOT_BQty Then
                            LLQty = MTOT_BQty
                            '>>> UPDATE QTY2
                            mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                            Cnn.Execute mysql
                            MTOT_BQty = 0
                        ElseIf LQTY < MTOT_BQty Then
                            LLQty = LQTY
                            '>>> UPDATE QTY2
                            mysql = " EXEC UPD_BROKQTY2_ROWNO " & LLQty & "," & TRec!ROWNO & ""
                            Cnn.Execute mysql
                            MTOT_BQty = MTOT_BQty - LQTY
                        End If

                        TRec.MoveNext
                    Loop
                End If
                    
'                End If
                AccRec.MoveNext
                If AccRec.EOF Then Exit Do
            Loop
            If AccRec.EOF Then Exit Do
        Loop
        If AccRec.EOF Then Exit Do
    Loop
End If
Exit Sub
err1:
    MsgBox err.Description, vbCritical, "Error Number : " & err.Number
    If CNNERR = True Then
        
       Cnn.RollbackTrans
    End If
End Sub
'Public Sub Updt_EXBrokQty_Opening(LBParty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPInst As String)
'
'Dim AccRec As ADODB.Recordset:Dim TrdRec As ADODB.Recordset:Dim MBalQty As Double:
'Dim MBrokQty As Double:         Dim MTOT_BQty  As Double:           Dim MTOT_SQty  As Double:
'Dim MSauda  As String:          Dim MParty As String
'
'MYSQL = "SELECT DISTINCT PARTY,SAUDA FROM CTR_D WHERE COMPCODE=" & GCompCode  & " AND CONDATE>='" & Format(LBFromDate, "YYYY/MM/DD") & "'"
'MYSQL = MYSQL & " AND PATTAN ='C' AND BrokType ='O' AND BROKRATE <> 0 ORDER BY PARTY"
'Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open MYSQL, Cnn, adOpenKeyset, adLockReadOnly
'If Not AccRec.EOF Then
'    Do While Not AccRec.EOF
'        MParty = AccRec!Party:        MSauda = AccRec!Sauda
'        DoEvents
'        GETMAIN.Label1.Caption = "Updating Opening Qty for " & MParty & " for " & MSauda & ""
'        MYSQL = "SELECT CONDATE,ROWNO,CONTYPE,QTY FROM CTR_D WHERE COMPCODE=" & GCompCode  & " AND PARTY='" & MParty & "' AND SAUDA='" & MSauda & "'"
'        MYSQL = MYSQL & " AND UPDBQTY =0 AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
'        MYSQL = MYSQL & " AND BROKTYPE='O' AND INVNO = 0 "
'        MYSQL = MYSQL & " ORDER BY CONDATE, CONTYPE"
'        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset
'        TrdRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'        MBalQty = SDOpQty(MParty, MSauda, LBFromDate)
'        Do While Not TrdRec.EOF
'            MTOT_BQty = 0:      MTOT_SQty = 0:      MBrokQty = 0
'
'            If MBalQty = 0 Then
'                MBrokQty = TrdRec!QTY
'            ElseIf MBalQty > 0 And TrdRec!CONTYPE = "B" Then
'                MBrokQty = TrdRec!QTY
'            ElseIf MBalQty < 0 And TrdRec!CONTYPE = "S" Then
'                MBrokQty = TrdRec!QTY
'            ElseIf MBalQty > 0 And TrdRec!CONTYPE = "S" And Abs(MBalQty) <= TrdRec!QTY Then
'                MBrokQty = TrdRec!QTY - Abs(MBalQty)
'            ElseIf MBalQty < 0 And TrdRec!CONTYPE = "B" And Abs(MBalQty) <= TrdRec!QTY Then
'                MBrokQty = TrdRec!QTY - Abs(MBalQty)
'            End If
'
'            If TrdRec!CONTYPE = "B" Then
'                MBalQty = MBalQty + TrdRec!QTY
'            Else
'                MBalQty = MBalQty + (TrdRec!QTY * -1)
'            End If
'
'            MYSQL = " EXEC UPD_BROKQTY " & GCompCode  & "," & TrdRec!ROWNO & "," & MBrokQty & ""
'            Cnn.Execute MYSQL
'            TrdRec.MoveNext
'        Loop
'        Set TrdRec = Nothing
'        AccRec.MoveNext
'    Loop
'    Set AccRec = Nothing
'    MYSQL = "UPDATE CTR_D SET BROKQTY = 0 ,UPDBQTY =1  WHERE COMPCODE = " & GCompCode  & " "
'    MYSQL = MYSQL & " AND PATTAN = 'O' AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' "
'    Cnn.Execute MYSQL
'End If
'End Sub

Public Sub Updt_EXBrokQty_RZLotwise_Intraday(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPInst As String)
Dim AccRec As ADODB.Recordset:      Dim TrdRec As ADODB.Recordset
Dim mparty As String:               Dim MSauda As String
Dim MBQty As Double:                Dim msqty As Double:
Dim MBalQty As Double:              Dim MBrokQty As Double
Dim MTBQty As Double:               Dim MTSQty As Double
Dim MDt As Date:                    Dim LSaudaID As Long
mysql = "SELECT DISTINCT PARTY FROM CTR_D WHERE COMPCODE  = " & GCompCode & " "
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID IN(" & LBEXCODE & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ") "
mysql = mysql & " AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
mysql = mysql & " AND BrokType ='R' ORDER BY PARTY "
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY
        mysql = " SELECT CONDATE,SAUDAID,SAUDA,ROWNO,CONTYPE,QTY FROM CTR_D WHERE COMPCODE  = " & GCompCode & "  AND PARTY  = '" & mparty & "'"
        mysql = mysql & " AND UPDBQTY =0 "
        mysql = mysql & " AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID IN(" & LBEXCODE & ") "
        If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
        If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ") "
        mysql = mysql & " AND BROKTYPE='R' AND INVNO = 0 "
        mysql = mysql & "ORDER BY SAUDAID,CONDATE,CONTYPE"
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset: TrdRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        MBalQty = 0: MTBQty = 0: MTSQty = 0: MBQty = 0: msqty = 0
        Do While Not TrdRec.EOF
            MBQty = 0: msqty = 0
            MSauda = TrdRec!Sauda
            LSaudaID = TrdRec!SAUDAID
            DoEvents
            GETMAIN.Label1.Caption = "Updating Qty for " & mparty & " for " & MSauda & ""
            MBalQty = 0
            Do While LSaudaID = TrdRec!SAUDAID
                MDt = TrdRec!Condate
                MBalQty = 0
                Do While MDt = TrdRec!Condate And LSaudaID = TrdRec!SAUDAID
                    MBrokQty = 0
                    If MBalQty = 0 Then
                        MBrokQty = TrdRec!QTY
                    ElseIf MBalQty > 0 And TrdRec!CONTYPE = "B" Then
                        MBrokQty = TrdRec!QTY
                    ElseIf MBalQty > 0 And TrdRec!CONTYPE = "S" And Abs(MBalQty) >= TrdRec!QTY Then
                        MBrokQty = 0
                    ElseIf MBalQty > 0 And TrdRec!CONTYPE = "S" And Abs(MBalQty) <= TrdRec!QTY Then
                        MBrokQty = TrdRec!QTY - Abs(MBalQty)
                    ElseIf MBalQty < 0 And TrdRec!CONTYPE = "S" Then
                        MBrokQty = TrdRec!QTY
                    ElseIf MBalQty < 0 And TrdRec!CONTYPE = "B" And Abs(MBalQty) >= TrdRec!QTY Then
                        MBrokQty = 0
                    ElseIf MBalQty < 0 And TrdRec!CONTYPE = "B" And Abs(MBalQty) <= TrdRec!QTY Then
                        MBrokQty = TrdRec!QTY - Abs(MBalQty)
                    End If
                    If TrdRec!CONTYPE = "B" Then
                        MBalQty = MBalQty + TrdRec!QTY
                    Else
                        MBalQty = MBalQty + (TrdRec!QTY * -1)
                    End If
                    'Cnn.Execute "UPDATE CTR_D SET BROKQTY = " & MBrokQty & ",UPDBQTY =1 WHERE  COMPCODE= " & GCompCode & " AND  ROWNO = " & TrdRec!ROWNO & " "
                    'MYSQL = "EXEC UPDATE_BROKQTY "
                    mysql = " EXEC UPD_BROKQTY_ROWNO " & MBrokQty & "," & TrdRec!ROWNO & ""
                    Cnn.Execute mysql
                    TrdRec.MoveNext
                    If TrdRec.EOF Then Exit Do
                Loop
                If TrdRec.EOF Then Exit Do
            Loop
            If TrdRec.EOF Then Exit Do
        Loop
        AccRec.MoveNext
        If AccRec.EOF Then Exit Do
    Loop
End If
End Sub
Public Sub Updt_EXBrokQty_WHigher(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPInst As String)
Dim BUYREC As ADODB.Recordset:      Dim SELLREC As ADODB.Recordset:     Dim AccRec As ADODB.Recordset
Dim TrdRec As ADODB.Recordset:      Dim SaudaRec As ADODB.Recordset:    Dim mparty As String
Dim MSauda As String:               Dim MBAmt As Double:                Dim MSAmt As Double
Dim LCondate As Date:               Dim LQTY As Double:                 Dim LRATE As Double
Dim LRowNo As Double: Dim LSaudaID As Long

mysql = "SELECT DISTINCT PARTY,SAUDA,SAUDAID FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND UPDBQTY =0  "
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY  IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & " AND EXID  IN (" & LBEXCODE & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ") "
mysql = mysql & " AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
mysql = mysql & " AND BrokType ='W' AND  BROKRATE <> 0 AND INVNO = 0 ORDER BY PARTY "
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        DoEvents
        GETMAIN.Label1.Caption = "Updating WHigher Valuewise Qty for " & mparty & " for " & MSauda & ""
        MBAmt = 0: MSAmt = 0
        mysql = "SELECT CONDATE,CONTYPE, SUM(QTY * RATE) AS AMT FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND INVNO=0 "
        mysql = mysql & "AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " GROUP BY CONDATE, CONTYPE ORDER BY CONDATE,CONTYPE "
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset: TrdRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        Do While Not TrdRec.EOF
            MBAmt = 0:      MSAmt = 0
            LCondate = TrdRec!Condate
            Do While LCondate = TrdRec!Condate
                If TrdRec!CONTYPE = "B" Then
                    MBAmt = TrdRec!AMT
                Else
                    MSAmt = TrdRec!AMT
                End If
                TrdRec.MoveNext
                If TrdRec.EOF Then Exit Do
            Loop
            If MBAmt > MSAmt Then
                mysql = "SELECT ROWNO, QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='B' AND PARTY='" & mparty & "' "
                mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' ORDER BY RATE DESC"
                Set BUYREC = Nothing
                Set BUYREC = New ADODB.Recordset
                BUYREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not BUYREC.EOF
                    LRowNo = BUYREC!ROWNO:  LQTY = BUYREC!QTY:  LRATE = BUYREC!Rate
                    Do While LQTY <> 0
                        mysql = "SELECT ROWNO, ADJQTY,QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='S' "
                        mysql = mysql & " AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND "
                        mysql = mysql & " CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' AND QTY<>ADJQTY ORDER BY RATE "
                        Set SELLREC = Nothing
                        Set SELLREC = New ADODB.Recordset
                        SELLREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        If SELLREC.EOF Then
                            'MYSQL = "UPDATE CTR_D SET BROKQTY=BROKQTY + " & LQty & ",UPDBQTY =1  WHERE ROWNO=" & LRowNo & " "
                            mysql = " EXEC UPD_BROKQTY_ROWNO " & LQTY & "," & LRowNo & ""
                            Cnn.Execute mysql
                            LQTY = 0
                        Else
                            If LRATE >= SELLREC!Rate Then
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    'MYSQL = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & (SELLREC!QTY - SELLREC!ADJQTY) & ", UPDBQTY =1 WHERE ROWNO=" & LRowNo & " "
                                    mysql = " EXEC UPD_BROKQTY_ROWNO " & (SELLREC!QTY - SELLREC!ADJQTY) & "," & LRowNo & ""
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                    mysql = "UPDATE CTR_D SET ADJQTY=" & SELLREC!QTY & ",UPDBQTY =1 WHERE  ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                Else
                                    'MYSQL = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & LQty & ",UPDBQTY =1  WHERE   ROWNO=" & LRowNo & " "
                                    mysql = " EXEC UPD_BROKQTY_ROWNO " & LQTY & "," & LRowNo & ""
                                    Cnn.Execute mysql
                                    mysql = "UPDATE CTR_D SET ADJQTY=ADJQTY + " & LQTY & ",UPDBQTY =1  WHERE  ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            Else
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    mysql = "UPDATE CTR_D SET BROKQTY= BROKQTY + " & (SELLREC!QTY - SELLREC!ADJQTY) & ", ADJQTY =" & SELLREC!QTY & ",UPDBQTY =1 WHERE ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                Else
                                    mysql = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & LQTY & " ,ADJQTY = ADJQTY+ " & LQTY & ",UPDBQTY = 1 WHERE ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            End If
                        End If
                    Loop
                    BUYREC.MoveNext
                Loop
            Else
                mysql = "SELECT ROWNO, QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='S' AND PARTY='" & mparty & "' "
                mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' ORDER BY RATE DESC"
                Set BUYREC = Nothing
                Set BUYREC = New ADODB.Recordset
                BUYREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not BUYREC.EOF
                    LRowNo = BUYREC!ROWNO:  LQTY = BUYREC!QTY:  LRATE = BUYREC!Rate
                    Do While LQTY <> 0
                        mysql = "SELECT ROWNO, ADJQTY,QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='B' AND PARTY='" & mparty & "' "
                        mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' AND QTY<>ADJQTY ORDER BY RATE "
                        Set SELLREC = Nothing:  Set SELLREC = New ADODB.Recordset
                        SELLREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        If SELLREC.EOF Then
                            'MYSQL = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & LQty & ",UPDBQTY =1 WHERE  ROWNO=" & LRowNo & " "
                            mysql = " EXEC UPD_BROKQTY_ROWNO " & LQTY & "," & LRowNo & ""
                            Cnn.Execute mysql
                            LQTY = 0
                        Else
                            If LRATE >= SELLREC!Rate Then
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    'MYSQL = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & (SELLREC!QTY - SELLREC!ADJQTY) & " ,UPDBQTY =1 WHERE ROWNO=" & LRowNo & " "
                                    mysql = " EXEC UPD_BROKQTY_ROWNO " & (SELLREC!QTY - SELLREC!ADJQTY) & "," & LRowNo & ""
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                    mysql = "UPDATE CTR_D SET ADJQTY=" & SELLREC!QTY & " ,UPDBQTY =1 WHERE ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                Else
                                    'MYSQL = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & LQty & " ,UPDBQTY =1 WHERE ROWNO=" & LRowNo & " "
                                    mysql = " EXEC UPD_BROKQTY_ROWNO " & LQTY & "," & LRowNo & ""
                                    Cnn.Execute mysql
                                    mysql = "UPDATE CTR_D SET ADJQTY=ADJQTY+ " & LQTY & " ,UPDBQTY =1 WHERE ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            Else
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    mysql = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & (SELLREC!QTY - SELLREC!ADJQTY) & ", ADJQTY =" & SELLREC!QTY & " ,UPDBQTY =1 WHERE  ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                Else
                                    mysql = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & LQTY & " ,ADJQTY = ADJQTY+ " & LQTY & " ,UPDBQTY =1 WHERE ROWNO=" & SELLREC!ROWNO & " "
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            End If
                        End If
                    Loop
                    BUYREC.MoveNext
                Loop
            End If
            If TrdRec.EOF Then Exit Do
        Loop
        AccRec.MoveNext
    Loop
End If
End Sub

Public Sub Updt_EXBrokQty_Higher(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPBrok As String)
Dim AccRec As ADODB.Recordset:      Dim SaudaRec As ADODB.Recordset:        Dim TrdRec As ADODB.Recordset
Dim mparty As String:               Dim MSauda As String:                   Dim MBAmt As Double
Dim MSAmt As Double:                Dim LCondate As Date:
Dim LSaudaID As Long
On Error GoTo err5
mysql = "SELECT DISTINCT PARTY,SAUDA ,SAUDAID FROM CTR_D WHERE COMPCODE  = " & GCompCode & " "
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & " AND EXID IN (" & LBEXCODE & ") "
mysql = mysql & "AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
mysql = mysql & " AND BrokType ='" & LPBrok & "' AND INVNO = 0 ORDER BY PARTY "
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY:        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        MBAmt = 0:                    MSAmt = 0
        DoEvents
        GETMAIN.Label1.Caption = "Updating Higher Valuewise Qty for " & mparty & " for " & MSauda & ""
        mysql = "SELECT CONDATE,CONTYPE, SUM(QTY * RATE) AS AMT FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & ""
        mysql = mysql & "AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " AND BrokType ='" & LPBrok & "' AND INVNO = 0 "
        mysql = mysql & " GROUP BY CONDATE, CONTYPE ORDER BY CONDATE,CONTYPE "
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset: TrdRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        Do While Not TrdRec.EOF
            MBAmt = 0: MSAmt = 0
            LCondate = TrdRec!Condate
            Do While LCondate = TrdRec!Condate
                If TrdRec!CONTYPE = "B" Then
                    MBAmt = TrdRec!AMT
                Else
                    MSAmt = TrdRec!AMT
                End If
                TrdRec.MoveNext
                If TrdRec.EOF Then Exit Do
            Loop
            If MBAmt > MSAmt Then
                mysql = "UPDATE CTR_D SET BROKQTY=QTY ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND PARTY='" & mparty & "' And SAUDAID =" & LSaudaID & " AND CONDATE ='" & Format(LCondate, "YYYY/MM/DD") & "' And CONTYPE = 'B' "
                Cnn.Execute mysql
            Else
                mysql = "UPDATE CTR_D SET BROKQTY=QTY ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & "  AND PARTY='" & mparty & "' And SAUDAID = " & LSaudaID & " AND CONDATE ='" & Format(LCondate, "YYYY/MM/DD") & "' AND CONTYPE ='S' "
                Cnn.Execute mysql
            End If
            If TrdRec.EOF Then Exit Do
        Loop
        AccRec.MoveNext
    Loop
End If
Exit Sub
err5:
    If err.Number <> 0 Then
        MsgBox err.Description
        
        If CNNERR = True Then
            Cnn.RollbackTrans: CNNERR = False
        End If
    End If
End Sub
Public Sub Updt_EXBrokQty_XIntraday(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPInst As String)
Dim BUYREC As ADODB.Recordset:      Dim SELLREC As ADODB.Recordset:     Dim AccRec As ADODB.Recordset
Dim TrdRec As ADODB.Recordset:      Dim SaudaRec As ADODB.Recordset:    Dim mparty As String
Dim MSauda As String:               Dim MBAmt As Double:                Dim MSAmt As Double
Dim LCondate As Date:               Dim LSaudaID As Long
mysql = "SELECT DISTINCT PARTY,SAUDA , SAUDAID FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND UPDBQTY =0 AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID IN (" & LBEXCODE & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & "AND SAUDAID IN (" & LBSauda & ") "
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ") "
mysql = mysql & " AND BrokType ='X' AND BROKRATE <> 0 AND INVNO = 0 ORDER BY PARTY, SAUDA"
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset:
AccRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY:        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        DoEvents
        GETMAIN.Label1.Caption = "Updating XIntraday Wise Qty for " & mparty & " for " & MSauda & ""
        MBAmt = 0: MSAmt = 0
        mysql = "SELECT CONDATE,CONTYPE, SUM(CASE CONTYPE WHEN 'B' THEN QTY * RATE WHEN 'S' THEN QTY*RATE*-1 END ) AS AMT FROM CTR_D "
        mysql = mysql & " WHERE COMPCODE =" & GCompCode & " AND PARTY='" & mparty & "' AND SAUDAID =" & LSaudaID & " AND INVNO =0 "
        mysql = mysql & " AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " GROUP BY CONDATE, CONTYPE ORDER BY CONDATE,CONTYPE "
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset
        TrdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not TrdRec.EOF
            MBAmt = 0: MSAmt = 0
            LCondate = TrdRec!Condate
            If TrdRec!AMT > 0 Then
                If TrdRec.EOF Then Exit Do
                mysql = "UPDATE CTR_D SET BROKQTY = QTY ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND CONTYPE ='B' AND PARTY='" & mparty & "' "
                mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
            Else
                mysql = "UPDATE CTR_D SET BROKQTY = QTY  ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND CONTYPE='S' AND PARTY='" & mparty & "' "
                mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
            End If
            TrdRec.MoveNext
        Loop
        AccRec.MoveNext
    Loop
End If
End Sub

Public Function Create_CCItemMast(LCItemCode As String, LCItemName As String, LCExhCode As String, LCLot As Double, LCExCode As String) As String
Dim Rec As ADODB.Recordset: Dim NewItem As Boolean: Dim ItemRec As ADODB.Recordset: Dim REC2 As ADODB.Recordset: Dim Rec3 As ADODB.Recordset
Dim NRec As ADODB.Recordset
Set ItemRec = Nothing
Set ItemRec = New ADODB.Recordset
Dim LCItemCode1  As String
mysql = "SELECT ITEMCODE FROM CONTRACTMASTER WHERE  EXCODE = '" & LCExCode & "' AND EX_SYMBOL = '" & LCExhCode & "'"
ItemRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If ItemRec.EOF Then
    If Duplicate_CItem_Chk(LCItemCode) Then
        LCItemCode1 = Trim(LCExCode) & " " & Trim(LCItemCode)
        If Duplicate_CItem_Chk(LCItemCode1) Then
            MsgBox "Please Check Entry for " & LCExhCode & ""
            Create_CCItemMast = vbNullString
            Exit Function
        End If
    Else
        LCItemCode1 = LCItemCode
    End If
    mysql = "EXEC INSERT_CONTRACTMASTER '" & LCExCode & "','" & LCItemCode1 & "','" & LCItemName & "','" & LCExhCode & "','N',0," & LCLot & ",'','','',0"
    Cnn.Execute mysql
    
Else
    LCItemCode1 = ItemRec!ITEMCODE
End If
    Create_CCItemMast = LCItemCode1
End Function
Public Function Create_SSSaudaMast(LPExhCode As String, LPMDate As Date, LPExCode As String, LPInstType As String, LPOptType As String, LPStrike As Double) As String
Dim LPItemCode As String: Dim TRec As ADODB.Recordset: Dim LPSaudaCode As String
LPSaudaCode = vbNullString
Dim LPLLOT As Double

Set TRec = Nothing: Set TRec = New ADODB.Recordset
mysql = "SELECT SAUDACODE FROM SCRIPTMASTER  WHERE EX_SYMBOL ='" & LPExhCode & "'"
mysql = mysql & " AND MATURITY='" & Format(LPMDate, "yyyy/MM/dd") & "' AND EXCODE ='" & LPExCode & "'AND INSTTYPE ='" & LPInstType & "' AND OPTTYPE='" & LPOptType & "' AND STRIKEPRICE = " & LPStrike & ""
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    LPSaudaCode = TRec!saudacode
Else
    mysql = "SELECT ITEMCODE FROM CONTRACTMASTER WHERE  EXCODE='" & LPExCode & "' AND EX_SYMBOL ='" & LPExhCode & "'"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not TRec.EOF Then
        LPItemCode = TRec!ITEMCODE
        If LPInstType = "FUT" Then
            LPSaudaCode = Trim(LPItemCode) & " " & Left$(CStr(Day(LPMDate)), 2) & UCase(Left$(MonthName(Val(month(LPMDate))), 3)) & Right$(Year(LPMDate), 2)
        ElseIf LPInstType = "OPT" Then
            LPSaudaCode = Trim(LPItemCode) & " " & LPInstType & " " & LPOptType & " " & Trim(CStr(LPStrike)) & " " & Left$(CStr(Day(LPMDate)), 2) & UCase(Left$(MonthName(Val(month(LPMDate))), 3)) & Right$(Year(LPMDate), 2)
        Else
            LPSaudaCode = Trim(LPItemCode) & " " & LPInstType
        End If
        If Duplicate_SSauda_Chk(LPSaudaCode) = True Then
            LPSaudaCode = LPExCode & " " & LPSaudaCode
            If Duplicate_SSauda_Chk(LPSaudaCode) = True Then
                MsgBox "Please Check Entry for " & LPSaudaCode & ""
                Create_SSSaudaMast = vbNullString
                Exit Function
            End If
        End If
        LPLLOT = 1
        If GAmtDivide = "1" Then
            LPLLOT = LPLLOT / 100
        End If
        mysql = " EXEC INSERT_SCRIPT_MASTER  '" & LPExCode & "','" & LPExhCode & "','" & LPItemCode & "','" & LPItemCode & "','A','',''," & LPLLOT & ",'N','" & LPSaudaCode & "','" & LPSaudaCode & "','" & Format(LPMDate, "yyyy/MM/dd") & "'," & Trim(CStr(LPStrike)) & ",'" & LPOptType & "','" & LPInstType & "',0,1"
        Cnn.Execute mysql
    End If
End If
Create_SSSaudaMast = LPSaudaCode
End Function


Public Sub Update_Import_MarginAmt(LIParties As String, LIFromDate As Date, LIExCodes As String)

Dim LMIRate  As Double:     Dim LMERate As Double:              Dim LAddLong As Double
Dim LAddShort As Double:    Dim LMargAmt As Double:             Dim LMARate As Double
Dim LCloseQty As Double:    Dim LLOT As Double:                 Dim LCLRATE As Double
Dim MCondate As Date:       Dim MItemCode As String:            Dim MExCode As String
Dim mparty As String:       Dim MSauda As String:               Dim LMarRate As Double
Dim Lmaturity As Date:      Dim LELMLong As Double:             Dim LELMShort As Double
Dim LDelivery As Double:    Dim NewRec As ADODB.Recordset:      Dim MRateRec As ADODB.Recordset
Dim LSaudaID As Long:       Dim LExID As Integer:               Dim LItemID As Integer
Dim LACCID As Long
Dim LTotMarginRate As Double

On Error GoTo ERR2

    
    mysql = "SELECT D.ITEMID,D.SAUDAID,D.SAUDA,D.CONDATE,D.ITEMCODE,D.ACCID,D.PARTY,D.MATURITY,D.CLOSEQTY,D.FLATQTY,D.SPREADQTY,"
    mysql = mysql & " D.EXCODE,D.CLOSERATE,D.EXID FROM DMARGIN AS D"
    mysql = mysql & " WHERE D.COMPCODE = " & GCompCode & " AND CLOSEQTY <> 0 "
    If LenB(LIParties) <> 0 Then mysql = mysql & " AND D.PARTY IN (" & LIParties & ")"
    If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND D.EXID  IN (" & LIExCodes & ")"
    mysql = mysql & " AND D.ACCID  IN (SELECT DISTINCT ACCID FROM PEXBROK WHERE "
    mysql = mysql & " COMPCODE =" & GCompCode & " AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "' AND MARTYPE ='I' AND INSTTYPE ='FUT')"
    mysql = mysql & " AND D.CONDATE >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
    mysql = mysql & " ORDER BY D.EXCODE,D.SAUDA,D.CONDATE, D.PARTY "
    
    Set NewRec = Nothing
    Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not NewRec.EOF Then
        mysql = "SELECT * FROM DLYMGN WHERE COMPCODE = " & GCompCode & " "
        mysql = mysql & " AND MATURITY >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
        If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND EXID IN (" & LIExCodes & ")"
        mysql = mysql & " ORDER BY CONDATE DESC , SAUDA "
        Set MRateRec = Nothing:    Set MRateRec = New ADODB.Recordset
        MRateRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    
        mysql = "UPDATE DMARGIN SET MARGINAMT =0 WHERE COMPCODE =" & GCompCode & " AND CLOSEQTY =0"
        If LenB(LIParties) <> 0 Then mysql = mysql & " AND PARTY IN (" & LIParties & ")"
        If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND EXID IN (" & LIExCodes & ")"
        mysql = mysql & " AND CONDATE >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
        Cnn.Execute mysql
    End If
    Do While Not NewRec.EOF
        MSauda = NewRec!Sauda:        MCondate = NewRec!Condate
        LSaudaID = NewRec!SAUDAID:    LItemID = NewRec!itemid
        LExID = NewRec!EXID
        'LSaudaID = NewRec!SAUDAID
        Lmaturity = NewRec!MATURITY
        LMIRate = 0:                  LMERate = 0:
        LAddLong = 0:                 LAddShort = 0:
        LMargAmt = 0
        
        LLOT = Get_LotSize(NewRec!itemid, LSaudaID, LExID)
        MRateRec.Filter = adFilterNone
        MRateRec.Filter = "CONDATE<='" & Format(MCondate, "yyyy/MM/dd") & "' AND SAUDA='" & MSauda & "'"
        If Not MRateRec.EOF Then
            'DoEvents
            LMIRate = Val(MRateRec!IMRate):             LMERate = Val(MRateRec!EMRate)
            LMARate = Val(MRateRec!AMRate):             LAddLong = Val(MRateRec!ADDLONG)
            LAddShort = Val(MRateRec!ADDSHORT):         LELMLong = Val(MRateRec!ELMLong)
            LELMShort = Val(MRateRec!ELmShort):         LDelivery = Val(MRateRec!Delivery)
        Else
            LMIRate = 0:    LMERate = 0:    LMARate = 0:    LAddLong = 0: LAddShort = 0
            LELMLong = 0:   LELMShort = 0:  LDelivery = 0
        End If
        DoEvents
        GETMAIN.Label1.Caption = "Updateing I Margin Amt for " & MSauda & " " & MCondate & ""
        Do While NewRec!Condate = MCondate And NewRec!Sauda = MSauda
            MItemCode = NewRec!ITEMCODE:            mparty = NewRec!PARTY
            LACCID = NewRec!ACCID
            LCLRATE = IIf(IsNull(NewRec!CLOSERATE), 1, NewRec!CLOSERATE)
            LMargAmt = 0
            LCloseQty = NewRec!CLOSEQTY
            If LCloseQty > 0 Then
                LMarRate = LMIRate + LMERate + LMARate + LAddLong
                LMargAmt = (LMarRate / 100) * Abs(NewRec!FLATQTY) * LCLRATE * LLOT
                LMargAmt = LMargAmt + (NewRec!SPREADQTY * LCLRATE * LLOT * 0.02)
                LMargAmt = LMargAmt + (NewRec!SPREADQTY * LCLRATE * LLOT * ((LMERate / 100) / 3))
                LMargAmt = LMargAmt + (NewRec!SPREADQTY * LCLRATE * LLOT * (LMARate / 100))
                'LMargAmt = LMargAmt + (NewRec!FLATQTY * LCLRATE * LLot * (Val(LAddLong) / 100))
                LMargAmt = LMargAmt + (NewRec!FLATQTY * LCLRATE * LLOT * (LELMLong / 100))
                LMargAmt = LMargAmt + (NewRec!FLATQTY * LCLRATE * LLOT * (LDelivery / 100))
                LTotMarginRate = LMarRate + LELMLong + LDelivery
            ElseIf LCloseQty < 0 Then
                LMarRate = Val(LMIRate) + Val(LMERate) + Val(LMARate) + Val(LAddShort)
                LMargAmt = (LMarRate / 100) * Abs(NewRec!FLATQTY) * LCLRATE * LLOT
                LMargAmt = LMargAmt + (Abs(NewRec!SPREADQTY) * LCLRATE * LLOT * 0.02)
                LMargAmt = LMargAmt + (Abs(NewRec!SPREADQTY) * LCLRATE * LLOT * ((Val(LMERate) / 100) / 3))
                LMargAmt = LMargAmt + (Abs(NewRec!SPREADQTY) * LCLRATE * LLOT * (Val(LMARate) / 100))
                'LMargAmt = LMargAmt + (Abs(NewRec!FLATQTY) * LCLRATE * LLot * (Val(LAddShort) / 100))
                LMargAmt = LMargAmt + (Abs(NewRec!FLATQTY) * LCLRATE * LLOT * (Val(LELMShort) / 100))
                LMargAmt = LMargAmt + (Abs(NewRec!FLATQTY) * LCLRATE * LLOT * (Val(LDelivery) / 100))
                LTotMarginRate = LMarRate + LELMShort + LDelivery
            End If
            If Lmaturity = MCondate Then LMargAmt = 0
            NewRec.MoveNext
            
            mysql = "EXEC Upd_MarginAmt " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & LMargAmt & "," & LTotMarginRate & " "
            Cnn.Execute mysql
            If NewRec.EOF Then Exit Do
        Loop
        If NewRec.EOF Then Exit Do
    Loop
    Set NewRec = Nothing
    Set MRateRec = Nothing
    Exit Sub
ERR2:
    If err.Number <> 0 Then
        MsgBox err.Description
        
        Set NewRec = Nothing
        Set MRateRec = Nothing
        If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
    End If
End Sub
'Public Sub Update_Quantity_MarginAmt(LQParties As String, LQFromDate As DATE , LQToDate As DATE , LQExCodes As String)
'
'Dim LMargAmt As Double:             Dim MCondate As Date:           Dim MItemCode As String:    Dim MExCode As String
'Dim MParty As String:               Dim MSauda As String:           Dim LMarRate As Double
'Dim LMaturity As Date:              Dim MargAmt As Double:          Dim MRateRec As ADODB.Recordset
'Dim MRateRec2 As ADODB.Recordset:   Dim NewRec As ADODB.Recordset
'
'    MYSQL = "SELECT * FROM PEXBROK WHERE COMPCODE = " & GCompCode  & " "
'    If LenB(LQToDate) > 0 Then MYSQL = MYSQL & " AND UPTOSTDT <='" & Format(CDate(LQToDate), "YYYY/MM/DD") & "'"
'    MYSQL = MYSQL & " AND MARTYPE='Q'"
'    If LenB(LQParties) > 0 Then MYSQL = MYSQL & " AND AC_CODE IN (" & LQParties & ")"
'    MYSQL = MYSQL & " ORDER BY UPTOSTDT DESC"
'    Set MRateRec = Nothing:    Set MRateRec = New ADODB.Recordset
'    MRateRec.Open MYSQL, Cnn, adOpenStatic, adLockReadOnly
'
'    MYSQL = "SELECT * FROM PITBROK WHERE COMPCODE = " & GCompCode  & " "
'    If LenB(LQToDate) > 0 Then MYSQL = MYSQL & " AND UPTOSTDT <='" & Format(CDate(LQToDate), "YYYY/MM/DD") & "'"
'    MYSQL = MYSQL & " AND MARTYPE='Q'"
'    If LenB(LQParties) > 0 Then MYSQL = MYSQL & " AND AC_CODE IN (" & LQParties & ")"
'    MYSQL = MYSQL & " ORDER BY UPTOSTDT DESC"
'    Set MRateRec2 = Nothing:    Set MRateRec2 = New ADODB.Recordset
'    MRateRec2.Open MYSQL, Cnn, adOpenStatic, adLockReadOnly
'
'
'    MYSQL = "SELECT * FROM DMARGIN WHERE COMPCODE = " & GCompCode  & ""
'    If LenB(LQParties) > 0 Then MYSQL = MYSQL & " AND PARTY IN (" & LQParties & ")"
'    MYSQL = MYSQL & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM PEXBROK WHERE COMPCODE =" & GCompCode  & " AND MARTYPE='Q' "
'    If LenB(LQExCodes) <> 0 Then MYSQL = MYSQL & " AND EXCODE IN (" & LQExCodes & ")"
'    MYSQL = MYSQL & " )"
'    If LenB(LQFromDate) > 0 Then MYSQL = MYSQL & " AND CONDATE >='" & Format(CDate(LQFromDate), "YYYY/MM/DD") & "'"
'    If LenB(LQToDate) > 0 Then MYSQL = MYSQL & " AND CONDATE <='" & Format(CDate(LQToDate), "YYYY/MM/DD") & "'"
'    MYSQL = MYSQL & " ORDER BY PARTY, ITEMCODE, SAUDA, CONDATE"
'    Set NewRec = Nothing
'    Set NewRec = New ADODB.Recordset
'    NewRec.Open MYSQL, Cnn, adOpenStatic, adLockReadOnly
'    Do While Not NewRec.EOF
'        MSauda = NewRec!Sauda:        MCondate = NewRec!Condate
'        MItemCode = NewRec!ITEMCODE:        MExCode = NewRec!ExCode
'        MParty = NewRec!Party:        LMaturity = NewRec!MATURITY
'        DoEvents
'        GETMAIN.Label1.Caption = "Updateing Margin Amount for " & MParty & ""
'        MargAmt = 0
'        MRateRec2.Filter = adFilterNone
'        MRateRec2.Filter = "ITEMCODE='" & MItemCode & "' AND AC_CODE ='" & MParty & "'"
'        LMargAmt = 0
'        If MRateRec2.RecordCount > 0 Then
'            MRateRec2.MoveFirst
'            DoEvents
'            LMarRate = Val(MRateRec2!MarRate) & ""
'            If NewRec!CLOSEQTY <> 0 Then LMargAmt = (LMarRate) * Abs(NewRec!CLOSEQTY)
'        Else
'            MRateRec.Filter = adFilterNone
'            MRateRec.Filter = "EXCODE='" & MExCode & "' AND AC_CODE ='" & MParty & "'"
'            If MRateRec.RecordCount > 0 Then
'                MRateRec.MoveFirst
'                DoEvents
'                LMarRate = Val(MRateRec!MarRate) & ""
'                If NewRec!CLOSEQTY <> 0 Then LMargAmt = (LMarRate) * Abs(NewRec!CLOSEQTY)
'            End If
'        End If
'        If LMaturity = MCondate Then LMargAmt = 0
'        NewRec.MoveNext
'        MYSQL = "UPDATE DMARGIN SET MARGINAMT = " & LMargAmt & " WHERE COMPCODE =" & GCompCode  & " AND PARTY='" & MParty & "' AND SAUDA ='" & MSauda & "' AND CONDATE ='" & Format(MCondate, "YYYY/MM/DD") & "'"
'        Cnn.Execute MYSQL
'    Loop
'
'End Sub
'
'Public Sub Update_Lot_MarginAmt(LLParties As String, LLFromDate As String, LLToDate As String, LLExCodes As String)
'
'    Dim LMargAmt As Double:             Dim MCondate As Date:       Dim MItemCode As String:    Dim MExCode As String
'    Dim MParty As String:               Dim MSauda As String:       Dim LMarRate As Double
'    Dim MRateRec As ADODB.Recordset:    Dim LPQtyLot As Double:     Dim LMaturity As Date
'    Dim MRateRec2 As ADODB.Recordset:   Dim NewRec As ADODB.Recordset
'
'    MYSQL = "SELECT * FROM PEXBROK WHERE COMPCODE = " & GCompCode  & " "
'    If LenB(LLToDate) > 0 Then MYSQL = MYSQL & " AND UPTOSTDT <='" & Format(CDate(LLToDate), "YYYY/MM/DD") & "'"
'    If LenB(LLParties) > 0 Then MYSQL = MYSQL & " AND AC_CODE IN (" & LLParties & ")"
'    If LenB(LLExCodes) > 0 Then MYSQL = MYSQL & " AND EXCODE IN (" & LLExCodes & ")"
'    MYSQL = MYSQL & " AND MARTYPE='L'"
'    MYSQL = MYSQL & " ORDER BY UPTOSTDT DESC"
'    Set MRateRec = Nothing:    Set MRateRec = New ADODB.Recordset
'    MRateRec.Open MYSQL, Cnn, adOpenStatic, adLockReadOnly
'
'    MYSQL = "SELECT * FROM PITBROK WHERE COMPCODE = " & GCompCode  & " "
'    If LenB(LLToDate) > 0 Then MYSQL = MYSQL & " AND UPTOSTDT <='" & Format(CDate(LLToDate), "YYYY/MM/DD") & "'"
'    MYSQL = MYSQL & " AND MARTYPE='L'"
'    If LenB(LLParties) > 0 Then MYSQL = MYSQL & " AND AC_CODE IN (" & LLParties & ")"
'    MYSQL = MYSQL & " ORDER BY UPTOSTDT DESC"
'    Set MRateRec2 = Nothing:    Set MRateRec2 = New ADODB.Recordset
'    MRateRec2.Open MYSQL, Cnn, adOpenStatic, adLockReadOnly
'
'    MYSQL = "SELECT A.*,B.BROKLOT FROM DMARGIN AS A, SAUDAMAST AS B WHERE A.COMPCODE = " & GCompCode  & " AND A.COMPCODE=B.COMPCODE AND A.SAUDA=B.SAUDACODE"
'    If LenB(LLParties) > 0 Then MYSQL = MYSQL & " AND A.PARTY IN (" & LLParties & ")"
'    MYSQL = MYSQL & " AND A.PARTY IN (SELECT DISTINCT AC_CODE FROM PEXBROK WHERE COMPCODE =" & GCompCode  & " AND MARTYPE='L' "
'    If LenB(LLExCodes) <> 0 Then MYSQL = MYSQL & " AND EXCODE IN (" & LLExCodes & ")"
'    MYSQL = MYSQL & " )"
'    If LenB(LLFromDate) > 0 Then MYSQL = MYSQL & " AND A.CONDATE >='" & Format(CDate(LLFromDate), "YYYY/MM/DD") & "'"
'    If LenB(LLToDate) > 0 Then MYSQL = MYSQL & " AND A.CONDATE <='" & Format(CDate(LLToDate), "YYYY/MM/DD") & "'"
'    MYSQL = MYSQL & " ORDER BY A.PARTY, A.ITEMCODE, A.SAUDA, A.CONDATE"
'
'    Set NewRec = Nothing:    Set NewRec = New ADODB.Recordset
'    NewRec.Open MYSQL, Cnn, adOpenStatic, adLockReadOnly
'    Do While Not NewRec.EOF
'        MSauda = NewRec!Sauda:              MCondate = NewRec!Condate
'        MItemCode = NewRec!ITEMCODE:        MExCode = NewRec!ExCode
'        MParty = NewRec!Party:              LPQtyLot = NewRec!BROKLOT
'        LMaturity = NewRec!MATURITY:        DoEvents
'        GETMAIN.Label1.Caption = "Updateing Margin Amount for " & MParty & ""
'        MRateRec2.Filter = adFilterNone
'        MRateRec2.Filter = "ITEMCODE='" & MItemCode & "' AND AC_CODE ='" & MParty & "'"
'        LMargAmt = 0
'        If MRateRec2.RecordCount > 0 Then
'            MRateRec2.MoveFirst
'            DoEvents
'            LMarRate = Val(MRateRec2!MarRate) & ""
'            If NewRec!CLOSEQTY <> 0 Then LMargAmt = (LMarRate) * (Abs(NewRec!CLOSEQTY / LPQtyLot))
'        Else
'            MRateRec.Filter = adFilterNone
'            MRateRec.Filter = "EXCODE='" & MExCode & "' AND AC_CODE ='" & MParty & "'"
'            If MRateRec.RecordCount > 0 Then
'                MRateRec.MoveFirst
'                DoEvents
'                LMarRate = Val(MRateRec!MarRate) & ""
'                If NewRec!CLOSEQTY <> 0 Then LMargAmt = (LMarRate) * (Abs(NewRec!CLOSEQTY) / LPQtyLot)
'            End If
'        End If
'        If LMaturity = MCondate Then LMargAmt = 0
'        NewRec.MoveNext
'        MYSQL = "UPDATE DMARGIN SET MARGINAMT = " & LMargAmt & " WHERE COMPCODE =" & GCompCode  & " AND PARTY='" & MParty & "' AND SAUDA ='" & MSauda & "' AND CONDATE ='" & Format(MCondate, "YYYY/MM/DD") & "'"
'        Cnn.Execute MYSQL
'    Loop
'End Sub

Public Sub Post_Margin_Import(LPFromDate As Date, LPParties As String, LPExCodes As String)
    Dim MDt As Date:                Dim Mdt1 As Date:
    Dim MFlagVou As Boolean:        Dim mcode As String:        Dim MCode1 As String
    Dim MNr As String:              Dim MNr1 As String:         Dim MMarginAc As String
    Dim MVouNo As String:           Dim MNarration As String:   Dim MAMT As Double
    Dim MAmnt As Double:            Dim LExCode As String:      Dim LFYear As String
    Dim LMVNo As Long:              Dim LExID As Integer
    Dim LACCID As Long
    Dim LMarginAccID As Long
    
    Dim MRec10 As ADODB.Recordset:  Dim NewRec As ADODB.Recordset
    Dim LEXParty As ADODB.Recordset
    
    On Error GoTo err1
    MNarration = "Import Rate Margin"
    Set LEXParty = Nothing:    Set LEXParty = New ADODB.Recordset
    mysql = "SELECT DISTINCT ACCID,AC_CODE, EXCODE,EXID FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND MARTYPE IN ('I','Q','V') "
    mysql = mysql & " AND INSTTYPE ='FUT' "
    If LenB(LPParties) > 0 Then mysql = mysql & " AND AC_CODE IN (" & LPParties & ")"
    If LenB(LPExCodes) > 0 Then mysql = mysql & " AND EXID IN (" & LPExCodes & ") "
    mysql = mysql & " ORDER BY AC_CODE,EXCODE "
    LEXParty.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not LEXParty.EOF Then
        LFYear = Mid(GFinBegin, 4, 2) & Mid(GFinEnd, 9, 2)
        GMaxVouNo = Val(Right$(Get_VouNo("MRGN", GFinYear), 7))
    End If
    
    Do While Not LEXParty.EOF
        LExCode = LEXParty!excode
        mcode = LEXParty!AC_CODE
        LACCID = LEXParty!ACCID
        LExID = LEXParty!EXID
        mysql = "EXEC Get_ExDMargin " & GCompCode & ",'" & mcode & "'," & LExID & ",'" & Format(CDate(LPFromDate), "YYYY/MM/DD") & "'"
        Set NewRec = Nothing
        Set NewRec = New ADODB.Recordset
        NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        MFlagVou = False
        Do While Not NewRec.EOF
            MDt = NewRec!Condate
            LExCode = NewRec!excode
            LExID = NewRec!EXID
            MFlagVou = True
            If Not IsNull(NewRec!MarginACC) Then
                MMarginAc = NewRec!MarginACC
                LMarginAccID = Get_AccID(MMarginAc)
            Else
                MsgBox "Please Import again as Exchange Margin Account not defined for " & LExCode, vbInformation
                Exit Sub
            End If
            DoEvents
            GETMAIN.Label1.Caption = "ImportRate Margin for " & mcode & " " & LExCode & " " & MDt
            Do While mcode = NewRec!PARTY And MDt = NewRec!Condate And LExID = NewRec!EXID
            
                MNr = "Margin Debited " & NewRec!excode & ""
                MNr1 = "Margin Credited " & NewRec!excode & " for Party " & NewRec!PARTY
                MAMT = IIf(IsNull(NewRec!MAmount), 0, NewRec!MAmount)
                If MAMT <> 0 Then
                    GMaxVouNo = GMaxVouNo + 1
                    MVouNo = Get_Next_Vou_No(GMaxVouNo, "MRGN", GFinYear)
                    LMVNo = PInsert_Voucher(MVouNo, NewRec!Condate, "M", "P", 0, "ADD", LExCode, 0, MNarration, LExCode, "0", LExID, 0)
                    Call PInsert_Vchamt(MVouNo, "M", NewRec!Condate, "D", mcode, MAMT, "I", NewRec!Condate, MNr, "1", LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                    Call PInsert_Vchamt(MVouNo, "M", NewRec!Condate, "C", MMarginAc, MAMT, "I", NewRec!Condate, MNr1, "1", LExCode, 0, LExCode, LMVNo, LExID, 0, LMarginAccID)
                End If
                NewRec.MoveNext
                If NewRec.EOF Then Exit Do
            Loop
            If MFlagVou = True Then
                MFlagVou = False
                mysql = "SELECT MAX(CONDATE) AS MDT FROM DMARGIN WHERE COMPCODE = " & GCompCode & " AND CONDATE <'" & Format(MDt, "yyyy/MM/dd") & "'"
                mysql = mysql & " AND PARTY ='" & mcode & "' AND EXID =" & LExID & ""
                Set MRec10 = Nothing
                Set MRec10 = New ADODB.Recordset
                MRec10.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not IsNull(MRec10!MDt) Then
                    Mdt1 = MRec10!MDt
                    mysql = "SELECT SUM(MARGINAMT) AS MAMT FROM DMARGIN  WHERE COMPCODE= " & GCompCode & " AND CONDATE  = '" & Format(Mdt1, "yyyy/MM/dd") & "' "
                    mysql = mysql & "  AND PARTY = '" & mcode & "' AND EXID = " & LExID & ""
                    Set MRec10 = Nothing
                    Set MRec10 = New ADODB.Recordset
                    MRec10.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    MAmnt = 0
                    If Not MRec10.EOF Then
                        MAmnt = MRec10!MAMT
                        If MAmnt <> 0 Then
                            GMaxVouNo = GMaxVouNo + 1
                            MVouNo = Get_Next_Vou_No(GMaxVouNo, "MRGN", GFinYear)
                        
                            MNr = "Margin Released of Party " & mcode & " of " & LExCode & ""
                            LMVNo = PInsert_Voucher(MVouNo, MDt, "M", "R", 0, "ADD", LExCode, 0, MNarration, LExCode, "0", LExID, 0)
                            MNr = "Margin Released of Party " & mcode & " For " & LExCode & ""
                            Call PInsert_Vchamt(MVouNo, "M", MDt, "C", mcode, MAmnt, "I", MDt, MNr, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                            Call PInsert_Vchamt(MVouNo, "M", MDt, "D", MMarginAc, MAmnt, "I", MDt, MNr, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LMarginAccID)
                        End If
                        
                    End If
                End If
                Set MRec10 = Nothing
            End If
        Loop
        Set NewRec = Nothing
        LEXParty.MoveNext
    Loop
    Set LEXParty = Nothing
    Exit Sub

err1:     If err.Number <> 0 Then
         
         MsgBox err.Description
        
        End If
End Sub

Public Sub Post_Margin_ClientWise(LCPFromDate As Date, LCParties As String, LCExCodes As String)
    
    Dim mcode As String:            Dim MNr As String:              Dim MNr1 As String:
    Dim MMarginAc As String:        Dim MVouNo As String:           Dim MNarration As String
    Dim LExCode As String:          Dim MClient As String:          Dim MarginAmt As Double
    Dim MAmnt As Double:            Dim LCondate As Date:           Dim LDT As Date:
    Dim LFYear As String:           Dim Mdt1 As Date:               Dim LMVNo As Long
    Dim MRec10 As ADODB.Recordset:  Dim NewRec As ADODB.Recordset:  Dim LExID As Integer
    Dim LMarginAccID As Long
    Dim LACCID As Long
    
    
    mysql = "SELECT D.CONDATE,D.ACCID,D.CLIENT,D.IMARGIN,D.MMARGIN,D.SPMARGIN,D.SPREADMARGIN,D.EXTREMELOSS,D.NETBUYPREMIUM ,E.EXCODE,E.EXID,D.CMARGIN ,D.PREEXPMARGIN,D.DELIVERYMARGIN, E.MARGINACC FROM DLYCLMGN AS D, EXMAST AS E"
    mysql = mysql & " WHERE E.COMPCODE =" & GCompCode & " AND E.EXID =D.EXID "
    If LenB(LCPFromDate) <> 0 Then mysql = mysql & " AND D.CONDATE >='" & Format(CDate(LCPFromDate), "YYYY/MM/DD") & "'"
    If LenB(LCParties) <> 0 Then mysql = mysql & " AND D.CLIENT IN (" & LCParties & ")"
    If LenB(LCExCodes) <> 0 Then mysql = mysql & " AND D.EXID IN (" & LCExCodes & ")"
    mysql = mysql & " ORDER BY D.EXCODE,D.CONDATE "
    Set NewRec = Nothing
    Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    LDT = Date
    If Not NewRec.EOF Then
        LFYear = Mid(GFinBegin, 9, 2) & Mid(GFinEnd, 9, 2)
        GMaxVouNo = Val(Right$(Get_VouNo("MRGN", LFYear), 7))
    End If
    
    Do While Not NewRec.EOF
        If IsNull(NewRec!MarginACC) Then
            MsgBox " Please Select Margin Ac in Exchange Master"
            Cnn.RollbackTrans
            Exit Sub
        Else
            MMarginAc = NewRec!MarginACC
            LMarginAccID = Get_AccID(MMarginAc)
        End If
        LExCode = NewRec!excode
        LExID = NewRec!EXID
        LCondate = NewRec!Condate
        Do While LCondate = NewRec!Condate And LExID = NewRec!EXID
            MClient = NewRec!CLIENT
            LACCID = NewRec!ACCID
            DoEvents
            GETMAIN.Label1.Caption = "Posting Client Wise Margin for " & MClient & " " & Format(LCondate, "DD/MM/YYYY") & " " & LExCode & " "
            GMaxVouNo = GMaxVouNo + 1
            MVouNo = Get_Next_Vou_No(GMaxVouNo, "MRGN", GFinYear)
            LMVNo = PInsert_Voucher(MVouNo, LCondate, "M", "P", 0, "ADD", LExCode, 0, "Client Margin", LExCode, "0", LExID, 0)
            MNr = "Client Wise Margin " & " FOR " & LExCode & ""
            MNr1 = "Client Wise Margin of Client  " & MClient & " for " & LExCode & ""
            MarginAmt = Val(NewRec!IMARGIN) + Val(NewRec!MMARGIN) + Val(NewRec!SPMARGIN) + Val(NewRec!CMARGIN) + Val(NewRec!PREEXPMARGIN) + NewRec!DELIVERYMARGIN + Val(NewRec!SPREADMARGIN) + Val(NewRec!EXTREMELOSS) + Val(NewRec!NETBUYPREMIUM)
            Call PInsert_Vchamt(MVouNo, "M", LCondate, "D", MClient, MarginAmt, "C", LCondate, MNr, "1", LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
            Call PInsert_Vchamt(MVouNo, "M", LCondate, "C", MMarginAc, MarginAmt, "C", LCondate, MNr1, "1", LExCode, 0, LExCode, LMVNo, LExID, 0, LMarginAccID)
            NewRec.MoveNext
            If NewRec.EOF Then Exit Do
        Loop
        
        mysql = "SELECT MAX(CONDATE) AS MDT FROM DLYCLMGN WHERE COMPCODE=" & GCompCode & " AND CONDATE<'" & Format(LCondate, "yyyy/MM/dd") & "'"
        mysql = mysql & " AND EXID=" & LExID & ""
        Set MRec10 = Nothing
        Set MRec10 = New ADODB.Recordset
        MRec10.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not IsNull(MRec10!MDt) Then
            Mdt1 = MRec10!MDt
            'MYSQL = "SELECT D.CONDATE,D.CLIENT,D.IMARGIN,D.MMARGIN,D.SPMARGIN,D.CMARGIN ,D.PREEXPMARGIN,D.DELIVERYMARGIN FROM DLYCLMGN AS D"
            mysql = "SELECT D.CONDATE,D.CLIENT,D.IMARGIN,D.MMARGIN,D.SPMARGIN,D.SPREADMARGIN,D.EXTREMELOSS,D.NETBUYPREMIUM ,D.CMARGIN ,D.PREEXPMARGIN,D.DELIVERYMARGIN  FROM DLYCLMGN AS D"
            mysql = mysql & " WHERE  D.EXID=" & LExID & ""
            mysql = mysql & " AND D.CONDATE ='" & Format(Mdt1, "YYYY/MM/DD") & "'"
            If LenB(LCParties) <> 0 Then mysql = mysql & " AND D.CLIENT IN (" & LCParties & ")"
            Set MRec10 = Nothing:            Set MRec10 = New ADODB.Recordset
            MRec10.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            While Not MRec10.EOF
                mcode = MRec10!CLIENT
                MarginAmt = Val(MRec10!IMARGIN) + Val(MRec10!MMARGIN) + Val(MRec10!SPMARGIN) + Val(MRec10!CMARGIN) + Val(MRec10!PREEXPMARGIN) + MRec10!DELIVERYMARGIN + Val(MRec10!SPREADMARGIN) + Val(MRec10!EXTREMELOSS) + Val(MRec10!NETBUYPREMIUM)
                'MarginAmt = Val(IIf(IsNull(MRec10!IMARGIN), 0, MRec10!IMARGIN)) + Val(IIf(IsNull(MRec10!MMARGIN), 0, MRec10!MMARGIN)) + Val(IIf(IsNull(MRec10!SPMARGIN), 0, MRec10!SPMARGIN)) + Val(IIf(IsNull(MRec10!CMARGIN), 0, MRec10!CMARGIN)) + Abs(MRec10!PREEXPMARGIN) + MRec10!DELIVERYMARGIN
                MNr = "Client Wise Margin released for " & LExCode & ""
                MNr1 = "Client Wise Margin released of " & mcode & " for " & LExCode & ""
                GMaxVouNo = GMaxVouNo + 1
                MVouNo = Get_Next_Vou_No(GMaxVouNo, "MRGN", GFinYear)
                LMVNo = PInsert_Voucher(MVouNo, LCondate, "M", "R", 0, "ADD", LExCode, 0, "Client Margin", LExCode, "0", LExID, 0)
                Call PInsert_Vchamt(MVouNo, "M", LCondate, "C", mcode, MarginAmt, "C", LCondate, MNr, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                Call PInsert_Vchamt(MVouNo, "M", LCondate, "D", MMarginAc, MarginAmt, "C", LCondate, MNr1, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LMarginAccID)
                MRec10.MoveNext
            Wend
            Set MRec10 = Nothing
        End If
        Set MRec10 = Nothing
        If NewRec.EOF Then Exit Do
    Loop
    Set NewRec = Nothing
    
End Sub

Public Sub UpdateStanding2(lsparty As String, LSItemCode As String, LSfromDate As Date, LSExCode As String)
    Dim DateRec As ADODB.Recordset:     Dim SaudaRec As ADODB.Recordset:    Dim PtyRec As ADODB.Recordset:    Dim NewRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset:    Dim NSAUDA As String
    Dim MMDate As Date:                 Dim MSauda As String:               Dim mparty As String:             Dim MCLoseRate As Double:         Dim MCloseAmt As Double:        Dim MBalQty As Double
    Dim MCloseQty As Double:            Dim MBuyQty As Double:              Dim MSellQty As Double:           Dim MSpreadQty As Double:         Dim LLOT As Double:             Dim LUPFromDate As Date
    Dim LExCode As String:              Dim LMinDate As String:             Dim MItemCode As String:          Dim MCondate As Date:             Dim MMaturity As Date:          Dim LStrMinDate As String
    Dim LSaudaID As Long:            Dim LExID As Integer:                  Dim LItemID As Integer
    Dim LSSaudaID As Long
    Dim LACCID  As Long
    Dim Lmaturity  As Date
    LUPFromDate = DateValue(LSfromDate)
                
    On Error GoTo err1
    If DateValue(GSysLockDt) > DateValue(LUPFromDate) Then LUPFromDate = DateValue(GSysLockDt) + 1
    
    mysql = "DELETE FROM DMARGIN WHERE COMPCODE =" & GCompCode & " "
    If LenB(LSItemCode) > 0 Then mysql = mysql & " AND ITEMID  IN (" & LSItemCode & ")"
    If LenB(lsparty) > 0 Then mysql = mysql & " AND PARTY IN (" & lsparty & ")"
    If LenB(LSExCode) > 0 Then mysql = mysql & " AND EXID  IN (" & LSExCode & ")"
    mysql = mysql & " AND CONDATE>='" & Format(LSfromDate, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    
    mysql = "SELECT DISTINCT C.ACCID,C.PARTY,C.EXCODE,C.ITEMCODE,C.SAUDA,S.SAUDAID,S.MATURITY,S.EXID ,S.ITEMID FROM CTR_D C,SAUDAMAST S "
    mysql = mysql & " WHERE C.COMPCODE=" & GCompCode & " AND S.SAUDAID =C.SAUDAID"
    If LenB(lsparty) > 0 Then mysql = mysql & " AND C.PARTY IN (" & lsparty & ")"
    If LenB(LSExCode) > 0 Then mysql = mysql & " AND S.EXID IN (" & LSExCode & ")"
    If LenB(LSItemCode) > 0 Then mysql = mysql & " AND S.ITEMID  IN (" & LSItemCode & ")"
    mysql = mysql & " AND S.MATURITY >='" & Format(LSfromDate, "YYYY/MM/DD") & "'"
    mysql = mysql & " ORDER BY C.PARTY,C.EXCODE,C.ITEMCODE,C.SAUDA,S.MATURITY"
    Set PtyRec = Nothing: Set PtyRec = New ADODB.Recordset
    PtyRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    DoEvents
    GETMAIN.Label1.Caption = "Updateing Closing Qty "
    Do While Not PtyRec.EOF
        LACCID = PtyRec!ACCID
        mparty = PtyRec!PARTY:          MSauda = PtyRec!Sauda:
        LExCode = PtyRec!excode:        MItemCode = PtyRec!ITEMCODE:        MMaturity = PtyRec!MATURITY
        LSaudaID = PtyRec!SAUDAID
        LExID = PtyRec!EXID
        LItemID = PtyRec!itemid
        LStrMinDate = Get_MinCondate(LACCID, LSaudaID, MMaturity)
        LUPFromDate = DateValue(LSfromDate)
        
        If LenB(LStrMinDate) > 0 Then
            LMinDate = DateValue(LStrMinDate)
            If LMinDate > LUPFromDate Then LUPFromDate = LMinDate
        End If
        MBalQty = Get_CloseQty(LACCID, LSaudaID, LUPFromDate - 1)
        mysql = " EXEC Get_ContypeQty " & GCompCode & ",'" & mparty & "'," & LSaudaID & ",'" & Format(LUPFromDate, "YYYY/MM/DD") & "'"
        Set SaudaRec = Nothing: Set SaudaRec = New ADODB.Recordset
        SaudaRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        
        mysql = "SELECT DISTINCT CONDATE FROM CTR_M WHERE EXID = " & LExID & " AND SAUDAID =" & LSaudaID & ""
        mysql = mysql & " AND CONDATE>='" & Format(LUPFromDate, "YYYY/MM/DD") & "'"
        mysql = mysql & " ORDER BY CONDATE"
        Set DateRec = Nothing: Set DateRec = New ADODB.Recordset
        DateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not DateRec.EOF
            MCondate = DateRec!Condate
            MCloseQty = 0: MBuyQty = 0: MSellQty = 0
            SaudaRec.Filter = adFilterNone
            SaudaRec.Filter = "CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "'"
            If Not SaudaRec.EOF Then
                If SaudaRec!CONTYPE = "B" Then
                    MBuyQty = SaudaRec!TotQty
                Else
                    MSellQty = SaudaRec!TotQty
                End If
                SaudaRec.MoveNext
                If Not SaudaRec.EOF Then
                    If SaudaRec!CONTYPE = "B" Then
                        MBuyQty = SaudaRec!TotQty
                    Else
                        MSellQty = SaudaRec!TotQty
                    End If
                End If
            End If
            MCloseQty = (MBalQty + MBuyQty) - MSellQty
            If Abs(MCloseQty) + (MBuyQty + MSellQty) <> 0 Then
                MCLoseRate = SDCLRATE(LSaudaID, MCondate, "C")
                mysql = " EXEC INSERT_DMARGIN " & GCompCode & ",'" & MItemCode & "',1,'" & MSauda & "','" & Format(MMaturity, "YYYY/MM/DD") & "','" & mparty & "',"
                mysql = mysql & "'" & Format(MCondate, "YYYY/MM/DD") & "'," & MBalQty & "," & MBuyQty & "," & MSellQty & "," & MCloseQty & "," & MCLoseRate & ",'" & LExCode & "'," & LSaudaID & "," & LItemID & "," & LExID & "," & LACCID & ""
                Cnn.Execute mysql
            End If
            MBalQty = MCloseQty
            DateRec.MoveNext
        Loop
        PtyRec.MoveNext
    Loop
    
        Call Update_SpreadQty(lsparty, LSItemCode, LSExCode, LSfromDate)
    Exit Sub
    'Loop
err1:   If err.Number <> 0 Then
            MsgBox err.Description
            
            If CNNERR = True Then
                Cnn.RollbackTrans
                CNNERR = False
            End If
        End If
End Sub
Public Function Get_MinCondate(LGPARTY As Long, LGSaudaID As Long, LGTodate As Date) As String
Dim TRec As ADODB.Command

Dim LDATE1 As String
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_MinCondate"

TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("MPARTY", adInteger, adParamInput, , LGPARTY)
TRec.Parameters.Append TRec.CreateParameter("MSAUDAID", adInteger, adParamInput, , LGSaudaID)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LGTodate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LDATE", adVarChar, adParamOutput, 20, LDATE1)
TRec.Execute
LDATE1 = TRec("LDATE")
Get_MinCondate = LDATE1
End Function



Public Function Get_Min_Sauda_Condate(LGCOMP As Integer, LGSaudaID As Long) As String
Dim TRec As ADODB.Command

Dim LDATE1 As String
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_Min_Sauda_Condate"

TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , LGCOMP)
TRec.Parameters.Append TRec.CreateParameter("MSAUDAID", adInteger, adParamInput, , LGSaudaID)
TRec.Parameters.Append TRec.CreateParameter("LDATE", adVarChar, adParamOutput, 20, LDATE1)
TRec.Execute
LDATE1 = TRec("LDATE")
Get_Min_Sauda_Condate = LDATE1
End Function
Public Function Get_MaxCondate(LGPARTY As String, LGSauda As String, LGTodate As Date) As String
Dim TRec As ADODB.Command

Dim LDATE1 As String
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_MaxCondate"

TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("MPARTY", adVarChar, adParamInput, 6, LGPARTY)
TRec.Parameters.Append TRec.CreateParameter("MSAUDA", adVarChar, adParamInput, 50, LGSauda)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LGTodate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LDATE", adVarChar, adParamOutput, 20, LDATE1)
TRec.Execute
LDATE1 = TRec("LDATE")
Get_MaxCondate = LDATE1
End Function

Public Function Get_MaxExCondate(LGExID As Integer, LGTodate As Date) As String
Dim TRec As ADODB.Command
Dim LDATE1 As String

Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_MaxExCondate"

TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LGExID)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LGTodate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LDATE", adVarChar, adParamOutput, 20, LDATE1)
TRec.Execute
LDATE1 = TRec("LDATE")
Get_MaxExCondate = LDATE1
End Function

Public Function Get_MaxCondate_CTRM(LGSaudaID As Long, LGTodate As Date) As String
Dim TRec As ADODB.Command
Dim LDATE1 As String
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_MaxCondate_CTRM"

TRec.Parameters.Append TRec.CreateParameter("MC_CODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("MSAUDAID", adInteger, adParamInput, 50, LGSaudaID)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LGTodate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LDATE", adVarChar, adParamOutput, 20, LDATE1)
TRec.Execute
LDATE1 = TRec("LDATE")
Get_MaxCondate_CTRM = LDATE1
End Function

Public Sub Create_Index()
Dim TRec As ADODB.Recordset

mysql = " SELECT DB_NAME() AS Database_Name,sc.name AS Schema_Name, o.name AS Table_Name, i.name AS Index_Name, i.type_desc AS Index_Type"
mysql = mysql & "FROM sys.indexes i INNER JOIN sys.objects o ON i.object_id = o.object_id INNER JOIN sys.schemas sc ON o.schema_id = sc.schema_id"
mysql = mysql & "Where i.Name Is Not Null AND o.type = 'U' ORDER BY o.name, i.type"
Set TRec = Nothing
Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
Do While TRec.EOF
    mysql = "DROP INDEX " & TRec!TABLE_NAME & "." & TRec!INDEX_NAME & ""
    Cnn.Execute mysql
    TRec.MoveNext
Loop

End Sub
Public Sub AUpdt_EXBrokQty_XIntraday(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPInst As String)
Dim BUYREC As ADODB.Recordset:      Dim SELLREC As ADODB.Recordset
Dim AccRec As ADODB.Recordset:      Dim TrdRec As ADODB.Recordset
Dim SaudaRec As ADODB.Recordset:    Dim mparty As String
Dim MSauda As String:               Dim MBAmt As Double
Dim MSAmt As Double:                Dim LCondate As Date
Dim LRowNo As Double:               Dim LQTY As Double
Dim LRATE As Double
                
mysql = "SELECT DISTINCT PARTY,SAUDA FROM CTR_D WHERE COMPCODE  = " & GCompCode & " AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXCODE  IN(" & LBEXCODE & " "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDA IN  (" & LBSauda & ")  "
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN  (" & LBItemCode & ") "
mysql = mysql & " AND BrokType ='X' AND BROKRATE <> 0 AND INVNO = 0 ORDER BY PARTY,SAUDA "
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset: AccRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY:      MSauda = AccRec!Sauda
        MBAmt = 0:                  MSAmt = 0
        mysql = "SELECT CONDATE,CONTYPE, SUM(QTY * RATE) AS AMT FROM CTR_D WHERE PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "'"
        mysql = mysql & "AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " GROUP BY CONDATE, CONTYPE ORDER BY CONDATE,CONTYPE "
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset: TrdRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        Do While Not TrdRec.EOF
            MBAmt = 0: MSAmt = 0
            LCondate = TrdRec!Condate
            Do While LCondate = TrdRec!Condate
                If TrdRec!CONTYPE = "B" Then
                    MBAmt = TrdRec!AMT
                ElseIf TrdRec!CONTYPE = "S" Then
                    MSAmt = TrdRec!AMT
                End If
                TrdRec.MoveNext
                If TrdRec.EOF Then Exit Do
            Loop
            If MBAmt > MSAmt Then
                mysql = "SELECT ROWNO, QTY,RATE,brokqty FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' ORDER BY RATE DESC"
                Set BUYREC = Nothing
                Set BUYREC = New ADODB.Recordset
                BUYREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not BUYREC.EOF
                    LRowNo = BUYREC!ROWNO
                    LQTY = BUYREC!QTY
                    LRATE = BUYREC!Rate
                    Do While LQTY <> 0
                        mysql = "SELECT ROWNO, ADJQTY,QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' AND QTY<>ADJQTY ORDER BY RATE "
                        Set SELLREC = Nothing
                        Set SELLREC = New ADODB.Recordset
                        SELLREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        If SELLREC.EOF Then
                            mysql = "UPDATE CTR_D SET BROKQTY= BROKQTY + " & Abs(LQTY) & "  ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & LRowNo & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                            Cnn.Execute mysql
                            LQTY = 0
                        Else
                            If LRATE >= SELLREC!Rate Then
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    mysql = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & (SELLREC!QTY - SELLREC!ADJQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & LRowNo & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                    mysql = "UPDATE CTR_D SET ADJQTY=" & SELLREC!QTY & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                Else
                                    mysql = "UPDATE CTR_D SET BROKQTY   = BROKQTY   + " & Abs(LQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & LRowNo & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    mysql = "UPDATE CTR_D SET ADJQTY=ADJQTY + " & Abs(LQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            Else
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    mysql = "UPDATE CTR_D SET BROKQTY  = BROKQTY + " & (SELLREC!QTY - SELLREC!ADJQTY) & ", ADJQTY =" & SELLREC!QTY & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                Else
                                    mysql = "UPDATE CTR_D SET BROKQTY   = BROKQTY  + " & Abs(LQTY) & " ,ADJQTY = ADJQTY+ " & Abs(LQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            End If
                        End If
                    Loop
                    BUYREC.MoveNext
                Loop
            Else
                mysql = "SELECT ROWNO, QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' ORDER BY RATE DESC"
                Set BUYREC = Nothing
                Set BUYREC = New ADODB.Recordset
                BUYREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                Do While Not BUYREC.EOF
                    LRowNo = BUYREC!ROWNO:                    LQTY = BUYREC!QTY:                    LRATE = BUYREC!Rate
                    Do While LQTY <> 0
                        DoEvents
                        mysql = "SELECT ROWNO, ADJQTY,QTY,RATE FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "' AND QTY<>ADJQTY ORDER BY RATE "
                        Set SELLREC = Nothing
                        Set SELLREC = New ADODB.Recordset
                        SELLREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        If SELLREC.EOF Then
                            mysql = "UPDATE CTR_D SET BROKQTY = BROKQTY + " & Abs(LQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & LRowNo & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                            Cnn.Execute mysql
                            LQTY = 0
                        Else
                            If LRATE >= SELLREC!Rate Then
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    mysql = "UPDATE CTR_D SET BROKQTY2  = BROKQTY2   + " & (SELLREC!QTY - SELLREC!ADJQTY) & " ,UPDBQTY =1  WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & LRowNo & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                    mysql = "UPDATE CTR_D SET ADJQTY=" & SELLREC!QTY & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                Else
                                    mysql = "UPDATE CTR_D SET BROKQTY   = BROKQTY   + " & Abs(LQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & LRowNo & " AND CONTYPE='S' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    mysql = "UPDATE CTR_D SET ADJQTY=ADJQTY+ " & Abs(LQTY) & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            Else
                                If LQTY > (SELLREC!QTY - SELLREC!ADJQTY) Then
                                    mysql = "UPDATE CTR_D SET BROKQTY  = BROKQTY   + " & (SELLREC!QTY - SELLREC!ADJQTY) & ", ADJQTY =" & SELLREC!QTY & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = LQTY - (SELLREC!QTY - SELLREC!ADJQTY)
                                Else
                                    mysql = "UPDATE CTR_D SET BROKQTY  = BROKQTY  + " & Abs(LQTY) & " ,ADJQTY = ADJQTY+ " & LQTY & " ,UPDBQTY =1 WHERE COMPCODE =" & GCompCode & " AND ROWNO=" & SELLREC!ROWNO & " AND CONTYPE='B' AND PARTY='" & mparty & "' AND SAUDA ='" & MSauda & "' AND CONDATE='" & Format(LCondate, "YYYY/MM/DD") & "'"
                                    Cnn.Execute mysql
                                    LQTY = 0
                                End If
                            End If
                        End If
                    Loop
                    BUYREC.MoveNext
                Loop
            End If
            If TrdRec.EOF Then Exit Do
        Loop
        AccRec.MoveNext
    Loop
End If
End Sub
Public Sub Post_ShareVou2(ByVal LNetValue As Double, ByVal LDiffAmt As Double, ByVal LBrokAmount As Double, ByVal LPParty As String, ByVal LPItemCode As String, ByVal LPUptoDate As Date, _
ByVal LPExCode As String, ByVal LSDInstType As String, ByVal LTotBQtyAmt As Double, ByVal LTotSQtyAmt As Double, ByVal LTotBuyQty As Double, ByVal LTotSellQty As Double, ByVal LTotBrokQty As Double, _
ByVal LTotNBrokQtyAmt As Double, ByVal LBrokQtyAmt As Double, ByVal MBillNo As Long, ByVal LBrokQty2 As Double, ByVal LPDSauda As String, ByVal LPDPartyName As String, ByVal LSEXID As Integer, ByVal LSItemid As Integer, ByVal LSSaudaID As Long, ByVal LSAccID As Long)

Dim LSBrokType As String:       Dim LSBrokRate2 As Double:      Dim LSBrokRate As Double:       Dim LSShType As String
Dim LSShRate As Double:         Dim LShareAmt As Double:        Dim LBBrokAmt As Double:        Dim MBVchNo As String
Dim MSVchNo As String:          Dim LFmlyCode As String:        Dim LFmlyHead As String:        Dim LContra_Ac As String
Dim LBrokQty As Double:         Dim MDR As String:              Dim MCR As String:              Dim LShNarration As String
Dim LPMBrokType As String:      Dim LMVNo As Long:              Dim LPBrokType As String:       Dim MPartyName As String
Dim LFmlyID  As Long:           Dim NewRec As ADODB.Recordset:  Dim MRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset:
Dim TBROKAMT As Double
Dim LLowRate As Double
Dim LHGRate As Double
Dim lcurrate As Double
Dim LExCode As String
Dim RateRec As ADODB.Recordset
Dim lusdinr As Double

Set RateRec = Nothing
Set RateRec = New ADODB.Recordset
mysql = "SELECT EXCODE FROM EXMAST WHERE EXID = " & LSEXID & " "
RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not RateRec.EOF Then
    LExCode = RateRec!excode
End If

LLowRate = 1
LHGRate = 1

    If gcurrtype = 1 And LExCode = "CMX" Then

        mysql = "SELECT HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LPUptoDate, "yyyy/mm/dd") & "' "
        Set RateRec = Nothing
        Set RateRec = New ADODB.Recordset
        RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not RateRec.EOF Then
            LLowRate = RateRec!LOWRATE
            LHGRate = RateRec!HGRATE
        Else
            LLowRate = 1
            LHGRate = 1
        End If
    End If

TBROKAMT = 0
LPMBrokType = vbNullString
LPBrokType = vbNullString
If Abs(LNetValue) <> 0 Or Abs(LDiffAmt) <> 0 Or LBrokAmount <> 0 Then
    mysql = "SELECT A.FMLYID,A.FMLYCODE,B.FMLYHEAD,B.CONTRA_AC FROM ACCFMLYD A ,ACCFMLY B WHERE A.ACCID =" & LSAccID & ""
    mysql = mysql & "  AND A.FMLYID =B.FMLYID"
    Set NewRec = Nothing:            Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not NewRec.EOF
        LShareAmt = 0:                  LBBrokAmt = 0:                  MBVchNo = vbNullString:         MSVchNo = vbNullString
        LFmlyCode = NewRec!FMLYCODE:    LFmlyHead = NewRec!FMLYHEAD:    LContra_Ac = NewRec!Contra_Ac:  LSBrokRate2 = 0
        LSBrokType = "P":               LSBrokRate = 0:                 LSShType = "N":                 LSShRate = 0:
        LFmlyID = NewRec!FMLYID
        mysql = " EXEC GET_SHARERATE " & LFmlyID & "," & LSAccID & "," & LSEXID & "," & LSItemid & ",'" & LSDInstType & "','" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
        Set MRec = Nothing
        Set MRec = New ADODB.Recordset
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            LSBrokType = MRec!broktype:                    LSBrokRate = MRec!brokrate
            LSBrokRate2 = MRec!BROKRATE2:                  LSShType = MRec!SHTYPE:                    LSShRate = MRec!SHRATE
        End If
        Set MRec = Nothing
        
        If LSBrokRate <> 0 Or LSBrokRate2 > 0 Then
            If Len(LPBrokType) > 0 Then
                If LPBrokType <> LSBrokType Then
                    LSBrokType = LPMBrokType
                End If
            End If
            If LSBrokType = "P" Then
                LBBrokAmt = (LTotBQtyAmt + Abs(LTotSQtyAmt)) * (LSBrokRate / 100)
            ElseIf LSBrokType = "S" Then
                LBBrokAmt = Abs(LBrokAmount) * (LSBrokRate / 100)
            ElseIf LSBrokType = "T" Then
                LBBrokAmt = (LTotBuyQty + LTotSellQty) * (LSBrokRate)
            ElseIf LSBrokType = "O" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "C" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "L" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "H" Then
                LBBrokAmt = LBrokQtyAmt * (LSBrokRate / 100)
            ElseIf LSBrokType = "D" Then
                LBBrokAmt = (LTotNBrokQtyAmt * (LSBrokRate / 100))
                LBBrokAmt = LBBrokAmt + (LBrokQtyAmt * (LSBrokRate2 / 100))
            ElseIf LSBrokType = "I" Then
                LBBrokAmt = (LBrokQtyAmt) * (LSBrokRate / 100)
            ElseIf LSBrokType = "V" Then
                 LBBrokAmt = ((LSBrokRate / 100) * (LTotBQtyAmt + Abs(LTotSQtyAmt)))
                 LBBrokAmt = LBBrokAmt + ((LSBrokRate2 / 100) * (LTotBrokQty))
            ElseIf LSBrokType = "Q" Then
                LBBrokAmt = LTotBrokQty * LSBrokRate2
                LBBrokAmt = LBBrokAmt + (((LSBrokRate * 2) - LSBrokRate2) * ((LTotBuyQty + LTotSellQty) - LTotBrokQty))
            ElseIf LSBrokType = "Z" Then
                    LBrokQty = GBrokLot
                    If LTotBrokQty <> 0 Then
                        If (LTotBuyQty + LTotSellQty) <> 0 Then LBBrokAmt = ((LTotBuyQty + LTotSellQty) / LBrokQty) * (LSBrokRate)
                    End If
                    
            ElseIf LSBrokType = "R" Then
                    LBrokQty2 = GBrokLot
                    If LBrokQty2 <> 0 Then
                        If (LTotBrokQty) <> 0 Then LBBrokAmt = ((LTotBrokQty / LBrokQty2) * (LSBrokRate))
                    End If
            ElseIf LSBrokType = "X" Then
                LBBrokAmt = (LBrokQtyAmt) * (LSBrokRate / 100)
            ElseIf LSBrokType = "W" Then
                LBBrokAmt = ((LSBrokRate / 100) * (LTotNBrokQtyAmt))
                LBBrokAmt = LBBrokAmt + ((LSBrokRate2 / 100) * (LBrokQtyAmt))
            End If
            If LBBrokAmt <> 0 Then
                'If GRoundOff = "Y" Then
                 '   LBBrokAmt = Round(LBBrokAmt)
              '  Else
                    LBBrokAmt = LBBrokAmt
               ' End If
            End If
        End If
        TBROKAMT = TBROKAMT + LBBrokAmt
        NewRec.MoveNext
    Loop
    If NewRec.RecordCount > 0 Then
    NewRec.MoveFirst
    Do While Not NewRec.EOF
        LShareAmt = 0:                  LBBrokAmt = 0:                  MBVchNo = vbNullString:         MSVchNo = vbNullString
        LFmlyCode = NewRec!FMLYCODE:    LFmlyHead = NewRec!FMLYHEAD:    LContra_Ac = NewRec!Contra_Ac:  LSBrokRate2 = 0
        LSBrokType = "P":               LSBrokRate = 0:                 LSShType = "N":                 LSShRate = 0:
        LFmlyID = NewRec!FMLYID
        mysql = " EXEC GET_SHARERATE " & LFmlyID & "," & LSAccID & "," & LSEXID & "," & LSItemid & ",'" & LSDInstType & "','" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
        Set MRec = Nothing
        Set MRec = New ADODB.Recordset
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            LSBrokType = MRec!broktype:                    LSBrokRate = MRec!brokrate
            LSBrokRate2 = MRec!BROKRATE2:                  LSShType = MRec!SHTYPE:                    LSShRate = MRec!SHRATE
        End If
        Set MRec = Nothing
        If LSBrokRate <> 0 Or LSBrokRate2 > 0 Then
            If Len(LPBrokType) > 0 Then
                If LPBrokType <> LSBrokType Then
                    LSBrokType = LPMBrokType
                End If
            End If
            If LSBrokType = "P" Then
                LBBrokAmt = (LTotBQtyAmt + Abs(LTotSQtyAmt)) * (LSBrokRate / 100)
            ElseIf LSBrokType = "S" Then
                LBBrokAmt = Abs(LBrokAmount) * (LSBrokRate / 100)
            ElseIf LSBrokType = "T" Then
                LBBrokAmt = (LTotBuyQty + LTotSellQty) * (LSBrokRate)
            ElseIf LSBrokType = "O" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "C" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "L" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "H" Then
                LBBrokAmt = LBrokQtyAmt * (LSBrokRate / 100)
            ElseIf LSBrokType = "D" Then
                LBBrokAmt = (LTotNBrokQtyAmt * (LSBrokRate / 100))
                LBBrokAmt = LBBrokAmt + (LBrokQtyAmt * (LSBrokRate2 / 100))
            ElseIf LSBrokType = "I" Then
                LBBrokAmt = (LBrokQtyAmt) * (LSBrokRate / 100)
            ElseIf LSBrokType = "V" Then
                 LBBrokAmt = ((LSBrokRate / 100) * (LTotBQtyAmt + Abs(LTotSQtyAmt)))
                 LBBrokAmt = LBBrokAmt + ((LSBrokRate2 / 100) * (LTotBrokQty))
            ElseIf LSBrokType = "Q" Then
                LBBrokAmt = LTotBrokQty * LSBrokRate2
                LBBrokAmt = LBBrokAmt + (((LSBrokRate * 2) - LSBrokRate2) * ((LTotBuyQty + LTotSellQty) - LTotBrokQty))
            ElseIf LSBrokType = "Z" Then
                    LBrokQty = GBrokLot
                    If LTotBrokQty <> 0 Then
                        If (LTotBuyQty + LTotSellQty) <> 0 Then LBBrokAmt = ((LTotBuyQty + LTotSellQty) / LBrokQty) * (LSBrokRate)
                    End If
            ElseIf LSBrokType = "R" Then
                    LBrokQty2 = GBrokLot
                    If LBrokQty2 <> 0 Then
                        If (LTotBrokQty) <> 0 Then LBBrokAmt = ((LTotBrokQty / LBrokQty2) * (LSBrokRate))
                    End If
            ElseIf LSBrokType = "X" Then
                LBBrokAmt = (LBrokQtyAmt) * (LSBrokRate / 100)
            ElseIf LSBrokType = "W" Then
                LBBrokAmt = ((LSBrokRate / 100) * (LTotNBrokQtyAmt))
                LBBrokAmt = LBBrokAmt + ((LSBrokRate2 / 100) * (LBrokQtyAmt))
            End If
            If LBBrokAmt <> 0 Then
                If GRoundOff = "Y" Then
                    LBBrokAmt = Round(LBBrokAmt)
                Else
                    LBBrokAmt = LBBrokAmt
                End If
            End If
        End If

        If LSShRate <> 0 Then
            MPartyName = LPDPartyName
            If LSShType = "N" Then
                LShareAmt = LNetValue * (LSShRate / 100)
            ElseIf LSShType = "S" Then
                LShareAmt = (LNetValue + TBROKAMT) * (LSShRate / 100)
            Else
                LShareAmt = LDiffAmt * (LSShRate / 100)
            End If
            If LShareAmt <> 0 Then
                If GRoundOff = "Y" Then
                    LShareAmt = Round(LShareAmt)
                Else
                    LShareAmt = LShareAmt
                End If
            End If
        End If
        
        '
        Dim MPARTYTYPE As String
        MPARTYTYPE = "1"
        Set MRec = Nothing
        Set MRec = New ADODB.Recordset
        mysql = "SELECT PARTYTYPE FROM ACCOUNTD WHERE ACCID =" & LSAccID & ""
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            MPARTYTYPE = MRec!PARTYTYPE
        End If
        If MPARTYTYPE <> 2 Then
            If LShareAmt > 0 Then
                lusdinr = LLowRate
            Else
                lusdinr = LHGRate
            End If
        Else
            If LShareAmt < 0 Then
                lusdinr = LLowRate
            Else
                lusdinr = LHGRate
            End If
        End If
        
        If LShareAmt <> 0 Or LBBrokAmt <> 0 Then
            mysql = "EXEC INSERT_INV_D1 " & GCompCode & ",'" & LFmlyCode & "','" & LPParty & "','" & LPExCode & "','" & LPItemCode & "','" & LPDSauda & "','" & MBVchNo & "'," & LBBrokAmt & "," & MBillNo & ",'" & Format(LPUptoDate, "yyyy/MM/dd") & "','" & MSVchNo & "'," & LShareAmt & "," & LMVNo & "," & LSEXID & "," & LSItemid & "," & LSSaudaID & "," & LFmlyID & "," & LSAccID & "," & lusdinr & ""
            Cnn.Execute mysql
        End If
        NewRec.MoveNext
    Loop
    End If

    Set NewRec = Nothing
End If
End Sub

Public Sub Post_ShareVou(ByVal LNetValue As Double, ByVal LDiffAmt As Double, ByVal LBrokAmount As Double, ByVal LPParty As String, ByVal LPItemCode As String, ByVal LPUptoDate As Date, _
ByVal LPExCode As String, ByVal LSDInstType As String, ByVal LTotBQtyAmt As Double, ByVal LTotSQtyAmt As Double, ByVal LTotBuyQty As Double, ByVal LTotSellQty As Double, ByVal LTotBrokQty As Double, _
ByVal LTotNBrokQtyAmt As Double, ByVal LBrokQtyAmt As Double, ByVal MBillNo As Long, ByVal LBrokQty2 As Double, ByVal LPDSauda As String, ByVal LPDPartyName As String, ByVal LSEXID As Integer, ByVal LSItemid As Integer, ByVal LSSaudaID As Long, ByVal LSAccID As Long, ByVal LBrokAmount2 As Double, ByVal lpbillby As String)

Dim LSBrokType As String:       Dim LSBrokRate2 As Double:      Dim LSBrokRate As Double:       Dim LSShType As String
Dim LSShRate As Double:         Dim LShareAmt As Double:        Dim LBBrokAmt As Double:        Dim MBVchNo As String
Dim MSVchNo As String:          Dim LFmlyCode As String:        Dim LFmlyHead As String:        Dim LContra_Ac As String
Dim LBrokQty As Double:         Dim MDR As String:              Dim MCR As String:              Dim LShNarration As String
Dim LPMBrokType As String:      Dim LMVNo As Long:              Dim LPBrokType As String:       Dim MPartyName As String
Dim LFmlyID  As Long:           Dim NewRec As ADODB.Recordset:  Dim MRec As ADODB.Recordset:    Dim TRec As ADODB.Recordset:
Dim MDt As Date
Dim LExCode As String
Dim lusdinr As Double
Dim RateRec As ADODB.Recordset
Dim LLowRate As Double: Dim LHGRate As Double: Dim lcurrate As Double
Dim LBrokRate As Double: Dim LBrokRate2 As Double
Dim LBmaturity As Date
Dim LPCLOSERATE As Double

Set RateRec = Nothing
Set RateRec = New ADODB.Recordset
mysql = "SELECT EXCODE FROM EXMAST WHERE EXID = " & LSEXID & " "
RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not RateRec.EOF Then
    LExCode = RateRec!excode
End If

LLowRate = 1
LHGRate = 1

LPMBrokType = vbNullString
LPBrokType = vbNullString
If Abs(LNetValue) <> 0 Or Abs(LDiffAmt) <> 0 Or LBrokAmount <> 0 Then
    mysql = "SELECT A.FMLYID,A.FMLYCODE,B.FMLYHEAD,B.CONTRA_AC FROM ACCFMLYD A ,ACCFMLY B WHERE A.ACCID =" & LSAccID & ""
    mysql = mysql & "  AND A.FMLYID =B.FMLYID"
    Set NewRec = Nothing:            Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not NewRec.EOF
        LShareAmt = 0:                  LBBrokAmt = 0:                  MBVchNo = vbNullString:         MSVchNo = vbNullString
        LFmlyCode = NewRec!FMLYCODE:    LFmlyHead = NewRec!FMLYHEAD:    LContra_Ac = NewRec!Contra_Ac:  LSBrokRate2 = 0
        LSBrokType = "P":               LSBrokRate = 0:                 LSShType = "N":                 LSShRate = 0:
        LFmlyID = NewRec!FMLYID
        
        If gcurrtype = 1 And LExCode = "CMX" Then
            If lpbillby = "P" Then
                Set RateRec = Nothing
                Set RateRec = New ADODB.Recordset
                mysql = "SELECT LOW,HIGH FROM CTR_RP WHERE ACCID = '" & LSAccID & "' AND SAUDA ='USDINR' AND CONDATE= '" & Format(LPUptoDate, "yyyy/mm/dd") & "'"
                RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not RateRec.EOF Then
                    LLowRate = RateRec!LOW
                    LHGRate = RateRec!HIGH
                Else
                    LLowRate = 1
                    LHGRate = 1
                End If
            Else
                mysql = "SELECT HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LPUptoDate, "yyyy/mm/dd") & "' "
                Set RateRec = Nothing
                Set RateRec = New ADODB.Recordset
                RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not RateRec.EOF Then
                    LLowRate = RateRec!LOWRATE
                    LHGRate = RateRec!HGRATE
                Else
                    LLowRate = 1
                    LHGRate = 1
                End If
            End If
        End If
      
       
        mysql = " EXEC GET_SHARERATE " & LFmlyID & "," & LSAccID & "," & LSEXID & "," & LSItemid & ",'" & LSDInstType & "','" & Format(LPUptoDate, "YYYY/MM/DD") & "'"
        Set MRec = Nothing
        Set MRec = New ADODB.Recordset
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            LSBrokType = MRec!broktype:                    LSBrokRate = MRec!brokrate
            LSBrokRate2 = MRec!BROKRATE2:                  LSShType = MRec!SHTYPE:                    LSShRate = MRec!SHRATE
        End If
        Set MRec = Nothing
        Set MRec = New ADODB.Recordset
        ''
        Dim TRec2 As ADODB.Recordset
        Set TRec2 = Nothing: Set TRec2 = New ADODB.Recordset
        mysql = "SELECT EXchangecode,QTYUNIT FROM ITEMMAST WHERE ITEMID = " & LSItemid & ""
        TRec2.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        If TRec2.EOF Then
            Exit Sub
        End If
       
        mysql = "SELECT BROKRATE,BROKRATE2 FROM PEXBROK WHERE COMPCODE = " & GCompCode & " "
        mysql = mysql & "AND ACCID = " & LSAccID & " AND INSTTYPE = '" & LSDInstType & "' AND EXID = " & LSEXID & " AND UPTOSTDT>='" & Format(LPUptoDate, "YYYY/MM/DD") & "' ORDER BY UPTOSTDT "
        MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not MRec.EOF Then
            LBrokRate = Val(MRec!brokrate & vbNullString)
            LBrokRate2 = Val(MRec!BROKRATE2 & vbNullString)
        End If
        
        If LSBrokRate <> 0 Or LSBrokRate2 > 0 Then
            If Len(LPBrokType) > 0 Then
                If LPBrokType <> LSBrokType Then
                    LSBrokType = LPMBrokType
                End If
            End If
            If LSBrokType = "P" Then
                LBBrokAmt = (LTotBQtyAmt + Abs(LTotSQtyAmt)) * (LSBrokRate / 100)
            ElseIf LSBrokType = "S" Then
                LBBrokAmt = Abs(LBrokAmount) * (LSBrokRate / 100)
            ElseIf LSBrokType = "T" Then
                LBBrokAmt = (LTotBuyQty + LTotSellQty) * (LSBrokRate)
            ElseIf LSBrokType = "O" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "C" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "L" Then
                LBBrokAmt = (LTotBrokQty) * (LSBrokRate)
            ElseIf LSBrokType = "H" Then
                LBBrokAmt = LBrokQtyAmt * (LSBrokRate / 100)
            ElseIf LSBrokType = "D" Then
                LBBrokAmt = (LTotNBrokQtyAmt * (LSBrokRate / 100))
                LBBrokAmt = LBBrokAmt + (LBrokQtyAmt * (LSBrokRate2 / 100))
            ElseIf LSBrokType = "I" Then
                LBBrokAmt = (LBrokQtyAmt) * (LSBrokRate / 100)
            ElseIf LSBrokType = "V" Then
                 LBBrokAmt = ((Abs(LBrokAmount) - Abs(LBrokAmount2)) / LBrokRate * 100) * (LSBrokRate / 100)
                 If LBrokAmount2 <> 0 Then
                    LBBrokAmt = LBBrokAmt + (Abs(LBrokAmount2) / LBrokRate2 * 100) * LSBrokRate2 / 100
                 End If
            ElseIf LSBrokType = "Q" Then
                LBBrokAmt = LTotBrokQty * LSBrokRate2
                LBBrokAmt = LBBrokAmt + (((LSBrokRate * 2) - LSBrokRate2) * ((LTotBuyQty + LTotSellQty) - LTotBrokQty))
            ElseIf LSBrokType = "Z" Then
                    If TRec2!EXCHANGECODE = "MCX" Then
                        LBrokQty = GBrokLot
                    'If LTotBrokQty <> 0 Then
                            LBBrokAmt = ((LTotBuyQty + LTotSellQty) / TRec2!QTYUNIT) * (LSBrokRate)
                     Else
                            LBrokQty = GBrokLot
                    'If LTotBrokQty <> 0 Then
                            If (LTotBuyQty + LTotSellQty) <> 0 Then LBBrokAmt = ((LTotBuyQty + LTotSellQty) / LBrokQty) * (LSBrokRate)

                     End If
                    'End If
            ElseIf LSBrokType = "5" Then
                    LBrokQty = GBrokLot
                    If LTotBrokQty <> 0 Then
                        LBBrokAmt = (LTotBrokQty / LBrokQty) * (LSBrokRate)
                    End If
            ElseIf LSBrokType = "R" Then
                    LBrokQty2 = GBrokLot
                    If LBrokQty2 <> 0 Then
                        If (LTotBrokQty) <> 0 Then LBBrokAmt = ((LTotBrokQty / LBrokQty2) * (LSBrokRate))
                    End If
            ElseIf LSBrokType = "X" Then
                LBBrokAmt = (LBrokQtyAmt) * (LSBrokRate / 100)
            ElseIf LSBrokType = "W" Then
                LBBrokAmt = ((LSBrokRate / 100) * (LTotNBrokQtyAmt))
                LBBrokAmt = LBBrokAmt + ((LSBrokRate2 / 100) * (LBrokQtyAmt))
            ElseIf LSBrokType = "3" Then
                mysql = "SELECT MATURITY FROM SAUDAMAST WHERE SAUDAID =" & LSSaudaID & ""
                Set MRec = Nothing
                Set MRec = New ADODB.Recordset
                MRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not MRec.EOF Then
                    LBmaturity = MRec!MATURITY

                    mysql = "SELECT CLRATE FROM CTR_R  WHERE SAUDAID =" & LSSaudaID & " AND CONDATE  ='" & Format(LPUptoDate, "yyyy/mm/dd") & "' "
                    Set RateRec = Nothing
                    Set RateRec = New ADODB.Recordset
                    RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not RateRec.EOF Then
                        LPCLOSERATE = RateRec!ClRate
                    End If
                    LBBrokAmt = Calculate_Percentage_BrokAmt(0, LPUptoDate, LSAccID, LSSaudaID, 0, LSBrokRate, LBmaturity, LPCLOSERATE)
                End If
                'LBrokAmount = Calculate_Percentage_BrokAmt(LOpQnty, LPUptoDate, LPAccID, LPSaudaID, LTotOpAmt, LBrokRate, LBMaturity, LPCloseRate)
            End If
            If LBBrokAmt <> 0 Then
                If GRoundOff = "Y" Then
                    LBBrokAmt = Round(LBBrokAmt)
                Else
                    LBBrokAmt = LBBrokAmt
                End If

            End If
        End If
        
        If LSShRate <> 0 Then
            MPartyName = LPDPartyName
            If LSShType = "N" Then
                'LShareAmt = LNetValue * (LSShRate / 100)
                If GUniqClientId = "BRO2-CHE" And LBBrokAmt = 0 Then
                    LBBrokAmt = (LBrokAmount * -1) * (LSShRate / 100)
                    LShareAmt = LDiffAmt * (LSShRate / 100)
                Else
                    LShareAmt = LNetValue * (LSShRate / 100)
                End If
                
                
            ElseIf LSShType = "S" Then
                LShareAmt = (LNetValue + LBBrokAmt) * (LSShRate / 100)
            Else
                LShareAmt = LDiffAmt * (LSShRate / 100)
            End If
            If LShareAmt <> 0 Then
                If GRoundOff = "Y" Then
                    LShareAmt = Round(LShareAmt)
                Else
                    LShareAmt = LShareAmt
                End If
            End If
        End If
        If LShareAmt > 0 Then
            lusdinr = LLowRate
        Else
            lusdinr = LHGRate
        End If
        If LShareAmt <> 0 Or LBBrokAmt <> 0 Then
            mysql = "EXEC INSERT_INV_D1 " & GCompCode & ",'" & LFmlyCode & "','" & LPParty & "','" & LPExCode & "','" & LPItemCode & "','" & LPDSauda & "','" & MBVchNo & "'," & LBBrokAmt & "," & MBillNo & ",'" & Format(LPUptoDate, "yyyy/MM/dd") & "','" & MSVchNo & "'," & LShareAmt & "," & LMVNo & "," & LSEXID & "," & LSItemid & "," & LSSaudaID & "," & LFmlyID & "," & LSAccID & "," & lusdinr & ""
            Cnn.Execute mysql
        End If
        NewRec.MoveNext
    Loop
   
    Set NewRec = Nothing
End If
End Sub

'Public Sub Delete_Indexes()
'Dim TREC As ADODB.Recordset
'Dim TRec1 As ADODB.Recordset
'Dim LTblName As String
'Dim LObjectID As Long
'Dim LConstraintName As String
'Dim LIndexName As String
'Set TREC = Nothing
'Set TREC = New ADODB.Recordset
'MYSQL = "SELECT NAME,OBJECT_ID FROM SYS.TABLES WHERE NAME <>'dtproperties'AND TYPE='U' ORDER BY NAME"
'TREC.Open MYSQL, cnn, adOpenStatic, adLockReadOnly
'Do While Not TREC.EOF
'    LTblName = TREC!Name
'    LObjectID = TREC!OBJECT_ID
'    MYSQL = "SELECT * FROM SYS.OBJECTS WHERE PARENT_OBJECT_ID =" & LObjectID & " AND TYPE='PK'"
'    Set TRec1 = Nothing
'    Set TRec1 = New ADODB.Recordset
'    TRec1.Open MYSQL, cnn, adOpenStatic, adLockReadOnly
'    If Not TRec1.EOF Then
'        LConstraintName = TRec1!Name
'        MYSQL = "ALTER TABLE " & LTblName & " DROP CONSTRAINT " & LConstraintName & ""
'        cnn.Execute MYSQL
'    End If
'    TREC.MoveNext
'Loop
'
'MYSQL = "SELECT A.NAME AS INDEX_NAME ,B.NAME AS TABLE_NAME,A.TYPE_DESC FROM sys.INDEXES  AS A, SYS.TABLES AS B "
'MYSQL = MYSQL & " WHERE  A.TYPE<>0 AND B.TYPE='U' AND A.OBJECT_ID=B.OBJECT_ID AND B.NAME <>'dtproperties'"
'Set TREC = Nothing
'Set TREC = New ADODB.Recordset
'TREC.Open MYSQL, cnn, adOpenStatic, adLockReadOnly
'Do While Not TREC.EOF
'    LTblName = TREC!TABLE_NAME
'    LIndexName = TREC!INDEX_NAME
'    MYSQL = "DROP INDEX [" & LIndexName & "] ON  " & LTblName & ""
'    cnn.Execute MYSQL
'    TREC.MoveNext
'Loop
'
'End Sub


Function uintnew(ByVal A As Double) As Double
If A > CDbl(2147483647) Then A = CDbl(2147483647)
If A < CDbl(-2147483648#) Then A = CDbl(-2147483648#)
If A < 0 Then
uintnew = CDbl(&H7FFFFFFF) + (CDbl(&H7FFFFFFF) + A) + 2
Else
uintnew = A
End If
End Function
Public Sub ALTER_TABLE_NULLS()
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AC_GROUP' AND COLUMN_NAME ='CODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE AC_GROUP ALTER COLUMN CODE SMALLINT NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AC_GROUP' AND COLUMN_NAME ='G_CODE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE AC_GROUP ALTER COLUMN G_CODE SMALLINT NOT NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AC_GROUP' AND COLUMN_NAME ='G_CODE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE AC_GROUP ALTER COLUMN G_NAME VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE AC_GROUP ALTER COLUMN PCODE SMALLINT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE AC_GROUP ALTER COLUMN [TYPE] VARCHAR(1) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE ACCFMLY ALTER COLUMN COMPCODE  INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE ACCFMLY ALTER COLUMN COMPCODE  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCFMLY ALTER COLUMN FMLYCODE  VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCFMLY ALTER COLUMN FMLYNAME  VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE ACCFMLYD ALTER COLUMN COMPCODE  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCFMLYD ALTER COLUMN FMLYCODE  VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCFMLYD ALTER COLUMN PARTY  VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    
    
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN AC_CODE VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN NAME  VARCHAR(100) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN GCODE  SMALLINT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCOUNTD SET PERSONNELAC='N' WHERE PERSONNELAC IS NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN PERSONNELAC VARCHAR(1) NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCOUNTD SET INTAPP='0' WHERE INTAPP IS NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN INTAPP VARCHAR(1) NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCOUNTD SET PARTYTYPE ='1' WHERE PARTYTYPE IS NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTD ALTER COLUMN PARTYTYPE VARCHAR(1) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE ACCOUNTM ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTM ALTER COLUMN AC_CODE VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTM ALTER COLUMN NAME  VARCHAR(100) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTM ALTER COLUMN GCODE  SMALLINT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTM ALTER COLUMN GRPCODE  SMALLINT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCOUNTM ALTER COLUMN OP_BAL FLOAT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE ACCT_EX ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCT_EX ALTER COLUMN AC_CODE VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCT_EX ALTER COLUMN EXCODE  VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE ACCT_EX ALTER COLUMN ACEXCODE VARCHAR(30) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE COMPANY ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE COMPANY ALTER COLUMN NAME VARCHAR(100) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE COMPANY  ALTER COLUMN FINBEGIN SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE COMPANY  ALTER COLUMN FINEND SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE CONTRACTMASTER ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CONTRACTMASTER ALTER COLUMN ITEMCODE  VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CONTRACTMASTER ALTER COLUMN ITEMNAME  VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CONTRACTMASTER ALTER COLUMN EX_SYMBOL VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CONTRACTMASTER ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE CTR_D ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN PARTY VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN SAUDA VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN ITEMCODE VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN CONSNO INT  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN CONNO INT  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN ROWNO INT  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN CONTYPE VARCHAR(1)  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN QTY FLOAT  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN RATE FLOAT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN PATTAN VARCHAR(1)  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN BILLNO INT  NOT NULL"
    Cnn.Execute mysql
    'MYSQL = "UPDATE CTR_D SET PERCONT='N' WHERE PERCONT IS NULL"
    'Cnn.Execute MYSQL
    'MYSQL = "ALTER TABLE CTR_D ALTER COLUMN PERCONT VARCHAR(1)  NOT NULL"
    'Cnn.Execute MYSQL
    mysql = "UPDATE CTR_D SET EXCODE =(SELECT EXCODE FROM SAUDAMAST WHERE SAUDAMAST.SAUDACODE=CTR_D.SAUDA)"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET CONCODE = PARTY WHERE CONCODE IS NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN CONCODE VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN CALVAL FLOAT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET STRIKE = (SELECT STRIKEPRICE FROM SAUDAMAST WHERE SAUDAMAST.SAUDACODE=CTR_D.SAUDA)"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET OPTTYPE  = (SELECT OPTTYPE FROM SAUDAMAST WHERE SAUDAMAST.SAUDACODE=CTR_D.SAUDA)"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN STRIKE FLOAT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_D ALTER COLUMN OPTTYPE VARCHAR(2) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE CTR_M ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_M ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_M ALTER COLUMN SAUDA VARCHAR(50)  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_M ALTER COLUMN ITEMCODE VARCHAR(50)  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_M ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_M ALTER COLUMN CONSNO INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_M ALTER COLUMN PATTAN VARCHAR(1) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE CTR_R ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_R ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_R ALTER COLUMN SAUDA VARCHAR(50)  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_R ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_R ALTER COLUMN CONSNO INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE CTR_R ALTER COLUMN CLOSERATE FLOAT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE DAILYMARGIN ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DAILYMARGIN ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DAILYMARGIN ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DAILYMARGIN ALTER COLUMN PARTY VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE DLYCLMGN ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYCLMGN ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYCLMGN ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYCLMGN ALTER COLUMN CLIENT VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM DLYMGN  WHERE SAUDA NOT IN (SELECT DISTINCT SAUDACODE FROM SAUDAMAST )"
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYMGN SET ITEMCODE = (SELECT ITEMCODE FROM SAUDAMAST WHERE SAUDAMAST.SAUDACODE =DLYMGN.SAUDA) WHERE ITEMCODE IS NULL "
    Cnn.Execute mysql
    mysql = "UPDATE DLYMGN SET EXCODE  = (SELECT EXCODE  FROM SAUDAMAST WHERE SAUDAMAST.SAUDACODE =DLYMGN.SAUDA) WHERE EXCODE IS NULL "
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE DLYMGN ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYMGN ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYMGN ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYMGN ALTER COLUMN SAUDA VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DLYMGN ALTER COLUMN ITEMCODE VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE DMARGIN LYMGN ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DMARGIN ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DMARGIN ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DMARGIN ALTER COLUMN SAUDA VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DMARGIN ALTER COLUMN ITEMCODE VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DMARGIN ALTER COLUMN PARTY VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE DMARGIN ALTER COLUMN MATURITY SMALLDATETIME NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE EXMAST ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE EXMAST ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE EXMAST ALTER COLUMN EXNAME VARCHAR(100) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE EXTAX ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE EXTAX ALTER COLUMN EXCHANGECODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE EXTAX ALTER COLUMN FROMDT SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE EXTAX ALTER COLUMN TODT SMALLDATETIME NOT NULL"
    Cnn.Execute mysql
    
    mysql = "ALTER TABLE INV_D ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE INV_D ALTER COLUMN EXCODE VARCHAR(10) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE INV_D ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE INV_D ALTER COLUMN SAUDA VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE INV_D ALTER COLUMN ITEMCODE VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE INV_D ALTER COLUMN PARTY VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    mysql = "ALTER TABLE INV_D1 ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
End Sub
'Public Sub Set_PK_value()
'MYSQL = "ALTER TABLE AC_GROUP ADD CONSTRAINT PK_AC_GROUP PRIMARY KEY CLUSTERED(CODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE ACCFMLY ADD CONSTRAINT PK_ACCFMLY PRIMARY KEY CLUSTERED(COMPCODE,FMLYCODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE ACCFMLYD ADD CONSTRAINT PK_ACCFMLYD PRIMARY KEY CLUSTERED(COMPCODE,FMLYCODE,PARTY)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE ACCOUNTD ADD CONSTRAINT PK_ACCOUNTD PRIMARY KEY CLUSTERED(COMPCODE,AC_CODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE ACCOUNTM ADD CONSTRAINT PK_ACCOUNTM PRIMARY KEY CLUSTERED(COMPCODE,AC_CODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE ACCT_EX ADD CONSTRAINT PK_ACCT_EX PRIMARY KEY CLUSTERED(COMPCODE,AC_CODE,EXID,ACEXCODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE COMPANY ADD CONSTRAINT PK_COMPANY PRIMARY KEY CLUSTERED(COMPCODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE CONTRACTMASTER ADD CONSTRAINT PK_CONTRACTMASTER PRIMARY KEY CLUSTERED(EXCODE,ITEMCODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE CTR_D ADD CONSTRAINT PK_CTR_D PRIMARY KEY CLUSTERED(ROWNO)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE CTR_M ADD CONSTRAINT PK_CTR_M PRIMARY KEY CLUSTERED(CONDATE,SAUDAID)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE CTR_R ADD CONSTRAINT PK_CTR_R PRIMARY KEY NONCLUSTERED(CONDATE,SAUDAID)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE DAILYMARGIN ADD CONSTRAINT PK_DAILYMARGIN PRIMARY KEY NONCLUSTERED(COMPCODE,EXCODE,CONDATE,PARTY)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE DLYCLMGN ADD CONSTRAINT PK_DLYCLMGN PRIMARY KEY NONCLUSTERED(COMPCODE,EXCODE,CONDATE,CLIENT)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE DLYMGN ADD CONSTRAINT PK_DLYMGN PRIMARY KEY NONCLUSTERED(COMPCODE,EXCODE,CONDATE,ITEMCODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE DMARGIN ADD CONSTRAINT PK_DMARGIN PRIMARY KEY NONCLUSTERED(COMPCODE,EXCODE,CONDATE,PARTY,SAUDA)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE EXMAST ADD CONSTRAINT PK_EXMAST PRIMARY KEY CLUSTERED(EXID"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE EXTAX ADD CONSTRAINT PK_EXTAX PRIMARY KEY CLUSTERED(COMPCODE,EXCHANGECODE,FROMDT,TODT)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE INV_D ADD CONSTRAINT PK_INV_D PRIMARY KEY CLUSTERED(COMPCODE,STDATE,BILLNO)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE INV_D1 ADD CONSTRAINT PK_INV_D1 PRIMARY KEY CLUSTERED(COMPCODE,STDATE,BILLNO)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE ITEMMAST ADD CONSTRAINT PK_ITEMMAST PRIMARY KEY CLUSTERED(ITEMID )"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE NARRATIONM ADD CONSTRAINT PK_NARRATIONM PRIMARY KEY CLUSTERED(COMPCODE,NARRCODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE PEXBROK ADD CONSTRAINT PK_PEXBROK PRIMARY KEY CLUSTERED(EXID,INSTTYPE,AC_CODE,UPTOSTDT)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE PEXSBROK ADD CONSTRAINT PK_PEXSBROK PRIMARY KEY CLUSTERED(COMPCODE,EXCODE,INSTTYPE,FMLYCODE,PARTY,UPTOSTDT)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE PITBROK ADD CONSTRAINT PK_PITBROK PRIMARY KEY CLUSTERED(COMPCODE,INSTTYPE,AC_CODE,ITEMCODE,UPTOSTDT)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE PITSBROK ADD CONSTRAINT PK_PITSBROK PRIMARY KEY CLUSTERED(COMPCODE,INSTTYPE,FMLYCODE,PARTY,ITEMCODE,UPTOSTDT)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE SAUDAMAST  ADD CONSTRAINT PK_SAUDAMAST PRIMARY KEY CLUSTERED(COMPCODE,SAUDACODE)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE SCRIPTMASTER ADD CONSTRAINT PK_SCRIPTMASTER PRIMARY KEY CLUSTERED(EXCODE,SAUDACODE,MATURITY)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE VOUCHER  ADD CONSTRAINT PK_VOUCHER  PRIMARY KEY NONCLUSTERED(COMPCODE,VOU_NO)"
'Cnn.Execute MYSQL
'MYSQL = "ALTER TABLE VCHAMT ADD CONSTRAINT PK_VCHAMT PRIMARY KEY NONCLUSTERED(VOUID)"
'Cnn.Execute MYSQL
'End Sub
Public Sub Sendkeys(text$, Optional wait As Boolean = False)
   Dim WshShell As Object
   Set WshShell = CreateObject("wscript.shell")
   WshShell.Sendkeys text, wait
       Set WshShell = Nothing
End Sub
Public Sub Delete_Indexes()
Dim TRec As ADODB.Recordset:        Dim TRec1 As ADODB.Recordset
Dim LTblName As String:             Dim LObjectID As Long
Dim LConstraintName As String:      Dim LIndexName As String
Set TRec = Nothing:                 Set TRec = New ADODB.Recordset
mysql = "SELECT NAME,OBJECT_ID FROM SYS.TABLES WHERE NAME NOT IN ('dtproperties','sysdiagrams')AND TYPE='U' ORDER BY NAME"
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
Do While Not TRec.EOF
    LTblName = TRec!NAME
    LObjectID = TRec!object_id
    mysql = "SELECT * FROM SYS.OBJECTS WHERE PARENT_OBJECT_ID =" & LObjectID & " AND TYPE='PK'"
    Set TRec1 = Nothing
    Set TRec1 = New ADODB.Recordset
    TRec1.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not TRec1.EOF Then
        LConstraintName = TRec1!NAME
        mysql = "ALTER TABLE " & LTblName & " DROP CONSTRAINT " & LConstraintName & ""
        Cnn.Execute mysql
    End If
    TRec.MoveNext
Loop
mysql = "SELECT A.NAME AS INDEX_NAME ,B.NAME AS TABLE_NAME,A.TYPE_DESC FROM sys.INDEXES  AS A, SYS.TABLES AS B "
mysql = mysql & " WHERE  A.TYPE<>0 AND B.TYPE='U' AND A.OBJECT_ID=B.OBJECT_ID AND B.NAME NOT IN ('dtproperties','sysdiagrams')"
Set TRec = Nothing
Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
Do While Not TRec.EOF
    LTblName = TRec!TABLE_NAME
    LIndexName = TRec!INDEX_NAME
    mysql = "DROP INDEX [" & LIndexName & "] ON  " & LTblName & ""
    Cnn.Execute mysql
    TRec.MoveNext
Loop
End Sub
Public Sub Create_Indexes()
    On Error GoTo err1

    
    'SETTLE
    mysql = "CREATE UNIQUE CLUSTERED INDEX SETTLE_COMPCODE_SETDATE ON SETTLE (COMPCODE,SETDATE)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    Exit Sub
    
    
err1:
    If err.Number <> 0 Then
        MsgBox err.Description
      
       If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
    End If
    
    
End Sub
Public Sub Create_Indexes12()
    'AC_GROUP
'    MYSQL = "CREATE CLUSTERED INDEX AC_GROUP_COMPCODE_G_CODE ON AC_GROUP (COMPCODE,G_CODE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'ACCFMLY
'    MYSQL = "CREATE CLUSTERED INDEX ACCFMLY_COMPCODE_FMLYCODE ON ACCFMLY (COMPCODE,FMLYCODE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'ACCFMLYD
'    MYSQL = "CREATE CLUSTERED INDEX ACCFMLYD_COMPCODE_FMLYCODE_PARTY ON ACCFMLYD (COMPCODE,FMLYCODE,PARTY)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'ACCOUNTD
'    MYSQL = "CREATE CLUSTERED INDEX ACCOUNTD_COMPCODE_AC_CODE ON ACCOUNTD (COMPCODE,AC_CODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'ACCOUNTM
'    MYSQL = "CREATE CLUSTERED INDEX ACCOUNTM_COMPCODE_AC_CODE ON ACCOUNTM (COMPCODE,AC_CODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'ACCT_EX
'    MYSQL = "CREATE CLUSTERED INDEX ACCT_EX_COMPCODE_AC_CODE_EXCODE ON ACCT_EX (COMPCODE,AC_CODE,EXCODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'COMPANY
'    MYSQL = "CREATE CLUSTERED INDEX COMPANY_COMPCODE ON COMPANY (COMPCODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'EXMAST
'    MYSQL = "CREATE CLUSTERED INDEX EXMAST_COMPCODE_EXCODE ON EXMAST (COMPCODE,EXCODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'ITEMMAST
'    MYSQL = "CREATE CLUSTERED INDEX ITEMMAST_COMPCODE_ITEMCODE ON ITEMMAST (COMPCODE,ITEMCODE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'SAUDAMMAST
'    MYSQL = "CREATE CLUSTERED INDEX SAUDAMAST_COMPCODE_SAUDACODE ON SAUDAMAST (COMPCODE,SAUDACODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'SETTLE
'    MYSQL = "CREATE CLUSTERED INDEX SETTLE_COMPCODE_SETDATE ON SETTLE (COMPCODE,SETDATE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'NARRATION
'    MYSQL = "CREATE CLUSTERED INDEX NARRATIONM_COMPCODE_NARRCODE ON NARRATIONM  (COMPCODE,NARRCODE )"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'SCRIPTMASTER
'    MYSQL = "CREATE UNIQUE INDEX SCRIPTMASTER_EXCODE_EX_SYMBOL_INSTTYPE_MATURITY_OPTTYPE_STRIKEPRICE ON SCRIPTMASTER  (EXCODE,EX_SYMBOL,INSTTYPE,MATURITY,OPTTYPE,STRIKEPRICE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'CTR_M
'    MYSQL = "CREATE UNIQUE INDEX CTR_M_COMPCODE_CONDATE_SAUDA ON CTR_M (COMPCODE,CONDATE,SAUDA)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX CTR_M_COMPCODE_SAUDAID_CONDATE ON CTR_M (COMPCODE,SAUDAID,CONDATE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    'CTR_D
'    'MYSQL = " CREATE NONCLUSTERED INDEX [CTR_D_COMPCODE_PARTY_SAUDA_INV_NO] ON "
'    'MYSQL = MYSQL & " [CTR_D] ([CompCode],[PARTY],[SAUDA],[INVNO])"
'    'MYSQL = MYSQL & " INCLUDE ([CONSNO],[CONTYPE],[QTY],[RATE],[BROKRATE],[TRANRATE],[BrokType],[TranType],[SrvTax],[BrokQty],[STMRATE],"
'    'MYSQL = MYSQL & "[BrokRate2],[STTRATE],[TRANTAX],[CALVAL],[SEBITAX],[SBC_TAX],[CGSTRATE],[SGSTRATE],[IGSTRATE],[UTTRATE],[BrokQty2])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE NONCLUSTERED INDEX [IX_CTR_D_CompCode_CONSNO_PARTY_SAUDA_INVNO] ON "
'    'MYSQL = MYSQL & " [CTR_D] ([CompCode], [CONSNO], [PARTY], [SAUDA], [INVNO])"
'    'MYSQL = MYSQL & " INCLUDE ([CONTYPE], [QTY], [RATE], [BROKRATE], [TRANRATE], [BrokType], [TranType], [SrvTax], [BrokQty], "
'    'MYSQL = MYSQL & " [STMRATE], [BrokRate2], [STTRATE], [TRANTAX], [CALVAL], [SEBITAX], [SBC_TAX], [CGSTRATE], [SGSTRATE], "
'    'MYSQL = MYSQL & "[IGSTRATE], [UTTRATE], [BrokQty2])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE NONCLUSTERED INDEX [IX_CTR_D_CompCode_EXCODE_CONSNO] ON "
'    'MYSQL = MYSQL & " [CTR_D] ([CompCode],[EXCODE],[CONSNO])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = " CREATE INDEX [IX_CTR_D_CompCode_SAUDA_CONDATE] ON [CTR_D] ([CompCode], [SAUDA], [CONDATE]) INCLUDE ([CONSNO], [EXCODE])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
' '   MYSQL = " CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDA_CONDATE_PATTAN] ON  [CTR_D] "
' '   MYSQL = MYSQL & " ([CompCode], [PARTY], [SAUDA],[CONDATE], [PATTAN]) INCLUDE ([CONTYPE], [QTY], [RATE], [BROKRATE], [BrokType], [BrokQty], [BROKRATE2], [ORDNO], [CALVAL], [BrokQty2])"
' '   MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
' '   Cnn.Execute MYSQL
'
'
'    MYSQL = "CREATE INDEX [IX_CTR_M_CompCode_PATTAN] ON [CTR_M] ([CompCode], [PATTAN]) INCLUDE ([CONSNO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDAID_CONDATE] ON  [CTR_D] ([CompCode], [PARTY], [SAUDAID],[CONDATE]) INCLUDE ([BILLNO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'
'  '  MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDA_CONDATE2] ON  [CTR_D]"
'  '  MYSQL = MYSQL & " ([CompCode], [PARTY], [SAUDA],[CONDATE]) INCLUDE ([CONSNO], [CONTYPE], [QTY], [RATE])"
'  ''  MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
''
'    MYSQL = "CREATE NONCLUSTERED INDEX [IX_CTR_D_CompCode_PARTY_SAUDA_CONDATE3] ON [CTR_D] "
'    MYSQL = MYSQL & " ([CompCode], [PARTY], [SAUDA],[CONDATE]) "
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
''
''    MYSQL = " CREATE NONCLUSTERED INDEX [IX_CTR_D_CompCode_SAUDA_CONDATE] ON [CTR_D] "
''    MYSQL = MYSQL & "([CompCode], [SAUDA], [CONDATE]) INCLUDE ([CONSNO], [CALVAL])"
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
''
''    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_ITEMCODE_INVNO_BrokType_INSTTYPE_CONDATE] ON [CTR_D] "
''    MYSQL = MYSQL & " ([CompCode], [PARTY], [ITEMCODE], [INVNO], [BrokType], [INSTTYPE],[CONDATE]) INCLUDE "
''    MYSQL = MYSQL & " ([BROKRATE], [TRANRATE], [TranType], [BROKRATE2])"
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
''
'    'MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_INVNO_BrokType_EXCODE_INSTTYPE_CONDATE] "
'    'MYSQL = MYSQL & " ON [CTR_D] ([CompCode], [PARTY], [INVNO], [BrokType], [EXCODE], [INSTTYPE],[CONDATE]) "
'    'MYSQL = MYSQL & " INCLUDE ([BROKRATE], [TRANRATE], [TranType], [BROKRATE2])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
''
''    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_CONDATE_EXCODE_PATTAN] ON "
''    MYSQL = MYSQL & " [CTR_D] ([CompCode], [PARTY], [CONDATE], [EXCODE],[PATTAN])"
''    MYSQL = MYSQL & " INCLUDE ([QTY], [RATE], [STMRATE], [CALVAL])"
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
''
'
'    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_EXCODE_CONDATE] ON [CTR_D] ([CompCode], [EXCODE],[CONDATE])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'
'    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_SAUDA_CONDATE_RATE] ON [CTR_D] ([CompCode], [SAUDA], [CONDATE],[RATE]) INCLUDE ([CONNO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'
'    'MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_BILLNO] ON [CTR_D] ([CompCode], [BILLNO])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_CTR_M_CompCode_EXCODE_CONDATE] ON [CTR_M] ([CompCode], [EXCODE],[CONDATE])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
    'MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDAID_CONDATE_PATTAN] ON  [CTR_D] ([CompCode], [PARTY], [SAUDAID],[CONDATE], [PATTAN])"
    'MYSQL = MYSQL & " INCLUDE ([CONTYPE], [QTY], [RATE], [BROKRATE], [BrokType], [BrokQty], [BROKRATE2], [ORDNO], [CALVAL], [BrokQty2])"
    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
    'Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDAID_CONDATE2] ON [CTR_D] ([CompCode], [PARTY], [SAUDAID],[CONDATE]) INCLUDE ([CONTYPE], [QTY])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDAID_CONDATE3] ON [CTR_D] ([CompCode], [PARTY], [SAUDAID],[CONDATE]) INCLUDE ([CONSNO], [CONTYPE], [QTY], [RATE])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX [IX_CTR_D_CompCode_SAUDA_SAUDAID] ON [CTR_D] ([CompCode], [SAUDA],[SAUDAID])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = " CREATE INDEX [IX_CTR_M_CompCode_CONSNO_PATTAN] ON  [CTR_M] ([CompCode], [CONSNO], [PATTAN])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_CTR_M_CompCode_SAUDA_EXCODE_CONDATE] ON [CTR_M] ([CompCode], [SAUDA], [EXCODE],[CONDATE])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    'MYSQL = " CREATE INDEX [IX_CTR_D_CompCode_PARTY_SAUDA_CONDATE3] ON [CTR_D] ([CompCode], [PARTY], [SAUDA],[CONDATE]) "
'    'MYSQL = MYSQL & " INCLUDE ([CONTYPE], [QTY], [RATE], [CALVAL])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX [IX_CTR_R_CompCode_SAUDA_SAUDAID] ON  [CTR_R] ([CompCode], [SAUDA],[SAUDAID])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [CTR_R_CompCode_CONDATE_SAUDAID] ON CTR_R (CompCode, CONDATE,SAUDAID)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    'MYSQL = "CREATE INDEX [INV_D_CompCode] ON [INV_D] ([CompCode]) INCLUDE ([BILLNO])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'    MYSQL = " CREATE INDEX [IX_INV_D_CompCode_PARTY_SAUDAID_STDATE] ON INV_D "
'    MYSQL = MYSQL & " ([CompCode], [PARTY], [SAUDAID],[STDATE]) "
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    MYSQL = " CREATE INDEX [IX_INV_D_CompCode_PARTY_SAUDA_STDATE] ON INV_D "
'    MYSQL = MYSQL & " ([CompCode], [PARTY], [SAUDA],[STDATE]) INCLUDE ([CLQTY], [CLRATE])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_BILLNO_STDATE_PARTY] ON [INV_D] ([CompCode], [BILLNO], [STDATE], [PARTY])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE UNIQUE INDEX [VOUCHER_CompCode_vou_no] ON [VOUCHER] ([CompCode],[VOU_NO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = " CREATE INDEX [IX_VOUCHER_CompCode] ON [VOUCHER] ([CompCode]) INCLUDE ([VNO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_VOUCHER_CompCode_VOU_TYPE] ON  [VOUCHER] ([CompCode],[VOU_TYPE]) INCLUDE ([VOU_NO], [sauda], [INVNO])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_VCHAMT_VOU_NO] ON VCHAMT (VOU_NO) INCLUDE (COMPCODE) "
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'    '/MYSQL = "CREATE INDEX [IX_VCHAMT_CompCode_AC_CODE_VOU_DT] ON  [VCHAMT] ([CompCode], [AC_CODE],[VOU_DT])"
'    'MYSQL = MYSQL & " INCLUDE ([VOU_NO], [VOU_TYPE], [DR_CR], [AMOUNT], [CHEQUE_NO], [CHEQUE_DT], [NARRATION], [BRANCH], [BANK_NAME], [EXCODE])"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_VCHAMT_CompCode_AC_CODE_VOU_TYPE_VOU_DT] ON [VCHAMT]"
'    MYSQL = MYSQL & "([CompCode], [AC_CODE],[VOU_TYPE], [VOU_DT]) INCLUDE ([DR_CR], [AMOUNT])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX [IX_VCHAMT_CompCode_VOU_NO_AC_CODE] ON [VCHAMT] ([CompCode], [VOU_NO],[AC_CODE])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    If GAppSpread = "Y" Then
'        MYSQL = "CREATE INDEX [IX_DlyCLMgn_Compcode_EXCODE_Condate] ON [DlyCLMgn] ([Compcode], [EXCODE],[Condate])"
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'        MYSQL = "CREATE INDEX [IX_DlyCLMgn_Compcode_Condate] ON [DlyCLMgn]"
'        MYSQL = MYSQL & " ([Compcode],[Condate]) INCLUDE ([Client], [IMargin], [MMargin], [SPMARGIN], [EXCODE], [CMARGIN])"
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'        MYSQL = " CREATE INDEX [IX_DMARGIN_COMPCODE_Party_EXCODE_CONDATE] ON  [DMARGIN]"
'        MYSQL = MYSQL & " ([COMPCODE], [Party], [EXCODE],[CONDATE])  INCLUDE ([MARGINAMT])"
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'
'        MYSQL = " CREATE INDEX [IX_DMARGIN_Compcode_Condate_Party_ItemCode] ON [DMARGIN] "
'        MYSQL = MYSQL & " ([Compcode], [Condate], [Party], [ItemCode]) INCLUDE ([CLOSEQTY])"
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'
'        MYSQL = " CREATE INDEX [IX_DMARGIN_Compcode_Condate_Party_ItemCode_CLOSEQTY] ON [DMARGIN]"
'        MYSQL = MYSQL & "([Compcode], [Condate], [Party], [ItemCode],[CLOSEQTY]) INCLUDE ([Sauda], [FlatQty], [Maturity])"
'
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'
'        MYSQL = " CREATE INDEX [IX_DMARGIN_Compcode_Condate_Party_ItemCode_Maturity] ON [DMARGIN]"
'        MYSQL = MYSQL & "([Compcode], [Condate], [Party], [ItemCode],[Maturity]) INCLUDE ([Sauda], [CLOSEQTY])"
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'
'        MYSQL = "CREATE INDEX [IX_DMARGIN_COMPCODE_CONDATE_SAUDA_Party] ON [DMARGIN]"
'        MYSQL = MYSQL & " ([COMPCODE], [CONDATE], [SAUDA], [Party]) INCLUDE ([MARGINAMT])"
'        MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'        Cnn.Execute MYSQL
'    End If
End Sub

Public Sub Delete_DependentConstrainst(LTableName As String, LColumnName As String)
Dim TRec As ADODB.Recordset
    
    mysql = "SELECT OBJECT_NAME(PARENT_OBJECT_ID) AS TABLE_NAME,COL_NAME (PARENT_OBJECT_ID, PARENT_COLUMN_ID) AS COLUMN_NAME,NAME AS DEFAULT_CONSTRAINT_NAME "
    mysql = mysql & " FROM SYS.DEFAULT_CONSTRAINTS"
    mysql = mysql & " WHERE  OBJECT_NAME(PARENT_OBJECT_ID)='" & LTableName & "' AND COL_NAME (PARENT_OBJECT_ID, PARENT_COLUMN_ID)='" & LColumnName & "'"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        Do While Not TRec.EOF
            mysql = "ALTER TABLE " & LTableName & " DROP CONSTRAINT " & TRec!DEFAULT_CONSTRAINT_NAME & ""
            Cnn.Execute mysql
            TRec.MoveNext
        Loop
    
    End If
    
End Sub
Public Sub Delete_DependentIndex(LTableName As String, LColumnName As String)

Dim TRec As ADODB.Recordset
mysql = " SELECT OBJECT_SCHEMA_NAME(ind.object_id) AS SchemaName,OBJECT_NAME(ind.object_id) AS ObjectName "
mysql = mysql & " , ind.name AS IndexName,ind.is_primary_key AS IsPrimaryKey,ind.is_unique AS IsUniqueIndex"
mysql = mysql & " , col.name AS ColumnName,ic.is_included_column AS IsIncludedColumn, ic.key_ordinal AS ColumnOrder"
mysql = mysql & " FROM    sys.indexes ind INNER JOIN sys.index_columns ic ON ind.object_id = ic.object_id"
mysql = mysql & " AND ind.index_id = ic.index_id  INNER JOIN sys.columns col"
mysql = mysql & " ON ic.object_id = col.object_id AND ic.column_id = col.column_id"
mysql = mysql & " INNER JOIN sys.tables t  ON ind.object_id = t.object_id"
mysql = mysql & " WHERE   t.is_ms_shipped = 0 and col.name='" & LColumnName & "' AND OBJECT_NAME(ind.object_id) ='" & LTableName & "'"
mysql = mysql & " ORDER BY OBJECT_SCHEMA_NAME(ind.object_id) --SchemaName"
mysql = mysql & " , OBJECT_NAME(ind.object_id) --ObjectName"
mysql = mysql & " , ind.is_primary_key DESC"
mysql = mysql & " , ind.is_unique DESC"
mysql = mysql & " , ind.name --IndexName"
mysql = mysql & " , ic.key_ordinal"
Set TRec = Nothing
Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If Not TRec.EOF Then
Do While Not TRec.EOF
    mysql = " DROP INDEX " & TRec!INDEXNAME & " ON " & LTableName & ""
    Cnn.Execute mysql
    TRec.MoveNext
Loop
End If
End Sub

Public Sub PInsert_PExBrok(LPAcCode As String, LExCode As String, LPBrokType As String, LPBrokRate As Double, LPBrokRate2 As Double, LPStdRate As Double, LPTranRate As Double, LPTranType As String, LPSTTRate As Double, LPMinRate As Double, LPMBrokType As String, LPMBrokRate As Double, LPMBrokRate2 As Double, LPMarType As String, LPMarRate As Double, LPUptoStDt As Date, LPInstType As String, LPSellBrok As Double, LPSellBrok2 As Double, LPEXID As Integer, LPAccID As Long)
mysql = "EXEC INSERT_PEXBROK " & GCompCode & ",'" & LPAcCode & "','" & LExCode & "','" & LPBrokType & "'," & LPBrokRate & "," & LPBrokRate2 & "," & LPStdRate & "," & LPTranRate & ","
mysql = mysql & "'" & LPTranType & "'," & LPSTTRate & "," & LPMinRate & ",'" & LPMBrokType & "'," & LPMBrokRate & "," & LPMBrokRate2 & ",'" & LPMarType & "'," & LPMarRate & ","
mysql = mysql & "'" & Format(LPUptoStDt, "YYYY/MM/DD") & "','" & LPInstType & "'," & LPSellBrok & "," & LPSellBrok2 & "," & LPEXID & "," & LPAccID & ""
Cnn.Execute mysql
End Sub

Public Sub PInsert_PitBrok(LPCompCode As Integer, LPAcCode As String, LPItemCode As String, LPBrokType As String, LPBrokRate As Double, LPStdRate As Double, LPTranRate As Double, LPTranType As String, LPBrokRate2 As Double, LPMarType As String, LPMarRate As Double, LPUptoStDt As Date, LPStmRate As Double, LPSTTRate As Double, LPMinRate As Double, LPMBrokType As String, LPMBrokRate As Double, LPMBrokRate2 As Double, LPInstType As String, LPExCode As String, LPEXID As Integer, lpitemid As Integer, LPAccID As Long)
mysql = "EXEC INSERT_PITBROK " & LPCompCode & ",'" & LPAcCode & "', '" & LPItemCode & "','" & Left$(LPBrokType, 1) & "'," & LPBrokRate & ""
mysql = mysql & " , " & LPStdRate & ", " & LPTranRate & ",'" & Left$(LPTranType, 1) & "'," & LPBrokRate2 & ",'" & Left$(LPMarType, 1) & "'," & LPMarRate & ""
mysql = mysql & " ,'" & Format(LPUptoStDt, "yyyy/MM/dd") & "'," & LPStmRate & "," & LPSTTRate & "," & LPMinRate & ",'" & Left$(LPMBrokType, 1) & "'"
mysql = mysql & " ," & LPMBrokRate & "," & LPMBrokRate2 & ",'" & LPInstType & "','" & LPExCode & "'," & LPEXID & "," & lpitemid & "," & LPAccID & ""
Cnn.Execute mysql
End Sub

Public Function PInsert_Voucher(LPVouNo As String, LPVouDate As Date, LPVouType As String, LPVouPR As String, LPBillNo As Long, LPUserAction As String, _
LPCashCode As String, LPInvNo As Long, LPNarration As String, LPExCode As String, LPImport As String, LPEXID As Integer, LPFmlyID As Long) As Long
Dim TRec As ADODB.Command
Dim LMaxVno  As Long
LMaxVno = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "INSERT_VOUCHER"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("VOU_NO", adVarChar, adParamInput, 20, LPVouNo)
TRec.Parameters.Append TRec.CreateParameter("VOU_TYPE", adVarChar, adParamInput, 2, LPVouType)
TRec.Parameters.Append TRec.CreateParameter("VOU_DT", adDBTimeStamp, adParamInput, , LPVouDate)
TRec.Parameters.Append TRec.CreateParameter("VOU_PR", adVarChar, adParamInput, 1, Left(LPVouPR, 1))
TRec.Parameters.Append TRec.CreateParameter("CASHCODE", adVarChar, adParamInput, 15, Left(LPCashCode, 15))
TRec.Parameters.Append TRec.CreateParameter("INVNO", adInteger, adParamInput, , LPInvNo)
TRec.Parameters.Append TRec.CreateParameter("EXCODE", adVarChar, adParamInput, 10, LPExCode)
TRec.Parameters.Append TRec.CreateParameter("IMPORT", adVarChar, adParamInput, 1, LPImport)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LPEXID)
TRec.Parameters.Append TRec.CreateParameter("FMLYID", adInteger, adParamInput, , LPFmlyID)
TRec.Parameters.Append TRec.CreateParameter("MAXVNO", adInteger, adParamOutput, , LMaxVno)

TRec.Execute
LMaxVno = TRec("MAXVNO")
PInsert_Voucher = LMaxVno
End Function

Public Sub PInsert_Vchamt(LPVouNo As String, LPVouType As String, LPVouDate As Date, LPDrCr As String, LPAcCode As String, LPAmount As Double, _
LPChqNo As String, LPChqDt As Date, LPNarration As String, LPBranch As String, LPBank As String, LPInvNo As Long, LPExCode As String, LPMVNo As Long, LPEXID As Integer, LPSaudaID As Long, LPAccID As Long)
Dim mvoutime As Date
mvoutime = DateValue(Now)
mysql = "EXEC INSERT_VCHAMT " & GCompCode & ",'" & LPVouNo & "','" & LPVouType & "','" & Format(LPVouDate, "yyyy/MM/dd") & "','" & LPDrCr & "','" & LPAcCode & "'," & LPAmount & ",'" & LPChqNo & "','" & Format(LPChqDt, "yyyy/mm/dd") & "','" & LPNarration & "','" & LPBranch & "','" & LPBank & "'," & LPInvNo & ",'" & LPExCode & "'," & LPMVNo & "," & LPEXID & "," & LPAccID & ",'" & Format(mvoutime, "yyyy/MM/dd HH:MM:SS") & "' "
Cnn.Execute mysql
End Sub

Public Sub PInsert_AccountM(LAAc_Code As String, LAName As String, LAGCode As Integer, LAGrpCode As Integer, LAOp_Bal As Double, LAActive As Byte, LAPtyHead As Integer)
mysql = "EXEC INSERT_ACCOUNTM " & GCompCode & ",'" & LAAc_Code & "','" & LAName & "'," & LAGCode & "," & LAGrpCode & "," & LAOp_Bal & "," & LAActive & "," & LAPtyHead & ""
Cnn.Execute mysql
End Sub

Public Sub PInsert_Accountd(LMAcCode As String, LMGCode As Integer, LMName As String, LMAdd1 As String, LMCity As String, LMPin As String, LMPhoneO As String, _
LMPhoneR As String, LMFax As String, LMMobile As String, LMEmail As String, LMPersonnelAc As String, LMIntApp As String, _
LMSrTaxApp As String, LMPANNo As String, LMDirector As String, LMBrokType As String, LMBrokRate As Double, _
LMTranType As String, LMTranRate As Double, LMSTDRate As Double, LMBCycle As String, LMPartyType As String, LMLSTNo As String, _
LMCSTNo As String, LMSTTRate As Double, LMCTTType As String, LMFromDate As Date, LMApplyOn As String, LMPtyHead As Integer, LMRiskMType As String, LMSEBIType As String, _
LMIntRate As Double, LMGSTIN As String, LMCGST As String, LMSGST As String, LMIGST As String, LMUTT As String, LMUCC As String, LMState As String, LMStateCode As String, LMIntType As String, _
LMOptCutBrok As String, LMFutCutBrok As String, LMMultiplier As String, LMSEBIRATE As Double, LMCurrRate As Double, LMCurrType As String, LMAccID As Long, LMCRLIMIT As Double)

mysql = "EXEC INSERT_ACCOUNTD " & GCompCode & ",'" & LMAcCode & "'," & LMGCode & ",'" & LMName & "','" & LMAdd1 & "','" & LMCity & "','" & LMPin & "','" & LMPhoneO & ""
mysql = mysql & "','" & LMPhoneR & "','" & LMFax & "','" & LMMobile & "','" & LMEmail & "','" & LMPersonnelAc & "','" & LMIntApp & "','" & LMSrTaxApp & "','" & LMPANNo & "','" & LMDirector & "','" & LMBrokType & "'," & LMBrokRate & ""
mysql = mysql & ",'" & LMTranType & "'," & LMTranRate & "," & LMSTDRate & ",'" & LMPartyType & "'," & LMSTTRate & ",'" & LMCTTType & "','" & LMApplyOn & "','" & LMRiskMType & "','" & LMSEBIType & ""
mysql = mysql & "'," & LMIntRate & ",'" & LMGSTIN & "','" & LMCGST & "','" & LMSGST & "','" & LMIGST & "','" & LMUTT & "','" & LMUCC & "','" & LMState & "','" & LMStateCode & "','" & LMIntType & "'"
mysql = mysql & ",'" & LMOptCutBrok & "','" & LMFutCutBrok & "','" & LMMultiplier & "'," & LMSEBIRATE & "," & LMCurrRate & ",'" & LMCurrType & "'," & LMAccID & "," & LMCRLIMIT & "," & LMBCycle & " "

Cnn.Execute mysql
End Sub

Public Sub AddAlter_Column(LTblName As String, LAction As String, LColName As String, LDataType As String)
mysql = "IF COL_LENGTH('" & LTblName & "','" & LColName & "')"
If LAction = "ADD" Then
    mysql = mysql & " IS NULL "
Else
    mysql = mysql & " IS NOT NULL "
End If
mysql = mysql & " ALTER TABLE " & LTblName & " " & LAction & " " & LColName & " "
If LAction <> "DROP COLUMN" Then mysql = mysql & " " & LDataType & " "
Cnn.Execute mysql
End Sub
Public Sub PInsert_SystNo(LB As String, LCustID As String, LSNo2 As String, LSNo3 As String, LPOptions As String, LPTDate As Date, LPLDate As Date, LPCCode As Integer)

    mysql = "EXEC INSERT_SYSTNO '" & LB & "','" & LCustID & "','" & LSNo2 & "','" & LSNo3 & "','" & vbNullString & "','" & vbNullString & "','" & vbNullString & "'," & " '" & LPOptions & "','" & Format(LPTDate, "YYYY/MM/DD") & "','" & Format(LPLDate, "YYYY/MM/DD") & "'," & LPCCode & ""
    MCnn.Execute mysql
End Sub

Public Function Get_ContractMaster(ByVal LCExCode As String, ByVal LCExSymbol As String) As String
Dim TRec As ADODB.Command
Dim LContractItem As String
LContractItem = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_CONTRACTMASTER"
TRec.Parameters.Append TRec.CreateParameter("EXCODE", adVarChar, adParamInput, 10, LCExCode)
TRec.Parameters.Append TRec.CreateParameter("EX_SYMBOL", adVarChar, adParamInput, 50, LCExSymbol)
TRec.Parameters.Append TRec.CreateParameter("LITEMCODE", adVarChar, adParamOutput, 50, LContractItem)
TRec.Execute
LContractItem = TRec("LITEMCODE")
Get_ContractMaster = LContractItem
End Function

Public Function Get_ItemMaster(LCExID As Integer, LCExSymbol As String) As String
Dim TRec As ADODB.Command
Dim LItem As String
LItem = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_ITEMMASTER"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LCExID)
TRec.Parameters.Append TRec.CreateParameter("EX_SYMBOL", adVarChar, adParamInput, 50, LCExSymbol)
TRec.Parameters.Append TRec.CreateParameter("LITEMCODE", adVarChar, adParamOutput, 50, LItem)
TRec.Execute
LItem = TRec("LITEMCODE")
Get_ItemMaster = LItem
End Function

Public Function Get_SaudaMaster(ByVal LCExID As Integer, ByVal LCItemID As Integer, ByVal LCMaturity As Date, ByVal LCInstType As String, ByVal LCOptType As String, ByVal LCStrike As Double) As String
Dim TRec As ADODB.Command
Dim LSauda As String
LSauda = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_SAUDAMASTER"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, 10, LCExID)
TRec.Parameters.Append TRec.CreateParameter("ITEMID", adInteger, adParamInput, , LCItemID)
TRec.Parameters.Append TRec.CreateParameter("MATURITY", adDBTimeStamp, adParamInput, , LCMaturity)
TRec.Parameters.Append TRec.CreateParameter("INSTTYPE", adVarChar, adParamInput, 3, LCInstType)
TRec.Parameters.Append TRec.CreateParameter("OPTTYPE", adVarChar, adParamInput, 2, LCOptType)
TRec.Parameters.Append TRec.CreateParameter("STRIKEPRICE", adDouble, adParamInput, , LCStrike)
TRec.Parameters.Append TRec.CreateParameter("PSAUDACODE", adVarChar, adParamOutput, 50, LSauda)
TRec.Execute
LSauda = TRec("PSAUDACODE")
Get_SaudaMaster = LSauda
End Function

Public Function Get_SaudaID(LCSauda As String) As Long
Dim TRec As ADODB.Command
Dim LSaudaID As Long
LSaudaID = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_SaudaiD"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("SAUDACODE", adVarChar, adParamInput, 50, LCSauda)
TRec.Parameters.Append TRec.CreateParameter("OSAUDAID", adInteger, adParamOutput, , LSaudaID)
TRec.Execute
LSaudaID = TRec("OSAUDAID")
Get_SaudaID = LSaudaID
End Function

Public Function Get_ITEMID(LCITEM As String) As Long
Dim TRec As ADODB.Command
Dim LItemID As Long
LItemID = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_ItemID"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("ITEMCODE", adVarChar, adParamInput, 20, LCITEM)
TRec.Parameters.Append TRec.CreateParameter("PITEMID", adInteger, adParamOutput, , LItemID)
TRec.Execute
LItemID = TRec("PITEMID")
Get_ITEMID = LItemID
End Function

Public Function Get_SaudaCODE(LCSaudaID As Long) As String
Dim TRec As ADODB.Command
Dim LSaudaCode  As String
LSaudaCode = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_SaudaCODE"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LCSaudaID)
TRec.Parameters.Append TRec.CreateParameter("PSAUDACODE", adVarChar, adParamOutput, 50, LSaudaCode)
TRec.Execute
LSaudaCode = TRec("PSAUDACODE")
Get_SaudaCODE = LSaudaCode
End Function


Public Function Get_ExID(LCExCode As String) As Long
Dim TRec As ADODB.Command
Dim LExID As Long
LExID = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_EXID"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("EXCODE", adVarChar, adParamInput, 10, LCExCode)
TRec.Parameters.Append TRec.CreateParameter("OEXID", adInteger, adParamOutput, , LExID)
TRec.Execute
LExID = TRec("OEXID")
Get_ExID = LExID
End Function

Public Function Get_AccID(LCAcCode As String, Optional lccomp As Integer) As Long
Dim TRec As ADODB.Command
Dim LACCID  As Long
If lccomp = 0 Then
    lccomp = GCompCode
End If

LACCID = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_ACCID"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , lccomp)
TRec.Parameters.Append TRec.CreateParameter("AC_CODE", adVarChar, adParamInput, 15, LCAcCode)
TRec.Parameters.Append TRec.CreateParameter("OACCID", adInteger, adParamOutput, , LACCID)
TRec.Execute
LACCID = TRec("OACCID")
Get_AccID = LACCID
End Function

Public Function Get_UBILLNO(LCStDate As Date, LCAccID As Long, LCSaudaID As Long) As Long
Dim TRec As ADODB.Command
Dim LBillNo  As Long
LBillNo = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_UBILLNO"
TRec.Parameters.Append TRec.CreateParameter("STDATE", adInteger, adParamInput, , LCStDate)
TRec.Parameters.Append TRec.CreateParameter("ACCID", adInteger, adParamInput, , LCAccID)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LCSaudaID)
TRec.Parameters.Append TRec.CreateParameter("UBILLNO", adInteger, adParamOutput, , LBillNo)
TRec.Execute
LBillNo = TRec("UBILLNO")
Get_UBILLNO = LBillNo
End Function

Public Function Get_Fmlyid(LCFmlyCode As String) As Long
Dim TRec As ADODB.Command
Dim LFmlyID   As Long
LFmlyID = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_FMLYID"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("FMLYCODE", adVarChar, adParamInput, 6, LCFmlyCode)
TRec.Parameters.Append TRec.CreateParameter("OFMLYID", adInteger, adParamOutput, , LFmlyID)
TRec.Execute
LFmlyID = TRec("OFMLYID")
Get_Fmlyid = LFmlyID
End Function


Public Sub PInsert_ContractMaster(LIExCode As String, LIItemCode As String, LIItemName As String, LIEx_Symbol As String, LILot As Double, LISc_Group As String, LIPriceUnit As String, LIQtyUnit As String, LIDeliveryUnit As String, LIRegularLot As Double)
mysql = "EXEC INSERT_CONTRACTMASTER '" & LIExCode & "','" & LIItemCode & "','" & LIItemName & "','" & LIEx_Symbol & "'," & LILot & ",'" & LISc_Group & "','" & LIPriceUnit & "','" & LIQtyUnit & "','" & LIDeliveryUnit & "','" & LIRegularLot & "'"
Cnn.Execute mysql
End Sub

Public Sub PInsert_SCRIPTMASTER(LTExCode As String, LTEx_Symbol As String, LTItemCode As String, LTLot As Double, LTSaudaCode As String, LTSaudaName As String, LTMaturity As Date, LTStrikePrice As Double, LTOptType As String, LTInstType As String, LTNoCode As Long, LTBrokLot As Double, LTRefLot As Double)
mysql = "EXEC INSERT_SCRIPT_MASTER '" & LTExCode & "','" & LTEx_Symbol & "','" & LTItemCode & "'," & LTLot & ",'" & LTSaudaCode & "','" & LTSaudaName & "','" & Format(LTMaturity, "YYYY/MM/DD") & "'," & LTStrikePrice & ",'" & LTOptType & "','" & LTInstType & "'," & LTNoCode & "," & LTBrokLot & "," & LTRefLot & ""
Cnn.Execute mysql
End Sub

Public Function Duplicate_CItem_Chk(LMItemCode As String) As Boolean
Dim TRec As ADODB.Command
Duplicate_CItem_Chk = False
Dim LCHK As Integer
Set TRec = Nothing
Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Chk_DuplicateContractItem"
TRec.Parameters.Append TRec.CreateParameter("ITEMCODE", adVarChar, adParamInput, 50, LMItemCode)
TRec.Parameters.Append TRec.CreateParameter("LEXIST", adInteger, adParamOutput, , LCHK)
TRec.Execute
LCHK = TRec("LEXIST")
If LCHK <> 0 Then Duplicate_CItem_Chk = True
End Function

Public Function Get_ScriptMaster(LPExSymbol As String, LPMaturity As Date, LPExCode As String, LPInstType As String, LPOptType As String, LPStrike As Double) As String
Dim TRec As ADODB.Command
Dim LScript As String
LScript = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_SCRIPTMASTER"
TRec.Parameters.Append TRec.CreateParameter("EX_SYMBOL", adVarChar, adParamInput, 50, LPExSymbol)
TRec.Parameters.Append TRec.CreateParameter("MATURITY", adDBTimeStamp, adParamInput, , LPMaturity)
TRec.Parameters.Append TRec.CreateParameter("LEXCODE", adVarChar, adParamInput, 10, LPExCode)
TRec.Parameters.Append TRec.CreateParameter("INSTTYPE", adVarChar, adParamInput, 3, LPInstType)
TRec.Parameters.Append TRec.CreateParameter("OPTTYPE", adVarChar, adParamInput, 3, LPOptType)
TRec.Parameters.Append TRec.CreateParameter("STRIKEPRICE", adDouble, adParamInput, , LPStrike)
TRec.Parameters.Append TRec.CreateParameter("LPSAUDACODE", adVarChar, adParamOutput, 50, LScript)
TRec.Execute
LScript = TRec("LPSAUDACODE")
Get_ScriptMaster = LScript
End Function

Public Sub PInsert_Saudamast(LGSaudaCode As String, LGSaudaName As String, LGItemCode As String, LGMaturity As Date, LGTradeableLot As Double, LGBrokLot As Double, LGNoCode As Long, LGInstType As String, LGOptType As String, LGStrike As Double, LGExCode As String, LGRefLot As Double, LGExID As Integer, LGItemid As Integer)
mysql = "EXEC INSERT_SAUDAMAST " & GCompCode & ",'" & LGSaudaCode & "','" & LGSaudaName & "','" & LGItemCode & "','" & Format(LGMaturity, "yyyy/MM/dd") & "'," & LGTradeableLot & "," & LGBrokLot & "," & LGNoCode & ",'" & LGInstType & "','" & LGOptType & "'," & LGStrike & ",'" & LGExCode & "'," & LGRefLot & "," & LGExID & "," & LGItemid & ""
Cnn.Execute mysql
End Sub

Public Sub PInsert_ItemMast(ByVal LIItemCode As String, ByVal LIItemName As String, ByVal LILot As Double, ByVal LIExhCode As String, ByVal LIExchanageCode As String, ByVal LIPriceUnit As String, ByVal LIQtyUnit As String, LIRegularLot As Double, ByVal LIScGroup As String, ByVal LICTTApp As String, ByVal LIRiskMApp As String, ByVal LIStmApp As String, ByVal LICTTDate As Date, LIExID As Integer)
If LenB(LIExchanageCode) < 1 Then
    MsgBox " Exchnage Code  Blank " & LIItemCode & ""
    Exit Sub
Else
    mysql = "EXEC INSERT_ITEMMAST " & GCompCode & ",'" & LIItemCode & "','" & LIItemName & "'," & LILot & ",'" & LIExhCode & "','" & LIExchanageCode & "','" & LIPriceUnit & "','" & LIQtyUnit & "'," & LIRegularLot & ",'" & LIScGroup & "','" & LICTTApp & "','" & LIRiskMApp & "','" & LIStmApp & "','" & Format(LICTTDate, "YYYY/MM/DD") & "'," & LIExID & ""
    
    Cnn.Execute mysql
End If
End Sub

Public Function Get_LotSize(ByVal LGItemid As Integer, ByVal LGSaudaID As Long, ByVal LGExID As Integer) As Double
Dim TRec As ADODB.Command
Dim TLot As Double
TLot = 1
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_LOT"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LGSaudaID)
TRec.Parameters.Append TRec.CreateParameter("ITEMID", adInteger, adParamInput, , LGItemid)
TRec.Parameters.Append TRec.CreateParameter("LEXID", adInteger, adParamInput, , LGExID)
TRec.Parameters.Append TRec.CreateParameter("LXLOT", adDouble, adParamOutput, , TLot)
TRec.Execute
TLot = TRec("LXLOT")
Get_LotSize = TLot
End Function

Public Function Get_ACCT_EX(ByVal LCExID As Integer, ByVal LCAcExCode As String) As String
Dim TRec As ADODB.Command
Dim TAc_Code As String
TAc_Code = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_ACCT_EX"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LCExID)
TRec.Parameters.Append TRec.CreateParameter("ACEXCODE", adVarChar, adParamInput, 30, LCAcExCode)
TRec.Parameters.Append TRec.CreateParameter("PAC_CODE", adVarChar, adParamOutput, 15, TAc_Code)
TRec.Execute
TAc_Code = TRec("PAC_CODE")
Get_ACCT_EX = TAc_Code
End Function
Public Sub Delete_CTR_R(LRConDate As Date, LRExID As Integer)
    mysql = "EXEC DELETE_CTR_R " & GCompCode & ",'" & Format(LRConDate, "YYYY/MM/DD") & "'," & LRExID & ""
    Cnn.Execute mysql
End Sub

Public Sub Delete_Inv_D(ByVal LXParties As String, ByVal LXExCodes As String, ByVal LXSaudas As String, ByVal LXDate As Date)
Dim TRec As ADODB.Recordset
Dim LExRec As ADODB.Recordset
On Error GoTo err1
'LXSaudas = ""

GBillParties = LXParties
GExIDs = LXExCodes
GMinBillDate = LXDate

''''
If LenB(LXExCodes) < 1 And Len(LXSaudas) > 1 Then
    mysql = "SELECT DISTINCT EXID FROM SAUDAMAST WHERE "
    mysql = mysql & "SAUDAID IN (" & LXSaudas & ") AND COMPCODE = " & GCompCode & " "
    
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        Do While Not TRec.EOF
            If LenB(GExIDs) > 0 Then
                GExIDs = GExIDs & "," & TRec!EXID & ""
            Else
                GExIDs = CStr(TRec!EXID)
            End If
            TRec.MoveNext
        Loop
    End If
End If

If GSysLockDt >= LXDate Then LXDate = GSysLockDt + 1
    
    mysql = "DELETE FROM VCHAMT WHERE VOU_TYPE = 'B' AND VOU_ID NOT IN (SELECT BVOU_ID FROM INV_D1)"
    Cnn.Execute mysql
    mysql = "DELETE FROM VCHAMT WHERE VOU_TYPE = 'S' AND VOU_ID NOT IN (SELECT VOU_ID FROM INV_D)"
    Cnn.Execute mysql
    mysql = "DELETE FROM VCHAMT WHERE VOU_TYPE = 'H' AND VOU_ID NOT IN (SELECT SVOU_ID FROM INV_D1)"
    Cnn.Execute mysql
    mysql = "DELETE FROM VOUCHER WHERE VOU_ID NOT IN (SELECT VOU_ID FROM VCHAMT)"
    Cnn.Execute mysql
    
    If Len(GExIDs) <= 0 And Len(LXParties) <= 0 And Len(LXSaudas) <= 0 Then
        mysql = "DELETE FROM VOUCHER WHERE COMPCODE = " & GCompCode & " AND VOU_DT >='" & Format(GMinBillDate, "yyyy/mm/dd") & "' AND VOU_TYPE IN ('S','H','B') "
        Cnn.Execute mysql
        
        mysql = " UPDATE CTR_D SET BILLNO=0 WHERE COMPCODE =" & GCompCode & " AND BILLNO IN ( SELECT DISTINCT BILLNO FROM INV_D "
        mysql = mysql & " WHERE STDATE >='" & Format(LXDate, "yyyy/mm/dd") & "' "
        
        mysql = "DELETE FROM INV_D WHERE COMPCODE = " & GCompCode & "  AND STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "' "
        Cnn.Execute mysql
        
        mysql = "DELETE FROM INV_D1 WHERE COMPCODE = " & GCompCode & "  AND STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "' "
        Cnn.Execute mysql
        Exit Sub
    End If
    Dim SVNO  As Long

    If LenB(LXParties) < 1 Then
        mysql = "SELECT DISTINCT PARTY FROM CTR_D WHERE "
        mysql = mysql & " COMPCODE = " & GCompCode & " AND CONDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "'"
        If Len(GExIDs) > 1 Then mysql = mysql & " AND EXID IN (" & GExIDs & ") "
        If LenB(LXSaudas) > 1 Then mysql = mysql & " AND SAUDAID IN (" & LXSaudas & ")"
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            Do While Not TRec.EOF
                If LenB(GBillParties) > 0 Then
                    GBillParties = GBillParties & "," & "'" & TRec!PARTY & "'"
                Else
                    GBillParties = "'" & TRec!PARTY & "'"
                End If
                TRec.MoveNext
            Loop
        Else
          '  Exit Sub
        End If
        mysql = "SELECT DISTINCT PARTY FROM INV_D  WHERE "
        mysql = mysql & " EXID IN (" & GExIDs & ") "
        If LenB(LXSaudas) > 1 Then
            mysql = mysql & " AND SAUDAID IN (" & LXSaudas & ") "
        End If
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            Do While Not TRec.EOF
                If LenB(GBillParties) > 0 Then
                    GBillParties = GBillParties & "," & "'" & TRec!PARTY & "'"
                Else
                    GBillParties = "'" & TRec!PARTY & "'"
                End If
                TRec.MoveNext
            Loop
        Else
            'Exit Sub
        End If
    End If
    
    If LenB(LXExCodes) < 1 Then
        mysql = "SELECT DISTINCT EXID FROM CTR_D WHERE "
        mysql = mysql & " CONDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "' "
        If LenB(GBillParties) Then mysql = mysql & " AND PARTY IN (" & GBillParties & ")"
        If LenB(LXSaudas) > 1 Then mysql = mysql & " AND SAUDAID IN (" & LXSaudas & ") "
        mysql = mysql & " AND COMPCODE = " & GCompCode & " "

        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            Do While Not TRec.EOF
                If LenB(GExIDs) > 0 Then
                    GExIDs = GExIDs & "," & TRec!EXID & ""
                Else
                    GExIDs = CStr(TRec!EXID)
                End If
                TRec.MoveNext
            Loop
        End If
    End If
    If Len(GExIDs) <= 0 Then
        Exit Sub
    End If
    

    mysql = "DELETE FROM VOUCHER WHERE VOU_ID IN (SELECT DISTINCT VOU_ID FROM INV_D WHERE STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "'"
    If LenB(GBillParties) > 1 Then mysql = mysql & " AND PARTY IN (" & GBillParties & ")"
    mysql = mysql & " AND EXID IN (" & GExIDs & "))"
    Cnn.Execute mysql

    mysql = " UPDATE CTR_D SET BILLNO=0 WHERE COMPCODE =" & GCompCode & " AND BILLNO IN ( SELECT DISTINCT BILLNO FROM INV_D "
    mysql = mysql & " WHERE STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "' "
    If LenB(GBillParties) > 1 Then mysql = mysql & " AND PARTY IN (" & GBillParties & ")"
    If LenB(LXSaudas) > 1 Then mysql = mysql & "  AND SAUDAID IN (" & LXSaudas & ")"
    mysql = mysql & " AND EXID IN (" & GExIDs & "))"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM INV_D WHERE STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "' "
    If LenB(GBillParties) > 1 Then mysql = mysql & " AND PARTY IN (" & GBillParties & ")"
    If LenB(LXSaudas) > 1 Then mysql = mysql & "  AND SAUDAID IN (" & LXSaudas & ")"
    mysql = mysql & " AND EXID IN (" & GExIDs & ")"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM VOUCHER WHERE VOU_ID IN (SELECT DISTINCT SVOU_ID FROM INV_D1 WHERE STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "'"
    If LenB(GBillParties) > 1 Then mysql = mysql & " AND PARTY IN (" & GBillParties & ") "
    mysql = mysql & " AND EXID IN (" & GExIDs & "))"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM VOUCHER WHERE VOU_ID IN (SELECT DISTINCT BVOU_ID FROM INV_D1 WHERE STDATE >='" & Format(GMinBillDate, "yyyy/mm/dd") & "'"
    If LenB(GBillParties) > 1 Then mysql = mysql & " AND PARTY IN (" & GBillParties & ") "
    mysql = mysql & " AND EXID IN (" & GExIDs & "))"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM INV_D1 WHERE COMPCODE =" & GCompCode & "  AND STDATE >='" & Format(LXDate, "yyyy/mm/dd") & "' "
    If LenB(GBillParties) > 1 Then mysql = mysql & " AND PARTY IN (" & GBillParties & ")"
    If LenB(LXSaudas) > 0 Then mysql = mysql & "  AND SAUDAID IN (" & LXSaudas & ")"
    mysql = mysql & " AND EXID IN (" & GExIDs & ")"
    Cnn.Execute mysql

    ''' New Delete
    mysql = "DELETE from vchamt where vou_type = 'S' AND vou_id not in (select vou_id from inv_d)"
    Cnn.Execute mysql
    mysql = "DELETE from vchamt where vou_type = 'B' AND vou_id not in (select Bvou_id from inv_d1)"
    Cnn.Execute mysql
    mysql = "DELETE from vchamt where vou_type = 'H' AND vou_id not in (select Svou_id from inv_d1)"
    Cnn.Execute mysql

    Exit Sub
err1:
MsgBox err.Description
End Sub
Public Sub Update_BrokTran(ByVal LYParties As String, ByVal LYExCodes As String, ByVal LYItems As String, ByVal LYSaudas As String, ByVal LYFromDate As Date, ByVal LYToDate As Date)
    On Error GoTo err1
    Dim TRec As ADODB.Recordset
    Dim TRec1 As ADODB.Recordset
    Dim LBParties As String
    LBParties = LYParties
    
    If DateValue(GSysLockDt) > DateValue(LYFromDate) Then LYFromDate = GSysLockDt + 1
    If LenB(LBParties) < 1 Then
        mysql = " SELECT DISTINCT PARTY FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND CONDATE >='" & Format(LYFromDate, "YYYY/MM/DD") & "'"
        If LenB(LYExCodes) > 0 Then mysql = mysql & " AND EXID  IN (" & LYExCodes & ")  "
        If LenB(LYItems) > 0 Then mysql = mysql & " AND ITEMID  IN (" & LYItems & ")"
        If LenB(LYSaudas) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LYSaudas & ")"
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            Do While Not TRec.EOF
                If LenB(LBParties) > 0 Then
                    LBParties = LBParties & ",'" & TRec!PARTY & "'"
                Else
                    LBParties = "'" & TRec!PARTY & "'"
                End If
                TRec.MoveNext
            Loop
        End If
    End If
    
    mysql = "UPDATE CTR_D SET BrokType= '0', TRANTYPE = '0' WHERE COMPCODE  = " & GCompCode & " "
    If LenB(LYParties) > 0 Then mysql = mysql & " AND PARTY  IN (" & LBParties & ") "
    If LenB(LYExCodes) > 0 Then mysql = mysql & " AND EXID  IN  (" & LYExCodes & ") "
    If LenB(LYSaudas) > 0 Then mysql = mysql & " AND SAUDAID IN (" & LYSaudas & ") "
    mysql = mysql & " AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' AND CONDATE <='" & Format(LYToDate, "yyyy/MM/dd") & "' AND INVNO = 0"
    Cnn.CommandTimeout = 600
    Cnn.Execute mysql
    Cnn.CommandTimeout = 300
    
    mysql = "SELECT DISTINCT P.ITEMID,P.AC_CODE,P.ACCID,P.BrokRate,P.BrokType,P.BrokRate2,P.TranRate,P.TranType,P.UPTOSTDT,P.ITEMCODE, P.MINRATE,P.MBROKTYPE,P.MBROKRATE,P.MBROKRATE2,P.INSTTYPE "
    mysql = mysql & " FROM PITBROK AS P ,CTR_D AS CD WHERE P.ACCID = CD.ACCID  AND P.ITEMID = CD.ITEMID "
    If LenB(LYParties) > 0 Then mysql = mysql & "AND P.AC_CODE IN (" & LBParties & ") "
    If LenB(LYExCodes) > 0 Then mysql = mysql & " AND P.EXID IN  (" & LYExCodes & ") "
    If LenB(LYFromDate) > 0 Then mysql = mysql & "AND P.UPTOSTDT >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' "
    mysql = mysql & "ORDER BY P.AC_CODE,P.ITEMCODE,P.UPTOSTDT"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset:
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        While Not TRec.EOF
            If TRec!MinRate <> 0 And TRec!MBROKTYPE <> "F" Then
                mysql = "UPDATE CTR_D SET TRANRATE=" & TRec!TRANRATE & ", TRANTYPE='" & TRec!TRANTYPE & "'"
                mysql = mysql & " WHERE TRANTYPE = '0' AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' "
                mysql = mysql & " AND ACCID = " & TRec!ACCID & " "
                mysql = mysql & " AND ITEMID = " & TRec!itemid & " AND INVNO = 0 AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND INSTTYPE='" & TRec!INSTTYPE & "' "
                
                mysql = "UPDATE CTR_D SET "
                mysql = mysql & " BrokRate = " & TRec!brokrate & ", BrokType = '" & TRec!broktype & "', BrokRate2 = " & IIf(IsNull(TRec!BROKRATE2), 0, TRec!BROKRATE2) & ""
                mysql = mysql & " WHERE  BROKTYPE = '0' AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' "
                mysql = mysql & " AND RATE >" & TRec!MinRate & " AND ACCID = " & TRec!ACCID & " "
                mysql = mysql & " AND ITEMID = " & TRec!itemid & " AND INVNO = 0 AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND INSTTYPE='" & TRec!INSTTYPE & "' AND BROKFLAG='Y' "
                Cnn.Execute mysql
                mysql = "UPDATE CTR_D SET "
                mysql = mysql & " BrokRate = " & TRec!MBROKRATE & ", BrokType = '" & TRec!MBROKTYPE & "', BrokRate2 = " & IIf(IsNull(TRec!MBROKRATE2), 0, TRec!MBROKRATE2) & ""
                mysql = mysql & " WHERE BROKTYPE = '0' AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' "
                mysql = mysql & " AND RATE <=" & TRec!MinRate & " AND ACCID  = " & TRec!ACCID & " "
                mysql = mysql & " AND ITEMID  = " & TRec!itemid & " AND INVNO = 0 AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND INSTTYPE='" & TRec!INSTTYPE & "' AND BROKFLAG='Y'"
                Cnn.Execute mysql
            Else
                mysql = "EXEC UPDATE_IT_BROKTRAN " & TRec!itemid & "," & TRec!ACCID & ",'" & TRec!INSTTYPE & "','" & TRec!broktype & "'," & TRec!brokrate & ""
                mysql = mysql & " ," & TRec!BROKRATE2 & ",'" & TRec!TRANTYPE & "'," & TRec!TRANRATE & ",'" & Format(LYFromDate, "YYYY/MM/DD") & "','" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
            End If
            DoEvents
            GETMAIN.Label1.Caption = "Updating Itemwise Brokerage Rate for :" & TRec!AC_CODE & " " & TRec!ITEMCODE
            TRec.MoveNext
        Wend
   End If
   Set TRec = Nothing
    mysql = "SELECT DISTINCT P.EXID,P.EXCODE,P.ACCID,P.AC_CODE,P.BrokRate,P.BrokType,P.BrokRate2,P.TranRate,P.TranType,P.UPTOSTDT,"
    mysql = mysql & " P.INSTTYPE,P.MINRATE,P.MBROKTYPE,P.MBROKRATE,P.MBROKRATE2 "
    mysql = mysql & " FROM PEXBROK AS P WHERE P.COMPCODE = " & GCompCode & " "
    If LenB(LYParties) > 0 Then mysql = mysql & "AND P.AC_CODE IN (" & LBParties & ") "
    If LenB(LYExCodes) > 0 Then mysql = mysql & " AND P.EXID IN  (" & LYExCodes & ") "
    If LenB(LYFromDate) > 0 Then mysql = mysql & "AND P.UptoStdt >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' "
    mysql = mysql & " ORDER BY P.AC_CODE,P.UPTOSTDT"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset:
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        While Not TRec.EOF
            If TRec!MinRate <> 0 And TRec!MBROKTYPE <> "F" Then
                mysql = "UPDATE CTR_D SET TRANRATE=" & TRec!TRANRATE & ",TRANTYPE='" & TRec!TRANTYPE & "'"
                mysql = mysql & " WHERE TRANTYPE = '0' "
                mysql = mysql & " AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' AND ACCID = " & TRec!ACCID & ""
                mysql = mysql & " AND INVNO = 0 AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND EXID =" & TRec!EXID & " AND INSTTYPE='" & TRec!INSTTYPE & "'"
                Cnn.Execute mysql
                
                mysql = "UPDATE CTR_D SET  BrokRate = " & TRec!brokrate & ""
                mysql = mysql & ",BROKTYPE ='" & TRec!broktype & "', BrokRate2 = " & IIf(IsNull(TRec!BROKRATE2), 0, TRec!BROKRATE2) & ""
                mysql = mysql & " WHERE RATE >" & TRec!MinRate & " AND BROKTYPE = '0' "
                mysql = mysql & " AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' AND ACCID = " & TRec!ACCID & ""
                mysql = mysql & " AND INVNO = 0 AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND EXID =" & TRec!EXID & " AND INSTTYPE='" & TRec!INSTTYPE & "' AND BROKFLAG='Y'"
                Cnn.Execute mysql

                mysql = "UPDATE CTR_D SET BrokRate = "
                mysql = mysql & TRec!MBROKRATE & ", BrokType = '" & TRec!MBROKTYPE & "', BrokRate2 = " & IIf(IsNull(TRec!MBROKRATE2), 0, TRec!MBROKRATE2) & ""
                mysql = mysql & " WHERE RATE<=" & TRec!MinRate & " AND BROKTYPE = '0' "
                mysql = mysql & " AND CONDATE >= '" & Format(LYFromDate, "yyyy/MM/dd") & "' AND ACCID = " & TRec!ACCID & ""
                mysql = mysql & " AND INVNO = 0 AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                mysql = mysql & " AND EXID =" & TRec!EXID & " AND INSTTYPE='" & TRec!INSTTYPE & "' AND BROKFLAG='Y'"
                Cnn.Execute mysql
            Else
                mysql = "EXEC UPDATE_EX_BROKTRAN " & TRec!EXID & "," & TRec!ACCID & ",'" & TRec!INSTTYPE & "','" & TRec!broktype & "'," & TRec!brokrate & ""
                mysql = mysql & " ," & TRec!BROKRATE2 & ",'" & TRec!TRANTYPE & "'," & TRec!TRANRATE & ",'" & Format(LYFromDate, "YYYY/MM/DD") & "','" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
            End If
            DoEvents
            GETMAIN.Label1.Caption = "Updating Exchange Wise Brokerage Rate for :" & TRec!AC_CODE
            TRec.MoveNext
        Wend
    End If
    Set TRec = Nothing
    Set TRec1 = Nothing
    DoEvents
    GETMAIN.Label1.Caption = "Exchange Wise Brokerage Rate Completed "
    Exit Sub
err1:
    MsgBox err.Description
      If CNNERR = True Then
     Cnn.RollbackTrans
    End If
End Sub
Public Function Get_AccountDCode(ByVal LXAcCode As String) As String
    Dim TRec As ADODB.Command
    Dim LAccount As String
    LAccount = vbNullString
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
    TRec.CommandText = "GET_ACCOUNTD_CODE"
    TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
    TRec.Parameters.Append TRec.CreateParameter("AC_CODE", adVarChar, adParamInput, 15, LXAcCode)
    TRec.Parameters.Append TRec.CreateParameter("PAC_CODE", adVarChar, adParamOutput, 15, LAccount)
    TRec.Execute
    LAccount = TRec("PAC_CODE")
    Get_AccountDCode = LAccount
End Function

Public Function Get_PartyMulti(ByVal LXParty As Long, LXItem As Integer, LXEXID As Integer) As Double
Dim TRec As ADODB.Command
Dim LXRate As Double
LXRate = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_Multi"
TRec.Parameters.Append TRec.CreateParameter("PARTY", adInteger, adParamInput, , LXParty)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LXEXID)
TRec.Parameters.Append TRec.CreateParameter("ITEMID", adInteger, adParamInput, , LXItem)
TRec.Parameters.Append TRec.CreateParameter("LRATE", adDouble, adParamOutput, , LXRate)
TRec.Execute
LXRate = TRec("LRATE")
Get_PartyMulti = LXRate
End Function

Public Function Get_MAXVNO() As Long
Dim TRec As ADODB.Command
Dim LMVNo  As Long
LMVNo = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_MAXVNO"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("Mp", adBigInt, adParamOutput, , LMVNo)
TRec.Execute
LMVNo = TRec("MVNO")
Get_MAXVNO = LMVNo
End Function



Public Function Get_RiskMRate(ByVal LXEXID As Integer, ByVal LXItemID As Integer, ByVal LXFromDate As Date, ByVal LXToDate As Date) As Double
Dim TRec As ADODB.Command
Dim LRATE As Double
LRATE = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_RiskMRate"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LXEXID)
TRec.Parameters.Append TRec.CreateParameter("ITEMID", adInteger, adParamInput, 20, LXItemID)
TRec.Parameters.Append TRec.CreateParameter("FROMDATEE", adDBTimeStamp, adParamInput, , LXFromDate)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , LXFromDate)
TRec.Parameters.Append TRec.CreateParameter("LPRATE", adDouble, adParamOutput, , LRATE)
TRec.Execute
LRATE = TRec("LPRATE")
Get_RiskMRate = LRATE
End Function

Public Function Get_PEXBROK_AC_CODE(ByVal LXAcCode As Long, ByVal LXEXID As Integer, ByVal LXUptoDate As Date, ByVal LXInstType As String) As String
Dim TRec As ADODB.Command
Dim LAccount As String
LAccount = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_PEXBROK_AC_CODE"
TRec.Parameters.Append TRec.CreateParameter("INSTTYPE", adVarChar, adParamInput, 3, LXInstType)
TRec.Parameters.Append TRec.CreateParameter("AC_CODE", adInteger, adParamInput, , LXAcCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LXEXID)
TRec.Parameters.Append TRec.CreateParameter("UPTOSTDT", adDBTimeStamp, adParamInput, , LXUptoDate)
TRec.Parameters.Append TRec.CreateParameter("LPAC_CODE", adVarChar, adParamOutput, 6, LAccount)
TRec.Execute
LAccount = TRec("LPAC_CODE")
Get_PEXBROK_AC_CODE = LAccount
End Function

Public Function Get_PEXSBROK_AC_CODE(ByVal LXFmlyCode As Long, ByVal LXAcCode As Long, ByVal LXEXID As Integer, ByVal LXUptoDate As Date, ByVal LXInstType As String) As String
'MYSQL = " CREATE PROCEDURE Get_PEXBROK_AC_CODE @COMPCODE INT,@INSTTYPE VARCHAR(3),@AC_CODE VARCHAR(6),@EXCODE VARCHAR(10),@UPTOSTDT SMALLDATETIME ,@LPAC_CODE VARCHAR(6) OUTPUT "
Dim TRec As ADODB.Command
Dim LAccount As String
LAccount = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "Get_PEXSBROK_AC_CODE"
TRec.Parameters.Append TRec.CreateParameter("INSTTYPE", adVarChar, adParamInput, 3, LXInstType)
TRec.Parameters.Append TRec.CreateParameter("FMLYCODE", adInteger, adParamInput, , LXFmlyCode)
TRec.Parameters.Append TRec.CreateParameter("PARTY", adInteger, adParamInput, , LXAcCode)
TRec.Parameters.Append TRec.CreateParameter("EXID", adInteger, adParamInput, , LXEXID)
TRec.Parameters.Append TRec.CreateParameter("UPTOSTDT", adDBTimeStamp, adParamInput, , LXUptoDate)
TRec.Parameters.Append TRec.CreateParameter("LPAC_CODE", adVarChar, adParamOutput, 6, LAccount)
TRec.Execute
LAccount = TRec("LPAC_CODE")
Get_PEXSBROK_AC_CODE = LAccount
End Function




Public Function Get_MaxSetNo() As Long
Dim TRec As ADODB.Command
Dim LSetNo As Long
LSetNo = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_MaxSetNo"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("SETNO", adInteger, adParamOutput, , LSetNo)
TRec.Execute
LSetNo = TRec("SETNO")
Get_MaxSetNo = LSetNo
End Function

Public Function Get_UserName(ByVal LXUserName As String, ByVal LXPasswd As String) As String
On Error GoTo err1
    Dim TRec As ADODB.Command
    Dim LUserName As String
    LUserName = vbNullString
    Set TRec = Nothing: Set TRec = New ADODB.Command
    Set TRec.ActiveConnection = Cnn
    TRec.CommandType = adCmdStoredProc
    TRec.CommandText = "Get_UserName"
    TRec.Parameters.Append TRec.CreateParameter("USERNAME", adVarChar, adParamInput, 12, LXUserName)
    TRec.Parameters.Append TRec.CreateParameter("PASSWD", adVarChar, adParamInput, 12, LXPasswd)
    TRec.Parameters.Append TRec.CreateParameter("PUSERNAME", adVarChar, adParamOutput, 12, LUserName)
    TRec.Execute
    LUserName = TRec("PUSERNAME")
    Get_UserName = LUserName
err1:
If err.Number <> 0 Then
    MsgBox "Get UserName:" & Cnn.State & "--" & err.Description
End If
End Function

Public Function Get_AccountName(ByVal LXAcCode As Long, Optional LCompCnn As String) As String
Dim TRec As ADODB.Command
Dim LAccount As String
LAccount = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command

If Len(LCompCnn) = 0 Then
    Set TRec.ActiveConnection = Cnn
Else
    Set TRec.ActiveConnection = CompCnn
End If

TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_AC_NAME"
TRec.Parameters.Append TRec.CreateParameter("AC_CODE", adInteger, adParamInput, 15, LXAcCode)
TRec.Parameters.Append TRec.CreateParameter("LNAME", adVarChar, adParamOutput, 100, LAccount)
TRec.Execute
LAccount = TRec("LNAME")
Get_AccountName = LAccount
End Function

Public Function Get_AccountMCode(ByVal LXAcCode As String) As String
Dim TRec As ADODB.Command
Dim LAccount As String
LAccount = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_ACCOUNTM_CODE"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("AC_CODE", adVarChar, adParamInput, 15, LXAcCode)
TRec.Parameters.Append TRec.CreateParameter("PAC_CODE", adVarChar, adParamOutput, 15, LAccount)
TRec.Execute
LAccount = TRec("PAC_CODE")
Get_AccountMCode = LAccount
End Function




Public Function Get_NextDate(ByVal LXParty As Long, ByVal LXSaudaID As Long, ByVal LXCondate As Date) As String
Dim TRec As ADODB.Command
Dim ldate As String
ldate = vbNullString
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_NEXTDATE"
TRec.Parameters.Append TRec.CreateParameter("COMPCODE", adInteger, adParamInput, , GCompCode)
TRec.Parameters.Append TRec.CreateParameter("PARTY", adInteger, adParamInput, , LXParty)
TRec.Parameters.Append TRec.CreateParameter("SAUDAID", adInteger, adParamInput, , LXSaudaID)
TRec.Parameters.Append TRec.CreateParameter("CONDATE", adDBTimeStamp, adParamInput, , LXCondate)
TRec.Parameters.Append TRec.CreateParameter("LNDATE", adVarChar, adParamOutput, 20, ldate)
TRec.Execute
ldate = TRec("LNDATE")
Get_NextDate = ldate
End Function


'Public Sub Chk_Billing()
'On Error GoTo ERR1
'Dim LSParties As String:        Dim LSSaudas As String:      Dim LCondate  As Date
'Dim LCloseRate As Double:       Dim TRec As ADODB.Recordset
'Dim LMaxCondate  As Date
'
'LSParties = vbNullString:   LSSaudas = vbNullString
'LCondate = Date
'Dim LExIDS As String
'LMaxCondate = DateValue(GFinEnd) + 1
'MYSQL = "SELECT MAX(CONDATE)AS MDT FROM CTR_R WHERE COMPCODE =" & GCompCode & ""
'Set TRec = Nothing
'Set TRec = New ADODB.Recordset
'TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'If Not TRec.EOF Then
'    If Not IsNull(TRec!MDt) Then LMaxCondate = TRec!MDt
'End If
'
'
'MYSQL = "DELETE  FROM VOUCHER WHERE VOU_TYPE='S' AND VOU_ID NOT IN (SELECT DISTINCT VOU_ID FROM INV_D WHERE VOU_ID <>0 )"
'Cnn.Execute MYSQL
'
'MYSQL = "DELETE  FROM VOUCHER WHERE VOU_TYPE='H' AND VOU_ID NOT IN (SELECT DISTINCT SVOU_ID FROM INV_D1 WHERE SVOU_ID <>0 )"
'Cnn.Execute MYSQL
'
'MYSQL = "DELETE  FROM VOUCHER WHERE VOU_TYPE='B' AND VOU_ID NOT IN (SELECT DISTINCT BVOU_ID FROM INV_D1 WHERE BVOU_ID <>0 )"
'Cnn.Execute MYSQL
'
''TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
''If Not TRec.EOF Then
''    MsgBox "Pls Call Sauda Support Staff Billing problem"
''    Exit Sub
''End If
''
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''MYSQL = "SELECT VOU_ID FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE='H' AND VOU_ID NOT IN (SELECT DISTINCT SVOU_ID FROM INV_D1 WHERE COMPCODE =" & GCompCode & " AND SAMOUNT <>0 )"
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
''If Not TRec.EOF Then
''    MsgBox "Pls Call Sauda Support Staff Sharing Problem"
''    Exit Sub
''End If
''
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''MYSQL = "SELECT VOU_ID FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE='B' AND VOU_ID NOT IN (SELECT DISTINCT BVOU_ID FROM INV_D1 WHERE COMPCODE =" & GCompCode & " AND AMOUNT <>0 )"
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
''If Not TRec.EOF Then
''    MsgBox "Pls Call Sauda Support Staff Brok Sharing Problem"
''    Exit Sub
''End If
''
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''MYSQL = "SELECT VOU_ID FROM INV_D  WHERE COMPCODE =" & GCompCode & " AND ABS(DIFFAMT)+ABS(BROKAMT)+ ABS(BILLAMT) <> 0 AND VOU_ID NOT IN (SELECT DISTINCT VOU_ID FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE='S' )"
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
''If Not TRec.EOF Then
''    MsgBox "Pls Call Sauda Support Staff Billing Problem"
''    Exit Sub
''End If
''
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''MYSQL = "SELECT SVOU_ID FROM INV_D1  WHERE COMPCODE =" & GCompCode & " AND SVOU_ID<>0  AND SVOU_ID NOT IN (SELECT DISTINCT VOU_ID FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE='H' )"
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
''If Not TRec.EOF Then
''    MsgBox "Pls Call Sauda Support Staff sharing  Problem"
''    Exit Sub
''End If
''
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''MYSQL = "SELECT BVOU_ID FROM INV_D1  WHERE COMPCODE =" & GCompCode & " AND AMOUNT <>0 AND BVOU_ID NOT IN (SELECT DISTINCT VOU_ID FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE='B' )"
''Set TRec = Nothing:     Set TRec = New ADODB.Recordset
''TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
''If Not TRec.EOF Then
''    MsgBox "Pls Call Sauda Support Staff Billing Problem"
''    Exit Sub
''End If
'Set TRec = Nothing:     Set TRec = New ADODB.Recordset
'MYSQL = "SELECT DISTINCT EXID,PARTY ,CONDATE, SAUDAID FROM CTR_D WHERE CompCode =" & GCompCode & " AND BILLNO =0 AND PATTAN <>'O' "
'MYSQL = MYSQL & " AND CONDATE <'" & Format(LMaxCondate, "YYYY/MM/DD") & "'ORDER BY PARTY, SAUDAID"
'TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'If Not TRec.EOF Then
'    Do While Not TRec.EOF
'        'LCloseRate = 0
'        'LCloseRate = SDCLRATE(TRec!SAUDAID, TRec!Condate, "C")
'        'If LCloseRate <> 0 Then
'        If LCondate > TRec!Condate Then LCondate = TRec!Condate
'        If LenB(LSParties) < 1 Then
'            LSParties = "'" & TRec!PARTY & "'"
'        Else
'            If InStr(LSParties, "'" & TRec!PARTY & "'") < 1 Then
'                LSParties = LSParties & ",'" & TRec!PARTY & "'"
'            End If
'        End If
'
'        If LenB(LSSaudas) < 1 Then
'            LSSaudas = "" & TRec!SAUDAID & ""
'        Else
'            If LStr_Exists(LSSaudas, Trim(Str(TRec!SAUDAID))) = False Then
'                LSSaudas = LSSaudas & "," & Trim(Str(TRec!SAUDAID)) & ""
'            End If
'        End If
'        If LenB(LExIDS) < 1 Then
'            LExIDS = "" & TRec!EXID & ""
'        Else
'            If LStr_Exists(LExIDS, Trim(Str(TRec!EXID))) = False Then
'                LExIDS = LExIDS & "," & Trim(Str(TRec!EXID)) & ""
'            End If
'        End If
'        TRec.MoveNext
'    Loop
'End If
'If LenB(LSParties) > 0 Then
'
'    'MsgBox "Re Billling Missed Parties"
'    Cnn.BeginTrans
'    CNNERR = True
'    If BILL_GENERATION(LCondate, GFinEnd, LSSaudas, LSParties, LExIDS) Then
'        Cnn.CommitTrans
'        CNNERR = False
'    Else
'        Cnn.RollbackTrans
'        CNNERR = False
'    End If
'    'Call Chk_Trading
'End If
'
'Exit Sub
'ERR1:
'    If err.Number <> 0 Then
'        MsgBox err.Description
'        If CNNERR = True Then
'
'            Cnn.RollbackTrans
'            CNNERR = False
'        End If
'
'    End If
'End Sub
Public Sub Update_Charges(ByVal LTParties As String, ByVal LTEXcodes As String, ByVal LTSaudas As String, ByVal LTItems As String, ByVal LTFromDate As Date, ByVal LTTodate As Date, ByVal LCNoteYN As Boolean)
    If GSysLockDt >= LTFromDate Then
        LTFromDate = GSysLockDt + 1
    End If
    If LCNoteYN = True Then
        If GAppCnote = "1" Then Call Update_Contract_No(CStr(LTFromDate))
    End If
    
    If GMarginYN = "Y" Then Call UpdateMargin(LTItems, LTParties, LTFromDate, LTTodate, LTEXcodes)
    
    If GOnlyBrok = 0 Then Call Updt_SrvTax(LTParties, LTEXcodes, LTSaudas, LTFromDate, LTTodate)
    
    Call Update_BrokTran(LTParties, LTEXcodes, LTItems, LTSaudas, LTFromDate, LTTodate)
    
    Call Updt_BrokEXQty(LTParties, LTEXcodes, LTSaudas, LTFromDate, LTItems)
    
    Call UpdateBrokRateType(LTParties, LTItems, LTFromDate, LTTodate, LTSaudas, LTEXcodes)
    
End Sub
Public Sub Chk_Brok(LFDate As Date)
Dim TRec As ADODB.Recordset
Dim TRec2 As ADODB.Recordset
Dim BrokChk  As Boolean
mysql = "UPDATE CTR_D SET UPDBROK = 0 WHERE COMPDCODE=" & GCompCode & " AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "'"
mysql = "SELECT AC_CODE,INSTTYPE,ITEMCODE,BROKTYPE,BROKRATE,BROKRATE2,MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2,UPTOSTDT FROM PITBROK "
mysql = mysql & " WHERE COMPCODE =" & GCompCode & " AND UPTOSTDT>='" & Format(LFDate, "YYYY/MM/DD") & "' ORDER BY AC_CODE,INSTTYPE,ITEMCODE,UPTOSTDT"
Set TRec = Nothing
Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
Do While Not TRec.EOF
    If TRec!MinRate = 0 Then
        mysql = "UPDATE CTR_D SET UPDBROK = 1 WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='" & TRec!INSTTYPE & "'"
        mysql = mysql & " AND ITEMCODE ='" & TRec!ITEMCODE & "'  AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND BROKTYPE='" & TRec!broktype & "'"
        mysql = mysql & " AND BROKRATE =" & TRec!brokrate & "  AND BROKRATE2=" & TRec!BROKRATE2 & ""
        Cnn.Execute mysql
    Else
        mysql = "UPDATE CTR_D SET UPDBROK = 1 WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='" & TRec!INSTTYPE & "'"
        mysql = mysql & " AND ITEMCODE ='" & TRec!ITEMCODE & "'  AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND BROKTYPE='" & TRec!broktype & "'"
        mysql = mysql & " AND BROKRATE =" & TRec!brokrate & "  AND BROKRATE2=" & TRec!BROKRATE2 & " AND RATE >MINRATE"
        Cnn.Execute mysql
        mysql = "UPDATE CTR_D SET UPDBROK = 1 WHERE COMPCODE =" & GCompCode & " AND PARTY='" & TRec!AC_CODE & "' AND INSTTYPE ='" & TRec!INSTTYPE & "'"
        mysql = mysql & " AND ITEMCODE ='" & TRec!ITEMCODE & "'  AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND BROKTYPE='" & TRec!MBROKTYPE & "'"
        mysql = mysql & " AND BROKRATE =" & TRec!MBROKRATE & "  AND BROKRATE2=" & TRec!MBROKRATE2 & " AND RATE <MINRATE"
        Cnn.Execute mysql
    End If
    mysql = "SELECT CONDATE,CONNO,SAUDA FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND ITEMCODE ='" & TRec!ITEMCODE & "' AND PARTY ='" & TRec!AC_CODE & "'"
    mysql = mysql & " AND INSTTYPE ='" & TRec!INSTTYPE & "' AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND UPDBROK =0"
    Set TRec2 = Nothing
    Set TRec2 = New ADODB.Recordset
    TRec2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec2.EOF
        MsgBox " Check Brokerage  " & TRec2!Condate & " " & TRec2!Sauda & " " & TRec!AC_CODE & " TradeNo  " & TRec2!CONNO & " "
        TRec2.MoveNext
    Loop
    TRec.MoveNext
Loop
mysql = "SELECT AC_CODE,INSTTYPE,EXCODE ,BROKTYPE,BROKRATE,BROKRATE2,MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2,UPTOSTDT FROM PEXBROK "
mysql = mysql & " WHERE COMPCODE =" & GCompCode & " AND UPTOSTDT>='" & Format(LFDate, "YYYY/MM/DD") & "' ORDER BY AC_CODE,INSTTYPE,EXCODE,UPTOSTDT"
Set TRec = Nothing
Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
Do While Not TRec.EOF
    If TRec!MinRate = 0 Then
        mysql = "UPDATE CTR_D SET UPDBROK = 1 WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='" & TRec!INSTTYPE & "'"
        mysql = mysql & " AND ITEMCODE ='" & TRec!ITEMCODE & "'  AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND BROKTYPE='" & TRec!broktype & "'"
        mysql = mysql & " AND BROKRATE =" & TRec!brokrate & "  AND BROKRATE2=" & TRec!BROKRATE2 & " AND UPDBROK=0 "
        Cnn.Execute mysql
    Else
        mysql = "UPDATE CTR_D SET UPDBROK = 1 WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & TRec!AC_CODE & "' AND INSTTYPE ='" & TRec!INSTTYPE & "'"
        mysql = mysql & " AND ITEMCODE ='" & TRec!ITEMCODE & "'  AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND BROKTYPE='" & TRec!broktype & "'"
        mysql = mysql & " AND BROKRATE =" & TRec!brokrate & "  AND BROKRATE2=" & TRec!BROKRATE2 & " AND RATE >MINRATE"
        Cnn.Execute mysql
        mysql = "UPDATE CTR_D SET UPDBROK = 1 WHERE COMPCODE =" & GCompCode & " AND PARTY='" & TRec!AC_CODE & "' AND INSTTYPE ='" & TRec!INSTTYPE & "'"
        mysql = mysql & " AND ITEMCODE ='" & TRec!ITEMCODE & "'  AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND BROKTYPE='" & TRec!MBROKTYPE & "'"
        mysql = mysql & " AND BROKRATE =" & TRec!MBROKRATE & "  AND BROKRATE2=" & TRec!MBROKRATE2 & " AND RATE <MINRATE"
        Cnn.Execute mysql
    End If
    mysql = "SELECT CONDATE,CONNO,SAUDA FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND ITEMCODE ='" & TRec!ITEMCODE & "' AND PARTY ='" & TRec!AC_CODE & "'"
    mysql = mysql & " AND INSTTYPE ='" & TRec!INSTTYPE & "' AND CONDATE >='" & Format(LFDate, "YYYY/MM/DD") & "' AND CONDATE <='" & Format(TRec!UPTOSTDT, "YYYY/MM/DD") & "' AND UPDBROK =0"
    Set TRec2 = Nothing
    Set TRec2 = New ADODB.Recordset
    TRec2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec2.EOF
        MsgBox " Check Brokerage  " & TRec2!Condate & " " & TRec2!Sauda & " " & TRec!AC_CODE & " TradeNo  " & TRec2!CONNO & " "
        TRec2.MoveNext
    Loop
    TRec.MoveNext
Loop
End Sub
Public Function Get_BrokQty(ByVal LGBrokType As String, ByVal LGBalQty As Double, ByVal LGContype As String, ByVal LGQty As Double) As Double
    Select Case LGBrokType
    Case "A"
        If LGBalQty = 0 Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty > 0 And LGContype = "B" Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty < 0 And LGContype = "S" Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty > 0 And LGContype = "S" And Abs(LGBalQty) <= LGQty Then
            Get_BrokQty = LGQty - Abs(LGBalQty)
        ElseIf LGBalQty < 0 And LGContype = "B" And Abs(LGBalQty) <= LGQty Then
            Get_BrokQty = LGQty - Abs(LGBalQty)
        End If
    Case "O"
        If LGBalQty = 0 Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty > 0 And LGContype = "B" Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty < 0 And LGContype = "S" Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty > 0 And LGContype = "S" And Abs(LGBalQty) <= LGQty Then
            Get_BrokQty = LGQty - Abs(LGBalQty)
        ElseIf LGBalQty < 0 And LGContype = "B" And Abs(LGBalQty) <= LGQty Then
            Get_BrokQty = LGQty - Abs(LGBalQty)
        End If
    Case "C"
        If LGBalQty = 0 Then
            Get_BrokQty = 0
        ElseIf LGBalQty > 0 And LGContype = "B" Then
            Get_BrokQty = 0
        ElseIf LGBalQty < 0 And LGContype = "S" Then
            Get_BrokQty = 0
        ElseIf LGBalQty > 0 And LGContype = "S" And Abs(LGBalQty) >= LGQty Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty > 0 And LGContype = "S" And Abs(LGBalQty) < LGQty Then
            Get_BrokQty = Abs(LGBalQty)
        ElseIf LGBalQty < 0 And LGContype = "B" And Abs(LGBalQty) >= LGQty Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty < 0 And LGContype = "B" And Abs(LGBalQty) <= LGQty Then
            Get_BrokQty = Abs(LGBalQty)
        End If
        
    Case "5"
        If LGBalQty = 0 Then
            Get_BrokQty = 0
        ElseIf LGBalQty > 0 And LGContype = "B" Then
            Get_BrokQty = 0
        ElseIf LGBalQty < 0 And LGContype = "S" Then
            Get_BrokQty = 0
        ElseIf LGBalQty > 0 And LGContype = "S" And Abs(LGBalQty) >= LGQty Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty > 0 And LGContype = "S" And Abs(LGBalQty) < LGQty Then
            Get_BrokQty = Abs(LGBalQty)
        ElseIf LGBalQty < 0 And LGContype = "B" And Abs(LGBalQty) >= LGQty Then
            Get_BrokQty = LGQty
        ElseIf LGBalQty < 0 And LGContype = "B" And Abs(LGBalQty) <= LGQty Then
            Get_BrokQty = Abs(LGBalQty)
        End If
    End Select
End Function
Public Function Get_Next_Vou_No(ByVal LMaxNo As Long, ByVal LVouSeries As String, ByVal LFinYear As String) As String
    Dim LVouNo As String
    Dim I As Integer
    I = Len(Trim(str(LMaxNo)))
    LVouNo = LVouSeries & LFinYear & "-"
    LVouNo = LVouNo & String(Val(7) - Val(I), "0") & Trim(str(LMaxNo))
    Get_Next_Vou_No = LVouNo
End Function
Public Function Get_ClosingBal(ByVal LPParty As Long, ByVal LPToDate As Date) As Double
Dim TRec As ADODB.Command:
Dim LBal As Double
LBal = 0
Set TRec = Nothing: Set TRec = New ADODB.Command
Set TRec.ActiveConnection = Cnn
TRec.CommandType = adCmdStoredProc
TRec.CommandText = "GET_BALANCE"
TRec.Parameters.Append TRec.CreateParameter("AC_CODE", adInteger, adParamInput, , LPParty)
TRec.Parameters.Append TRec.CreateParameter("TODATE", adDBTimeStamp, adParamInput, , Format(LPToDate, "YYYY/MM/DD"))
TRec.Parameters.Append TRec.CreateParameter("LBALANCE", adDouble, adParamOutput, , LBal)
TRec.Execute
LBal = TRec("LBALANCE")
Get_ClosingBal = LBal
End Function
'Public Sub UPDATE_CURRENCY(ByVal LSfromDate As Date)
'    On Error GoTo ERR1
'    Dim DateRec As ADODB.Recordset:         Dim TRec2 As ADODB.Recordset:    Dim TRec As ADODB.Recordset
'    Dim LNetCRate As Double:                Dim MDR As String:               Dim LXExCode As String
'    Dim LCurrSauda As String:               Dim LCurrDRate  As Double:       Dim LCurrCRate As Double
'    Dim LVchNo  As String:                  Dim MAmount As Double:           Dim MNarration As String
'    Dim MCR As String:                      Dim LParty As String:            Dim LCondate  As Date
'    Dim LMVNo As Long:                      Dim LEXID As Integer
'
'    MYSQL = "UPDATE INV_D SET CURRRATE = 1  WHERE COMPCODE =" & GCompCode & " "
'    MYSQL = MYSQL & " AND EXCODE  IN (SELECT DISTINCT EXCODE FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'    MYSQL = MYSQL & " AND STDATE >='" & Format(LSfromDate, "YYYY/MM/DD") & "'"
'    Cnn.Execute MYSQL
'
'    MYSQL = "UPDATE VCHAMT SET AMOUNT = IAMOUNT  WHERE COMPCODE =" & GCompCode & " "
'    MYSQL = MYSQL & " AND EXCODE  IN (SELECT DISTINCT EXCODE FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'    MYSQL = MYSQL & " AND VOU_TYPE='S' AND CURRRATE >1 AND VOU_DT >='" & Format(LSfromDate, "YYYY/MM/DD") & "'"
'    Cnn.Execute MYSQL
'
'    MYSQL = "UPDATE VCHAMT SET IAMOUNT = AMOUNT  WHERE COMPCODE =" & GCompCode & ""
'    MYSQL = MYSQL & " AND EXCODE  IN (SELECT DISTINCT EXCODE FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'    MYSQL = MYSQL & " AND VOU_TYPE='S' AND CURRRATE =1 AND VOU_DT >='" & Format(LSfromDate, "YYYY/MM/DD") & "'"
'    Cnn.Execute MYSQL
'
'    MYSQL = "UPDATE VCHAMT SET CURRRATE  = 1 WHERE COMPCODE =" & GCompCode & " "
'    MYSQL = MYSQL & " AND EXCODE  IN (SELECT DISTINCT EXCODE FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'    MYSQL = MYSQL & " AND VOU_TYPE='S' AND CURRRATE >1 AND VOU_DT >='" & Format(LSfromDate, "YYYY/MM/DD") & "'"
'    Cnn.Execute MYSQL
'    If GCurrType = "1" Then
'        MYSQL = "SELECT DISTINCT CONDATE,PARTY,SETTLERATE FROM CTR_RP WHERE COMPCODE = " & GCompCode & " "
'        MYSQL = MYSQL & " AND CONDATE >='" & Format(LSfromDate, "YYYY/MM/DD") & "' "
'        MYSQL = MYSQL & " ORDER BY CONDATE ,PARTY "
'        Set DateRec = Nothing
'        Set DateRec = New ADODB.Recordset
'        DateRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'        Do While Not DateRec.EOF
'            LParty = DateRec!PARTY
'            LCondate = DateRec!Condate
'            LNetCRate = DateRec!SETTLERATE
'            Set TRec2 = Nothing:                        Set TRec2 = New ADODB.Recordset
'            MYSQL = "UPDATE INV_D SET CURRRATE =" & LNetCRate & " "
'            MYSQL = MYSQL & " ,IDIFFAMT=DIFFAMT * " & LNetCRate & ""
'            MYSQL = MYSQL & " ,IBROKAMT = BROKAMT  * " & LNetCRate & ""
'            MYSQL = MYSQL & " ,IBILLAMT =BILLAMT  * " & LNetCRate & ""
'            MYSQL = MYSQL & "  WHERE COMPCODE =" & GCompCode & " "
'            MYSQL = MYSQL & " AND EXID IN (SELECT DISTINCT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'            MYSQL = MYSQL & " AND PARTY ='" & DateRec!PARTY & "'AND STDATE<='" & Format(DateRec!Condate, "YYYY/MM/DD") & "'AND CURRRATE =1 "
'            Cnn.Execute MYSQL
'
'            MYSQL = "UPDATE VCHAMT SET CURRRATE =" & LNetCRate & ""
'            MYSQL = MYSQL & " ,AMOUNT= IAMOUNT *" & LNetCRate & ""
'            MYSQL = MYSQL & " WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE ='S' "
'            MYSQL = MYSQL & " AND EXID   IN (SELECT DISTINCT EXID  FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'            MYSQL = MYSQL & " AND VOU_NO IN (SELECT DISTINCT VOU_NO FROM VCHAMT WHERE COMPCODE =" & GCompCode & " AND VOU_DT <='" & Format(DateRec!Condate, "YYYY/MM/DD") & "'"
'            MYSQL = MYSQL & " AND CURRRATE=1 AND AC_CODE ='" & DateRec!PARTY & "')"
'            Cnn.Execute MYSQL
'            DateRec.MoveNext
'        Loop
'    Else
'        MYSQL = "SELECT DISTINCT A.STDATE,A.PARTY,B.PARTYTYPE ,SUM(A.BILLAMT) AS BAMT FROM INV_D AS A , ACCOUNTD AS B WHERE A.COMPCODE = " & GCompCode & " "
'        MYSQL = MYSQL & " AND A.COMPCODE =B.COMPCODE AND A.PARTY = B.AC_CODE "
'        MYSQL = MYSQL & " AND A.STDATE>='" & Format(LSfromDate, "YYYY/MM/DD") & "' "
'        MYSQL = MYSQL & " AND A.EXID IN (SELECT DISTINCT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'        MYSQL = MYSQL & " GROUP BY A.STDATE,A.PARTY,B.PARTYTYPE ORDER BY A.STDATE,A.PARTY "
'        Set DateRec = Nothing
'        Set DateRec = New ADODB.Recordset
'        DateRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'        Do While Not DateRec.EOF
'            LParty = DateRec!PARTY
'            Set TRec2 = Nothing:                        Set TRec2 = New ADODB.Recordset
'            MYSQL = "SELECT LOWRATE,HGRATE FROM CTR_R WHERE COMPCODE =" & GCompCode & "  AND CONDATE ='" & Format(DateRec!StDate, "YYYY/MM/DD") & "' AND SAUDA ='" & LCurrSauda & "'"
'            TRec2.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'            If Not TRec2.EOF Then
'                LCurrDRate = TRec2!HGRATE
'                LCurrCRate = TRec2!LOWRATE
'                If DateRec!PARTYTYPE <> 2 Then
'                    If DateRec!BAmt > 0 Then
'                        LNetCRate = LCurrCRate
'                    Else
'                        LNetCRate = LCurrDRate
'                    End If
'                Else
'                    If DateRec!BAmt > 0 Then
'                        LNetCRate = LCurrDRate
'                    Else
'                        LNetCRate = LCurrCRate
'                    End If
'                End If
'                MYSQL = "UPDATE INV_D SET CURRRATE =" & LNetCRate & " "
'                MYSQL = MYSQL & " ,IDIFFAMT=DIFFAMT * " & LNetCRate & ""
'                MYSQL = MYSQL & " ,IBROKAMT = BROKAMT  * " & LNetCRate & ""
'                MYSQL = MYSQL & " ,IBILLAMT =BILLAMT  * " & LNetCRate & ""
'                MYSQL = MYSQL & "  WHERE COMPCODE =" & GCompCode & " "
'                MYSQL = MYSQL & " AND EXID  IN (SELECT DISTINCT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'                MYSQL = MYSQL & " AND PARTY ='" & DateRec!PARTY & "'AND STDATE='" & Format(DateRec!StDate, "YYYY/MM/DD") & "'"
'                Cnn.Execute MYSQL
'
'                MYSQL = "UPDATE VCHAMT SET CURRRATE =" & LNetCRate & ""
'                MYSQL = MYSQL & " ,AMOUNT= IAMOUNT *" & LNetCRate & ""
'                MYSQL = MYSQL & " WHERE COMPCODE =" & GCompCode & " AND VOU_TYPE ='S' "
'                MYSQL = MYSQL & " AND EXID  IN (SELECT DISTINCT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y' ) "
'                MYSQL = MYSQL & " AND VOU_NO IN (SELECT DISTINCT VOU_NO FROM VCHAMT WHERE COMPCODE =" & GCompCode & " AND VOU_DT ='" & Format(DateRec!StDate, "YYYY/MM/DD") & "'"
'                MYSQL = MYSQL & " AND AC_CODE ='" & DateRec!PARTY & "')"
'                Cnn.Execute MYSQL
'            End If
'            DateRec.MoveNext
'        Loop
'    End If
'    Set DateRec = Nothing
'    Set TRec = Nothing
'    Set TRec = New ADODB.Recordset
'    MYSQL = "SELECT EXID,TRADINGACC,BROKAC,SHREEAC FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND EXCODE ='CMX' "
'    TRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'    If Not TRec.EOF Then
'        GShree = TRec!shreeac
'        GTrading = TRec!TRADINGACC
'        GBrokrage = TRec!BROKAC
'        LEXID = TRec!EXID
'    End If
'
'    MYSQL = "DELETE FROM VOUCHER WHERE COMPCODE =" & GCompCode & " AND VOU_DT >='" & Format(LSfromDate, "YYYY/MM/DD") & "' AND EXID =" & LEXID & " AND VOU_TYPE ='O' "
'    Cnn.Execute MYSQL
'    If Not TRec.EOF Then
'        MYSQL = "SELECT DISTINCT STDATE,SUM(IDIFFAMT) AS DAMT FROM INV_D WHERE COMPCODE = " & GCompCode & " "
'        MYSQL = MYSQL & " AND STDATE>='" & Format(LSfromDate, "YYYY/MM/DD") & "'  AND EXID  =" & LEXID & ""
'        MYSQL = MYSQL & " GROUP BY STDATE ORDER BY STDATE "
'        Set DateRec = Nothing
'        Set DateRec = New ADODB.Recordset
'        DateRec.Open MYSQL, Cnn, adOpenForwardOnly, adLockReadOnly
'        Do While Not DateRec.EOF
'            If DateRec!DAMT <> 0 Then
'                LVchNo = Get_VouNo("CONT", GFinYear)
'                LMVNo = PInsert_Voucher(LVchNo, DateRec!StDate, "O", "P", 0, "ADD", "CMX", 0, "", "CMX", "0", LEXID, 0)
'                MAmount = Round(Val(DateRec!DAMT), 2)
'                If Val(MAmount) < 0 Then
'                    MCR = "C": MDR = "D"
'                Else
'                    MCR = "D": MDR = "C"
'                End If
'                MAmount = Abs(MAmount)
'                MNarration = "Currency Shree for : " & "CMX" & ", " & Format(DateRec!StDate, "yyyy/MM/dd")
'                'SHREE POSTING
'                Call PInsert_Vchamt(LVchNo, "O", DateValue(DateRec!StDate), MDR, GShree, MAmount, vbNullString, DateValue(DateRec!StDate), MNarration, "CMX", "CMX", 0, "CMX", LMVNo, LEXID, 0)
'                'TRADING AC POSTING
'                Call PInsert_Vchamt(LVchNo, "O", DateValue(DateRec!StDate), MCR, GTrading, MAmount, vbNullString, DateValue(DateRec!StDate), MNarration, "CMX", "CMX", 0, "CMX", LMVNo, LEXID, 0)
'            End If
'            DateRec.MoveNext
'        Loop
'    End If
'    Set TRec = Nothing
'    Set DateRec = Nothing
'    Exit Sub
'ERR1:
'    If err.Number <> 0 Then
'        MsgBox err.Description
'        If CNNERR = True Then
'
'            Cnn.RollbackTrans
'        End If
'
'    End If
'
'End Sub
Private Sub Chk_ItemMast()
    Dim ITRec As ADODB.Recordset
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking ITEMMMAST EXCHANGECODE "
    
    mysql = "UPDATE ITEMMAST SET EXCHANGECODE ='' WHERE EXCHANGECODE IS NULL "
    Cnn.Execute mysql
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking ITEMMMAST EXHCODE "
    
    mysql = "UPDATE ITEMMAST SET EXHCODE ='' WHERE EXHCODE IS NULL "
    Cnn.Execute mysql
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking SAUDAMAST ITEMCODE"
    
    mysql = "UPDATE SAUDAMAST SET ITEMCODE   ='' WHERE ITEMCODE IS NULL "
    Cnn.Execute mysql
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking SAUDAMAST EXCODE"
    mysql = "UPDATE SAUDAMAST SET EXCODE ='' WHERE EXCODE IS NULL "
    Cnn.Execute mysql
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking ITEMMAST ITEMNAME "
    mysql = "SELECT ITEMCODE FROM ITEMMAST WHERE COMPCODE =" & GCompCode & " AND ITEMNAME =''"
    Set ITRec = Nothing
    Set ITRec = New ADODB.Recordset
    ITRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not ITRec.EOF Then
        Do While Not ITRec.EOF
            MsgBox " Please Call Sauda Support Staff. Get Item Name Updated in Item Master for  " & ITRec!ITEMCODE & ""
            ITRec.MoveNext
        Loop
    End If
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking ITEMMAST EXCHANGECODE"
    mysql = "SELECT ITEMCODE FROM ITEMMAST WHERE COMPCODE =" & GCompCode & " AND EXCHANGECODE =''"
    Set ITRec = Nothing
    Set ITRec = New ADODB.Recordset
    ITRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not ITRec.EOF Then
        Do While Not ITRec.EOF
            MsgBox " Please Call Sauda Support Staff. Get Exchange Updated in Item Master for  " & ITRec!ITEMCODE & ""
            ITRec.MoveNext
        Loop
    End If
    DoEvents
    GETMAIN.Label1.Caption = "Checking SAUDAMAST SAUDANAME"
    mysql = "SELECT SAUDACODE FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & " AND SAUDANAME  =''"
    Set ITRec = Nothing
    Set ITRec = New ADODB.Recordset
    ITRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not ITRec.EOF Then
        Do While Not ITRec.EOF
            MsgBox " Please Call Sauda Support Staff. Get Sauda Name Updated in Sauda  Master for  " & ITRec!saudacode & ""
            ITRec.MoveNext
        Loop
    End If
    
    DoEvents
    GETMAIN.Label1.Caption = "Checking SAUDAMAST ITEMCODE"
    
    mysql = "SELECT SAUDACODE FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & " AND ITEMCODE   =''"
    Set ITRec = Nothing
    Set ITRec = New ADODB.Recordset
    ITRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not ITRec.EOF Then
        Do While Not ITRec.EOF
            MsgBox " Please Call Sauda Support Staff. Get Item Code Updated in Sauda  Master for  " & ITRec!saudacode & ""
            ITRec.MoveNext
        Loop
    End If
    DoEvents
    GETMAIN.Label1.Caption = "Checking SAUDAMAST EXCODE"
    
    mysql = "SELECT SAUDACODE FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & " AND EXCODE  =''"
    Set ITRec = Nothing
    Set ITRec = New ADODB.Recordset
    ITRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not ITRec.EOF Then
        Do While Not ITRec.EOF
            MsgBox " Please Call Sauda Support Staff. Get Exchange Code Updated in Sauda  Master for  " & ITRec!saudacode & ""
            ITRec.MoveNext
        Loop
    End If
End Sub
Sub CalInt(LFromDate As Date)
    Dim MDAmt As Double:            Dim MCAmt As Double:            Dim MTBal As Double
    Dim MDt As Date:                Dim MIntAmt As Double:          Dim LInterestRate As Double:
    Dim LInterestAcc As String:     Dim REC1 As ADODB.Recordset:    Dim REC2 As ADODB.Recordset
    Dim LOpBal As Double:           Dim LNetAmt As Double:          Dim VchNo As String:
    Dim MDR As String:              Dim MCR As String:              Dim MNarration As String
    Dim MAmount As Double:          Dim LFYear As String:           Dim Rec As ADODB.Recordset
    Dim LMaxDate As Date:           Dim LSetDate As Date:           Dim A As String
    Dim LAC_CODE As String:         Dim LMVNo As Long:              Dim TRec As ADODB.Recordset
    Dim LMinDate As Date:           Dim LTotIntAmt  As Double:      Dim LLastMonthDate As Date
    Dim LDT As Date:                Dim MPARTYTYPE As String
    Dim LACCID As Long:             Dim QRec As ADODB.Recordset
    Dim LIntAccID As Long
    Dim MAMT  As Long
    Dim RECVou As ADODB.Recordset
    Dim MQty As Double


    Cnn.Execute "DELETE FROM VOUCHER WHERE COMPCODE  = " & GCompCode & " AND VOU_DT>='" & Format(LFromDate, "YYYY/MM/DD") & "' AND  VOU_TYPE='I' "
    Cnn.Execute "DELETE FROM VOUCHER WHERE COMPCODE  = " & GCompCode & " AND VOU_DT>='" & Format(LFromDate, "YYYY/MM/DD") & "' AND  VOU_NO LIKE 'INTR%' "
    
    '''
    If Ginttype <> "P" Then
        If Gintt1 = "0" Then '  Same Day int
            mysql = "SELECT v.vou_dt,DATENAME(weekday,v.vou_dt) as 'weekday',v.vou_dt  as 'dateadded', "
            mysql = mysql & "V.* FROM ACCOUNTD A ,VCHAMT V WHERE A.ACCID = V.ACCID AND A.INTAPP='1'AND A.INTRATE <> 0 "
        ElseIf Gintt1 = "1" Then ' next Day int
            mysql = "SELECT v.vou_dt,DATENAME(weekday,v.vou_dt) as 'weekday', "
            mysql = mysql & "(case "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Monday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,1,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Tuesday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,1,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Wednesday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,1,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Thursday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,1,v .vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Friday'  and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,1,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Saturday'  and v.vou_type='S'  and v.dr_cr = 'C' then DATEADD(D,1,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Sunday'  and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,1,v.vou_dt)  else v.vou_dt end) as 'dateadded', "
            mysql = mysql & "V.* FROM ACCOUNTD A ,VCHAMT V WHERE A.ACCID = V.ACCID AND A.INTAPP='1'AND A.INTRATE <> 0 "
        ElseIf Gintt1 = "2" Then ' t+2  int
            mysql = "SELECT v.vou_dt,DATENAME(weekday,v.vou_dt) as 'weekday', "
            mysql = mysql & "(case "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Monday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,2,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Tuesday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,2,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Wednesday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,2,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Thursday' and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,4,v .vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Friday'  and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,4,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Saturday'  and v.vou_type='S'  and v.dr_cr = 'C' then DATEADD(D,4,v.vou_dt) "
            mysql = mysql & "when DATENAME(weekday,v.vou_dt) = 'Sunday'  and v.vou_type='S' and v.dr_cr = 'C' then DATEADD(D,4,v.vou_dt)  else v.vou_dt end) as 'dateadded', "
            mysql = mysql & "V.* FROM ACCOUNTD A ,VCHAMT V WHERE A.ACCID = V.ACCID AND A.INTAPP='1'AND A.INTRATE <> 0 "
        End If
    Else
        mysql = "SELECT v.vou_dt,DATENAME(weekday,v.vou_dt) as 'weekday',v.vou_dt  as 'dateadded', "
        mysql = mysql & "V.* FROM ACCOUNTD A ,VCHAMT V WHERE A.ACCID = V.ACCID AND A.INTAPP='1'AND A.INTRATE <> 0 "
    End If
        Set RECVou = Nothing
        Set RECVou = New ADODB.Recordset
        
    RECVou.Open mysql, Cnn, adOpenStatic, adLockReadOnly

    
    LInterestAcc = vbNullString
    mysql = "SELECT INTERESTACC FROM EXMAST WHERE COMPCODE =" & GCompCode & " ORDER BY EXCODE"
    Set REC1 = Nothing
    Set REC1 = New ADODB.Recordset
    REC1.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not REC1.EOF Then
        LInterestAcc = IIf(IsNull(REC1!InterestAcc), "", REC1!InterestAcc)
        If LenB(LInterestAcc) < 1 Then
            MsgBox " Please Select Interest Ac in " & REC1!excode & ""
            Exit Sub
        End If
        LIntAccID = Get_AccID(LInterestAcc)
    Else
       Exit Sub
    End If


    LMaxDate = Date
    If LMaxDate > GFinEnd Then LMaxDate = GFinEnd
    
    mysql = "SELECT A.PARTYTYPE,A.ACCID,A.AC_CODE,A.NAME,B.OP_BAL,A.INTRATE,INTTYPE FROM ACCOUNTD AS A, ACCOUNTM AS B "
    mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & "  AND A.COMPCODE=B.COMPCODE AND A.AC_CODE=B.AC_CODE AND A.INTAPP='1'AND INTRATE <> 0 "
    Set Rec = Nothing: Set Rec = New ADODB.Recordset: Rec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
     Do While Not Rec.EOF ' START PARTY LOOP
        MDAmt = 0:        MCAmt = 0:        LOpBal = Rec!OP_BAL:         MIntAmt = 0
        LInterestRate = Rec!INTRATE
        
        MDt = LFromDate
        LMinDate = MDt
        A = Rec!NAME
        LAC_CODE = Rec!AC_CODE
        LACCID = Rec!ACCID

        MPARTYTYPE = Rec!PARTYTYPE
        MIntAmt = 0
        If Rec!INTTYPE = "D" Then
            Do While MDt < LMaxDate
                DoEvents
                GETMAIN.Label1.Caption = "Updating Interest " & A & " " & MDt & ""
                MIntAmt = 0
                If Ginttype = "S" Then
                    'mysql = "SELECT SUM(CASE DR_CR WHEN 'D' THEN AMOUNT*-1 WHEN 'C' THEN AMOUNT END) AS AMT FROM VCHAMT WHERE COMPCODE =" & GCompCode & ""
                    'mysql = mysql & " AND AC_CODE='" & Rec!AC_CODE & "' AND VOU_DT<='" & Format(MDt, "yyyy/MM/dd") & "' AND VOU_TYPE <>'I'"

                    MAMT = 0
                    RECVou.Filter = adFilterNone
                    If RECVou.RecordCount <> 0 Then
                        RECVou.MoveFirst
                        RECVou.Filter = "AC_CODE ='" & Rec!AC_CODE & "' AND DATEADDED= '" & Format(MDt, "yyyy/MM/dd") & "' AND VOU_TYPE <>'I'"
                        If Not RECVou.EOF Then
                            While Not RECVou.EOF
                                If RECVou!DR_CR = "C" Then
                                    MAMT = MAMT + RECVou!AMOUNT
                                Else
                                    MAMT = MAMT - RECVou!AMOUNT
                                End If
                           
                                RECVou.MoveNext
                            Wend
                        End If
                    End If
                Else
                    'mysql = "SELECT SUM(CASE DR_CR WHEN 'D' THEN AMOUNT*-1 WHEN 'C' THEN AMOUNT END) AS AMT FROM VCHAMT WHERE COMPCODE =" & GCompCode & ""
                    'mysql = mysql & " AND AC_CODE='" & Rec!AC_CODE & "' AND VOU_DT<='" & Format(MDt, "yyyy/MM/dd") & "'"

                    MAMT = 0
                    RECVou.Filter = adFilterNone
                    If RECVou.RecordCount <> 0 Then
                        RECVou.MoveFirst
                        RECVou.Filter = "AC_CODE ='" & Rec!AC_CODE & "' AND DATEADDED= '" & Format(MDt, "yyyy/MM/dd") & "' "
                        If Not RECVou.EOF Then
                            While Not RECVou.EOF
                                If RECVou!DR_CR = "C" Then
                                    MAMT = MAMT + RECVou!AMOUNT
                                Else
                                    MAMT = MAMT - RECVou!AMOUNT
                                End If
                           
                                RECVou.MoveNext
                            Wend
                        End If
                    End If
                End If
                
                MQty = 0
                If GUniqClientId = "2159MUM" Then

                    mysql = "SELECT CONTYPE,SUM(QTY) AS QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND PARTY = '" & Rec!AC_CODE & "'"
                    mysql = mysql & " AND CONDATE <='" & Format(MDt, "yyyy/MM/dd") & "' GROUP BY CONTYPE"
                    Set QRec = Nothing: Set QRec = New ADODB.Recordset: QRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
                    If Not QRec.EOF Then
                        If QRec!CONTYPE = "B" Then
                            MQty = MQty + IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                        Else
                            MQty = MQty - IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                        End If
                        QRec.MoveNext
                        If Not QRec.EOF Then
                            If QRec!CONTYPE = "B" Then
                                MQty = MQty + IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                            Else
                                MQty = MQty - IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                            End If
                        End If
                    End If
                Else
                    MQty = 1
                End If


                'Set REC2 = Nothing: Set REC2 = New ADODB.Recordset
                'REC2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly

                If MQty <> 0 Then
                    LNetAmt = MAMT
                    MTBal = LOpBal + LNetAmt

                'If Not REC2.EOF Then LNetAmt = IIf(IsNull(REC2!AMT), 0, REC2!AMT)
                    
                    LOpBal = MTBal
                    If MPARTYTYPE <> 2 Then
                        If MTBal < 0 Then MIntAmt = MIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 365) * 1)
                    Else
                        If MTBal > 0 Then MIntAmt = MIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 365) * 1)
                    End If
                End If
                If (Val(MIntAmt) <> 0 And GUniqClientId <> "2159MUM") Or (GUniqClientId = "2159MUM" And MQty <> 0 And Val(MIntAmt) <> 0) Then
                    LFYear = Mid(GFinBegin, 9, 2) & Mid(GFinEnd, 9, 2)
                    GMaxVouNo = Val(Right$(Get_VouNo("INTR", LFYear), 7))
                    GMaxVouNo = GMaxVouNo + 1
                    VchNo = Get_Next_Vou_No(GMaxVouNo, "INTR", LFYear)
                    LMVNo = PInsert_Voucher(VchNo, MDt, "I", vbNullString, 0, vbNullString, vbNullString, 0, vbNullString, vbNullString, "0", 0, 0)
                    MAmount = Abs(Val(MIntAmt))
                    If Val(MIntAmt) > 0 Then
                        MCR = "C": MDR = "D"
                    Else
                        MCR = "D": MDR = "C"
                    End If
                    If MPARTYTYPE <> 2 Then
                        MNarration = "Interest Debited for : " & Rec!NAME & ""
                        Call PInsert_Vchamt(VchNo, "I", MDt, MDR, Rec!AC_CODE, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "I", MDt, MCR, LInterestAcc, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LIntAccID)
                    Else
                        MNarration = "Interest Credited for : " & Rec!NAME & ""
                        Call PInsert_Vchamt(VchNo, "I", MDt, MCR, Rec!AC_CODE, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "I", MDt, MDR, LInterestAcc, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LIntAccID)
                    End If
                    If Ginttype = "C" Or Ginttype = "P" Then
                        If LOpBal > 0 Then
                            LOpBal = LOpBal + MIntAmt
                        Else
                            LOpBal = LOpBal - MIntAmt
                        End If
                    End If
                End If
                MDt = MDt + 1
            Loop
        ElseIf Rec!INTTYPE = "M" Then
            
            Do While MDt < LMaxDate
                DoEvents
                LLastMonthDate = Get_LastMonthDate(MDt)
                If LLastMonthDate > LMaxDate Then LLastMonthDate = LMaxDate
                
                LTotIntAmt = 0
                Do While MDt <= LLastMonthDate
                    GETMAIN.Label1.Caption = "Updateing Interest " & A & " " & MDt & ""
                    MIntAmt = 0
                    If Ginttype = "S" Then
                        MAMT = 0
                        RECVou.Filter = adFilterNone
                        If RECVou.RecordCount <> 0 Then
                            RECVou.MoveFirst
                            RECVou.Filter = "AC_CODE ='" & Rec!AC_CODE & "' AND DATEADDED= '" & Format(MDt, "yyyy/MM/dd") & "' AND VOU_TYPE <>'I'"
                            If Not RECVou.EOF Then
                                While Not RECVou.EOF
                                    If RECVou!DR_CR = "C" Then
                                        MAMT = MAMT + RECVou!AMOUNT
                                    Else
                                        MAMT = MAMT - RECVou!AMOUNT
                                    End If
                           
                                    RECVou.MoveNext
                                Wend
                            End If
                        End If
                    Else
                        MAMT = 0
                        RECVou.Filter = adFilterNone
                        If RECVou.RecordCount <> 0 Then
                            RECVou.MoveFirst
                            RECVou.Filter = "AC_CODE ='" & Rec!AC_CODE & "' AND DATEADDED= '" & Format(MDt, "yyyy/MM/dd") & "' AND VOU_TYPE <>'I'"
                            If Not RECVou.EOF Then
                                While Not RECVou.EOF
                                    If RECVou!DR_CR = "C" Then
                                        MAMT = MAMT + RECVou!AMOUNT
                                    Else
                                        MAMT = MAMT - RECVou!AMOUNT
                                    End If
                           
                                    RECVou.MoveNext
                                Wend
                            End If
                        End If
                        
                    End If
                    LNetAmt = MAMT
                    MTBal = LOpBal + LNetAmt
                    
                    LOpBal = MTBal
                    If GUniqClientId = "2159MUM" Then
                        MQty = 0
                        mysql = "SELECT CONTYPE,SUM(QTY) AS QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND PARTY = '" & Rec!AC_CODE & "'"
                        mysql = mysql & " AND CONDATE <='" & Format(MDt, "yyyy/MM/dd") & "' GROUP BY CONTYPE"
                        Set QRec = Nothing: Set QRec = New ADODB.Recordset: QRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
                        If Not QRec.EOF Then
                            If QRec!CONTYPE = "B" Then
                                MQty = MQty + IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                            Else
                                MQty = MQty - IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                            End If
                            QRec.MoveNext
                            If Not QRec.EOF Then
                                If QRec!CONTYPE = "B" Then
                                    MQty = MQty + IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                                Else
                                    MQty = MQty - IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                                End If
                            End If
                        End If
                    End If
                    If (MTBal <> 0 And GUniqClientId <> "2159MUM") Or (GUniqClientId = "2159MUM" And MQty <> 0 And MTBal <> 0) Then
                    If Ginttype = "P" Then
                        If MPARTYTYPE <> 2 Then
                            If MTBal < 0 Then LTotIntAmt = LTotIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 360) * 1)
                        Else
                            If MTBal > 0 Then LTotIntAmt = LTotIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 360) * 1)
                        End If
                    Else
                        If MPARTYTYPE <> 2 Then
                            If MTBal < 0 Then LTotIntAmt = LTotIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 365) * 1)
                        Else
                            If MTBal > 0 Then LTotIntAmt = LTotIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 365) * 1)
                        End If
                   End If
                    End If
                    MDt = MDt + 1
                Loop
                If LTotIntAmt <> 0 Then
                    LFYear = Mid(GFinBegin, 9, 2) & Mid(GFinEnd, 9, 2)
                    GMaxVouNo = Val(Right$(Get_VouNo("INTR", LFYear), 7))
                    GMaxVouNo = GMaxVouNo + 1
                    VchNo = Get_Next_Vou_No(GMaxVouNo, "INTR", LFYear)
                    LDT = MDt - 1
                    LMVNo = PInsert_Voucher(VchNo, LDT, "I", vbNullString, 0, vbNullString, vbNullString, 0, vbNullString, vbNullString, "0", 0, 0)
                    MAmount = Abs(Val(LTotIntAmt))
                    If Val(LTotIntAmt) > 0 Then
                        MCR = "C": MDR = "D"
                    Else
                        MCR = "D": MDR = "C"
                    End If
                    If MPARTYTYPE <> 2 Then
                        MNarration = "Interest Debited for : " & Rec!NAME & ""
                        Call PInsert_Vchamt(VchNo, "I", LDT, MDR, Rec!AC_CODE, MAmount, vbNullString, LDT, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "I", LDT, MCR, LInterestAcc, MAmount, vbNullString, LDT, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LIntAccID)
                    Else
                        MNarration = "Interest Credited for : " & Rec!NAME & ""
                        Call PInsert_Vchamt(VchNo, "I", LDT, MCR, Rec!AC_CODE, MAmount, vbNullString, LDT, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "I", LDT, MDR, LInterestAcc, MAmount, vbNullString, LDT, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LIntAccID)
                    End If
                    If Ginttype = "C" Or Ginttype = "P" Then
                        If LOpBal > 0 Then
                            LOpBal = LOpBal + LTotIntAmt
                        Else
                            LOpBal = LOpBal - LTotIntAmt
                        End If
                    End If
                End If
            Loop
        Else
            Set REC1 = Nothing
            Set REC1 = New ADODB.Recordset
            If GUniqClientId = "2159MUM" Then
                mysql = "SELECT  DATEADD(D,2,SETDATE) as setdate FROM SETTLE WHERE COMPCODE =" & GCompCode & "  AND SETDATE >='" & Format(MDt, "YYYY/MM/DD") & "'AND SETDATE <='" & Format(LMaxDate, "YYYY/MM/DD") & "'"
            Else
                mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & "  AND SETDATE >='" & Format(MDt, "YYYY/MM/DD") & "'AND SETDATE <='" & Format(LMaxDate, "YYYY/MM/DD") & "'"
            End If
            REC1.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            Do While Not REC1.EOF
                LSetDate = REC1!SETDATE
                MIntAmt = 0
                DoEvents
                GETMAIN.Label1.Caption = "Updateing Interest " & A & " " & MDt & ""
                
                Do While REC1!SETDATE >= MDt
                    
                    MQty = 0
                    If GUniqClientId = "2159MUM" Then
                        mysql = "SELECT CONTYPE,SUM(QTY) AS QTY FROM CTR_D WHERE COMPCODE =" & GCompCode & " AND PARTY = '" & Rec!AC_CODE & "'"
                        mysql = mysql & " AND CONDATE <='" & Format(MDt, "yyyy/MM/dd") & "' GROUP BY CONTYPE"
                        Set QRec = Nothing: Set QRec = New ADODB.Recordset: QRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
                        If Not QRec.EOF Then
                            If QRec!CONTYPE = "B" Then
                                MQty = MQty + IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                            Else
                                MQty = MQty - IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                            End If
                            QRec.MoveNext
                            If Not QRec.EOF Then
                                If QRec!CONTYPE = "B" Then
                                    MQty = MQty + IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                                Else
                                    MQty = MQty - IIf(IsNull(QRec!QTY), 0, QRec!QTY)
                                End If
                            End If
                        End If
                    Else
                        MQty = 1
                    End If

                    If MQty <> 0 Then
                        mysql = "SELECT SUM(CASE DR_CR WHEN 'D' THEN AMOUNT*-1 WHEN 'C' THEN AMOUNT END) AS AMT FROM VCHAMT WHERE COMPCODE =" & GCompCode & ""
                        mysql = mysql & " AND AC_CODE='" & Rec!AC_CODE & "' AND VOU_DT<='" & Format(MDt, "yyyy/MM/dd") & "'"
                        Set REC2 = Nothing: Set REC2 = New ADODB.Recordset
                        REC2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                        LNetAmt = 0
                        If Not REC2.EOF Then LNetAmt = IIf(IsNull(REC2!AMT), 0, REC2!AMT)
                        MTBal = LOpBal + LNetAmt
                        If MPARTYTYPE <> 2 Then
                            If MTBal < 0 Then MIntAmt = MIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 365) * 1)
                        Else
                            If MTBal > 0 Then MIntAmt = MIntAmt + (((Abs(MTBal) * (LInterestRate / 100)) / 365) * 1)
                        End If
                    End If
                    MDt = MDt + 1
                Loop
                If Val(MIntAmt) <> 0 Then
                    MDt = MDt - 1
                    LFYear = Mid(GFinBegin, 9, 2) & Mid(GFinEnd, 9, 2)
                    GMaxVouNo = Val(Right$(Get_VouNo("INTR", LFYear), 7))
                    GMaxVouNo = GMaxVouNo + 1
                    VchNo = Get_Next_Vou_No(GMaxVouNo, "INTR", LFYear)
                    LMVNo = PInsert_Voucher(VchNo, MDt, "I", vbNullString, 0, vbNullString, vbNullString, 0, vbNullString, vbNullString, "0", 0, 0)
                    MAmount = Abs(Val(MIntAmt))
                    If Val(MIntAmt) > 0 Then
                        MCR = "C": MDR = "D"
                    Else
                        MCR = "D": MDR = "C"
                    End If
                    If MPARTYTYPE <> 2 Then
                        MNarration = "Interest Debited for : " & Rec!NAME & ""
                        Call PInsert_Vchamt(VchNo, "I", MDt, MDR, Rec!AC_CODE, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "I", MDt, MCR, LInterestAcc, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LIntAccID)
                   Else
                        MNarration = "Interest Credited for : " & Rec!NAME & ""
                        Call PInsert_Vchamt(VchNo, "I", MDt, MCR, Rec!AC_CODE, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LACCID)
                        Call PInsert_Vchamt(VchNo, "I", MDt, MDR, LInterestAcc, MAmount, vbNullString, MDt, MNarration, vbNullString, vbNullString, 0, vbNullString, LMVNo, 0, 0, LIntAccID)
                   End If
                End If
                MDt = MDt + 1
                REC1.MoveNext
            Loop
        End If
        'Loop ' END SETTLE LOOP

        Rec.MoveNext
    Loop ' END PARTY LOOP
End Sub
Public Sub PInsert_PostVchamt(LVVouNo As String, LVAmount, LVAcc As String, LVStDate As Date, LVExCode As String, LVParty As String, LVNarr As String, LVMVNo As Long, LVExID As Integer, LVSaudaID As Long)
mysql = "EXEC Post_BillVchAmt " & GCompCode & " ,'" & LVVouNo & "'," & LVAmount & ",'" & LVAcc & "','" & Format(LVStDate, "yyyy/mm/dd") & "','" & LVExCode & "','" & LVParty & "','" & LVNarr & "'," & LVMVNo & "," & LVExID & "," & LVSaudaID & ""
Cnn.Execute mysql
End Sub
Public Sub PInsert_Ctr_Log(LCConNo As Long, LCRowNo1 As String, LCAAction As String, LCATime As String, LCCondate As Date, LCExCode As String, LCSauda As String, LCParty As String, LCBroker As String, LCConType As String, LCQty As Double, LCRate As Double, LCRate2 As Double, LCAUser As String)
'MYSQL = "EXEC INSERT_CTR_LOG " & GCompCode & " ," & LCConNo & ",'" & LCRowNo1 & "','" & LCAAction & "','" & LCATime & "','" & Format(LCCondate, "yyyy/mm/dd") & "','" & LCExCode & "','" & LCSauda & "','" & LCParty & "','" & LCBroker & "','" & LCConType & "'," & LCQty & "," & LCRate & "," & LCRate2 & ",'" & LCAUser & "'"
'Cnn.Execute MYSQL
End Sub
Public Sub Update_Qtywise_MarginAmt(LIParties As String, LIFromDate As Date, LIExCodes As String)
Dim LMargAmt As Double:     Dim LMRate As Double:               Dim LCloseQty As Double:    Dim LLOT As Double:
Dim MCondate As Date:       Dim MItemCode As String:            Dim MExCode As String
Dim mparty As String:       Dim MSauda As String:               Dim LMarRate As Double
Dim Lmaturity As Date:      Dim LExCode As String:              Dim NewRec As ADODB.Recordset:
Dim LSaudaID As Long
Dim LExID As Integer
Dim LACCID As Long

Dim MRateRec As ADODB.Recordset

mysql = "SELECT EXCODE,AC_CODE,MARRATE,UPTOSTDT FROM PEXBROK WHERE COMPCODE =" & GCompCode & " "
If LenB(LIParties) <> 0 Then mysql = mysql & " AND AC_CODE  IN (" & LIParties & ")"
If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND EXID IN (" & LIExCodes & ")"
mysql = mysql & " AND MARTYPE = 'Q' AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
mysql = mysql & " ORDER BY AC_CODE,EXCODE,UPTOSTDT"
Set MRateRec = Nothing: Set MRateRec = New ADODB.Recordset
MRateRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly

On Error GoTo ERR2
    mysql = "UPDATE DMARGIN SET MARGINAMT =0 WHERE COMPCODE =" & GCompCode & " AND CLOSEQTY =0"
    If LenB(LIParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LIParties & ")"
    If LenB(LIExCodes) > 0 Then mysql = mysql & " AND EXID IN (" & LIExCodes & ")"
    mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND MARTYPE ='Q' "
    mysql = mysql & " AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "')"
    Cnn.Execute mysql
    
    mysql = "SELECT D.SAUDAID,D.EXID,D.SAUDA,D.CONDATE,D.ITEMCODE,D.ACCID,D.PARTY,D.MATURITY,D.CLOSEQTY,D.EXCODE FROM DMARGIN AS D"
    mysql = mysql & " WHERE D.COMPCODE = " & GCompCode & " AND CLOSEQTY <> 0 "
    If LenB(LIParties) <> 0 Then mysql = mysql & " AND D.PARTY IN (" & LIParties & ")"
    If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND D.EXID IN (" & LIExCodes & ")"
    mysql = mysql & " AND D.CONDATE >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
    mysql = mysql & " AND ACCID IN (SELECT DISTINCT ACCID  FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND MARTYPE ='Q'"
    mysql = mysql & " AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "')"
    mysql = mysql & " ORDER BY D.EXCODE,D.ITEMCODE,D.SAUDA,D.CONDATE, D.PARTY "
    Set NewRec = Nothing
    Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not NewRec.EOF
        MSauda = NewRec!Sauda:        MCondate = NewRec!Condate
        Lmaturity = NewRec!MATURITY:  LExID = NewRec!EXID
        LSaudaID = NewRec!SAUDAID:    LExCode = NewRec!excode
        LMargAmt = 0
        DoEvents
        GETMAIN.Label1.Caption = "Updateing Qtywise Margin Amt for " & MSauda & " " & MCondate & ""
        MItemCode = NewRec!ITEMCODE:            mparty = NewRec!PARTY
        
        MRateRec.Filter = adFilterNone
        MRateRec.Filter = "UPTOSTDT>='" & Format(MCondate, "yyyy/MM/dd") & "' AND AC_CODE='" & mparty & "' AND EXCODE='" & LExCode & "'"
        If Not MRateRec.EOF Then
            LMRate = MRateRec!MARRATE
        Else
            LMRate = 0
        End If
        
        LACCID = NewRec!ACCID
        LCloseQty = Abs(NewRec!CLOSEQTY)
        LMargAmt = LCloseQty * LMRate
        If Lmaturity = MCondate Then LMargAmt = 0
        'MYSQL = "UPDATE DMARGIN SET MARGINAMT = " & LMargAmt & " WHERE COMPCODE =" & GCompCode & " AND PARTY='" & MParty & "' "
        'MYSQL = MYSQL & " AND SAUDA ='" & MSauda & "' AND CONDATE ='" & Format(MCondate, "YYYY/MM/DD") & "'"
        mysql = "EXEC Upd_MarginAmt " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & LMargAmt & "," & LMRate & ""
        Cnn.Execute mysql
        NewRec.MoveNext
    Loop
    Set NewRec = Nothing
    Set MRateRec = Nothing
    Exit Sub
ERR2:
    If err.Number <> 0 Then
        MsgBox err.Description
        Set NewRec = Nothing
        Set MRateRec = Nothing
        If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
    End If
End Sub
Function Win32ToVbTime(ft As Currency) As Date
    Dim ftl As Currency
    ' Call API to convert from UTC time to local time
    If FileTimeToLocalFileTime(ft, ftl) Then
        ' Local time is nanoseconds since 01-01-1601
        ' In Currency that comes out as milliseconds
        ' Divide by milliseconds per day to get days since 1601
        ' Subtract days from 1601 to 1899 to get VB Date equivalent
        Win32ToVbTime = CDate((ftl / rMillisecondPerDay) - rDayZeroBias)
    Else
        MsgBox err.LastDllError
    End If
End Function
Public Sub Connect_Ftp(LHostName As String, LUserName As String, LPass As String, LRemoteFileName As String, LLocalFileName As String)
    Dim hopen As Long
    Dim dwType As Long
    Dim dwSeman As Long
    Dim hConnection As Long
    FlagDownloadedFromOurFTP = False

    hopen = InternetOpen("My VB Test", INTERNET_OPEN_TYPE_PRECONFIG, vbNullString, vbNullString, 0)
    If hopen = 0 Then
        ErrorOut err.LastDllError, "InternetOpen"
        Exit Sub
    End If
  dwType = FTP_TRANSFER_TYPE_ASCII
  dwSeman = 0
  hConnection = 0
    If hConnection <> 0 Then
        InternetCloseHandle hConnection
    End If
    hConnection = InternetConnect(hopen, LHostName, INTERNET_INVALID_PORT_NUMBER, _
    LUserName, LPass, INTERNET_SERVICE_FTP, dwSeman, 0)
    If hConnection = 0 Then
        ErrorOut err.LastDllError, "InternetConnect"
        Exit Sub
    'Else
     '   MsgBox "Connected!", , "SimpleFtp"
    End If
    
    If (FtpGetFile(hConnection, LRemoteFileName, LLocalFileName, False, FILE_ATTRIBUTE_NORMAL, dwType Or INTERNET_FLAG_RELOAD, 0) = False) Then
        ErrorOut err.LastDllError, "FtpPutFile"
        Exit Sub
    Else
        'MsgBox "File transfered!", , "SimpleFtp"
        FlagDownloadedFromOurFTP = True
    End If
End Sub


Public Sub ErrorOut(ByVal dwError As Long, ByRef szFunc As String)
Dim dwRet As Long
Dim dwTemp As Long
Dim szString As String * 2048
Dim szErrorMessage As String
dwRet = FormatMessage(FORMAT_MESSAGE_FROM_HMODULE, _
                  GetModuleHandle("wininet.dll"), dwError, 0, _
                  szString, 256, 0)
szErrorMessage = szFunc & " error code: " & dwError & " Message: " & szString
Debug.Print szErrorMessage

'MsgBox "err=" & szErrorMessage
FTPerr = szErrorMessage
'MsgBox szErrorMessage, , "SimpleFtp"


If (dwError = 12003) Then
    ' Extended error information was returned
    dwRet = InternetGetLastResponseInfo(dwTemp, szString, 2048)
    Debug.Print szString
    'Form2.Show
    'Form2.Text1.text = szString
    'Frame10.Visible = True
    'Text2.text = szString
    
End If
End Sub

Public Sub Update_ValueWise_MarginAmt(LIParties As String, LIFromDate As Date, LIExCodes As String)

Dim LMIRate  As Double:     Dim LMERate As Double:              Dim LAddLong As Double:         Dim LAddShort As Double:    Dim LMargAmt As Double:             Dim LMARate As Double
Dim LCloseQty As Double:    Dim LLOT As Double:                 Dim LCLRATE As Double:          Dim MCondate As Date:       Dim MItemCode As String:            Dim MExCode As String
Dim mparty As String:       Dim MSauda As String:               Dim LMarRate As Double:         Dim Lmaturity As Date:      Dim LELMLong As Double:             Dim LELMShort As Double
Dim LDelivery As Double:    Dim NewRec As ADODB.Recordset:      Dim MRateRec As ADODB.Recordset
Dim LSaudaID As Long
Dim LItemID As Integer
Dim LACCID  As Long
On Error GoTo ERR2
    Set MRateRec = Nothing
    Set MRateRec = New ADODB.Recordset
    mysql = "SELECT DISTINCT AC_CODE,EXCODE,INSTTYPE,MARRATE,UPTOSTDT FROM PEXBROK WHERE COMPCODE =" & GCompCode & ""
    mysql = mysql & " AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "' AND MARTYPE='V' AND MARRATE <>0 "
    If LenB(LIParties) <> 0 Then mysql = mysql & " AND AC_CODE IN (" & LIParties & ")"
    If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND EXID IN (" & LIExCodes & ")"
    mysql = mysql & " ORDER BY AC_CODE,EXCODE,INSTTYPE,UPTOSTDT "
    MRateRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    
    mysql = "UPDATE DMARGIN SET MARGINAMT =0 WHERE COMPCODE =" & GCompCode & " AND CLOSEQTY =0"
    If LenB(LIParties) <> 0 Then mysql = mysql & " AND PARTY IN (" & LIParties & ")"
    If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND EXID IN (" & LIExCodes & ")"
    mysql = mysql & " AND PARTY IN (SELECT DISTINCT AC_CODE FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND MARTYPE ='V' AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "')"
    mysql = mysql & " AND CONDATE >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
    Cnn.Execute mysql
    
    mysql = "SELECT D.ITEMID,D.EXID,D.SAUDAID,D.SAUDA,D.CONDATE,D.ITEMCODE,D.PARTY,D.MATURITY,D.CLOSEQTY, D.EXCODE,D.CLOSERATE FROM DMARGIN AS D"
    mysql = mysql & " WHERE D.COMPCODE = " & GCompCode & " AND CLOSEQTY <> 0 AND D.PARTY IN (SELECT DISTINCT AC_CODE FROM PEXBROK WHERE "
    mysql = mysql & " COMPCODE =" & GCompCode & " AND UPTOSTDT >='" & Format(LIFromDate, "YYYY/MM/DD") & "' AND MARTYPE ='V') AND D.CONDATE >='" & Format(LIFromDate, "YYYY/MM/DD") & "'"
    If LenB(LIParties) <> 0 Then mysql = mysql & " AND D.PARTY IN (" & LIParties & ")"
    If LenB(LIExCodes) <> 0 Then mysql = mysql & " AND D.EXID IN (" & LIExCodes & ")"
    mysql = mysql & " ORDER BY D.EXCODE,D.SAUDA,D.CONDATE, D.PARTY "
    Set NewRec = Nothing
    Set NewRec = New ADODB.Recordset
    NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not NewRec.EOF
        MSauda = NewRec!Sauda:        MCondate = NewRec!Condate
        Lmaturity = NewRec!MATURITY
        LMIRate = 0:                  LMERate = 0:
        LAddLong = 0:                 LAddShort = 0:
        mparty = NewRec!PARTY
        LACCID = Get_AccID(mparty)
        MExCode = NewRec!excode
        LMargAmt = 0
        LItemID = NewRec!itemid
        LSaudaID = NewRec!SAUDAID
        LLOT = Get_LotSize(LItemID, LSaudaID, NewRec!EXID)
        MRateRec.Filter = adFilterNone
        MRateRec.Filter = "UPTOSTDT>='" & Format(MCondate, "yyyy/MM/dd") & "' AND EXCODE ='" & NewRec!excode & "' AND AC_CODE ='" & NewRec!PARTY & "'"
        If Not MRateRec.EOF Then
            LMarRate = MRateRec!MARRATE
        Else
            LMarRate = 0
        End If
        DoEvents
        GETMAIN.Label1.Caption = "Updateing Valuse wise Margin Amt for " & MSauda & " " & MCondate & ""
        Do While NewRec!PARTY = mparty And NewRec!excode = MExCode
            MItemCode = NewRec!ITEMCODE:            mparty = NewRec!PARTY
            LCLRATE = IIf(IsNull(NewRec!CLOSERATE), 1, NewRec!CLOSERATE)
            LMargAmt = 0
            LCloseQty = NewRec!CLOSEQTY
            LMargAmt = (Abs(LCloseQty) * LCLRATE * LLOT) * LMarRate / 100
            If Lmaturity = MCondate Then LMargAmt = 0
            NewRec.MoveNext
            mysql = "EXEC Upd_MarginAmt  " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & LMargAmt & "," & LMarRate & ""
            Cnn.Execute mysql
            If NewRec.EOF Then Exit Do
        Loop
        If NewRec.EOF Then Exit Do
    Loop
    Set NewRec = Nothing
    Set MRateRec = Nothing
    Exit Sub
ERR2:
    If err.Number <> 0 Then
        MsgBox err.Description
        Set NewRec = Nothing
        Set MRateRec = Nothing
        If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
    End If
End Sub

Public Sub PInsert_Pitsbrok(LIParty As String, LIFmlyCode As String, LIExCode As String, LIItemCode As String, LIBrokType As String, LIBrokRate As Double, LIShType As String, LIShRate As Double, LIUptoStDt As Date, LIInstType As String, LIBrokRate2 As Double, LIExID As Integer, LIItemID As Integer, LIFmlyID As Long, LIAccID As Long)
    mysql = "EXEC INSERT_PITSBROK " & GCompCode & ",'" & LIParty & "','" & LIFmlyCode & "','" & LIExCode & "','" & LIItemCode & "','" & LIBrokType & "'," & LIBrokRate & ",'" & LIShType & "'," & LIShRate & ",'" & Format(LIUptoStDt, "yyyy/mm/dd") & "','" & LIInstType & "'," & LIBrokRate2 & "," & LIItemID & "," & LIExID & "," & LIFmlyID & "," & LIAccID & ""
    Cnn.Execute mysql
End Sub

Public Sub PINSERT_PEXSBROK(LIParty As String, LIFmlyCode As String, LIExCode As String, LIBrokType As String, LIBrokRate As Double, LIShType As String, LIShRate As Double, LIUptoStDt As Date, LIInstType As String, LIBrokRate2 As Double, LIExID As Integer, LIFmlyID As Long, LIAccID As Long)
    mysql = "EXEC INSERT_PEXSBROK " & GCompCode & ",'" & LIParty & "','" & LIFmlyCode & "','" & LIExCode & "','" & LIBrokType & "'," & LIBrokRate & ",'" & LIShType & "'," & LIShRate & ",'" & Format(LIUptoStDt, "yyyy/mm/dd") & "','" & LIInstType & "'," & LIBrokRate2 & "," & LIExID & "," & LIFmlyID & "," & LIAccID & ""
    Cnn.Execute mysql
End Sub
Public Sub PInsert_COMP_PExBrok(LPCompCode As Integer, LPAcCode As String, LExCode As String, LPBrokType As String, LPBrokRate As Double, LPBrokRate2 As Double, LPStdRate As Double, LPTranRate As Double, LPTranType As String, LPSTTRate As Double, LPMinRate As Double, LPMBrokType As String, LPMBrokRate As Double, LPMBrokRate2 As Double, LPMarType As String, LPMarRate As Double, LPUptoStDt As Date, LPInstType As String, LPSellBrok As Double, LPSellBrok2 As Double, LPEXID As Integer)
Dim LACCID As Long
LACCID = Get_AccID(LPAcCode, LPCompCode)
mysql = "EXEC INSERT_PEXBROK " & LPCompCode & ",'" & LPAcCode & "','" & LExCode & "','" & LPBrokType & "'," & LPBrokRate & "," & LPBrokRate2 & "," & LPStdRate & "," & LPTranRate & ","
mysql = mysql & "'" & LPTranType & "'," & LPSTTRate & "," & LPMinRate & ",'" & LPMBrokType & "'," & LPMBrokRate & "," & LPMBrokRate2 & ",'" & LPMarType & "'," & LPMarRate & ","
mysql = mysql & "'" & Format(LPUptoStDt, "YYYY/MM/DD") & "','" & LPInstType & "'," & LPSellBrok & "," & LPSellBrok2 & "," & LPEXID & "," & LACCID & ""
Cnn.Execute mysql
End Sub
Sub TDownloadFile(MyURL As String, LocalFilePath As String)

On Error GoTo NOFILE

    GLOBALFLAG = True
    
    Dim WinHttpReq As Object
    Dim oStream As Object
    
    Set WinHttpReq = CreateObject("Microsoft.XMLHTTP")
    WinHttpReq.Open "GET", MyURL, False, "", ""  '("username", "password")
    
    ' - WinHttpReq.SetRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
    
    WinHttpReq.send
    
    ' - STATUS 403 -- The server understood the request, but cannot fulfill it.
    'The HTTP 403 Forbidden client error status response code indicates that the server understood the request but refuses to authorize it.
    
    If WinHttpReq.Status = 200 Then
        Set oStream = CreateObject("ADODB.Stream")
        oStream.Open
        oStream.Type = 1
        oStream.Write WinHttpReq.responseBody
        oStream.SaveToFile LocalFilePath, 2 ' 1 = no overwrite, 2 = overwrite
        oStream.Close
    End If
    
NOFILE:
    If err.Number <> 0 Then
        GLOBALFLAG = False
    End If
    
    GLOBALFLAG = CheckFileSize(LocalFilePath)
    '>>> if file does not downloaded from above source then download from our server c:/saudasoftwarefiles/
    If Not GLOBALFLAG Then
        'Call Connect_Ftp("185.184.70.148", "", "", "/" & Replace(Replace(LocalFilePath, App.Path & "\", ""), "\", "/"), LocalFilePath)
        'Call Connect_Ftp("178.33.73.246", "", "", "/" & Replace(Replace(LocalFilePath, App.Path & "\", ""), "\", "/"), LocalFilePath)
        
        'Call Connect_Ftp("50.62.169.103", "saudasoftware", "Khushi@12345", "/S-BKP/Files/" & Replace(Replace(LocalFilePath, App.Path & "\", ""), "\", "/"), LocalFilePath)
        Call Connect_Ftp("50.63.8.230", "saudasoftware", "Reet@73284", "/S-BKP/Files/" & Replace(Replace(LocalFilePath, App.Path & "\", ""), "\", "/"), LocalFilePath)
        GLOBALFLAG = FlagDownloadedFromOurFTP
    End If
        
End Sub

Public Sub PINSERT_DLYMGN(LDConDate As Date, LDSauda As String, LDImRate As Double, LDEmRate As Double, LDAmRate As Double, LDTmRate As Double, LDAddLong As Double, LDAddShort As Double, LdCashLong As Double, LDCashShort As Double, LDItem As String, LDExCode As String, LDMaturity As Date, _
LDELMLong As Double, LDELmShort As Double, LDDelivery As Double, LDSaudaID As Long, LDItemID As Integer, LDExID As Integer)

    mysql = "INSERT INTO DLYMGN (COMPCODE,ConDate,Sauda,IMRate,EMRate,AMRate,TMRate,AddLong,AddShort,SPCashMGLong,SPCashMGShort,ITEMCODE,ExCode,Maturity,ELMLong,ELmShort,Delivery,SaudaId,ITEMID,EXID )"
    mysql = mysql & " VALUES  (" & GCompCode & ",'" & Format(LDConDate, "YYYY/MM/DD") & "','" & LDSauda & "'," & LDImRate & "," & LDEmRate & "," & LDAmRate & "," & LDTmRate & ","
    mysql = mysql & LDAddLong & "," & LDAddShort & "," & LdCashLong & "," & LDCashShort & ",'" & LDItem & "','" & LDExCode & "','" & Format(LDMaturity, "YYYY/MM/DD") & "',"
    mysql = mysql & LDELMLong & "," & LDELmShort & "," & LDDelivery & "," & LDSaudaID & "," & LDItemID & "," & LDExID & ")"
    Cnn.Execute mysql
End Sub
Public Sub PInsert_Ctr_R(ByVal LIConSno As Long, ByVal LISauda As String, ByVal LIConDate As Date, ByVal LIOpenRate As Double, ByVal LIHighRate As Double, ByVal LILowRate As Double, ByVal LISettleRate As Double, ByVal LICloseRate As Double, ByVal LIExCode As String, ByVal LIItemCode As String, ByVal LISaudaId As Long, ByVal LIItemID As Integer, ByVal LIExID As Integer, ByVal LPRATE As Double, LContime As String)
    mysql = "EXEC INSERT_CTR_R " & GCompCode & "," & Val(LIConSno) & ",'" & LISauda & "','" & Format(LIConDate, "yyyy/MM/dd") & "'," & LIOpenRate & ", " & LIHighRate & ", " & LILowRate & "," & LISettleRate & "," & LICloseRate & ",'" & LIExCode & "','" & LIItemCode & "'," & LISaudaId & "," & LIItemID & "," & LIExID & "," & LPRATE & ",'" & LContime & "'"
    Cnn.Execute mysql
End Sub

Public Sub UPDATE_CTR_R()
Dim TRec As ADODB.Recordset:    Dim CompRec  As ADODB.Recordset
Dim LCompCode As Integer:       Dim LSaudaID As Long
Dim LMinDate  As String:        Dim LSauda As String

mysql = "SELECT COMPCODE FROM COMPANY "
Set CompRec = Nothing
Set CompRec = New ADODB.Recordset
CompRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
Do While Not CompRec.EOF
    LCompCode = CompRec!CompCode
    
    mysql = "SELECT DISTINCT SAUDA,SAUDAID FROM CTR_D WHERE COMPCODE=" & LCompCode & " ORDER BY SAUDAID "
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        LSauda = TRec!Sauda
        LSaudaID = TRec!SAUDAID
        LMinDate = Get_Min_Sauda_Condate(LCompCode, LSaudaID)
        DoEvents
        GETMAIN.Label1.Caption = "Updating CTR_R " & LSauda & " DATE " & LMinDate & ""
        If LenB(LMinDate) > 0 Then
            mysql = "DELETE FROM CTR_M WHERE COMPCODE =" & LCompCode & "  AND CONDATE <'" & Format(DateValue(LMinDate), "YYYY/MM/DD") & "' AND SAUDAID =" & LSaudaID & ""
            Cnn.Execute mysql
            mysql = "DELETE FROM CTR_R WHERE COMPCODE =" & LCompCode & "  AND CONDATE <'" & Format(DateValue(LMinDate), "YYYY/MM/DD") & "' AND SAUDAID =" & LSaudaID & ""
            Cnn.Execute mysql
        End If
        TRec.MoveNext
    Loop
    CompRec.MoveNext
Loop
End Sub
Public Sub PINSERT_ACCT_EX(LPAc_Code As String, LPExCode As String, LPAcExCode As String, lpbillby As String, LPEXID As Integer, LPAccID As Long)
    mysql = "EXEC PINSERT_ACCT_EX " & GCompCode & ",'" & LPAc_Code & "','" & LPExCode & "','" & LPAcExCode & "','" & lpbillby & "'," & LPEXID & "," & LPAccID & ""
    Cnn.Execute mysql
End Sub

Function LStr_Exists(ByVal STR1 As String, ByVal STR2 As String) As Boolean
Dim LLists() As String
Dim LCount As Integer
Dim I As Integer
LLists = Split(STR1, ",")
LCount = UBound(LLists)
LStr_Exists = False
For I = 0 To LCount
    If LLists(I) = STR2 Then
        LStr_Exists = True
        Exit Function
    End If
Next I
End Function


Public Sub Check_PExSBrok()
Dim TRec As ADODB.Recordset:    Dim ExRec As ADODB.Recordset:   Dim LExCode As String
Dim LAC_CODE As String:         Dim LXAc_Code As String:        Dim LExID As Integer
Dim LFmlyCode As String:        Dim LFmlyID As Long:            Dim LACCID As Long

Set ExRec = Nothing
Set ExRec = New ADODB.Recordset
mysql = "SELECT EXCODE,EXID,OPTIONS FROM EXMAST WHERE COMPCODE =" & GCompCode & " ORDER BY EXCODE "

ExRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly

Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = "SELECT FMLYID,ACCID,FMLYCODE,PARTY  FROM ACCFMLYD WHERE COMPCODE =" & GCompCode & ""
'If AllParties = False Then MYSQL = MYSQL & " AND AC_CODE IN (" & LSParties & ")"
mysql = mysql & " ORDER BY FMLYCODE,PARTY  "
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        LAC_CODE = TRec!PARTY:        LFmlyCode = TRec!FMLYCODE
        LFmlyID = TRec!FMLYID:        LACCID = TRec!ACCID
        ExRec.MoveFirst
        Do While Not ExRec.EOF
            LExCode = ExRec!excode
            LExID = ExRec!EXID
            GETMAIN.Label1.Caption = "CHECKING FMLY" & LFmlyCode & ""
            DoEvents
            If LExCode = "EQ" Or LExCode = "BEQ" Then
                LXAc_Code = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, LExID, GFinEnd, "CSH")
                If Not LenB(LXAc_Code) > 0 Then
                    Call PINSERT_PEXSBROK(LAC_CODE, LFmlyCode, LExCode, "P", 0, "N", 0, GFinEnd, "CSH", 0, LExID, LFmlyID, LACCID)
                End If
            Else
                If ExRec!Options = "Y" Then
                    LXAc_Code = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, LExID, GFinEnd, "OPT")
                    If Not LenB(LXAc_Code) > 0 Then
                        Call PINSERT_PEXSBROK(LAC_CODE, LFmlyCode, LExCode, "P", 0, "N", 0, GFinEnd, "OPT", 0, LExID, LFmlyID, LACCID)
                    End If
                End If
                LXAc_Code = Get_PEXSBROK_AC_CODE(LFmlyID, LACCID, LExID, GFinEnd, "FUT")
                If Not LenB(LXAc_Code) > 0 Then
                    Call PINSERT_PEXSBROK(LAC_CODE, LFmlyCode, LExCode, "P", 0, "N", 0, GFinEnd, "FUT", 0, LExID, LFmlyID, LACCID)
                End If
            End If
            ExRec.MoveNext
        Loop
        TRec.MoveNext
    Loop
End If

End Sub



Public Sub Check_PExBrok()
Dim TRec As ADODB.Recordset:    Dim ExRec As ADODB.Recordset:   Dim LExCode As String
Dim LAC_CODE As String:         Dim LXAc_Code As String:        Dim LExID As Integer
Dim LACCID  As Long

Set ExRec = Nothing
Set ExRec = New ADODB.Recordset
mysql = "SELECT EXCODE,EXID,OPTIONS FROM EXMAST WHERE COMPCODE =" & GCompCode & " ORDER BY EXCODE "

ExRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly

Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = "SELECT ACCID,AC_CODE FROM ACCOUNTD WHERE COMPCODE =" & GCompCode & ""
mysql = mysql & " ORDER BY ACCID "
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        LAC_CODE = TRec!AC_CODE
        LACCID = TRec!ACCID
        ExRec.MoveFirst
        Do While Not ExRec.EOF
            LExCode = ExRec!excode
            LExID = ExRec!EXID
            If LExCode = "EQ" Or LExCode = "BEQ" Then
                LXAc_Code = Get_PEXBROK_AC_CODE(LACCID, LExID, DateValue(GFinEnd), "CSH")
                If Not LenB(LXAc_Code) > 0 Then
                  mysql = "EXEC INSERT_PEXBROK " & GCompCode & ",'" & LAC_CODE & "','" & LExCode & "','P',0,0,0,0,'P',"
                  mysql = mysql & "0,0,'P',0,0,'I',0,'" & Format(GFinEnd, "YYYY/MM/DD") & "','CSH',0,0," & LExID & "," & LACCID & ""
                  Cnn.Execute mysql
                End If
            Else
                If ExRec!Options = "Y" Then
                    LXAc_Code = Get_PEXBROK_AC_CODE(LACCID, LExID, DateValue(GFinEnd), "OPT")
                    If Not LenB(LXAc_Code) > 0 Then
                        mysql = "EXEC INSERT_PEXBROK " & GCompCode & ",'" & LAC_CODE & "','" & LExCode & "','P',0,0,0,0,'P',"
                        mysql = mysql & "0,0,'P',0,0,'I',0,'" & Format(GFinEnd, "YYYY/MM/DD") & "','OPT',0,0," & LExID & "," & LACCID & ""
                        Cnn.Execute mysql
                    End If
                End If
                LXAc_Code = Get_PEXBROK_AC_CODE(LACCID, LExID, DateValue(GFinEnd), "FUT")
                If Not LenB(LXAc_Code) > 0 Then
                    mysql = "EXEC INSERT_PEXBROK " & GCompCode & ",'" & LAC_CODE & "','" & LExCode & "','P',0,0,0,0,'P',"
                    mysql = mysql & "0,0,'P',0,0,'I',0,'" & Format(GFinEnd, "YYYY/MM/DD") & "','FUT',0,0," & LExID & "," & LACCID & ""
                    Cnn.Execute mysql
                End If
            End If
            ExRec.MoveNext
        Loop
        TRec.MoveNext
    Loop
End If

End Sub

Public Function Get_LastMonthDate(LPDate As Date) As Date
Dim LMONTH As Integer
Dim lyear As Integer
Dim LDT  As Date
LMONTH = month(LPDate)
lyear = Year(LPDate)
If LMONTH = 12 Then
    LMONTH = 1
    lyear = lyear + 1
Else
    LMONTH = LMONTH + 1
End If

LDT = DateValue("01/" & LMONTH & "/" & lyear)
Get_LastMonthDate = LDT - 1

End Function

Public Sub Chk_Trading()
On Error GoTo err1
Dim LSParties As String:        Dim LSSaudas As String:      Dim LCondate  As Date
Dim LCloseRate As Double:       Dim TRec As ADODB.Recordset
Dim LMaxCondate  As Date
LSParties = vbNullString:   LSSaudas = vbNullString
LCondate = Date
Dim LDT As Date
Dim LSaudaCode As String
LMaxCondate = DateValue(GFinEnd) + 1
Set TRec = Nothing:     Set TRec = New ADODB.Recordset
mysql = "SELECT DISTINCT A.CONDATE, A.SAUDAID, A.SAUDA FROM CTR_D  AS A, INV_D as B WHERE A.CompCode =" & GCompCode & " AND A.COMPCODE =B.COMPCODE AND A.BILLNO = B.BILLNO AND A.CONDATE <> B.STDATE ORDER BY A.CONDATE "
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    Do While Not TRec.EOF
        LDT = TRec!Condate
        LSaudaCode = TRec!Sauda
        LCloseRate = 0
        LCloseRate = SDCLRATE(TRec!SAUDAID, TRec!Condate, "C")
        If LCloseRate <> 0 Then
            If LCondate > TRec!Condate Then LCondate = TRec!Condate
            If LenB(LSSaudas) < 1 Then
                LSSaudas = "" & TRec!SAUDAID & ""
            Else
                If LStr_Exists(LSSaudas, Trim(str(TRec!SAUDAID))) = False Then
                    LSSaudas = LSSaudas & "," & Trim(str(TRec!SAUDAID)) & ""
                End If
            End If
        Else
           ' MsgBox "Closing Rate Missing For " & LSaudaCode & " of Date " & LDT & ""
        End If
        TRec.MoveNext
    Loop
End If
If LenB(LSParties) > 0 Then
    MsgBox "Re Billling Missed Parties"
    Cnn.BeginTrans
    CNNERR = True
    If BILL_GENERATION(LCondate, GFinEnd, LSSaudas, vbNullString, vbNullString) Then
        Cnn.CommitTrans
        CNNERR = False
    Else
        Cnn.RollbackTrans
        CNNERR = False
    End If
End If
Exit Sub
err1:
    If err.Number <> 0 Then
        MsgBox err.Description
        
        If CNNERR = True Then
            Cnn.RollbackTrans
            CNNERR = False
        End If
        
    End If
End Sub


Public Sub UPD_EXID()
    GETMAIN.Label1.Caption = "Updateing EXID ITEMMAST  "
    DoEvents
    
    
    
    
    mysql = "IF COL_LENGTH('DAILYMARGIN','EXID') IS NULL ALTER TABLE DAILYMARGIN ADD EXID INT "
    Cnn.Execute mysql
    mysql = "UPDATE DAILYMARGIN SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =DAILYMARGIN.COMPCODE AND EXMAST.EXCODE = DAILYMARGIN.EXCODE) WHERE EXID IS NULL"
    Cnn.Execute mysql
    
    
    
End Sub
Public Function Create_ItemMast(ByVal LPItemCode As String, ByVal LPItemName As String, ByVal LPExhCode As String, ByVal LPLot As Double, ByVal LPExCode As String, LPEXID As Integer) As String
Dim LItem As String
'Dim LEXID As Integer
'LEXID = Get_ExID(LPExCode)
LItem = Get_ItemMaster(LPEXID, LPExhCode)
If LenB(LItem) < 1 Then
    If Duplicate_Item_Chk(LPItemCode) Then
        LPItemCode = Trim(LPExCode) & " " & Trim(LPItemCode)
        If Duplicate_Item_Chk(LPItemCode) Then
            MsgBox "Please Check Entry for " & LPExhCode & ""
            Create_ItemMast = vbNullString
            Exit Function
        End If
    End If
    Call PInsert_ItemMast(LPItemCode, LPItemName, LPLot, LPExhCode, LPExCode, vbNullString, vbNullString, 0, vbNullString, "N", "N", "N", "01/07/2013", LPEXID)
    LItem = LPItemCode
End If
Create_ItemMast = LItem
End Function

Public Sub Post_Inv_d(LVParties As String, LVSaudas As String, LVExIDs As String, LVFromDate As Date)
On Error GoTo err1
Dim LInvdRec As ADODB.Recordset:    Dim LParty As String:       Dim LExCode As String:         Dim LExID As Integer:       Dim LBIllAmt As Double
Dim LIVouNo As String:              Dim LBrokAmt  As Double:    Dim LDiffAmt As Double:        Dim LMVNo As Long:          Dim LPartyType  As String
Dim LPartyDrCr As String:           Dim LContraDrCr As String:  Dim LBillDate As Date:         Dim LDiffDrCr As String:    Dim LBrokDrCr As String
Dim LNarration As String:           Dim LPartyName As String:   Dim LTradingAcc As String:     Dim LBrokAcc As String:     Dim LCGSTAcc As String:
Dim LIGSTAcc As String:             Dim LSGSTAcc As String:     Dim LStampAcc As String:       Dim LSBCAcc As String:      Dim LSrvTaxAcc As String
Dim LStandAcc As String:            Dim LTranAcc As String:     Dim LSEBIAcc As String:        Dim LCTTAcc As String:      Dim LRiskMAcc As String
Dim LICGSTDrCr As String:           Dim LISGSTDrCr As String:   Dim LIIGSTDrCr As String:      Dim LISGSTAmt As Double:    Dim LICGSTAmt As Double
Dim LIIGSTAmt As Double:            Dim LTranDrCr As String:    Dim LSrvTAxDrCr As String:     Dim LStandDrCr As String:   Dim LTanAmt As Double
Dim LSrvTaxAmt  As Double:          Dim LStandAmt  As Double:   Dim LSEBITaxDrCr As String:    Dim LCTTDrCr As String:     Dim LSBCDrCr As String
Dim LSEBITaxAmt As Double:          Dim LCttAmt  As Double:     Dim LSBCDrCrR  As Double:      Dim LIStampDrCr As String:  Dim LIStampAmt As Double
Dim LTranAmt As Double:             Dim LRiskMDrCr As String:   Dim LISBCAmt As Double:        Dim LRiskMAmt As Double:    Dim LHeadAc As String
Dim LFmlyCode As String:            Dim LContraAc As String:    Dim LBBrokAmt As Double:       Dim LShareAmt As Double:    Dim LShNarration As String
Dim LShVouNo As String:             Dim MDR As String:          Dim MCR As String:             Dim BVNO As Long:           Dim SVNO As Long
Dim GMaxBVouNo As Long:             Dim GMaxHVouNo As Long:     Dim LCHK  As ADODB.Recordset:                           Dim LExRec As ADODB.Recordset
Dim LBillParties As String:         Dim LCurrency  As String:   Dim LACCID As Long:           Dim TradingAccID As Long

Dim LBrokAccID As Long:             Dim LFmlyID As Long:        Dim LHeadID   As Long:        Dim LContraID  As Long
Dim LExpAccID As Long:              Dim LBankAccID As Long:     Dim LCGSTAccID As Long:       Dim LSGSTAccID As Long
Dim LIGSTAccID As Long:             Dim LSBCAccID  As Long:     Dim LSrvTaxAccID As Long:     Dim LRiskMAccID As Long
Dim LStandAccID  As Long:           Dim LTranAccID As Long:     Dim LCTTAccID As Long:        Dim LStampAccID  As Long
Dim LSEBIAccID As Long:             Dim LNBOTBank As String
Dim LBillBy As String
Dim mbcycle As String
Dim lastsettle As Date: Dim msettleday As Date



Dim LLowRate As Double
Dim LHGRate As Double
Dim LFIXRate As Double

Dim RateRec As ADODB.Recordset
Dim TRec As New ADODB.Recordset
Dim SetRec As New ADODB.Recordset

mysql = "SELECT * FROM EXMAST WHERE COMPCODE =" & GCompCode & " "
If LenB(LVExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LVExIDs & ") "
Set LExRec = Nothing
Set LExRec = New ADODB.Recordset
LExRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly

Dim LChkVouRec As ADODB.Recordset
Set LInvdRec = Nothing
Set LInvdRec = New ADODB.Recordset
If GOnlyBrok <> 0 Then
    mysql = "SELECT A.PARTYTYPE,A.NAME,I.STDATE,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE ,SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT FROM INV_D AS I, ACCOUNTD AS A "
    mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & " AND A.ACCID =I.ACCID   "
    mysql = mysql & " AND i.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='N') "
    mysql = mysql & " AND STDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
    If LenB(LVParties) > 0 Then mysql = mysql & " AND I.PARTY IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY I.EXCODE,I.STDATE,A.AC_CODE,A.PARTYTYPE,A.NAME,I.EXID,A.ACCID "
    mysql = mysql & " ORDER BY I.EXCODE,I.STDATE,A.AC_CODE"
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
Else
    mysql = "SELECT A.PARTYTYPE,A.NAME,I.STDATE,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE ,SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT "
    mysql = mysql & " ,SUM(TRANAMT) AS TRANAMT,SUM(SRVAMT) AS SRVAMT,SUM(RISKMAMT) AS RISKMAMT,SUM(STDAMT) AS STDAMT"
    mysql = mysql & ", SUM(SBC_TAX_AMT) AS SBCTAXAMT ,SUM(STTTAX) AS CTTAMT ,SUM(SEBITAXAMT) AS SEBITAX "
    mysql = mysql & ", SUM(CGSTAMT) AS CGSTAMT,SUM(SGSTAMT) AS SGSTAMT,SUM(IGSTAMT) AS IGSTAMT, SUM(STAMPAMT) AS STAMPAMT "
    mysql = mysql & " FROM INV_D AS I, ACCOUNTD AS A WHERE A.COMPCODE =" & GCompCode & " AND A.ACCID =I.ACCID AND "
    mysql = mysql & " STDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "' "
    mysql = mysql & " AND EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='N') "
    If LenB(LVParties) > 0 Then mysql = mysql & " AND I.PARTY IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY I.EXCODE,I.STDATE,A.AC_CODE,A.PARTYTYPE,A.NAME,I.EXID,A.ACCID"
    mysql = mysql & " ORDER BY I.EXCODE,I.STDATE,A.AC_CODE"
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
End If
    If Not LInvdRec.EOF Then
        GMaxVouNo = Val(Right$(Get_VouNo("SETL", GFinYear), 7))
        GMaxBVouNo = Val(Right$(Get_VouNo("BROK", GFinYear), 7))
        GMaxHVouNo = Val(Right$(Get_VouNo("SHAR", GFinYear), 7))
        LInvdRec.MoveFirst
    End If
    Do While Not LInvdRec.EOF
        LExCode = LInvdRec!excode
        LExID = LInvdRec!EXID
        LExRec.MoveFirst
        LExRec.Find "EXID=" & LExID & ""
        If Not LExRec.EOF Then
            LTradingAcc = LExRec!TRADINGACC & vbNullString:    LBrokAcc = LExRec!BROKAC & vbNullString:
            LBrokAccID = Get_AccID(LBrokAcc)
            TradingAccID = Get_AccID(LTradingAcc)
            If GOnlyBrok = 0 Then
                LNBOTBank = LExRec!BANKACC & vbNullString:    LCGSTAcc = (LExRec!CGSTACC & vbNullString):           LSGSTAcc = (LExRec!SGSTACC & vbNullString):
                LSBCAcc = (LExRec!SBCACC & vbNullString):       LSrvTaxAcc = (LExRec!SrvTaxACC & vbNullString):     LStandAcc = (LExRec!standac & vbNullString)
                LTranAcc = (LExRec!tranac & vbNullString):      LCTTAcc = (LExRec!TRANTAX & vbNullString):          LRiskMAcc = (LExRec!RISKMACC & vbNullString)
                LSEBIAcc = (LExRec!STCACC & vbNullString):      LStampAcc = (LExRec!SDutyTaxAcc & vbNullString):    LIGSTAcc = (LExRec!IGSTACC & vbNullString):
                
                LBankAccID = Get_AccID(LNBOTBank):                LCGSTAccID = Get_AccID(LCGSTAcc)
                LSGSTAccID = Get_AccID(LSGSTAcc):                 LIGSTAccID = Get_AccID(LIGSTAcc)
                LSBCAccID = Get_AccID(LSBCAcc):                   LSrvTaxAccID = Get_AccID(LSrvTaxAcc)
                LStandAccID = Get_AccID(LStandAcc):               LTranAccID = Get_AccID(LTranAcc)
                LCTTAccID = Get_AccID(LCTTAcc):                   LRiskMAccID = Get_AccID(LRiskMAcc)
                LSEBIAccID = Get_AccID(LSEBIAcc):                 LStampAccID = Get_AccID(LStampAcc)
            End If
        End If

        LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
        Do While LExID = LInvdRec!EXID
            LBillDate = LInvdRec!STDATE:
            GETMAIN.Label1.Caption = LExCode & " Posting Bill Voucher " & LBillDate
            DoEvents
            
            Do While LBillDate = LInvdRec!STDATE And LExID = LInvdRec!EXID

                If GOnlyBrok = 0 Then
                    LICGSTDrCr = "C":    LISGSTDrCr = "C":  LIIGSTDrCr = "C"
                    LIStampDrCr = "C":   LSBCDrCr = "C":    LSrvTAxDrCr = "C":  LStandDrCr = "C"
                    LTranDrCr = "C":     LCTTDrCr = "C":    LRiskMDrCr = "C":   LSEBITaxDrCr = "C":

                    LStandAmt = 0:       LTranAmt = 0:      LIStampAmt = 0:
                    LICGSTAmt = 0:       LISGSTAmt = 0:     LIIGSTAmt = 0:
                    LCttAmt = 0:         LSrvTaxAmt = 0:    LRiskMAmt = 0
                    LSEBITaxAmt = 0:     LISBCAmt = 0
                End If
                LParty = LInvdRec!AC_CODE
                LACCID = LInvdRec!ACCID
                mbcycle = "D"

                mysql = "SELECT BCYCLE FROM ACCOUNTD WHERE COMPCODE = " & GCompCode & " AND AC_CODE = '" & LParty & "' "
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    mbcycle = TRec!BCYCLE
                End If
                LPartyName = LInvdRec!NAME:
                LPartyType = LInvdRec!PARTYTYPE
                
                If gcurrtype = 1 And LExCode = "CMX" And mbcycle = "S" Then
                    LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
                    Do While LBillDate = LInvdRec!STDATE And LExID = LInvdRec!EXID And LInvdRec!NAME = LPartyName
                        LBIllAmt = LBIllAmt + LInvdRec!BAMT
                        LBrokAmt = LBrokAmt + LInvdRec!BrAMT:
                        LDiffAmt = LDiffAmt + LInvdRec!dAMT
                        LInvdRec.MoveNext
                        If LInvdRec.EOF Then Exit Do
                    Loop
                Else
                    LBrokAmt = LInvdRec!BrAMT:      LBIllAmt = LInvdRec!BAMT
                    LDiffAmt = LInvdRec!dAMT
                End If
                
                LBillBy = "S"
                Set TRec = Nothing
                mysql = "SELECT BILLBY FROM ACCT_EX WHERE ACCID = '" & LACCID & "' AND EXID ='" & LExID & "'  "
                TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not TRec.EOF Then
                    LBillBy = TRec!billby
                End If
                
                LDiffDrCr = "C":    LBrokDrCr = "C":    LPartyDrCr = "C":
                If Val(LBIllAmt) < 0 Then LPartyDrCr = "D"
                If Val(LDiffAmt) > 0 Then LDiffDrCr = "D"
                If Val(LBrokAmt) > 0 Then LBrokDrCr = "D"
                
                If GOnlyBrok = 0 Then
                    LICGSTAmt = LInvdRec!cgstamt
                    If LICGSTAmt > 0 Then LICGSTDrCr = "D"
                    LISGSTAmt = LInvdRec!SGSTAMT
                    If LISGSTAmt > 0 Then LISGSTDrCr = "D"
                    LIIGSTAmt = LInvdRec!IGSTAMT
                    If LIIGSTAmt > 0 Then LIIGSTDrCr = "D"
                    LIStampAmt = LInvdRec!STampamt
                    If LIStampAmt > 0 Then LIStampDrCr = "D"
                    LTranAmt = LInvdRec!TranAmt
                    If LTranAmt > 0 Then LTranDrCr = "D"
                    LStandAmt = LInvdRec!STDAMT
                    If LStandAmt > 0 Then LStandDrCr = "D"
                    LRiskMAmt = LInvdRec!RISKMAMT
                    If LRiskMAmt > 0 Then LRiskMDrCr = "D"
                    LSrvTaxAmt = LInvdRec!SRVAMT
                    If LSrvTaxAmt > 0 Then LSrvTAxDrCr = "D"
                    LCttAmt = LInvdRec!CTTAMT
                    If LCttAmt > 0 Then LCTTDrCr = "D"
                    LSEBITaxAmt = LInvdRec!SEBITAX
                    If LSEBITaxAmt > 0 Then LSEBITaxDrCr = "D"
                    LISBCAmt = LInvdRec!SBCTaxAmt
                    If LISBCAmt > 0 Then LSBCDrCr = "D"
                End If

                ''
                ''''Currency Type = 1
                If gcurrtype = 1 And LExCode = "CMX" Then
                    mysql = "SELECT CLOSERATE,HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LBillDate, "yyyy/mm/dd") & "' "
                    Set RateRec = Nothing
                    Set RateRec = New ADODB.Recordset
                    RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not RateRec.EOF Then
                        If LBillBy = "S" Then
                            LLowRate = RateRec!CLOSERATE
                            LHGRate = RateRec!CLOSERATE
                        Else
                            LLowRate = RateRec!LOWRATE
                            LHGRate = RateRec!HGRATE
                        End If
                    Else
                        LLowRate = 1
                        LHGRate = 1
                    End If
                    
                    If LBillBy = "P" Then
                        Set RateRec = Nothing
                        Set RateRec = New ADODB.Recordset
                        mysql = "SELECT TOP 1 LOW,HIGH FROM CTR_RP WHERE ACCID = " & LACCID & " AND SAUDA ='USDINR' AND CONDATE = '" & Format(LBillDate, "yyyy/mm/dd") & "' "
                        RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                        If Not RateRec.EOF Then
                            LLowRate = IIf(RateRec!LOW = 0, LLowRate, RateRec!LOW)
                            LHGRate = IIf(RateRec!HIGH = 0, LHGRate, RateRec!HIGH)
                        End If

                        Set RateRec = Nothing
                   End If
                   If LPartyType <> 2 Then
                        If LBIllAmt > 0 Then

                            LDiffAmt = LDiffAmt * LLowRate

                            If GUniqClientId = "BRO2-CHE" Then
                                LBrokAmt = LBrokAmt * LHGRate
                                LBIllAmt = LDiffAmt + LBrokAmt
                            Else
                                LBIllAmt = LBIllAmt * LLowRate
                                LBrokAmt = LBrokAmt * LLowRate
                            End If
                            LFIXRate = LLowRate
                        Else
                            LBIllAmt = LBIllAmt * LHGRate
                            LDiffAmt = LDiffAmt * LHGRate
                            LBrokAmt = LBrokAmt * LHGRate
                            LFIXRate = LHGRate
                        End If
                    Else
                        If LBIllAmt < 0 Then
                            LBIllAmt = LBIllAmt * LLowRate
                            LDiffAmt = LDiffAmt * LLowRate
                            If GUniqClientId = "BRO2-CHE" Then
                                LBrokAmt = LBrokAmt * LHGRate
                            Else
                                LBrokAmt = LBrokAmt * LLowRate
                            End If
                            LFIXRate = LLowRate
                        Else
                            LBIllAmt = LBIllAmt * LHGRate
                            LDiffAmt = LDiffAmt * LHGRate
                            LBrokAmt = LBrokAmt * LHGRate
                            LFIXRate = LHGRate
                        End If
                    End If
                End If
                ''
                If Abs(LDiffAmt) + Abs(LBrokAmt) + Abs(LBIllAmt) <> 0 Then
                    LIVouNo = Get_Next_Vou_No(GMaxVouNo, "SETL", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                    GMaxVouNo = GMaxVouNo + 1
                    LMVNo = PInsert_Voucher(LIVouNo, LBillDate, "S", "P", 0, "ADD", LParty, 0, vbNullString, LExCode, "0", LExID, 0)
                    mysql = "EXEC UPD_INVD_VNO " & LACCID & ",'" & Format(LBillDate, "YYYY/MM/DD") & "'," & LExID & "," & LMVNo & ",'" & LIVouNo & "'"
                    Cnn.Execute mysql
                    
                    LNarration = LExCode & "Settlement"
                    If LPartyType = "3" Then
                        'NBOT BANK AC POSTING
                        If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, GNBOTBank, Abs(Val(LBIllAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBankAccID)
                    Else
                        ''PARTY AC POSTING
                        If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, LParty, Abs(Val(LBIllAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                    End If
                    If LDiffAmt <> 0 Then
                        LNarration = "Settlemet " & LExCode & " " & LPartyName & " " & LParty
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LDiffDrCr, LTradingAcc, Abs(Val(LDiffAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, TradingAccID)
                    End If
                    If LBrokAmt <> 0 Then
                        LNarration = "Brok " & LExCode & " " & LPartyName & " " & LParty
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LBrokDrCr, LBrokAcc, Abs(Val(LBrokAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBrokAccID)
                    End If
                End If
                
                If GOnlyBrok = 0 Then
                    LNarration = "Exp " & LExCode & " " & LPartyName & " " & LParty
                    If LICGSTAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LICGSTDrCr, LCGSTAcc, Abs(Val(LICGSTAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LCGSTAccID)
                    If LISGSTAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LISGSTDrCr, LSGSTAcc, Abs(Val(LISGSTAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSGSTAccID)
                    If LIIGSTAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LIIGSTDrCr, LIGSTAcc, Abs(Val(LIIGSTAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LIGSTAccID)
                    If LIStampAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LIStampDrCr, LStampAcc, Abs(Val(LIStampAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LStampAccID)
                    If LISBCAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LSBCDrCr, LSBCAcc, Abs(Val(LISBCAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSBCAccID)
                    If LCttAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LCTTDrCr, LCTTAcc, Abs(Val(LCttAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LCTTAccID)
                    If LRiskMAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LRiskMDrCr, LRiskMAcc, Abs(Val(LRiskMAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LRiskMAccID)
                    If LSEBITaxAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LSEBITaxDrCr, LSEBIAcc, Abs(Val(LSEBITaxAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSEBIAccID)
                    If LStandAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LStandDrCr, LStandAcc, Abs(Val(LStandAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LStandAccID)
                    If LTranAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LTranDrCr, LTranAcc, Abs(Val(LTranAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LTranAccID)
                    If LSrvTaxAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LSrvTAxDrCr, LSrvTaxAcc, Abs(Val(LSrvTaxAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSrvTaxAccID)
                End If
                
                ''''''''
                If gcurrtype = 1 And LExCode = "CMX" And mbcycle = "S" Then
                    'Update Same usdinr in all bills of same date
                    mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE <='" & Format((LBillDate - 1), "YYYY/MM/DD") & "' ORDER BY SETDATE DESC"
                    Set TRec = Nothing
                    Set TRec = New ADODB.Recordset
                    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not TRec.EOF Then
                        lastsettle = TRec!SETDATE
                    Else
                        lastsettle = LBillDate - 7
                    End If
                    
                    mysql = "UPDATE INV_D SET currrate =" & LHGRate & " ,USDINR = " & LFIXRate & " WHERE COMPCODE = " & GCompCode & " AND EXID = " & LExID & " And STDATE > '" & Format(lastsettle, "YYYY/MM/DD") & "'  And STDATE <= '" & Format(LBillDate, "YYYY/MM/DD") & "' AND PARTY ='" & LParty & "'"
                    Cnn.Execute mysql

                    'If Not SetRec.EOF Then
                    '     LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
                    'End If
                End If
nextrec:
                If Not LInvdRec.EOF And Not (gcurrtype = 1 And LExCode = "CMX" And mbcycle = "S") Then
                    LInvdRec.MoveNext
                End If
                If LInvdRec.EOF Then Exit Do
            Loop
            If LInvdRec.EOF Then Exit Do
        Loop
        If LInvdRec.EOF Then Exit Do
    Loop
    
    GETMAIN.ProgressBar1.Visible = False
    GETMAIN.PERLBL.Caption = vbNullString
    Set LInvdRec = Nothing
    Set LInvdRec = New ADODB.Recordset
    mysql = "SELECT B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRA_AC,B.CONTRAID,A.STDATE,A.ACCID,C.AC_CODE ,C.NAME,A.EXCODE,A.EXID,AD.PARTYTYPE,"
    mysql = mysql & " SUM(A.AMOUNT) AS BROKAMT ,SUM(A.SAMOUNT) AS SHAREAMT FROM INV_D1 AS A,ACCFMLY AS B, ACCOUNTM AS C,ACCOUNTD AS AD"
    mysql = mysql & " Where C.COMPCODE =" & GCompCode & " AND A.FMLYID  = B.FMLYID AND A.ACCID = AD.ACCID  AND A.ACCID = C.ACCID "
    mysql = mysql & " AND A.STDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
    mysql = mysql & " AND A.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='N') "
    If LenB(LVParties) > 0 Then mysql = mysql & " AND C.AC_CODE  IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND A.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRA_AC,B.CONTRAID,A.STDATE,A.ACCID,C.AC_CODE ,C.NAME,A.EXCODE,A.EXID,AD.PARTYTYPE"
    mysql = mysql & " ORDER BY A.STDATE,B.FMLYCODE,C.AC_CODE  ,A.EXCODE"
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not LInvdRec.EOF
        LBillDate = LInvdRec!STDATE
        GETMAIN.Label1.Caption = "Posting Share Voucher " & LBillDate
        DoEvents
        Do While LBillDate = LInvdRec!STDATE
            LIVouNo = vbNullString:                  LShVouNo = vbNullString
            BVNO = 0:                                SVNO = 0
            LBBrokAmt = LInvdRec!BROKAMT:            LShareAmt = LInvdRec!SHAREAMT
            LFmlyCode = LInvdRec!FMLYCODE:           LHeadAc = LInvdRec!FMLYHEAD
            LContraAc = LInvdRec!Contra_Ac:          LParty = LInvdRec!AC_CODE
            LPartyName = LInvdRec!NAME:              LExCode = LInvdRec!excode:
            LExID = LInvdRec!EXID:                   LFmlyID = LInvdRec!FMLYID:
            LACCID = LInvdRec!ACCID:                 LHeadID = LInvdRec!HEADID
            LContraID = LInvdRec!CONTRAID
            LPartyType = LInvdRec!PARTYTYPE
            
            LBillBy = "S"
            Set TRec = Nothing
            mysql = "SELECT BILLBY FROM ACCT_EX WHERE ACCID = '" & LACCID & "' AND EXID ='" & LExID & "'  "
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                LBillBy = TRec!billby
            End If
            

    ''''Currency Type = 1
            If gcurrtype = 1 And LExCode = "CMX" Then
    
                mysql = "SELECT CLOSERATE,HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LBillDate, "yyyy/mm/dd") & "' "
                Set RateRec = Nothing
                Set RateRec = New ADODB.Recordset
                RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not RateRec.EOF Then
                    If LBillBy = "S" Then
                        LLowRate = RateRec!CLOSERATE
                        LHGRate = RateRec!CLOSERATE
                    Else
                        LLowRate = RateRec!LOWRATE
                        LHGRate = RateRec!HGRATE
                    End If
                Else
                    LLowRate = 1
                    LHGRate = 1
                End If
                Set RateRec = Nothing
                
                If LPartyType <> 2 Then
                    If LBBrokAmt > 0 Then
                        If GUniqClientId = "BRO2-CHE" Then
                            LBBrokAmt = LBBrokAmt * LHGRate
                        Else
                            LBBrokAmt = LBBrokAmt * LLowRate
                        End If
                    Else
                        LBBrokAmt = LBBrokAmt * LHGRate
                    End If
                
                    If LShareAmt > 0 Then
                        LShareAmt = LShareAmt * LLowRate
                    Else
                        LShareAmt = LShareAmt * LHGRate
                    End If
                Else
                    If LBBrokAmt < 0 Then
                        If GUniqClientId = "BRO2-CHE" Then
                            LBBrokAmt = LBBrokAmt * LHGRate
                        Else
                            LBBrokAmt = LBBrokAmt * LLowRate
                        End If
                    Else
                        LBBrokAmt = LBBrokAmt * LHGRate
                    End If
                
                    If LShareAmt < 0 Then
                        LShareAmt = LShareAmt * LLowRate
                    Else
                        LShareAmt = LShareAmt * LHGRate
                    End If
                End If
            End If
            
            If LBBrokAmt <> 0 Then
                If LBBrokAmt > 0 Then
                    MDR = "C": MCR = "D"
                Else
                    MDR = "D": MCR = "C"
                End If
                LIVouNo = Get_Next_Vou_No(GMaxBVouNo, "BROK", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxBVouNo = GMaxBVouNo + 1
                LShNarration = LExCode & " Sub Brok For " & LPartyName & ""
                BVNO = PInsert_Voucher(LIVouNo, LBillDate, "B", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MDR, LHeadAc, Abs(LBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LHeadID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MCR, LBrokAcc, Abs(LBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LBrokAccID)
            End If
            If LShareAmt <> 0 Then
                If LShareAmt < 0 Then
                    MCR = "D": MDR = "C"
                Else
                    MCR = "C": MDR = "D"
                End If
                LShVouNo = Get_Next_Vou_No(GMaxHVouNo, "SHAR", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxHVouNo = GMaxHVouNo + 1
                LShNarration = LExCode & " Share Amt For Client " & LPartyName & " "
                SVNO = PInsert_Voucher(LShVouNo, LBillDate, "H", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                    'PARTY AC POSTING
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MCR, LContraAc, Abs(Val(LShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LContraID)
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MDR, LHeadAc, Abs(Val(LShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LHeadID)
            End If
            'MYSQL = "UPDATE INV_D1 SET BVNO=" & BVNO & ",SVNO=" & SVNO & ",VOU_NO='" & LIVouNo & "',SVOU_NO='" & LShVouNo & "' WHERE COMPCODE =" & GCompCode & " "
            'MYSQL = MYSQL & " AND PARTY ='" & LParty & "' AND FMLYCODE ='" & LFmlyCode & "' AND EXID =" & LEXID & ""
            'MYSQL = MYSQL & " AND STDATE ='" & Format(LBillDate, "YYYY/MM/DD") & "'"
            mysql = "EXEC UPD_INVD1_VNO " & LFmlyID & "," & LACCID & ",'" & Format(LBillDate, "YYYY/MM/DD") & "'," & LExID & "," & BVNO & "," & SVNO & ",'" & LIVouNo & "','" & LShVouNo & "'"
            Cnn.Execute mysql
            LInvdRec.MoveNext
            If LInvdRec.EOF Then Exit Do
        Loop
        If LInvdRec.EOF Then Exit Do
    Loop
        'COMMEX inr posting for settlement billing
        Call Post_Inv_d5(LVParties, LVSaudas, LVExIDs, LVFromDate)
        'COMMEX inr posting for datewise billing
        Call Post_Inv_d6(LVParties, LVSaudas, LVExIDs, LVFromDate)
    'End If
    Exit Sub
GETMAIN.ProgressBar1.Visible = False
err1:
 MsgBox (err.Description)


End Sub
Public Sub UPD_ACCID()
    On Error GoTo err1
    GETMAIN.Label1.Caption = "Updating ACCID ACCOUNTD "
    DoEvents
    
    mysql = "IF COL_LENGTH('CTR_RP','ACCID') IS NULL ALTER TABLE CTR_RP ADD ACCID  INT "
    Cnn.Execute mysql
    mysql = "UPDATE CTR_RP SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_RP SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=CTR_RP.COMPCODE AND ACCOUNTM.AC_CODE  = CTR_RP.PARTY ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    Exit Sub
err1:
     If err.Number <> 0 Then
        MsgBox err.Description
     End If
End Sub



Public Sub VER_AC_GROUP()
GETMAIN.Label1.Caption = "Data Integration Check AC_GROUP "
DoEvents
    Call Delete_DependentConstrainst("AC_GROUP", "COMPCODE")
    Call AddAlter_Column("AC_GROUP", "DROP COLUMN", "COMPCODE", vbNullString)
    
    Call Delete_DependentConstrainst("AC_GROUP", "G_CAT")
    Call AddAlter_Column("AC_GROUP", "DROP COLUMN", "G_CAT", vbNullString)
    
    Call Delete_DependentConstrainst("AC_GROUP", "KEYGROUP")
    Call AddAlter_Column("AC_GROUP", "DROP COLUMN", "KEYGROUP", vbNullString)
    
    Call Delete_DependentConstrainst("AC_GROUP", "MAINGRP")
    Call AddAlter_Column("AC_GROUP", "DROP COLUMN", "MAINGRP", vbNullString)
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'AC_GROUP' AND COLUMN_NAME ='CODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER  TABLE AC_GROUP ALTER COLUMN CODE SMALLINT NOT NULL"
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("AC_GROUP") = False Then
        mysql = "ALTER TABLE AC_GROUP ADD Primary key (CODE)"
        Cnn.Execute mysql
    End If
    
    
End Sub
Public Sub VER_COMPANY()
    GETMAIN.Label1.Caption = "Data Integration Check COMPANY"
    DoEvents
    
    Call Delete_DependentConstrainst("COMPANY", "ADD2")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "ADD2", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "STSRVDATE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "STSRVDATE", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "STSRV")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "STSRV", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "STDTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "STDTYPE", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "SOFTWARETYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "SOFTWARETYPE", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "SRVDATE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "SRVDATE", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "SRSTDYN")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "SRSTDYN", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "MARTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "MARTYPE", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "STDCHRTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "STDCHRTYPE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BROKAC")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BROKAC", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "STANDAC")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "STANDAC", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "TRANAC")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "TRANAC", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "SHREEAC")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "SHREEAC", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "TRADEAC")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "TRADEAC", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "NBOTBANK")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "NBOTBANK", vbNullString)
    
    Call Delete_DependentConstrainst("COMPANY", "REFTIME")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "REFTIME", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "MCX")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "MCX", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "NSE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "NSE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "NCDX")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "NCDX", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BSE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BSE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "NBOT")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "NBOT", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "NMCE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "NMCE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "ACE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "ACE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "EQ")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "EQ", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BEQ")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BEQ", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "ICEX")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "ICEX", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "CMX")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "CMX", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "DGCX")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "DGCX", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "PRINTTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "PRINTTYPE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "CCONTRACT")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "CCONTRACT", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BCYCLE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BCYCLE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "PACKDATA")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "PACKDATA", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "REMINV")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "REMINV", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "PCODE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "PCODE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "PHEADER")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "PHEADER", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "NETWORK")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "NETWORK", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "PRINTID")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "PRINTID", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "DEMO")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "DEMO", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "CASHWITHCODE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "CASHWITHCODE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "OPTIONSYN")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "OPTIONSYN", vbNullString)
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "SRVYN", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "AMTCALBY")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "AMTCALBY", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "RATESLAB")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "RATESLAB", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "VOUPR")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "VOUPR", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BROKTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BROKTYPE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BROKRATE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BROKRATE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "BROKERTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "BROKERTYPE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "MVOU")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "MVOU", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "MARTYPE")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "MARTYPE", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "REGNO2")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "REGNO2", vbNullString)
    Call Delete_DependentConstrainst("COMPANY", "CALVAL")
    Call AddAlter_Column("COMPANY", "DROP COLUMN", "CALVAL", vbNullString)
    
    
    VER_ADJ "COMPANY", "COMPCODE", "INT", , "0"
    VER_ADJ "COMPANY", "NAME", "VARCHAR", 100, "0"
    VER_ADJ "COMPANY", "ADD1", "VARCHAR", 200, "0"
    VER_ADJ "COMPANY", "CITY", "VARCHAR", 20, "0"
    VER_ADJ "COMPANY", "PIN", "VARCHAR", 6, "0"
    VER_ADJ "COMPANY", "STATE", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "PHONEO", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "PHONER", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "MOBILE", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "FAX", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "EMAIL", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "FINBEGIN", "SMALLDATETIME", , ""
    VER_ADJ "COMPANY", "FINEND", "SMALLDATETIME", , ""
    VER_ADJ "COMPANY", "RPT_PATH", "VARCHAR", 200, "0"
    VER_ADJ "COMPANY", "PARTYCODETYPE", "VARCHAR", 1, "N"
    
    VER_ADJ "COMPANY", "FlagDataImport", "CHAR", 1, "Y"
    VER_ADJ "COMPANY", "FlagDataBackup", "CHAR", 1, "Y"
    VER_ADJ "COMPANY", "FlagLiveRate", "CHAR", 1, "N"
    VER_ADJ "COMPANY", "INTTYPE", "CHAR", 1, "S"
    VER_ADJ "COMPANY", "INTT1", "CHAR", 1, "2"
    VER_ADJ "COMPANY", "AUTOUPDLOT", "CHAR", 1, "Y"
        
    Call CHK_DEFAULT("COMPANY", "PARTYCODETYPE", "N")
    
    VER_ADJ "COMPANY", "AUTOBROK", "BIT", , "0"
    VER_ADJ "COMPANY", "BillingCycle", "BIT", , "1"
    VER_ADJ "COMPANY", "INVOICE", "BIT", , "0"
    
    VER_ADJ "COMPANY", "CTRTYPE", "VARCHAR", 15, "7"
    VER_ADJ "COMPANY", "ROUNDOFF", "VARCHAR", 1, "Y"
    
    VER_ADJ "COMPANY", "APPSPREAD", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "SETINVNO", "VARCHAR", 1, "S"
    VER_ADJ "COMPANY", "DPATH", "VARCHAR", 100, "0"
    VER_ADJ "COMPANY", "PANNO", "VARCHAR", 50, "0"
    VER_ADJ "COMPANY", "APPCNOTE", "VARCHAR", 1, "0"
    VER_ADJ "COMPANY", "SYSLOCKDT", "SMALLDATETIME", , ""
    VER_ADJ "COMPANY", "CHECKRT", "VARCHAR", 1, "Y"
    VER_ADJ "COMPANY", "MINBROK", "FLOAT", , "0"
    VER_ADJ "COMPANY", "ACORDER", "VARCHAR", 1, "C"
    VER_ADJ "COMPANY", "TRANFEES", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "StampDuty", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "ValueWise", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "Standing", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "MinBrokYN", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "STT", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "SubBrok", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "SrvTax", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "UNIQCLIENTID", "VARCHAR", 50, "N"
    VER_ADJ "COMPANY", "MARGIN", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "GenQuery", "VARCHAR", 1, "1"
    VER_ADJ "COMPANY", "STMDT", "SMALLDATETIME", , "2015/01/10"
    VER_ADJ "COMPANY", "BUYSELLBROK", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "SEBIREGNO", "VARCHAR", 20, ""
    VER_ADJ "COMPANY", "GSTIN", "VARCHAR", 20, ""
    VER_ADJ "COMPANY", "SHOWLOT", "VARCHAR", 1, "0"
    VER_ADJ "COMPANY", "SHOWLOTENTRY", "CHAR", 1, "0"
    VER_ADJ "COMPANY", "OnlyBrok", "INT", , "0"
    VER_ADJ "COMPANY", "ConNoType", "INT", , "0"
    VER_ADJ "COMPANY", "SHOWSTD", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "EQ", "VARCHAR", 1, "0"
    VER_ADJ "COMPANY", "CINNO", "VARCHAR", 1, "0"
    VER_ADJ "COMPANY", "AmtDivide", "VARCHAR", 1, "0"
    VER_ADJ "COMPANY", "QTY_DECIMAL", "BIT", , "0"
    VER_ADJ "COMPANY", "OrderEntry", "VARCHAR", 1, "N"
    VER_ADJ "COMPANY", "currtype", "INT", , "0"

    mysql = "ALTER TABLE COMPANY ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
       
    mysql = "ALTER TABLE COMPANY ALTER COLUMN CTRTYPE VARCHAR(15) NULL"
    Cnn.Execute mysql
    If CHK_PRIMARY_KEY("COMPANY") = False Then
        mysql = "ALTER TABLE COMPANY ADD Primary key (COMPCODE)"
        Cnn.Execute mysql
    End If
    
    
End Sub
Public Sub CHK_DEFAULT(LTblName As String, LColName As String, LStrDefault As String)
mysql = " IF (SELECT Column_Default FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = '" & LTblName & "' AND COLUMN_NAME = '" & LColName & "') is NULL"
mysql = mysql & "    BEGIN"
mysql = mysql & "    ALTER TABLE " & LTblName & ""
mysql = mysql & "    ADD DEFAULT ('" & LStrDefault & "') FOR " & LColName & ""
mysql = mysql & "    End"
Cnn.Execute mysql
mysql = "UPDATE " & LTblName & " SET " & LColName & " ='" & LStrDefault & "' WHERE " & LColName & " IS NULL"
Cnn.Execute mysql

End Sub
Public Sub VER_DMARGIN()
    GETMAIN.Label1.Caption = "Data Integration Check DMARGIN "
    DoEvents
    
    VER_ADJ "DMARGIN", "Compcode", "Smallint", , "0"
    VER_ADJ "DMARGIN", "CONDATE", "SmallDateTime"
    VER_ADJ "DMARGIN", "Party", "VARCHAR", 15, ""
    VER_ADJ "DMARGIN", "Sauda", "VARCHAR", 50, ""
    VER_ADJ "DMARGIN", "ItemCode", "VARCHAR", 20, ""
    VER_ADJ "DMARGIN", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "DMARGIN", "SpreadQty", "Float", , "0"
    VER_ADJ "DMARGIN", "Updated", "VARCHAR", 1, "N"
    VER_ADJ "DMARGIN", "FlatQty", "Float", , "0"
    VER_ADJ "DMARGIN", "Maturity", "SmallDateTime"
    VER_ADJ "DMARGIN", "OpenQty", "Float", , "0"
    VER_ADJ "DMARGIN", "LOT", "Float", , "0"
    VER_ADJ "DMARGIN", "OPENRATE", "Float", , "0"
    VER_ADJ "DMARGIN", "SELLQTY", "FLOAT", , "0"
    VER_ADJ "DMARGIN", "CLOSEQTY", "FLOAT", , "0"
    VER_ADJ "DMARGIN", "CLOSERATE", "FLOAT", , "0"
    VER_ADJ "DMARGIN", "MARGINAMT", "FLOAT", , "0"
    VER_ADJ "DMARGIN", "MARGINRATE", "FLOAT", , "0"
    VER_ADJ "DMARGIN", "ACCID", "INT", , "0"
    VER_ADJ "DMARGIN", "EXID", "INT", , "0"
    VER_ADJ "DMARGIN", "ITEMID", "INT", , "0"
    VER_ADJ "DMARGIN", "SAUDAID", "INT", , "0"
    Call Delete_DependentConstrainst("DMARGIN", "BUY")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "BUY", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "SELL")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "SELL", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "OPENAMT")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "OPENAMT", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "BUYRATE")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "BUYRATE", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "BUYAMT")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "BUYAMT", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "SELLRATE")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "SELLRATE", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "SELLAMT")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "SELLAMT", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "CLOSEAMT")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "CLOSEAMT", vbNullString)
    Call Delete_DependentConstrainst("DMARGIN", "QTY")
    Call AddAlter_Column("DMARGIN", "DROP COLUMN", "QTY", vbNullString)
    
    
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN COMPCODE INT NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN CONDATE SMALLDATETIME NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN PARTY VARCHAR(15) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN SAUDA VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN ITEMCODE  VARCHAR(20)NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE DMARGIN SET ACCID =0 WHERE ACCID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN ALTER COLUMN ACCID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DMARGIN SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=DMARGIN.COMPCODE AND ACCOUNTM.AC_CODE  =DMARGIN.PARTY ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE DMARGIN SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN EXID  INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DMARGIN SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE=DMARGIN.COMPCODE AND EXMAST.EXCODE =DMARGIN.EXCODE ) WHERE EXID   =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE DMARGIN SET ITEMID =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN ITEMID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DMARGIN SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE=DMARGIN.COMPCODE AND ITEMMAST.ITEMCODE  =DMARGIN.ITEMCODE  ) WHERE ITEMID    =0  "
    Cnn.Execute mysql
    
    
    mysql = "UPDATE DMARGIN SET SAUDAID =0 WHERE SAUDAID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DMARGIN' AND COLUMN_NAME ='SAUDAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DMARGIN  ALTER COLUMN SAUDAID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DMARGIN SET SAUDAID  =(SELECT SAUDAID FROM SAUDAMAST  WHERE SAUDAMAST.COMPCODE=DMARGIN.COMPCODE AND SAUDAMAST.SAUDACODE =DMARGIN.SAUDA  ) WHERE SAUDAID =0  "
    Cnn.Execute mysql
    If CHK_PRIMARY_KEY("DMARGIN") = False Then
        mysql = "ALTER TABLE DMARGIN   ADD Primary key (CONDATE,ACCID,SAUDAID ) "
        Cnn.Execute mysql
    End If
 
    VER_ADJ "DLYMGN", "SpCashMgLong", "Float", , "0"
    VER_ADJ "DLYMGN", "SpCashMgShort", "Float", , "0"
    VER_ADJ "DLYMGN", "COMPCODE", "Int", , 0
    VER_ADJ "DLYMGN", "Condate", "SMALLDateTime"
    VER_ADJ "DLYMGN", "Sauda", "VARCHAR", 50
    VER_ADJ "DLYMGN", "MATURITY", "SMALLDATETIME", , ""
    VER_ADJ "DLYMGN", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "DLYMGN", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "DLYMGN", "IMRate", "Float", , 0
    VER_ADJ "DLYMGN", "EMRate", "Float", , 0
    VER_ADJ "DLYMGN", "AMRate", "Float", , 0
    VER_ADJ "DLYMGN", "TMRate", "Float", , 0
    VER_ADJ "DLYMGN", "AddLong", "Float", , 0
    VER_ADJ "DLYMGN", "AddShort", "Float", , 0
    VER_ADJ "DLYMGN", "ELMLong", "Float", , 0
    VER_ADJ "DLYMGN", "ELMShort", "Float", , 0
    VER_ADJ "DLYMGN", "DELIVERY", "Float", , 0
    VER_ADJ "DLYMGN", "EXID", "INT", , "0"
    VER_ADJ "DLYMGN", "ITEMID", "INT", , "0"
    VER_ADJ "DLYMGN", "SAUDAID", "INT", , "0"
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN COMPCODE INT NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN CONDATE SMALLDATETIME NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN SAUDA VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql

    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='MATURITY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN MATURITY SMALLDATETIME  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYMGN SET EXID =0 WHERE EXID IS NULL"
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN EXID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DLYMGN SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE=DLYMGN.COMPCODE AND EXMAST.EXCODE =DLYMGN.EXCODE ) WHERE EXID   =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYMGN SET ITEMID  =0 WHERE ITEMID  IS NULL"
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN ITEMID  INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DLYMGN SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE=DLYMGN.COMPCODE AND ITEMMAST.ITEMCODE  =DLYMGN.ITEMCODE ) WHERE ITEMID    =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYMGN SET SAUDAID  =0 WHERE SAUDAID IS NULL"
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYMGN' AND COLUMN_NAME ='SAUDAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYMGN  ALTER COLUMN SAUDAID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DLYMGN SET SAUDAID =(SELECT SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE=DLYMGN.COMPCODE AND SAUDAMAST.SAUDACODE =DLYMGN.SAUDA  ) WHERE SAUDAID =0  "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("DLYMGN") = False Then
        mysql = "ALTER TABLE DLYMGN ADD Primary key (CONDATE,SAUDAID ) "
        Cnn.Execute mysql
    End If
    
    VER_ADJ "DLYCLMGN", "VOU_NO", "VARCHAR", 20, ""
    VER_ADJ "DLYCLMGN", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "DLYCLMGN", "SpMargin", "FLOAT", , "0"
    VER_ADJ "DlyCLMgn", "COMPCODE", "Int", , 0
    VER_ADJ "DlyCLMgn", "Condate", "DateTime"
    VER_ADJ "DlyCLMgn", "Client", "VARCHAR", 15
    VER_ADJ "DlyCLMgn", "IMargin", "Float", , 0
    VER_ADJ "DlyCLMgn", "MMargin", "Float", , 0
    VER_ADJ "DLYCLMGN", "CMARGIN", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "PreExpMargin", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "DeliveryMargin", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "ExtremeLoss", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "PeakMargin", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "SpreadMargin", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "NETBUYPREMIUM", "FLOAT", , "0"
    VER_ADJ "DLYCLMGN", "ACCID", "INT", , "0"
    VER_ADJ "DLYCLMGN", "EXID", "INT", , "0"
    VER_ADJ "DLYCLMGN", "VOU_ID", "INT", , "0"
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN  ALTER COLUMN COMPCODE INT NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN  ALTER COLUMN CONDATE SMALLDATETIME  NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='CLIENT' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN  ALTER COLUMN CLIENT VARCHAR(6) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN  ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYCLMGN SET EXID =0 WHERE EXID IS NULL"
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN  ALTER COLUMN EXID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DLYCLMGN SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE=DLYCLMGN.COMPCODE AND EXMAST.EXCODE =DLYCLMGN.EXCODE ) WHERE EXID   =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYCLMGN SET ACCID =0 WHERE ACCID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN ALTER COLUMN ACCID INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DLYCLMGN SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=DLYCLMGN.COMPCODE AND ACCOUNTM.AC_CODE  =DLYCLMGN.CLIENT ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE DLYCLMGN SET VOU_ID  =0 WHERE VOU_ID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DLYCLMGN' AND COLUMN_NAME ='VOU_ID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DLYCLMGN ALTER COLUMN VOU_ID  INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE DLYCLMGN SET VOU_ID   =(SELECT VOU_ID  FROM VOUCHER  WHERE VOUCHER.COMPCODE=DLYCLMGN.COMPCODE AND VOUCHER.VOU_NO =DLYCLMGN.VOU_NO  ) WHERE VOU_ID =0 AND VOU_NO<>'' "
    Cnn.Execute mysql
    If CHK_PRIMARY_KEY("DLYCLMGN") = False Then
        mysql = "ALTER TABLE DLYCLMGN  ADD Primary key (CONDATE,ACCID,EXID  ) "
        Cnn.Execute mysql
    End If

    mysql = " CREATE INDEX [IX_DlyCLMgn_Compcode_EXID_Condate] ON [DlyCLMgn] ([Compcode], [EXID],[Condate])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql

    

End Sub
Public Sub VER_BILLSUMREC()
    
    GETMAIN.Label1.Caption = "Data Integration Check BILLSUMREC "
    DoEvents

    VER_ADJ "BillSumRec", "PARTY", "VarChar", 15, ""
    VER_ADJ "BillSumRec", "ACCID", "INT", , "0"
    VER_ADJ "BillSumRec", "EXID", "INT", , ""
    VER_ADJ "BillSumRec", "SAUDAID", "INT", , ""
    VER_ADJ "BillSumRec", "OPQTY", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "OPRATE", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "OPENRATE", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "OPAMT", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "BUYQTY", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "BUYRATE", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "BUYAMT", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "SELLQTY", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "SELLRATE", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "SELLAMT", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "CLQTY", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "CLRATE", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "CLAMT", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "BROKAMT", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "CALVAL", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "MARGIN", "FLOAT", , "0"
    VER_ADJ "BillSumRec", "CONCODE", "VARCHAR", 15, ""
    VER_ADJ "BillSumRec", "USERID", "VARCHAR", 50, ""

    VER_ADJ "BillSum", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "BillSum", "NAME", "VARCHAR", 100, ""
    VER_ADJ "BillSum", "CONTRACT", "VARCHAR", 50, ""
    VER_ADJ "BillSum", "OPENQTY", "FLOAT", , "0"
    VER_ADJ "BillSum", "OPENRATE", "FLOAT", , "0"
    VER_ADJ "BillSum", "OPENAMT", "FLOAT", , "0"
    VER_ADJ "BillSum", "BUYQTY", "FLOAT", , "0"
    VER_ADJ "BillSum", "BUYRATE", "FLOAT", , "0"
    VER_ADJ "BillSum", "BUYAMT", "FLOAT", , "0"
    VER_ADJ "BillSum", "SELLQTY", "FLOAT", , "0"
    VER_ADJ "BillSum", "SELLRATE", "FLOAT", , "0"
    VER_ADJ "BillSum", "SELLAMT", "FLOAT", , "0"
    VER_ADJ "BillSum", "CLOSEQTY", "FLOAT", , "0"
    VER_ADJ "BillSum", "LTP", "FLOAT", , "0"
    VER_ADJ "BillSum", "CLOSEAMT", "FLOAT", , "0"
    VER_ADJ "BillSum", "GROSSMTM", "FLOAT", , "0"
    VER_ADJ "BillSum", "BROKAMT", "FLOAT", , "0"
    VER_ADJ "BillSum", "MARGINAMT", "FLOAT", , "0"
    VER_ADJ "BillSum", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "BillSum", "NETQTY", "FLOAT", , "0"
    VER_ADJ "BillSum", "NETRATE", "FLOAT", , "0"
    VER_ADJ "BillSum", "CALVAL", "FLOAT", , "0"
    VER_ADJ "BillSum", "SAUDAID", "INT", , "0"
    VER_ADJ "BillSum", "ACCID", "INT", , "0"

    mysql = "ALTER TABLE BILLSUM ALTER COLUMN EXCODE VARCHAR(10)"
    Cnn.Execute mysql


    

End Sub
Public Sub VER_INV_D1()

    GETMAIN.Label1.Caption = "Data Integration Check INV_D1  "
    DoEvents
    
    mysql = "IF COL_LENGTH('INV_D1','UBILLNO') IS NULL "
    mysql = mysql & " ALTER TABLE INV_D1 ADD UBILLNO INT IDENTITY(1,1) NOT NULL "
    Cnn.Execute mysql
    
    VER_ADJ "INV_D1", "Compcode", "INT", , "0"
    VER_ADJ "INV_D1", "FMLYCODE", "VARCHAR", 6, ""
    VER_ADJ "INV_D1", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "INV_D1", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "INV_D1", "ITEMCODE", "VARCHAR", 50, ""
    VER_ADJ "INV_D1", "SAUDA", "VARCHAR", 50, ""
    VER_ADJ "INV_D1", "VOU_NO", "VARCHAR", 20, ""
    VER_ADJ "INV_D1", "AMOUNT", "FLOAT", , "0"
    VER_ADJ "INV_D1", "BVNO", "INT", , "0"
    VER_ADJ "INV_D1", "SVNO", "INT", , "0"
    VER_ADJ "INV_D1", "BILLNO", "INT", , "0"
    VER_ADJ "INV_D1", "STDATE", "SMALLDATETIME", , ""
    VER_ADJ "INV_D1", "SVOU_NO", "VARCHAR", 20, ""
    VER_ADJ "INV_D1", "SAMOUNT", "FLOAT", , "0"
    VER_ADJ "INV_D1", "CURR_RATE", "FLOAT", , "1"
    VER_ADJ "INV_D1", "POST", "INT", , "0"
    VER_ADJ "INV_D1", "SVOU_ID", "INT", , "0"
    VER_ADJ "INV_D1", "BVOU_ID", "INT", , "0"
    VER_ADJ "INV_D1", "ACCID", "INT", , "0"
    VER_ADJ "INV_D1", "SAUDAID", "INT", , "0"
    VER_ADJ "INV_D1", "ITEMID", "INT", , "0"
    VER_ADJ "INV_D1", "EXID", "INT", , "0"
    VER_ADJ "INV_D1", "FMLYID", "INT", , "0"
    VER_ADJ "INV_D1", "USDINR", "FLOAT", , "1"
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN PARTY VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='STDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN STDATE SMALLDATETIME NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN SAUDA VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET EXCODE ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET EXCODE  =(SELECT EXCODE FROM SAUDAMAST  WHERE INV_D1.COMPCODE=SAUDAMAST.COMPCODE AND SAUDAMAST.SAUDACODE  =INV_D1.SAUDA  ) WHERE EXCODE=''"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN EXCODE  VARCHAR(20) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1  SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=INV_D1.COMPCODE AND ACCOUNTM.AC_CODE  =INV_D1.PARTY  ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET EXID   =0 WHERE EXID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN EXID  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET EXID   =(SELECT EXID  FROM EXMAST WHERE EXMAST.COMPCODE=INV_D1.COMPCODE AND EXMAST.EXCODE=INV_D1.EXCODE) WHERE EXID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET ITEMID =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN ITEMID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE=INV_D1.COMPCODE AND ITEMMAST.ITEMCODE  =INV_D1.ITEMCODE ) WHERE ITEMID   =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET SAUDAID =0 WHERE SAUDAID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='SAUDAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1 ALTER COLUMN SAUDAID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET SAUDAID  =(SELECT SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE=INV_D1.COMPCODE AND SAUDAMAST.SAUDACODE =INV_D1.SAUDA ) WHERE SAUDAID =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET FMLYID  =0 WHERE FMLYID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D1' AND COLUMN_NAME ='FMLYID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D1  ALTER COLUMN FMLYID  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET FMLYID =(SELECT FMLYID FROM ACCFMLY  WHERE ACCFMLY.COMPCODE=INV_D1.COMPCODE AND ACCFMLY.FMLYCODE =INV_D1.FMLYCODE ) WHERE FMLYID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET SVOU_ID  =0 WHERE SVOU_ID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET SVOU_ID =(SELECT VOU_ID  FROM VOUCHER WHERE VOUCHER.COMPCODE=INV_D1.COMPCODE AND INV_D1.SVOU_NO  =VOUCHER.VOU_NO  ) WHERE SVOU_ID  =0 AND SVOU_NO<>'' "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D1 SET BVOU_ID  =0 WHERE BVOU_ID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET BVOU_ID =(SELECT VOU_ID FROM VOUCHER WHERE VOUCHER.COMPCODE=INV_D1.COMPCODE AND INV_D1.VOU_NO  =VOUCHER.VOU_NO  ) WHERE BVOU_ID  =0 AND VOU_NO<>'' "
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET POST  =1 WHERE INV_D1.SVOU_ID IN (SELECT VOU_ID FROM VOUCHER WHERE VOUCHER.VOU_ID =INV_D1.SVOU_ID  ) AND POST =0 "
    Cnn.Execute mysql
    mysql = "UPDATE INV_D1 SET POST  =1 WHERE INV_D1.BVOU_ID IN (SELECT VOU_ID FROM VOUCHER WHERE VOUCHER.VOU_ID =INV_D1.BVOU_ID  ) AND POST =0 "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("INV_D1") = False Then
        mysql = "ALTER TABLE INV_D1 ADD Primary key (UBILLNO)"
        Cnn.Execute mysql
    End If
End Sub
Public Sub VER_PEXSBROK()
    VER_ADJ "PEXSBROK", "CompCode", "INT", , "0"
    VER_ADJ "PEXSBROK", "ExCode", "VARCHAR", 10, ""
    VER_ADJ "PEXSBROK", "InstType", "VARCHAR", 3, "FUT"
    VER_ADJ "PEXSBROK", "FmlyCode", "VARCHAR", 6, ""
    VER_ADJ "PEXSBROK", "Party", "VARCHAR", 15, ""
    VER_ADJ "PEXSBROK", "BrokType", "VARCHAR", 1, "P"
    VER_ADJ "PEXSBROK", "BrokRate", "FLOAT", , "0"
    VER_ADJ "PEXSBROK", "BrokRate2", "FLOAT", , "0"
    VER_ADJ "PEXSBROK", "ShType", "VARCHAR", 1, "N"
    VER_ADJ "PEXSBROK", "ShRate", "FLOAT", , "0"
    VER_ADJ "PEXSBROK", "UpToStDt", "SMALLDATETIME", , ""
    VER_ADJ "PEXSBROK", "ACCID", "INT", , "0"
    VER_ADJ "PEXSBROK", "EXID", "INT", , "0"
    VER_ADJ "PEXSBROK", "FMLYID", "INT", , "0"
    
    mysql = "DELETE FROM PEXSBROK WHERE EXCODE NOT IN (SELECT DISTINCT EXCODE FROM EXMAST ) "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN PARTY VARCHAR(15)  NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='FMLYCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN FMLYCODE VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='INSTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN INSTTYPE VARCHAR(3) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='UPTOSTDT' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN UPTOSTDT SMALLDATETIME NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE PEXSBROK SET ACCID =0 WHERE ACCID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN ACCID  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PEXSBROK   SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=PEXSBROK.COMPCODE AND ACCOUNTM.AC_CODE  =PEXSBROK.PARTY  ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    
    mysql = "UPDATE PEXSBROK SET EXID  =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN EXID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PEXSBROK SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =PEXSBROK.COMPCODE AND EXMAST.EXCODE = PEXSBROK.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM PEXSBROK  WHERE COMPCODE =" & GCompCode & "  AND FMLYCODE NOT IN (SELECT FMLYCODE FROM ACCFMLY WHERE COMPCODE =" & GCompCode & ")"
    Cnn.Execute mysql
    mysql = "UPDATE PEXSBROK SET FMLYID  =0 WHERE FMLYID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='FMLYID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN FMLYID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PEXSBROK  SET FMLYID =(SELECT FMLYID FROM ACCFMLY  WHERE ACCFMLY.COMPCODE=PEXSBROK.COMPCODE AND ACCFMLY.FMLYCODE  =PEXSBROK.FMLYCODE ) WHERE FMLYID  =0  "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='INSTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN INSTTYPE VARCHAR(3) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXSBROK' AND COLUMN_NAME ='UPTOSTDT' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXSBROK ALTER COLUMN UPTOSTDT SMALLDATETIME  NOT NULL"
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("PEXSBROK") = False Then
        mysql = "ALTER TABLE PEXSBROK ADD Primary key (FMLYID,ACCID,EXID,INSTTYPE,UPTOSTDT )"
        Cnn.Execute mysql
    End If

    
    VER_ADJ "PITSBROK", "Compcode", "INT", , "0"
    VER_ADJ "PITSBROK", "FMLYCODE", "VARCHAR", 6, ""
    VER_ADJ "PITSBROK", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "PITSBROK", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "PITSBROK", "ITEMCODE", "VARCHAR", 50, ""
    VER_ADJ "PITSBROK", "BrokType", "VARCHAR", 1, "P"
    VER_ADJ "PITSBROK", "BROKRATE", "FLOAT", , "0"
    VER_ADJ "PITSBROK", "BROKRATE2", "FLOAT", , "0"
    VER_ADJ "PITSBROK", "SHTYPE", "VARCHAR", 1, "N"
    VER_ADJ "PITSBROK", "SHRATE", "FLOAT", , "0"
    VER_ADJ "PITSBROK", "UPTOSTDT", "SMALLDATETIME", , ""
    VER_ADJ "PITSBROK", "INSTTYPE", "VARCHAR", 3, "FUT"
    VER_ADJ "PITSBROK", "ACCID", "INT", , "0"
    VER_ADJ "PITSBROK", "EXID", "INT", , "0"
    VER_ADJ "PITSBROK", "ITEMID", "INT", , "0"
    VER_ADJ "PITSBROK", "FMLYID", "INT", , "0"
        
    mysql = "DELETE FROM PITSBROK WHERE ITEMCODE  NOT IN (SELECT DISTINCT ITEMCODE  FROM ITEMMAST ) "
    Cnn.Execute mysql
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN PARTY VARCHAR(15)  NOT NULL"
    Cnn.Execute mysql
    
    mysql = " UPDATE PITSBROK SET EXCODE ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN EXCODE VARCHAR(10)  NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN ITEMCODE VARCHAR(20)  NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE PITSBROK SET EXCODE = (SELECT EXCHANGECODE FROM ITEMMAST  WHERE PITSBROK.COMPCODE = ITEMMAST.COMPCODE AND ITEMMAST.ITEMCODE =PITSBROK.ITEMCODE ) WHERE EXCODE =''"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='FMLYCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN FMLYCODE VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='INSTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN INSTTYPE VARCHAR(3) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='UPTOSTDT' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN UPTOSTDT SMALLDATETIME NOT NULL"
    Cnn.Execute mysql

    
    mysql = "UPDATE PITSBROK  SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK  ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PITSBROK   SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=PITSBROK.COMPCODE AND ACCOUNTM.AC_CODE  =PITSBROK.PARTY  ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE PITSBROK  SET EXID  =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK  ALTER COLUMN EXID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PITSBROK SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =PITSBROK.COMPCODE AND EXMAST.EXCODE = PITSBROK.EXCODE) WHERE EXID =0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE PITSBROK  SET ITEMID   =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK  ALTER COLUMN ITEMID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PITSBROK SET ITEMID  =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE =PITSBROK.COMPCODE AND ITEMMAST.ITEMCODE = PITSBROK.ITEMCODE ) WHERE ITEMID =0 "
    Cnn.Execute mysql
    
    mysql = "IF COL_LENGTH('PITSBROK','FMLYID') IS NULL ALTER TABLE PITSBROK  ADD FMLYID  INT "
    Cnn.Execute mysql
    mysql = "UPDATE PITSBROK SET FMLYID  =0 WHERE FMLYID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITSBROK' AND COLUMN_NAME ='FMLYID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PITSBROK ALTER COLUMN FMLYID  INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE PITSBROK  SET FMLYID =(SELECT FMLYID FROM ACCFMLY  WHERE ACCFMLY.COMPCODE=PITSBROK.COMPCODE AND ACCFMLY.FMLYCODE  =PITSBROK.FMLYCODE ) WHERE FMLYID  =0  "
    Cnn.Execute mysql
    
    
    If CHK_PRIMARY_KEY("PITSBROK") = False Then
        mysql = "ALTER TABLE PITSBROK ADD Primary key (FMLYID,ACCID,ITEMID ,INSTTYPE,UPTOSTDT )"
        Cnn.Execute mysql
    End If


    
End Sub
Public Sub VER_PITBROK()

    GETMAIN.Label1.Caption = "Data Integration Check PITBROK  "
    DoEvents
    VER_ADJ "PITBROK", "INSTTYPE", "VARCHAR", 6, "FUT"
    VER_ADJ "PITBROK", "MinRate", "FLOAT", , "0"
    VER_ADJ "PITBROK", "MBroktype", "VARCHAR", 1, "P"
    VER_ADJ "PITBROK", "MBrokrate", "FLOAT", , "0"
    VER_ADJ "PITBROK", "MBrokrate2", "FLOAT", , "0"
    VER_ADJ "PITBROK", "TRANTYPE", "VARCHAR", 1, "P"
    VER_ADJ "PITBROK", "BrokRate2", "Float", , 0
    VER_ADJ "PITBROK", "STTRATE", "FLOAT", , "0"
    VER_ADJ "PITBROK", "STMRATE", "FLOAT", , 0
    VER_ADJ "PITBROK", "TranType", "VARCHAR", 1, "T"
    VER_ADJ "PITBROK", "ACCID", "INT", , "0"
    VER_ADJ "PITBROK", "EXID", "INT", , "0"
    VER_ADJ "PITBROK", "ITEMID", "INT", , "0"
    
    mysql = "DELETE FROM PITBROK WHERE ITEMCODE  NOT IN (SELECT DISTINCT ITEMCODE  FROM ITEMMAST  ) "
    Cnn.Execute mysql
    Call Delete_DependentConstrainst("PITBROK", "BCYCLE")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "BCYCLE", vbNullString)
    Call Delete_DependentConstrainst("PITBROK", "PARTYTYPE")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "PARTYTYPE", vbNullString)
    Call Delete_DependentConstrainst("PITBROK", "PERSONNELAC")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "PERSONNELAC", vbNullString)
    Call Delete_DependentConstrainst("PITBROK", "SHARE")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "SHARE", vbNullString)
    Call Delete_DependentConstrainst("PITBROK", "SHARE2")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "SHARE2", vbNullString)
    Call Delete_DependentConstrainst("PITBROK", "APPLYON")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "APPLYON", vbNullString)
    Call Delete_DependentConstrainst("PITBROK", "APPLYON2")
    Call AddAlter_Column("PITBROK", "DROP COLUMN", "APPLYON2", vbNullString)
    Call AddAlter_Column("PITBROK", "ADD", "EXCODE", "VARCHAR(10) NULL")
    
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='AC_CODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN AC_CODE VARCHAR(15) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='BROKTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN BROKTYPE VARCHAR(1) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE PITBROK SET EXCODE ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE PITBROK SET EXCODE=(SELECT EXCHANGECODE FROM ITEMMAST WHERE ITEMMAST.EXCHANGECODE=PITBROK.EXCODE AND ITEMMAST.COMPCODE = PITBROK.COMPCODE) WHERE EXCODE ='' "
    Cnn.Execute mysql
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN COMPCODE INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='INSTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN INSTTYPE VARCHAR(3) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='UPTOSTDT' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN UPTOSTDT SMALLDATETIME  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE PITBROK SET ACCID  =0 WHERE ACCID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN ACCID  INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE PITBROK   SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=PITBROK.COMPCODE AND ACCOUNTM.AC_CODE  =PITBROK.AC_CODE  ) WHERE ACCID  =0  "
    Cnn.Execute mysql

    
    mysql = "UPDATE PITBROK SET EXID   =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN EXID INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE PITBROK SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =PITBROK.COMPCODE AND EXMAST.EXCODE = PITBROK.EXCODE) WHERE EXID IS NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE PITBROK SET ITEMID =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PITBROK' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PITBROK ALTER COLUMN ITEMID  INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE PITBROK SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE PITBROK.COMPCODE=ITEMMAST.COMPCODE AND PITBROK.ITEMCODE =ITEMMAST.ITEMCODE  ) WHERE ITEMID=0"
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("PITBROK") = False Then
        mysql = "ALTER TABLE PITBROK ADD Primary key (ACCID,ITEMID,INSTTYPE,UPTOSTDT )"
        Cnn.Execute mysql
    End If
    
    mysql = "CREATE NONCLUSTERED INDEX [IDX_PITBROK_AC_CODE,EXID_INSTTYPE_UPTOSTDT] ON [PITBROK]"
    mysql = mysql & " ( [AC_CODE] ASC,[EXID] ASC,[INSTTYPE] ASC, [uptostdt] Asc)"
    mysql = mysql & " INCLUDE ( [BROKTYPE],[BROKRATE],[TRANRATE],[TranType],[BrokRate2],MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2 ) "
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE INDEX [IX_PITBROK_CompCode_AC_CODE_INSTTYPE_ITEMID_UPTOSTDT ] ON "
    mysql = mysql & "[PITBROK] ( [AC_CODE], [INSTTYPE], [ITEMID],[uptostdt]) INCLUDE ([ITEMCODE])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE NONCLUSTERED INDEX [IDX_PITBROK_COMPCODE_AC_CODE,ITEMID_INSTTYPE_UPTOSTDT] ON [PITBROK]"
    mysql = mysql & " ( [AC_CODE] ASC,[ITEMID] ASC,[INSTTYPE] ASC, [UPTOSTDT] Asc)"
    mysql = mysql & " INCLUDE ( [BROKTYPE],[BROKRATE],[TRANRATE],[TranType],[BrokRate2],MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2 ) "
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql

    
End Sub
Public Sub VER_CTR_D()
    On Error GoTo err1
    GETMAIN.Label1.Caption = "Data Integration Check CTR_D   "
    DoEvents
    
    VER_ADJ "CTR_D", "COMPCODE", "INT", , "0"
    VER_ADJ "CTR_D", "CONSNO", "INT", , "0"
    VER_ADJ "CTR_D", "CONNO", "INT", , "0"
    VER_ADJ "CTR_D", "PARTY", "VARCHAR", 15, "0"
    VER_ADJ "CTR_D", "SAUDA", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D", "ITEMCODE", "VARCHAR", 20, "0"
    VER_ADJ "CTR_D", "EXCODE", "VARCHAR", 10, "0"
    VER_ADJ "CTR_D", "CONDATE", "SMALLDATETIME", , ""
    VER_ADJ "CTR_D", "CONTYPE", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D", "QTY", "FLOAT", , "0"
    VER_ADJ "CTR_D", "RATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "PATTAN", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D", "BROKRATE", "FLOAT", 1, "0"
    VER_ADJ "CTR_D", "TRANRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "BILLNO", "INT", , "0"
    VER_ADJ "CTR_D", "ROWNO1", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D", "PERCONT", "VARCHAR", 1, "C"
    VER_ADJ "CTR_D", "INVNO", "INT", , "0"
    VER_ADJ "CTR_D", "DATAIMPORT", "BIT", , "0"
    VER_ADJ "CTR_D", "ROWNO", "INT", , "0"
    VER_ADJ "CTR_D", "CONTIME", "VARCHAR", 20, "0"
    VER_ADJ "CTR_D", "BROKTYPE", "VARCHAR", 1, "P"
    VER_ADJ "CTR_D", "TRANTYPE", "VARCHAR", 1, "P"
    VER_ADJ "CTR_D", "SRVTAX", "FLOAT", , "0"
    VER_ADJ "CTR_D", "USERID", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D", "BROKQTY", "FLOAT", , "0"
    VER_ADJ "CTR_D", "BROKAMT", "FLOAT", , "0"
    VER_ADJ "CTR_D", "STMRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "BROKRATE2", "FLOAT", , "0"
    VER_ADJ "CTR_D", "ORDNO", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D", "STTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "NOTENO", "FLOAT", , "0"
    VER_ADJ "CTR_D", "TRANTAX", "FLOAT", , "0"
    VER_ADJ "CTR_D", "CONCODE", "VARCHAR", 15, "0"
    VER_ADJ "CTR_D", "CALVAL", "FLOAT", , "0"
    VER_ADJ "CTR_D", "CONFIRM", "INT", , "0"
    VER_ADJ "CTR_D", "ADJQTY", "INT", , "0"
    VER_ADJ "CTR_D", "INSTTYPE", "VARCHAR", 3, "FUT"
    VER_ADJ "CTR_D", "OPTTYPE", "VARCHAR", 2, ""
    VER_ADJ "CTR_D", "STRIKE", "FLOAT", 2, "0"
    VER_ADJ "CTR_D", "BROKQTY2", "FLOAT", , "0"
    VER_ADJ "CTR_D", "CGSTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "IGSTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "ORDTIME", "VARCHAR", 50, ""
    VER_ADJ "CTR_D", "SGSTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "SBC_TAX", "FLOAT", , "0"
    VER_ADJ "CTR_D", "SEBITAX", "FLOAT", , "0"
    VER_ADJ "CTR_D", "STTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "TRANTAX", "FLOAT", , "0"
    VER_ADJ "CTR_D", "UTTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D", "UPDBQTY", "FLOAT", , "0"
    VER_ADJ "CTR_D", "EXID", "INT", , "0"
    VER_ADJ "CTR_D", "ACCID", "INT", , "0"
    VER_ADJ "CTR_D", "SAUDAID", "INT", , "0"
    VER_ADJ "CTR_D", "ITEMID", "INT", , "0"
    VER_ADJ "CTR_D", "BROKFLAG", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D", "MULTI", "FLOAT", , "0"
    VER_ADJ "CTR_D", "FILETYPE", "VARCHAR", 3, "0"
    VER_ADJ "CTR_D", "CLCODE", "VARCHAR", 20, "0"
    VER_ADJ "CTR_D", "EQ_STT", "FLOAT", , "0"
    VER_ADJ "CTR_D", "EQ_STAMP", "FLOAT", , "0"
    VER_ADJ "CTR_D", "ContractType", "VARCHAR", 1, "0"
        
    Call Delete_DependentConstrainst("CTR_D", "BROKAMOUNT")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "BROKAMOUNT", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "STDRATE")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "STDRATE", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "BROKERAGEAMT")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "BROKERAGEAMT", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "SCGROUP")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "SCGROUP", vbNullString)
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "INVDATE", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "BROKTYPE2")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "BROKTYPE2", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "BBROKRATE")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "BBROKRATE", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "BTRANRATE")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "BTRANRATE", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "SRVAMT")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "SRVAMT", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "TRANAMT")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "TRANAMT", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "SR")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "SR", vbNullString)
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "MODTIME", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "UPDBROKE")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "UPDBROKE", vbNullString)
    Call Delete_DependentConstrainst("CTR_D", "CNOTE_NO")
    Call AddAlter_Column("CTR_D", "DROP COLUMN", "CNOTE_NO", vbNullString)
        
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='FILETYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN FILETYPE VARCHAR(3) NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN PARTY VARCHAR(15) NOT NULL  END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='CLCODE')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN CLCODE VARCHAR(20) NOT NULL  END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN COMPCODE  INT  NOT NULL  END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN CONDATE SMALLDATETIME   NOT NULL  END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN SAUDA  VARCHAR(50) NOT NULL  END "
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET EXCODE ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN ITEMCODE  VARCHAR(20) NOT NULL  END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_D SET ITEMCODE = (SELECT ITEMCODE FROM SAUDAMAST WHERE SAUDAMAST.SAUDACODE=CTR_D.SAUDA AND CTR_D.COMPCODE =SAUDAMAST.COMPCODE ) WHERE ITEMCODE=''"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET EXCODE ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "  BEGIN ALTER TABLE CTR_D ALTER COLUMN EXCODE   VARCHAR(10) NOT NULL  END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_D SET EXCODE  = (SELECT EXCHANGECODE FROM ITEMMAST  WHERE ITEMMAST.ITEMCODE =CTR_D.ITEMCODE AND CTR_D.COMPCODE =ITEMMAST.COMPCODE ) WHERE EXCODE =''"
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_D SET EXID=0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE CTR_D ALTER COLUMN EXID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =CTR_D.COMPCODE AND EXMAST.EXCODE = CTR_D.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_D  SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE CTR_D ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=CTR_D.COMPCODE AND ACCOUNTM.AC_CODE  =CTR_D.PARTY  ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_D SET INSTTYPE=(SELECT INSTTYPE FROM SAUDAMAST WHERE SAUDAMAST.SAUDAID = CTR_D.SAUDAID AND CTR_D.COMPCODE=SAUDAMAST.COMPCODE) WHERE INSTTYPE IS NULL"
    Cnn.Execute mysql
    
    GETMAIN.Label1.Caption = "UPDATEING SAUDAID CTR_D  "
    DoEvents
    mysql = "UPDATE CTR_D SET OPTTYPE =(SELECT OPTTYPE FROM SAUDAMAST WHERE SAUDAMAST.SAUDAID =CTR_D.SAUDAID ) WHERE OPTTYPE IS NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_D SET STRIKE  =(SELECT STRIKEPRICE FROM SAUDAMAST WHERE SAUDAMAST.SAUDAID =CTR_D.SAUDAID ) WHERE INSTTYPE ='OPT' AND STRIKE =0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_D SET ITEMID =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_D' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE CTR_D ALTER COLUMN ITEMID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE CTR_D SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE CTR_D.COMPCODE=ITEMMAST.COMPCODE AND CTR_D.ITEMCODE =ITEMMAST.ITEMCODE  ) WHERE ITEMID=0 "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("CTR_D") = False Then
        mysql = "ALTER TABLE CTR_D ADD Primary key (ROWNO) "
        Cnn.Execute mysql
    End If
    
    mysql = " CREATE INDEX [IX_CTR_D_SAUDAID_ACCID_CONDATE_PATTAN] ON  [CTR_D] ([SAUDAID], [CONDATE],[ACCID], [PATTAN])"
    mysql = mysql & " INCLUDE ([CONTYPE], [QTY], [RATE], [BROKRATE], [BrokType], [BrokQty], [BROKRATE2], [ORDNO], [CALVAL], [BrokQty2])"
    Cnn.Execute mysql
    mysql = "CREATE INDEX [IX_CTR_D_SAUDAID_ACCID_CONDATE] ON [CTR_D] ([SAUDAID], [ACCID],[CONDATE]) INCLUDE ([ROWNO])"
    Cnn.Execute mysql
    'MYSQL = "CREATE INDEX [IX_CTR_D_SAUDAID_ACCID_CONDATE] ON [S-2020-MUK].[dbo].[CTR_D] ([SAUDAID], [ACCID],[CONDATE])"
    mysql = "CREATE INDEX [IX_CTR_D_PATTAN_SAUDAID_ACCID_CONDATE] ON [CTR_D] ([PATTAN], [SAUDAID], [ACCID],[CONDATE]) "
    mysql = mysql & " INCLUDE ([CONTYPE], [QTY], [RATE], [CALVAL])"
    Cnn.Execute mysql
    mysql = "CREATE INDEX [IX_CTR_D_SAUDAID_ACCID_CONDATE2] ON [CTR_D] ([CONDATE], [ACCID],[SAUDAID]) INCLUDE ([CONTYPE], [QTY])"
    Cnn.Execute mysql

    Exit Sub
err1:
    MsgBox err.Description
End Sub
Public Sub VER_CTR_D_LOG()
    On Error GoTo err1
    GETMAIN.Label1.Caption = "Data Integration Check CTR_D_LOG   "
    DoEvents

    VER_ADJ "CTR_D_LOG", "COMPCODE", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "CONSNO", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "CONNO", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "PARTY", "VARCHAR", 15, "0"
    VER_ADJ "CTR_D_LOG", "SAUDA", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D_LOG", "ITEMCODE", "VARCHAR", 20, "0"
    VER_ADJ "CTR_D_LOG", "CONDATE", "SMALLDATETIME", , ""
    VER_ADJ "CTR_D_LOG", "CONTYPE", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D_LOG", "QTY", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "RATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "PATTAN", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D_LOG", "BROKRATE", "FLOAT", 1, "0"
    VER_ADJ "CTR_D_LOG", "TRANRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "BILLNO", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "ROWNO1", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D_LOG", "PERCONT", "VARCHAR", 1, "C"
    VER_ADJ "CTR_D_LOG", "INVNO", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "DATAIMPORT", "BIT", , "0"
    VER_ADJ "CTR_D_LOG", "ROWNO", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "CONTIME", "VARCHAR", 20, "0"
    VER_ADJ "CTR_D_LOG", "BROKTYPE", "VARCHAR", 1, "P"
    VER_ADJ "CTR_D_LOG", "TRANTYPE", "VARCHAR", 1, "P"
    VER_ADJ "CTR_D_LOG", "SRVTAX", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "USERID", "VARCHAR", 50, "0"
    VER_ADJ "CTR_D_LOG", "BROKQTY", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "BROKAMT", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "CLCODE", "VARCHAR", 20, "0"
    VER_ADJ "CTR_D_LOG", "STMRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "BROKRATE2", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "ORDNO", "VARCHAR", 25, "0"
    VER_ADJ "CTR_D_LOG", "STTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "NOTENO", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "TRANTAX", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "CONCODE", "VARCHAR", 15, "0"
    VER_ADJ "CTR_D_LOG", "EXCODE", "VARCHAR", 6, "0"
    VER_ADJ "CTR_D_LOG", "CALVAL", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "CONFIRM", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "ADJQTY", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "INSTTYPE", "VARCHAR", 3, "FUT"
    VER_ADJ "CTR_D_LOG", "OPTTYPE", "VARCHAR", 2, ""
    VER_ADJ "CTR_D_LOG", "STRIKE", "FLOAT", 2, "0"
    VER_ADJ "CTR_D_LOG", "UPDBROK", "FLOAT", 2, "0"
    VER_ADJ "CTR_D_LOG", "BROKQTY2", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "CGSTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "IGSTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "ORDTIME", "VARCHAR", 50, ""
    VER_ADJ "CTR_D_LOG", "SGSTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "SBC_TAX", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "SEBITAX", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "UTTRATE", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "UPDBQTY", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "SAUDAID", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "BROKFLAG", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D_LOG", "MULTI", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "EXID", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "ITEMID", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "EQ_STT", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "EQ_STAMP", "FLOAT", , "0"
    VER_ADJ "CTR_D_LOG", "ACCID", "INT", , "0"
    VER_ADJ "CTR_D_LOG", "ContractType", "VARCHAR", 1, "0"
    VER_ADJ "CTR_D_LOG", "FILETYPE", "VARCHAR", 3, "0"
    VER_ADJ "CTR_D_LOG", "LOGINUSER", "VARCHAR", 15, "0"
    VER_ADJ "CTR_D_LOG", "DATETM", "SMALLDATETIME", , ""
    VER_ADJ "CTR_D_LOG", "TRAN", "VARCHAR", 15, "0"
    
    
    mysql = " CREATE INDEX [IX_CTR_D_SAUDAID_ACCID_CONDATE_PATTAN_LOG] ON  [CTR_D_LOG] ([SAUDAID], [CONDATE],[ACCID], [PATTAN])"
    mysql = mysql & " INCLUDE ([CONTYPE], [QTY], [RATE], [BROKRATE], [BrokType], [BrokQty], [BROKRATE2], [ORDNO], [CALVAL], [BrokQty2])"
    Cnn.Execute mysql
    mysql = "CREATE INDEX [IX_CTR_D_SAUDAID_ACCID_CONDATE_LOG] ON [CTR_D_LOG] ([SAUDAID], [ACCID],[CONDATE]) INCLUDE ([ROWNO])"
    Cnn.Execute mysql

    Exit Sub
err1:
    MsgBox err.Description
End Sub
    
    
Public Sub VER_CTR_M()
    Dim TRec As ADODB.Recordset
    GETMAIN.Label1.Caption = "Data Integration Check CTR_M   "
    DoEvents
    
    
    mysql = "IF COL_LENGTH('CTR_M','CTR_MID') IS NULL "
    mysql = mysql & " ALTER TABLE CTR_M ADD CTR_MID INT IDENTITY(1,1) NOT NULL "
    Cnn.Execute mysql
    
    Call Delete_DependentConstrainst("CTR_M", "CLOSERATE")
    Call Delete_DependentConstrainst("CTR_M", "DATAIMPORT")
    
    Call AddAlter_Column("CTR_M", "DROP COLUMN", "CLOSERATE", vbNullString)
    Call AddAlter_Column("CTR_M", "DROP COLUMN", "DATAIMPORT", vbNullString)
    Call AddAlter_Column("CTR_M", "DROP COLUMN", "VOU_NO", vbNullString)
    
    VER_ADJ "CTR_M", "COMPCODE", "INT", , "0"
    VER_ADJ "CTR_M", "CONSNO", "INT", , "0"
    VER_ADJ "CTR_M", "CONDATE", "SMALLDATETIME", , ""
    VER_ADJ "CTR_M", "SAUDA", "VARCHAR", 20, ""
    VER_ADJ "CTR_M", "PATTAN", "VARCHAR", 1, ""
    VER_ADJ "CTR_M", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "CTR_M", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "CTR_M", "EXID", "INT", , "0"
    VER_ADJ "CTR_M", "ITEMID", "INT", , "0"
    VER_ADJ "CTR_M", "SAUDAID", "INT", , "0"
    
    Call Delete_DependentConstrainst("CTR_M", "CALVAL")
    Call AddAlter_Column("CTR_M", "DROP COLUMN", "CALVAL", vbNullString)
    
    mysql = "DELETE FROM CTR_M  WHERE SAUDA NOT IN (SELECT DISTINCT SAUDACODE FROM SAUDAMAST  ) "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN SAUDA  VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN CONDATE SMALLDATETIME NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN COMPCODE INT NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_M SET ITEMCODE ='' WHERE ITEMCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN ITEMCODE  VARCHAR(20) NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_M SET ITEMCODE = (SELECT ITEMCODE FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =CTR_M.COMPCODE AND CTR_M.SAUDA=SAUDAMAST.SAUDACODE) WHERE ITEMCODE =''"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='SAUDACODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN SAUDACODE VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_M SET EXCODE  ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_M SET EXCODE  = (SELECT EXCHANGECODE FROM ITEMMAST WHERE ITEMMAST.COMPCODE =CTR_M.COMPCODE AND CTR_M.ITEMCODE=ITEMMAST.ITEMCODE ) WHERE EXCODE=''"
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_M SET SAUDAID=0  WHERE SAUDAID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='SAUDAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN SAUDAID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_M SET SAUDAID = (SELECT SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =CTR_M.COMPCODE AND CTR_M.SAUDA=SAUDAMAST.SAUDACODE) WHERE SAUDAID =0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_M SET EXID  = 0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN EXID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_M SET EXID = (SELECT EXID  FROM EXMAST  WHERE EXMAST.COMPCODE =CTR_M.COMPCODE AND EXMAST.EXCODE =CTR_M.EXCODE ) WHERE EXID=0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_M SET ITEMID  = 0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_M' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_M ALTER COLUMN ITEMID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_M SET ITEMID = (SELECT ITEMID FROM ITEMMAST  WHERE ITEMMAST.COMPCODE =CTR_M.COMPCODE AND ITEMMAST.ITEMCODE =CTR_M.ITEMCODE  ) WHERE ITEMID=0 "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("CTR_M") = False Then
        mysql = "ALTER TABLE CTR_M ADD Primary key (CONDATE,SAUDAID) "
        Cnn.Execute mysql
    End If
    
    mysql = " CREATE INDEX [IX_CTR_M_CompCode_CONDATE_pattan] ON [CTR_M] ([CompCode],[CONDATE]) "
    mysql = mysql & " INCLUDE ([CONSNO], [PATTAN])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE INDEX [IX_CTR_M_SAUDAID_CONDATE] ON [CTR_M] ([SAUDAID],[CONDATE])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE INDEX [IX_CTR_M_CompCode_PATTAN] ON  [CTR_M] ([CompCode], [PATTAN]) INCLUDE ([CONSNO])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE INDEX [IX_CTR_M_CompCode_EXID_CONDATE] ON [CTR_M] ([CompCode], [EXID],[CONDATE])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    

    
    
    ' CTR_R
    
    
    VER_ADJ "CTR_R", "COMPCODE", "INT", , "0"
    VER_ADJ "CTR_R", "CONSNO", "INT", , "0"
    VER_ADJ "CTR_R", "SAUDA", "VARCHAR", 20, ""
    VER_ADJ "CTR_R", "CONDATE", "SMALLDATETIME", , ""
    VER_ADJ "CTR_R", "OPRATE", "FLOAT", , ""
    VER_ADJ "CTR_R", "HGRATE", "FLOAT", , ""
    VER_ADJ "CTR_R", "LOWRATE", "FLOAT", , ""
    VER_ADJ "CTR_R", "CLOSERATE", "FLOAT", , ""
    VER_ADJ "CTR_R", "CLRate", "Float", , 0
    VER_ADJ "CTR_R", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "CTR_R", "EXID", "INT", , "0"
    VER_ADJ "CTR_R", "ITEMID", "INT", , "0"
    VER_ADJ "CTR_R", "SAUDAID", "INT", , "0"
    VER_ADJ "CTR_R", "ITEMCODE", "VARCHAR", "20", ""
    VER_ADJ "CTR_R", "PRATE", "FLOAT", , 0
    VER_ADJ "CTR_R", "CONTIME", "VARCHAR", 50, ""
    
    'Call Delete_DependentIndex("CTR_R", "PATTAN")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "PATTAN", vbNullString)
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "DATAIMPORT", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "OPENINTEREST")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "OPENINTEREST", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "TOTALQTY")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "TOTALQTY", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "TOTALVALUE")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "TOTALVALUE", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "AVERAGERATE")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "AVERAGERATE", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "NoOfTrades")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "NOOFTRADES", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "LifeTimeHigh")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "LifeTimeHigh", vbNullString)
    Call Delete_DependentConstrainst("CTR_R", "LifeTimeLow")
    Call AddAlter_Column("CTR_R", "DROP COLUMN", "LifeTimeLow", vbNullString)
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN CONDATE SMALLDATETIME NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN SAUDA  VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_R SET ITEMCODE ='' WHERE ITEMCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN ITEMCODE  VARCHAR(20) NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_R SET ITEMCODE = (SELECT ITEMCODE FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =CTR_R.COMPCODE AND CTR_R.SAUDA=SAUDAMAST.SAUDACODE) WHERE ITEMCODE =''"
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_R SET EXCODE  ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_R SET EXCODE  = (SELECT EXCHANGECODE FROM ITEMMAST WHERE ITEMMAST.COMPCODE =CTR_R.COMPCODE AND CTR_R.ITEMCODE=ITEMMAST.ITEMCODE ) WHERE EXCODE=''"
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_R SET SAUDAID  =0 WHERE SAUDAID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='SAUDAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN SAUDAID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_R SET SAUDAID  = (SELECT SAUDAID  FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE =CTR_R.COMPCODE AND CTR_R.SAUDA=SAUDAMAST.SAUDACODE) WHERE SAUDAID=0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_R SET ITEMID  = 0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN ITEMID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_R SET ITEMID = (SELECT ITEMID FROM ITEMMAST  WHERE ITEMMAST.COMPCODE =CTR_R.COMPCODE AND ITEMMAST.ITEMCODE =CTR_R.ITEMCODE  ) WHERE ITEMID=0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE CTR_R SET EXID   = 0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CTR_R' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CTR_R ALTER COLUMN EXID  INT NOT NULL END "
    Cnn.Execute mysql
    mysql = " UPDATE CTR_R SET EXID = (SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =CTR_R.COMPCODE AND EXMAST.EXCODE  =CTR_R.EXCODE   ) WHERE EXID =0 "
    Cnn.Execute mysql
    
    
    
    
    If CHK_PRIMARY_KEY("CTR_R") = False Then
        mysql = "ALTER TABLE CTR_R ADD Primary key (CONDATE,SAUDAID) "
        Cnn.Execute mysql
    End If
    
    mysql = "CREATE  NONCLUSTERED INDEX [IX_CTR_R_CompCode_SAUDAID_CONDATE] ON [CTR_R] ([CONDATE],[SAUDAID])"
    mysql = mysql & " INCLUDE ([CLOSERATE]) "
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql

    
    
End Sub
Public Sub VER_ORD_M_D()

    Dim TRec As ADODB.Recordset
    GETMAIN.Label1.Caption = "Data Integration Check ORD_M   "
    DoEvents
        
   
    VER_ADJ "ORD_M", "COMPCODE", "INT", , "0"
    VER_ADJ "ORD_M", "ORDNO", "INT", , "0"
    VER_ADJ "ORD_M", "ORDDT", "SMALLDATETIME", , "01/01/1900"
    VER_ADJ "ORD_M", "PARTY", "VARCHAR", 20, ""
    VER_ADJ "ORD_M", "ACCID", "INT", , "0"
    
    If CHK_PRIMARY_KEY("ORD_M") = False Then
        mysql = "ALTER TABLE ORD_M ADD Primary key (ORDDT,ORDNO) "
        Cnn.Execute mysql
    End If
       
    VER_ADJ "ORD_D", "COMPCODE", "INT", , "0"
    VER_ADJ "ORD_D", "ORDNO", "INT", , "0"
    VER_ADJ "ORD_D", "ORDDT", "SMALLDATETIME", , "01/01/1900"
    VER_ADJ "ORD_D", "SAUDA", "VARCHAR", 20, ""
    VER_ADJ "ORD_D", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "ORD_D", "QTY", "FLOAT", , ""
    VER_ADJ "ORD_D", "Rate", "Float", , 0
    VER_ADJ "ORD_D", "CONTYPE", "VARCHAR", 20, ""
    VER_ADJ "ORD_D", "Status", "INT", , "0"
    VER_ADJ "ORD_D", "ROWNO", "INT", , "0"
        
    If CHK_PRIMARY_KEY("ORD_D") = False Then
        mysql = "ALTER TABLE ORD_D ADD Primary key (ORDDT,ORDNO) "
        Cnn.Execute mysql
    End If
    
    
End Sub
Public Sub VER_INV_D()


    Dim TRec As ADODB.Recordset
    GETMAIN.Label1.Caption = "Data Integration Check INV_D   "
    DoEvents
    
    mysql = "IF COL_LENGTH('INV_D','UBILLNO') IS NULL "
    mysql = mysql & " ALTER TABLE INV_D ADD UBILLNO INT IDENTITY(1,1) NOT NULL "
    Cnn.Execute mysql
    VER_ADJ "INV_D", "COMPCODE", "INT", , "0"
    VER_ADJ "INV_D", "BILLNO", "INT", , "0"
    VER_ADJ "INV_D", "STDATE", "SMALLDATETIME", , ""
    VER_ADJ "INV_D", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "INV_D", "SAUDA", "VARCHAR", 50, ""
    VER_ADJ "INV_D", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "INV_D", "EXCODE", "VARCHAR", 6, ""
    VER_ADJ "INV_D", "OPQTY", "FLOAT", , "0"
    VER_ADJ "INV_D", "OPRATE", "FLOAT", , "0"
    VER_ADJ "INV_D", "CLQTY", "FLOAT", , "0"
    VER_ADJ "INV_D", "CLRATE", "FLOAT", , "0"
    VER_ADJ "INV_D", "DIFFAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "BROKAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "BROKAMT2", "FLOAT", , "0"
    VER_ADJ "INV_D", "STDAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "TRANAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "BILLAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "VCHNO", "VARCHAR", 20, ""
    VER_ADJ "INV_D", "SETNO", "INT", , "0"
    VER_ADJ "INV_D", "INVNO", "INT", , "0"
    VER_ADJ "INV_D", "CutQty", "Float", , "0"
    VER_ADJ "INV_D", "CutRate", "Float", , "0"
    VER_ADJ "INV_D", "CALVAL", "Float", , "0"
    VER_ADJ "INV_D", "SRVAMT", "Float", , "0"
    VER_ADJ "INV_D", "OPENDT", "SMALLDateTime"
    VER_ADJ "INV_D", "TOTBQTY", "FLOAT", , "0"
    VER_ADJ "INV_D", "TOTBAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "TOTSQTY", "FLOAT", , "0"
    VER_ADJ "INV_D", "TOTSAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "STAMPAMT", "Float", , "0"
    VER_ADJ "INV_D", "FROMDATE", "SmallDateTime", , ""
    VER_ADJ "INV_D", "STTTAX", "FLOAT", , "0"
    VER_ADJ "INV_D", "CTTAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "RISKMAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "STMVOU", "FLOAT", , "0"
    VER_ADJ "INV_D", "CGSTAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "SGSTAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "IGSTAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "UTTAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "IDIFFAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "IBROKAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "IBILLAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "CURR_RATE", "FLOAT", , "1"
    VER_ADJ "INV_D", "SBC_TAX_AMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "SEBITAXAMT", "FLOAT", , "0"
    VER_ADJ "INV_D", "ACCID", "INT", , "0"
    VER_ADJ "INV_D", "ITEMID", "INT", , "0"
    VER_ADJ "INV_D", "SAUDAID", "INT", , "0"
    VER_ADJ "INV_D", "EXID", "INT", , "0"
    VER_ADJ "INV_D", "POST", "INT", , "0"
    VER_ADJ "INV_D", "VOU_ID", "INT", , "0"
    VER_ADJ "INV_D", "USDINR", "FLOAT", , "1"
    VER_ADJ "INV_D", "BROKAMT2", "FLOAT", , "1"
    
    
    Call AddAlter_Column("INV_D1", "DROP COLUMN", "VOU_TYPE", vbNullString)
    Call AddAlter_Column("INV_D", "ALTER COLUMN", "VCHNO", "VARCHAR(20) NULL")
    Call Delete_DependentConstrainst("INV_D", "BROKRATE")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "BROKRATE", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "TRANRATE")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "TRANRATE", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "STDRATE")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "STDRATE", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "BBROKAMT")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "BBROKAMT", vbNullString)
    Call AddAlter_Column("INV_D", "DROP COLUMN", "BVOUNO", vbNullString)
    Call AddAlter_Column("INV_D", "DROP COLUMN", "SVOUNO", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "SUBBROKAMT")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "SUBBROKAMT", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "SHAREAMT")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "SHAREAMT", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "SHAREAMT2")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "SHAREAMT2", vbNullString)
    Call Delete_DependentConstrainst("INV_D", "SVOUNO2")
    Call AddAlter_Column("INV_D", "DROP COLUMN", "SVOUNO2", vbNullString)
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN PARTY VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='STDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN STDATE SMALLDATETIME NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='SAUDA' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN SAUDA VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D SET EXCODE ='' WHERE EXCODE IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET EXCODE  =(SELECT EXCODE FROM SAUDAMAST  WHERE INV_D.COMPCODE=SAUDAMAST.COMPCODE AND SAUDAMAST.SAUDACODE  =INV_D.SAUDA  ) WHERE EXCODE=''"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN EXCODE  VARCHAR(20) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D  SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=INV_D.COMPCODE AND ACCOUNTM.AC_CODE  =INV_D.PARTY  ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D SET EXID   =0 WHERE EXID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN EXID  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET EXID   =(SELECT EXID  FROM EXMAST WHERE EXMAST.COMPCODE=INV_D.COMPCODE AND EXMAST.EXCODE  =INV_D.EXCODE) WHERE EXID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D SET ITEMID =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN ITEMID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE=INV_D.COMPCODE AND ITEMMAST.ITEMCODE  =INV_D.ITEMCODE ) WHERE ITEMID   =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D SET SAUDAID =0 WHERE SAUDAID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INV_D' AND COLUMN_NAME ='SAUDAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE INV_D ALTER COLUMN SAUDAID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET SAUDAID  =(SELECT SAUDAID FROM SAUDAMAST WHERE SAUDAMAST.COMPCODE=INV_D.COMPCODE AND SAUDAMAST.SAUDACODE =INV_D.SAUDA ) WHERE SAUDAID =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D SET VOU_ID  =0 WHERE VOU_ID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET VOU_ID =(SELECT VOU_ID  FROM VOUCHER WHERE VOUCHER.COMPCODE=INV_D.COMPCODE AND INV_D.VCHNO  =VOUCHER.VOU_NO  ) WHERE VOU_ID  =0 AND VCHNO <> '' AND BILLAMT<>0  "
    Cnn.Execute mysql
    mysql = "UPDATE INV_D SET VOU_ID  =0 WHERE VOU_ID IS NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE INV_D SET POST  =1 WHERE INV_D.VOU_ID IN (SELECT VOU_ID FROM VOUCHER WHERE VOUCHER.VOU_ID =INV_D.VOU_ID  ) AND POST =0 "
    Cnn.Execute mysql

    If CHK_PRIMARY_KEY("INV_D") = False Then
        mysql = "ALTER TABLE INV_D ADD Primary key (UBILLNO)"
        Cnn.Execute mysql
    End If
    
    mysql = "CREATE INDEX [IX_INV_D_SAUDAID_ACCID_STDATE] ON [INV_D] ([SAUDAID], [ACCID],[STDATE])"
    Cnn.Execute mysql
    mysql = "CREATE INDEX [IX_INV_D_STDATE_ACCID_SAUDAID] ON [INV_D] ([STDATE], [ACCID],[SAUDAID])"
    Cnn.Execute mysql
    
'    '    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_STDATE_INVNO_SAUDAID_EXID] ON [INV_D] (CompCode,STDATE,INVNO,SAUDAID,EXID)"
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode] ON [INV_D] ([CompCode]) INCLUDE ([BILLNO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D_STDATE_PARTY_EXID] ON [INV_D] ( [STDATE], [PARTY], [EXID])"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE NONCLUSTERED INDEX [IX_INV_D_VOU_ID] ON [INV_D] ([VOU_ID])"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_STDATE] ON [INV_D] ([CompCode], [STDATE])"
'    Cnn.Execute MYSQL
'
'    MYSQL = " CREATE INDEX [IX_INV_D_EXID_POST_ACCID_STDATE] ON [INV_D] ([EXID], [POST], [ACCID],[STDATE]) INCLUDE ([VOU_ID])"
'    Cnn.Execute MYSQL
'
'    MYSQL = " CREATE NONCLUSTERED INDEX [POST_STDATE_EXID] ON [INV_D1] ([POST],[STDATE],[EXID])"
'    MYSQL = MYSQL & " INCLUDE ([EXCODE],[AMOUNT],[SAMOUNT],[ACCID],[FMLYID])"
'    Cnn.Execute MYSQL
'
'    MYSQL = " CREATE NONCLUSTERED INDEX [INV_D1_FMLYID_ACCID_EXID_STDATE] ON [INV_D1] (FMLYID,ACCID,EXID,STDATE)"
'    Cnn.Execute MYSQL
'    MYSQL = " CREATE NONCLUSTERED INDEX [INV_D1_SVOU_ID] ON [INV_D1] (SVOU_ID)"
'    Cnn.Execute MYSQL
'    MYSQL = " CREATE NONCLUSTERED INDEX [INV_D1_BVOU_ID] ON [INV_D1] (BVOU_ID)"
'    Cnn.Execute MYSQL
'
''
''    'MYSQL = "CREATE INDEX [IX_INV_D_CompCode_VCHNO] ON [INV_D] ([CompCode],VCHNO) "
''    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    'Cnn.Execute MYSQL
''
''    MYSQL = "CREATE INDEX [IX_INV_D_SAUDAID] ON [INV_D] ([SAUDAID])"
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
''
''    MYSQL = "CREATE INDEX [IX_INV_D_STDATE] ON [INV_D] ([STDATE]) INCLUDE ([CompCode], [PARTY], [SAUDAID])"
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
''
''
''    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_VNO] ON [INV_D] ([CompCode],VNO) "
''    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
''    Cnn.Execute MYSQL
''
'    'MYSQL = "CREATE INDEX [IX_INV_D_CompCode_PARTY_SAUDAID_STDATE] ON [INV_D] ([CompCode], [PARTY], [SAUDAID],[STDATE]) INCLUDE ([CLQTY], [CLRATE]) "
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D ACCID_SAUDAID_STDATE] ON [INV_D] (ACCID, [SAUDAID],[STDATE]) INCLUDE ([CLQTY], [CLRATE]) "
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
''
'    MYSQL = "CREATE INDEX [IX_INV_D_PARTY_SAUDAID_STDATE2] ON [INV_D] ( [PARTY], [SAUDAID],[STDATE]) "
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_billno_vou_id ] ON  [INV_D] ([CompCode]) INCLUDE ([BILLNO], [VOU_ID])"
'    Cnn.Execute MYSQL

'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_STDATE] ON [INV_D] ([CompCode], [STDATE])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'    MYSQL = " CREATE INDEX [IX_INV_D_CompCode_SAUDAID_STDATE_PARTY_INVNO] ON [INV_D] ([CompCode], [SAUDAID],[STDATE], [PARTY],INVNO)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_STDATE_PARTY_EXID] ON [INV_D] ([CompCode], [STDATE], [PARTY], [EXID])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'
'    MYSQL = "CREATE INDEX [IX_INV_D_CompCode_STDATE_PARTY_SAUDAID_EXID] ON [INV_D] (CompCode,STDATE,PARTY,SAUDAID,EXID)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = " CREATE INDEX [IX_INV_D_CompCode_BILLNO] ON  [INV_D] ([CompCode], [BILLNO])"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    MYSQL = "CREATE INDEX [IX_INV_D1_CompCode_STDATE] ON [INV_D1] (CompCode,STDATE)"
'    MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_INV_D1_CompCode_SVOU_NO] ON [INV_D1] (CompCode,SVOU_NO )"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_INV_D1_CompCode_SVNO] ON [INV_D1] (CompCode,SVNO )"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_INV_D1_CompCode_BVNO] ON [INV_D1] (CompCode,BVNO )"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL
'
'    'MYSQL = "CREATE INDEX [IX_INV_D1_CompCode_VOU_NO] ON [INV_D1] (CompCode,VOU_NO )"
'    'MYSQL = MYSQL & " WITH ( FILLFACTOR = 80)"
'    'Cnn.Execute MYSQL

    
    
End Sub
Public Sub VER_ACCOUNT()
    Dim TRec As ADODB.Recordset
    GETMAIN.Label1.Caption = "Data Integration Check ACCOUNTM  "
    DoEvents
    
    mysql = "DELETE FROM ACCOUNTM WHERE COMPCODE IS NULL"
    Cnn.Execute mysql
    
    mysql = "IF COL_LENGTH('ACCOUNTM','ACCID') IS NULL "
    mysql = mysql & " ALTER TABLE ACCOUNTM ADD ACCID INT IDENTITY(1,1) NOT NULL "
    Cnn.Execute mysql
    
    
    VER_ADJ "ACCOUNTM", "COMPCODE", "INT", , "0"
    VER_ADJ "ACCOUNTM", "AC_CODE", "VARCHAR", 15, "0"
    VER_ADJ "ACCOUNTM", "NAME", "VARCHAR", 100, "0"
    VER_ADJ "ACCOUNTM", "GCODE", "INT", , "0"
    VER_ADJ "ACCOUNTM", "GRPCODE", "INT", , "0"
    VER_ADJ "ACCOUNTM", "OP_BAL", "FLOAT", , "0"
    VER_ADJ "ACCOUNTM", "ACTIVE", "BIT", , "1"
    VER_ADJ "ACCOUNTM", "PTYHEAD", "INT", , "0"
    Call Delete_DependentConstrainst("ACCOUNTM", "CLBAL")
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "CLBAL", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "POSTDAYS", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "INTDATE", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "ADD1", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "ADD2", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "CITY", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "PIN", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "PHONEO", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "PHONER", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "MOBILE", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "FAX", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "EMAIL", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "CONTACT", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "CREDIT", vbNullString)
    Call AddAlter_Column("ACCOUNTM", "DROP COLUMN", "DEBIT", vbNullString)
    
   mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='AC_CODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN AC_CODE VARCHAR (15) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='NAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN NAME VARCHAR(100) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='GCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN GCODE  INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='GRPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN GRPCODE  INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='OP_BAL' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN OP_BAL FLOAT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='ACTIVE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN ACTIVE BIT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTM' AND COLUMN_NAME ='PTYHEAD' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTM ALTER COLUMN PTYHEAD INT NOT NULL"
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("ACCOUNTM") = False Then
        mysql = "ALTER TABLE ACCOUNTM ADD Primary key (ACCID )"
        Cnn.Execute mysql
    End If
    
    GETMAIN.Label1.Caption = "Data Integration Check ACCOUNTD "
    DoEvents
    
    VER_ADJ "ACCOUNTD", "COMPCODE", "INT", , "0"
    VER_ADJ "ACCOUNTD", "AC_CODE", "VARCHAR", 15, "0"
    VER_ADJ "ACCOUNTD", "NAME", "VARCHAR", 100, "0"
    VER_ADJ "ACCOUNTD", "GCODE", "INT", , "0"
    VER_ADJ "ACCOUNTD", "ADD1", "VARCHAR", 100, "0"
    VER_ADJ "ACCOUNTD", "CITY", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "PIN", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "PHONEO", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "FAX", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "MOBILE", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "EMAIL", "VARCHAR", 50, "0"
    VER_ADJ "ACCOUNTD", "PERSONNELAC", "VARCHAR", 1, "0"
    VER_ADJ "ACCOUNTD", "INTAPP", "CHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "SRTAXAPP", "VARCHAR", 100, "0"
    VER_ADJ "ACCOUNTD", "PANNO", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "DIRECTOR", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "BROKTYPE", "VARCHAR", 1, "P"
    VER_ADJ "ACCOUNTD", "BROKRATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "TRANTYPE", "VARCHART", 1, "P"
    VER_ADJ "ACCOUNTD", "TRANRATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "STDARATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "PARTYTYPE", "VARCHAR", 1, "1"
    VER_ADJ "ACCOUNTD", "STTRATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "CTTTYPE", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "RISKMTYPE", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "INTRATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "GSTIN", "VARCHAR", 30, "0"
    VER_ADJ "ACCOUNTD", "CGST", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "SGST", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "IGST", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "UTT", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "UCC", "VARCHAR", 20, "0"
    VER_ADJ "ACCOUNTD", "STATE", "VARCHAR", 20, "0"
    VER_ADJ "ACCOUNTD", "STATECODE", "VARCHAR", 10, "0"
    VER_ADJ "ACCOUNTD", "SEBITYPE", "VARCHAR", 1, "N"
    VER_ADJ "ACCOUNTD", "INTTYPE", "VARCHAR", 1, "M"
    VER_ADJ "ACCOUNTD", "OptCutBrok", "VARCHAR", 1, "1"
    VER_ADJ "ACCOUNTD", "FUTCutBrok", "VARCHAR", 1, "1"
    VER_ADJ "ACCOUNTD", "MULTIPLIER", "VARCHAR", 1, "0"
    VER_ADJ "ACCOUNTD", "FROMDATE", "SMALLDATETIME", , "01/04/2000"
    VER_ADJ "ACCOUNTD", "SEBIRATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "CURRTYPE", "VARCHAR", 1, "S"
    VER_ADJ "ACCOUNTD", "CURRRATE", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "ACCID", "INT", , "0"
    VER_ADJ "ACCOUNTD", "CRLIMIT", "FLOAT", , "0"
    VER_ADJ "ACCOUNTD", "BCYCLE", "VARCHAR", 1, "D"
    
    mysql = "UPDATE ACCOUNTD SET PARTYTYPE ='1' WHERE PARTYTYPE IS NULL"
    Cnn.Execute mysql
    
    mysql = "SELECT so.name AS table_name, sc.name AS column_name, sm.text AS default_value"
    mysql = mysql & " FROM sysobjects so  JOIN syscolumns sc ON sc.id = so.id LEFT JOIN syscomments SM ON sm.id = sc.cdefault"
    mysql = mysql & " WHERE so.xtype = 'U' AND SO.name = 'ACCOUNTD' ORDER BY so.[name], sc.colid"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not TRec.EOF Then
        If UCase(TRec!COLUMN_NAME) = "RISKMAPP" And IsNull(TRec!DEFAULT_VALUE) Then
            mysql = "ALTER TABLE ACCOUNTD ADD DEFAULT 'N' FOR RISKMAPP "
            Cnn.Execute mysql
        ElseIf UCase(TRec!COLUMN_NAME) = "APPLYON" And IsNull(TRec!DEFAULT_VALUE) Then
            mysql = "ALTER TABLE ACCOUNTD ADD DEFAULT 'N' FOR APPLYON "
            Cnn.Execute mysql
        ElseIf UCase(TRec!COLUMN_NAME) = "SEBITYPE" And IsNull(TRec!DEFAULT_VALUE) Then
            mysql = "ALTER TABLE ACCOUNTD ADD DEFAULT 'N' FOR SEBITYPE "
            Cnn.Execute mysql
        End If
    End If
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTD' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTD ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTD' AND COLUMN_NAME ='AC_CODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTD ALTER COLUMN AC_CODE VARCHAR(15) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTD' AND COLUMN_NAME ='NAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCOUNTD ALTER COLUMN NAME VARCHAR(100) NOT  NULL"
    Cnn.Execute mysql
    
    
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "ADD2", vbNullString)
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "FMLYID", vbNullString)
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "CONTACT", vbNullString)
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "CLBAL", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "FMLYID2")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "FMLYID2", vbNullString)
    Call AddAlter_Column("ACCFMLYD", "DROP COLUMN", "FMLYNAME", vbNullString)
    
    Call Delete_DependentConstrainst("ACCOUNTD", "BROKON")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "BROKON", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "SHARE")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "SHARE", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "CLIENTTYPE")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "CLIENTTYPE", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "APPREP")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "APPREP", vbNullString)
    
    Call Delete_DependentConstrainst("ACCOUNTD", "STDTYAPP")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "STDTYAPP", vbNullString)
    'Call Delete_DependentConstrainst("ACCOUNTD", "BCYCLE")
    'Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "BCYCLE", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "LSTNO")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "LSTNO", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "CSTNO")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "CSTNO", vbNullString)
    Call Delete_DependentConstrainst("ACCOUNTD", "PTYHEAD")
    Call AddAlter_Column("ACCOUNTD", "DROP COLUMN", "PTYHEAD", vbNullString)
    
    mysql = "IF COL_LENGTH('ACCOUNTD','ACCID') IS NULL ALTER TABLE ACCOUNTD ADD ACCID INT "
    Cnn.Execute mysql
    mysql = "UPDATE ACCOUNTD SET ACCID  =0 WHERE ACCID IS NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCOUNTD' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE ACCOUNTD  ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCOUNTD SET ACCID  =isnull((SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=ACCOUNTD.COMPCODE AND ACCOUNTM.AC_CODE  =ACCOUNTD.AC_CODE ),0) "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("ACCOUNTD") = False Then
        mysql = "ALTER TABLE ACCOUNTD ADD Primary key (ACCID )"
        Cnn.Execute mysql
    End If
    
    'ACCOUNTD
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ACCOUNTD_COMPCODE_AC_CODE ON ACCOUNTD (COMPCODE,AC_CODE )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ACCOUNTD_COMPCODE_NAME ON ACCOUNTD (COMPCODE,NAME )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    mysql = " CREATE INDEX [IX_AccountD_CompCode] ON  [AccountD] ([CompCode]) INCLUDE ([AC_CODE], [NAME], [ACCID])"
    Cnn.Execute mysql
    
    'ACCOUNTM
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ACCOUNTM_COMPCODE_AC_CODE ON ACCOUNTM (COMPCODE,AC_CODE )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ACCOUNTM_COMPCODE_NAME ON ACCOUNTM (COMPCODE,NAME )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE  NONCLUSTERED INDEX ACCOUNTM_COMPCODE_AC_CODE_OP_BAL ON ACCOUNTM (COMPCODE,AC_CODE ) INCLUDE (OP_BAL)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
End Sub
Public Sub VER_VOUCHER()

    GETMAIN.Label1.Caption = "Data Integration Check VOUCHER "
    DoEvents
    
    mysql = "IF COL_LENGTH('VOUCHER','VOU_ID') IS NULL "
    mysql = mysql & " Alter Table VOUCHER Add VOU_ID INT Identity(1,1) NOT NULL"
    Cnn.Execute mysql

    VER_ADJ "VOUCHER", "COMPCODE", "INT", , "0"
    VER_ADJ "VOUCHER", "VOU_NO", "VARCHAR", 20, ""
    VER_ADJ "VOUCHER", "VOU_TYPE", "VARCHAR", 2, ""
    VER_ADJ "VOUCHER", "VOU_DT", "SMALLDATETIME", , ""
    VER_ADJ "VOUCHER", "VOU_PR", "VARCHAR", 1, ""
    VER_ADJ "VOUCHER", "INVNO", "INT", , "0"
    VER_ADJ "VOUCHER", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "VOUCHER", "IMPORT", "VARCHAR", 1, "0"
    VER_ADJ "VOUCHER", "SAUDA", "VARCHAR", 10, "0"
    VER_ADJ "VOUCHER", "FMLYID", "INT", , "0"
    VER_ADJ "VOUCHER", "EXID", "INT", , "0"
    VER_ADJ "VOUCHER", "CASHCODE", "VARCHAR", 15, ""

    'MYSQL = "UPDATE VOUCHER SET CASHCODE =SAUDA WHERE VOU_TYPE='CV' OR VOU_TYPE= 'BV' AND   CASHCODE IS NULL"
    'Cnn.Execute MYSQL
    
    mysql = "UPDATE VOUCHER SET VOU_PR  =LEFT(VOU_PR,1) "
    Cnn.Execute mysql
    
    Call AddAlter_Column("VOUCHER", "ALTER COLUMN", "VOU_NO", "VARCHAR(20) NULL")
    
    Call Delete_DependentConstrainst("VOUCHER", "VNO")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "VNO", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "SAUDAID")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "SAUDAID", vbNullString)
    'Call Delete_DependentConstrainst("VOUCHER", "SAUDA")
    'Call AddAlter_Column("VOUCHER", "DROP COLUMN", "SAUDA", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "NARRATION")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "NARRATION", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "BILLNO")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "BILLNO", vbNullString)
        
    Call Delete_DependentConstrainst("VOUCHER", "INVDATE")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "INVDATE", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "BILLDT")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "BILLDT", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "VCHNO")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "VCHNO", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "USER_NAME")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "USER_NAME", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "USER_TIME")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "USER_TIME", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "USER_ACTION")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "USER_ACTION", vbNullString)
    Call Delete_DependentConstrainst("VOUCHER", "USER_DATE")
    Call AddAlter_Column("VOUCHER", "DROP COLUMN", "USER_DATE", vbNullString)
    Call Delete_DependentConstrainst("VCHAMT", "INVDATE")
    
    mysql = "UPDATE VOUCHER SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE VOUCHER  SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =VOUCHER.COMPCODE AND EXMAST.EXCODE = VOUCHER.EXCODE) WHERE EXCODE<>'' "
    Cnn.Execute mysql
    mysql = "UPDATE VOUCHER SET FMLYID =0 WHERE FMLYID IS NULL"
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("VOUCHER") = False Then
        mysql = "ALTER TABLE VOUCHER ADD Primary key (VOU_ID)"
        Cnn.Execute mysql
    End If
    
    mysql = " CREATE NONCLUSTERED INDEX [voucher_vou_type] ON [VOUCHER] ([VOU_TYPE])"
    mysql = mysql & " INCLUDE ([CompCode],[VOU_DT],[EXID])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE INDEX [IX_VOUCHER_CompCode_VouNO1] ON  [VOUCHER] ([CompCode],VOU_NO) "
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    VER_ADJ "VCHAMT", "COMPCODE", "INT", , "0"
    VER_ADJ "VCHAMT", "VOU_NO", "VARCHAR", 20, ""
    VER_ADJ "VCHAMT", "VOU_TYPE", "VARCHAR", 2, ""
    VER_ADJ "VCHAMT", "VOU_DT", "SMALLDATETIME", , ""
    VER_ADJ "VCHAMT", "DR_CR", "VARCHAR", 1, ""
    VER_ADJ "VCHAMT", "AC_CODE", "VARCHAR", 15, ""
    VER_ADJ "VCHAMT", "CHEQUE_NO", "VarChar ", 20, ""
    VER_ADJ "VCHAMT", "CHEQUE_DT", "VARCHAR", 10, ""
    VER_ADJ "VCHAMT", "NARRATION", "VARCHAR", 500, ""
    VER_ADJ "VCHAMT", "BRANCH", "VARCHAR", 20, ""
    VER_ADJ "VCHAMT", "BANK_NAME", "VARCHAR", 20, ""
    VER_ADJ "VCHAMT", "INVNO", "INT", , "0"
    VER_ADJ "VCHAMT", "VOU_ID", "INT", , "0"
    VER_ADJ "VCHAMT", "IAMOUNT", "FLOAT", , "1"
    VER_ADJ "VCHAMT", "CURRRATE", "FLOAT", , "1"
    VER_ADJ "VCHAMT", "INVNO", "Int", , "0"
    VER_ADJ "VCHAMT", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "VCHAMT", "ACCID", "INT", , "0"
    VER_ADJ "VCHAMT", "EXID", "INT", , "0"
    VER_ADJ "VCHAMT", "VOUTIME", "SMALLDATETIME", , ""

    mysql = "IF COL_LENGTH('VCHAMT','VOUID') IS NULL "
    mysql = mysql & " Alter Table VCHAMT Add VOUID INT Identity(1,1) NOT NULL"
    Cnn.Execute mysql
        
    Call AddAlter_Column("VCHAMT", "ALTER COLUMN", "VOU_NO", "VARCHAR(20) NULL")
    Call AddAlter_Column("VCHAMT", "ALTER COLUMN", "CHEQUE_NO", "VARCHAR(20) NULL")
    Call AddAlter_Column("VCHAMT", "DROP COLUMN", "INVDATE", vbNullString)
    Call Delete_DependentConstrainst("VCHAMT", "ADJAMT")
    Call AddAlter_Column("VCHAMT", "DROP COLUMN", "ADJAMT", vbNullString)
    Call Delete_DependentConstrainst("VCHAMT", "VNO")
    Call AddAlter_Column("VCHAMT", "DROP COLUMN", "VNO", vbNullString)
    Call Delete_DependentConstrainst("VCHAMT", "SAUDAID")
    Call AddAlter_Column("VCHAMT", "DROP COLUMN", "SAUDAID", vbNullString)
    Call Delete_DependentConstrainst("VCHAMT", "NARR_CD")
    Call AddAlter_Column("VCHAMT", "DROP COLUMN", "NARR_CD", vbNullString)
    Call Delete_DependentConstrainst("VCHAMT", "CL_BAL")
    Call AddAlter_Column("VCHAMT", "DROP COLUMN", "CL_BAL", vbNullString)
                
    mysql = "UPDATE VCHAMT SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'VCHAMT' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE VCHAMT ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE VCHAMT SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=VCHAMT.COMPCODE AND ACCOUNTM.AC_CODE  =VCHAMT.AC_CODE   ) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE VCHAMT SET EXID  =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE VCHAMT SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =VCHAMT.COMPCODE AND EXMAST.EXCODE = VCHAMT.EXCODE) WHERE EXCODE <>''"
    Cnn.Execute mysql
    
    mysql = "UPDATE VCHAMT SET VOU_ID= 0 WHERE VOU_ID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'VCHAMT' AND COLUMN_NAME ='VOU_ID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE VCHAMT ALTER COLUMN VOU_ID  INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE VCHAMT SET VOU_ID  =(SELECT VOU_ID FROM VOUCHER WHERE VOUCHER.COMPCODE=VCHAMT.COMPCODE AND VOUCHER.VOU_NO  =VCHAMT.VOU_NO ) WHERE VOU_ID  =0  "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("VCHAMT") = False Then
        mysql = "ALTER TABLE VCHAMT ADD Primary key (VOUID)"
        Cnn.Execute mysql
    End If
        
    mysql = "CREATE NONCLUSTERED INDEX [IX_VCHAMT_VOU_ID] ON [VCHAMT] ([VOU_ID])"
    Cnn.Execute mysql
    
    mysql = " CREATE  NONCLUSTERED INDEX [COMPCODE_VOU_NO200] ON [VCHAMT] (COMPCODE,[VOU_NO])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = " CREATE INDEX [IX_VCHAMT_ACCID_VOU_TYPE_VOU_DT] ON [VCHAMT]"
    mysql = mysql & "  ([ACCID],[VOU_TYPE], [VOU_DT]) INCLUDE ([DR_CR], [AMOUNT])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    'MYSQL = "CREATE INDEX [IX_VCHAMT_VOU_ID] ON  [VCHAMT] ([VOU_ID])"
    'Cnn.Execute MYSQL
    mysql = " CREATE INDEX [IX_VCHAMT_ACCID] ON  [VCHAMT] ([ACCID]) INCLUDE ([DR_CR], [AMOUNT], [VOU_ID])"
    Cnn.Execute mysql
    mysql = " CREATE INDEX [IX_VCHAMT_ACCID2] ON  [VCHAMT] ([ACCID])"
    Cnn.Execute mysql
              
             
    VER_ADJ "VCHAMT_LOG", "COMPCODE", "INT", , "0"
    VER_ADJ "VCHAMT_LOG", "VOU_NO", "VARCHAR", 20, ""
    VER_ADJ "VCHAMT_LOG", "VOU_TYPE", "VARCHAR", 2, ""
    VER_ADJ "VCHAMT_LOG", "VOU_DT", "SMALLDATETIME", , ""
    VER_ADJ "VCHAMT_LOG", "DR_CR", "VARCHAR", 1, ""
    VER_ADJ "VCHAMT_LOG", "AC_CODE", "VARCHAR", 15, ""
    VER_ADJ "VCHAMT_LOG", "AMOUNT", "FLOAT", , "1"
    VER_ADJ "VCHAMT_LOG", "CHEQUE_NO", "VarChar ", 7, ""
    VER_ADJ "VCHAMT_LOG", "CHEQUE_DT", "VARCHAR", 12, ""
    VER_ADJ "VCHAMT_LOG", "NARRATION", "VARCHAR", 500, ""
    VER_ADJ "VCHAMT_LOG", "BRANCH", "VARCHAR", 30, ""
    VER_ADJ "VCHAMT_LOG", "BANK_NAME", "VARCHAR", 30, ""
    VER_ADJ "VCHAMT_LOG", "VOUID", "INT", , "0"
    VER_ADJ "VCHAMT_LOG", "INVNO", "INT", , "0"
    VER_ADJ "VCHAMT_LOG", "VOU_ID", "INT", , "0"
    VER_ADJ "VCHAMT_LOG", "IAMOUNT", "FLOAT", , "1"
    VER_ADJ "VCHAMT_LOG", "CURRRATE", "FLOAT", , "1"
    VER_ADJ "VCHAMT_LOG", "INVNO", "Int", , "0"
    VER_ADJ "VCHAMT_LOG", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "VCHAMT_LOG", "ACCID", "INT", , "0"
    VER_ADJ "VCHAMT_LOG", "EXID", "INT", , "0"
    VER_ADJ "VCHAMT_LOG", "loginuser", "VARCHAR", 15, ""
    VER_ADJ "VCHAMT_LOG", "datetm", "SMALLDATETIME", , ""
    VER_ADJ "VCHAMT_LOG", "tran", "VARCHAR", 1, ""
        
End Sub

Public Sub VER_ACCFMLY()
    Dim TRec As ADODB.Recordset
    GETMAIN.Label1.Caption = "Data Integration Check ACCFMLY    "
    DoEvents
    
    VER_ADJ "ACCFMLY", "COMPCODE", "INT", 1, "0"
    VER_ADJ "ACCFMLY", "FMLYCODE", "VARCHAR", 6, "0"
    VER_ADJ "ACCFMLY", "FMLYNAME", "VARCHAR", 100, "0"
    VER_ADJ "ACCFMLY", "FMLYHEAD", "VARCHAR", 15, "0"
    VER_ADJ "ACCFMLY", "CONTRA_AC", "VARCHAR", 15, "0"
    VER_ADJ "ACCFMLY", "POSTSETTLE", "VARCHAR", 1, "N"
    VER_ADJ "ACCFMLY", "HEADID", "INT", , "0"
    VER_ADJ "ACCFMLY", "CONTRAID", "INT", , "0"

    mysql = "IF COL_LENGTH('ACCFMLY','FMLYID') IS NULL "
    mysql = mysql & " ALTER TABLE ACCFMLY ADD FMLYID INT IDENTITY(1,1) NOT NULL "
    Cnn.Execute mysql
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN COMPCODE INT NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='FMLYCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN FMLYCODE VARCHAR(6) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='FMLYNAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN FMLYNAME VARCHAR(50) NOT NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE ACCFMLY SET FMLYHEAD ='' WHERE FMLYHEAD IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='FMLYHEAD' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN FMLYHEAD VARCHAR(15) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE ACCFMLY SET CONTRA_AC ='' WHERE CONTRA_AC IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='CONTRA_AC' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN CONTRA_AC VARCHAR(15) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE ACCFMLY SET POSTSETTLE ='N'  WHERE POSTSETTLE IS NULL "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='POSTSETTLE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN POSTSETTLE VARCHAR(1) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='POSTSETTLE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN POSTSETTLE VARCHAR(1) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE ACCFMLY SET HEADID=0 WHERE HEADID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='HEADID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN HEADID  INT  NOT  NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCFMLY SET HEADID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=ACCFMLY.COMPCODE AND ACCOUNTM.AC_CODE  =ACCFMLY.FMLYHEAD ) WHERE HEADID  =0  "
    Cnn.Execute mysql
    
    
    mysql = "UPDATE ACCFMLY SET CONTRAID=0 WHERE CONTRAID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLY' AND COLUMN_NAME ='CONTRAID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLY ALTER COLUMN CONTRAID  INT  NOT  NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCFMLY  SET CONTRAID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=ACCFMLY.COMPCODE AND ACCOUNTM.AC_CODE  =ACCFMLY.CONTRA_AC  ) WHERE CONTRAID  =0  "
    Cnn.Execute mysql
    
    
    If CHK_PRIMARY_KEY("ACCFMLY") = False Then
        mysql = "ALTER TABLE ACCFMLY ADD Primary key (FMLYID )"
        Cnn.Execute mysql
    End If
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ACCFMLY_COMPCODE_FMLYNAME ON ACCFMLY (COMPCODE,FMLYNAME)"
    mysql = mysql & " INCLUDE (FMLYCODE)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
      
    GETMAIN.Label1.Caption = "Updating ACCID ACCFMLYD "
    DoEvents
    
    VER_ADJ "ACCFMLYD", "Compcode", "INT", , "0"
    VER_ADJ "ACCFMLYD", "FMLYCODE", "VARCHAR", 6, "0"
    VER_ADJ "ACCFMLYD", "PARTY", "VARCHAR", 15, "0"
    VER_ADJ "ACCFMLYD", "FMLYID", "INT", , "0"
    VER_ADJ "ACCFMLYD", "ACCID", "INT", , "0"
    VER_ADJ "ACCFMLYD", "INCLMTM", "VARCHAR", 1, "Y"

    mysql = "DELETE FROM ACCFMLYD WHERE COMPCODE =" & GCompCode & "  AND PARTY  NOT IN (SELECT AC_CODE FROM ACCOUNTD  WHERE COMPCODE =" & GCompCode & ")"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM ACCFMLYD WHERE COMPCODE =" & GCompCode & "  AND FMLYCODE NOT IN (SELECT FMLYCODE FROM ACCFMLY WHERE COMPCODE =" & GCompCode & ")"
    Cnn.Execute mysql
    
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLYD' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLYD ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLYD' AND COLUMN_NAME ='FMLYCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLYD ALTER COLUMN FMLYCODE VARCHAR(6) NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLYD' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLYD ALTER COLUMN PARTY  VARCHAR(15) NOT  NULL"
    Cnn.Execute mysql
    
    
    mysql = "UPDATE ACCFMLYD SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLYD' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCFMLYD ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCFMLYD  SET ACCID  =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=ACCFMLYD.COMPCODE AND ACCOUNTM.AC_CODE  =ACCFMLYD.PARTY  ) WHERE ACCID  =0  "
    Cnn.Execute mysql

    
    mysql = "IF COL_LENGTH('ACCFMLYD','FMLYID') IS NULL ALTER TABLE ACCFMLYD ADD FMLYID  INT "
    Cnn.Execute mysql
    mysql = "UPDATE ACCFMLYD  SET FMLYID  =0 WHERE FMLYID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCFMLYD' AND COLUMN_NAME ='FMLYID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE ACCFMLYD ALTER COLUMN FMLYID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCFMLYD SET FMLYID =(SELECT FMLYID FROM ACCFMLY  WHERE ACCFMLY.COMPCODE=ACCFMLYD.COMPCODE AND ACCFMLY.FMLYCODE  =ACCFMLYD.FMLYCODE ) WHERE FMLYID  =0  "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("ACCFMLYD") = False Then
        mysql = "ALTER TABLE ACCFMLYD ADD Primary key (FMLYID,ACCID )"
        Cnn.Execute mysql
    End If
      
End Sub
    


Public Function CHK_PRIMARY_KEY(LTblName As String) As Boolean
Dim TRec As ADODB.Recordset
CHK_PRIMARY_KEY = False
mysql = "SELECT * From information_schema.table_constraints WHERE constraint_type = 'PRIMARY KEY' AND table_name = '" & LTblName & "'"
Set TRec = Nothing
Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    CHK_PRIMARY_KEY = True
End If
End Function

Public Sub VER_EXMAST()
    
    
    GETMAIN.Label1.Caption = "Data Integration Check EXMAST"
    DoEvents
    
    mysql = "IF COL_LENGTH('EXMAST','EXID') IS NULL "
    mysql = mysql & " Alter Table EXMAST Add EXID INT Identity(1,1) NOT NULL"
    Cnn.Execute mysql
    VER_ADJ "EXMAST", "COMPCODE", "INT", , "0"
    VER_ADJ "EXMAST", "EXCODE", "VARCHAR", 10, "0"
    VER_ADJ "EXMAST", "EXNAME", "VARCHAR", 100, "0"
    VER_ADJ "EXMAST", "TRADINGACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "BANKACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "ContractACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "BROKAC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "STANDAC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "TRANAC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "SHREEAC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "TRADEDI", "VARCHAR", 1, "C"
    VER_ADJ "EXMAST", "SrvTaxACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "BROKERTYPE", "VARCHAR", 1, "S"
    VER_ADJ "EXMAST", "PARTYAS", "VARCHAR", 1, "C"
    VER_ADJ "EXMAST", "MarginACC", "VARCHAR", 15, "C"
    VER_ADJ "EXMAST", "MEMBERID", "VARCHAR", 30, "0"
    VER_ADJ "EXMAST", "SDutyTaxAcc", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "BANKCLI", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "TRANTAX", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "FMCCODE", "VARCHAR", 100, "0"
    VER_ADJ "EXMAST", "LOTWISE", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "TRADE", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "CLOSING", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "MARGINRATE", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "MARGINFILE", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "ONLINECTCL", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "OnlineCTCLODIN", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "ContractMaster", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "ALLTERMINAL", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "BANKFILE", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "SAUDATRADE", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "RISKMACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "CGSTACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "SGSTACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "IGSTACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "UTTTACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "CLOSEFILE", "VARCHAR", 1, "0"
    VER_ADJ "EXMAST", "InterestAcc", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "SBCAcc", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "STCAcc", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "CashAcc", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "OPTIONS", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "CLGACC", "VARCHAR", 15, "0"
    VER_ADJ "EXMAST", "CURR", "VARCHAR", 1, "N"
    VER_ADJ "EXMAST", "TFILETYPE", "VARCHAR", 1, "0"
    VER_ADJ "EXMAST", "CURRSAUDA", "VARCHAR", 50, "0"
    VER_ADJ "EXMAST", "OPTINDEX", "CHAR", 1, "N"
    If CHK_PRIMARY_KEY("EXMAST") = False Then
        mysql = "ALTER TABLE EXMAST ADD Primary key (EXID)"
        Cnn.Execute mysql
    End If
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXMAST' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXMAST ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXMAST' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXMAST ALTER COLUMN EXCODE VARCHAR(10) NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXMAST' AND COLUMN_NAME ='EXNAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXMAST ALTER COLUMN EXNAME VARCHAR(100) NOT  NULL"
    Cnn.Execute mysql
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX EXMAST_COMPCODE_EXCODE ON EXMAST (COMPCODE,EXCODE )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX EXMAST_COMPCODE_EXNAME ON EXMAST (COMPCODE,EXNAME )"
    mysql = mysql & " INCLUDE (EXCODE,CURR)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX EXMAST_COMPCODE_EXCODE_EXID ON EXMAST (COMPCODE,EXCODE )"
    mysql = mysql & " INCLUDE (EXID)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
End Sub
Public Sub VER_ITEMMAST()
    
    GETMAIN.Label1.Caption = "Data Integration Check ITEMMAST   "
    DoEvents
    
    mysql = "IF COL_LENGTH('ITEMMAST','ITEMID') IS NULL "
    mysql = mysql & " Alter Table ITEMMAST Add ITEMID int Identity(1,1) NOT NULL"
    Cnn.Execute mysql
    
    
    '>>> ALIAS COLUMNS - 21 FEB. 2021 -START
    mysql = "IF COL_LENGTH('ITEMMAST','ITALIAS_1') IS NULL "
    mysql = mysql & " Alter Table ITEMMAST Add ITALIAS_1 NVARCHAR(20) NULL"
    Cnn.Execute mysql
    mysql = "IF COL_LENGTH('ITEMMAST','ITALIAS_2') IS NULL "
    mysql = mysql & " Alter Table ITEMMAST Add ITALIAS_2 NVARCHAR(20) NULL"
    Cnn.Execute mysql
    mysql = "IF COL_LENGTH('ITEMMAST','ITALIAS_3') IS NULL "
    mysql = mysql & " Alter Table ITEMMAST Add ITALIAS_3 NVARCHAR(20) NULL"
    Cnn.Execute mysql
    mysql = "IF COL_LENGTH('ITEMMAST','ITALIAS_4') IS NULL "
    mysql = mysql & " Alter Table ITEMMAST Add ITALIAS_4 NVARCHAR(20) NULL"
    Cnn.Execute mysql
    mysql = "IF COL_LENGTH('ITEMMAST','ITALIAS_5') IS NULL "
    mysql = mysql & " Alter Table ITEMMAST Add ITALIAS_5 NVARCHAR(20) NULL"
    Cnn.Execute mysql
    '>>> ALIAS COLUMNS - 21 FEB. 2021 -END
    
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "BROKTYPE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "BROKRATE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "TRANTYPE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "TRANRATE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "MARTYPE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "MARRATE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "STDRATE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "ACTIVE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "ITEMRATE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "SDUTYTYPE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "SDUTYRATE", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "SDUTYPER", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "DELIVERYUNIT", vbNullString)
    Call Delete_DependentConstrainst("ITEMMAST", "DELIVERYLOT")
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "DELIVERYLOT", vbNullString)
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "STARTDATE", vbNullString)
    Call Delete_DependentConstrainst("ITEMMAST", "RISKMDATE")
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "RISKMDATE", vbNullString)
    Call Delete_DependentConstrainst("ITEMMAST", "RISKMTODATE")
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "RISKMTODATE", vbNullString)
    Call Delete_DependentConstrainst("ITEMMAST", "CTTTODATE")
    Call AddAlter_Column("ITEMMAST", "DROP COLUMN", "CTTTODATE", vbNullString)
    
    
    VER_ADJ "ITEMMAST", "COMPCODE", "INT", , "0"
    VER_ADJ "ITEMMAST", "ITEMCODE", "VARCHAR", 20, "0"
    VER_ADJ "ITEMMAST", "ITEMNAME", "VARCHAR", 50, "0"
    VER_ADJ "ITEMMAST", "LOT", "FLOAT", , "1"
    VER_ADJ "ITEMMAST", "EXHCODE", "VARCHAR", 30, "0"
    VER_ADJ "ITEMMAST", "EXCHANGECODE", "VARCHAR", 10, "0"
    VER_ADJ "ITEMMAST", "PRICEUNIT", "VARCHAR", 50, "0"
    VER_ADJ "ITEMMAST", "QTYUNIT", "VARCHAR", 50, "0"
    VER_ADJ "ITEMMAST", "RegularLot", "FLOAT", , "1"
    VER_ADJ "ITEMMAST", "SCGROUP", "VARCHAR", 5, "0"
    VER_ADJ "ITEMMAST", "CTTAPP", "VARCHAR", 1, "N"
    VER_ADJ "ITEMMAST", "RISKMAPP", "VARCHAR", 1, "N"
    VER_ADJ "ITEMMAST", "STMAPP", "VARCHAR", 1, "N"
    VER_ADJ "ITEMMAST", "CTTDATE", "SMALLDATETIME", , "01/07/2013"
    VER_ADJ "ITEMMAST", "EXID", "INT", , "0"
    VER_ADJ "ITEMMAST", "CITEMID", "INT", , "0"
    VER_ADJ "ITEMMAST", "REFLOT", "FLOAT", , "0"
    
    mysql = "UPDATE ITEMMAST SET CITEMID =ITEMID WHERE CITEMID =0"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEMMAST' AND COLUMN_NAME ='EXCHANGECODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST  ALTER COLUMN EXCHANGECODE VARCHAR(10)"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEMMAST' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEMMAST' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST ALTER COLUMN ITEMCODE  VARCHAR(20) NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEMMAST' AND COLUMN_NAME ='ITEMNAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST ALTER COLUMN ITEMNAME  VARCHAR(50) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF COL_LENGTH('ITEMMAST','EXID') IS NULL ALTER TABLE ITEMMAST Add EXID INT "
    Cnn.Execute mysql
    'WHERE EXID IS NULL"
    mysql = "UPDATE ITEMMAST SET EXID =0 "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEMMAST' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST ALTER COLUMN EXID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ITEMMAST SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =ITEMMAST.COMPCODE AND EXMAST.EXCODE = ITEMMAST.EXCHANGECODE) WHERE EXID =0 "
        Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("ITEMMAST") = False Then
        mysql = "ALTER TABLE ITEMMAST  ADD Primary key (ITEMID )"
        Cnn.Execute mysql
    End If
    
    VER_ADJ "ITEM_TAX", "COMPCODE", "INT", , ""
    VER_ADJ "ITEM_TAX", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "ITEM_TAX", "ITEMCODE", "VARCHAR", 50, ""
    VER_ADJ "ITEM_TAX", "FROMDT", "SMALLDATETIME", , ""
    VER_ADJ "ITEM_TAX", "TODT", "SMALLDATETIME", , ""
    VER_ADJ "ITEM_TAX", "RISKMRATE", "FLOAT", , "0"
    VER_ADJ "ITEM_TAX", "CTTRATE", "FLOAT", , "0"
    VER_ADJ "ITEM_TAX", "SEBITAX", "FLOAT", , "0"
    VER_ADJ "ITEM_TAX", "EXID", "INT", , "0"
    VER_ADJ "ITEM_TAX", "ITEMID", "INT", , "0"
    
    mysql = "UPDATE ITEM_TAX SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEM_TAX' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST ALTER COLUMN EXID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ITEM_TAX SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =ITEM_TAX.COMPCODE AND EXMAST.EXCODE = ITEM_TAX.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    
    mysql = "UPDATE ITEM_TAX SET ITEMID =0 WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ITEM_TAX' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ITEMMAST ALTER COLUMN ITEMID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ITEM_TAX SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE =ITEM_TAX.COMPCODE AND ITEMMAST.ITEMCODE = ITEM_TAX.ITEMCODE ) WHERE ITEMID =0"
    Cnn.Execute mysql
    
    
        'ITEMMAST
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ITEMMAST_COMPCODE_ITEMCODE ON ITEMMAST (COMPCODE,ITEMCODE)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ITEMMAST_COMPCODE_ITEMNAME ON ITEMMAST (COMPCODE,ITEMNAME)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    'ITEMMAST
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ITEMMAST_COMPCODE_EXCHANGECODE_EXHCODE ON ITEMMAST (COMPCODE,EXCHANGECODE,EXHCODE)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
   
    
    
    
End Sub
    
Public Sub VER_SAUDAMAST()


    GETMAIN.Label1.Caption = "Data Integration Check SAUDAMAST "
    DoEvents
    mysql = "IF COL_LENGTH('SAUDAMAST','SAUDAID') IS NULL "
    mysql = mysql & " Alter Table SAUDAMAST  Add SAUDAID INT  Identity(1,1) NOT NULL"
    Cnn.Execute mysql
    
    VER_ADJ "SAUDAMAST", "COMPCODE", "INT", , "0"
    VER_ADJ "SAUDAMAST", "SAUDACODE", "VARCHAR", 50, "0"
    VER_ADJ "SAUDAMAST", "SAUDANAME", "VARCHAR", 50, "0"
    VER_ADJ "SAUDAMAST", "EXCODE", "VARCHAR", 10, "0"
    VER_ADJ "SAUDAMAST", "ITEMCODE", "VARCHAR", 20, "0"
    VER_ADJ "SAUDAMAST", "EXID", "INT", , "0"
    VER_ADJ "SAUDAMAST", "ITEMID", "INT", , "0"
    VER_ADJ "SAUDAMAST", "MATURITY", "SAMLLDATETIME", , "31/03/2021"
    VER_ADJ "SAUDAMAST", "TRADEABLELOT", "FLOAT", , "1"
    VER_ADJ "SAUDAMAST", "BROKLOT", "FLOAT", , "1"
    VER_ADJ "SAUDAMAST", "NOCODE", "INT", , "0"
    VER_ADJ "SAUDAMAST", "INSTTYPE", "VARCHAR", 3, "FUT"
    VER_ADJ "SAUDAMAST", "OPTTYPE", "VARCHAR", 2, ""
    VER_ADJ "SAUDAMAST", "STRIKEPRICE", "FLOAT", , "0"
    VER_ADJ "SAUDAMAST", "REFLOT", "FLOAT", , "1"
    
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "COMMASSET", vbNullString)
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "COMMGROUP", vbNullString)
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "CONDEL", vbNullString)
    Call Delete_DependentConstrainst("SAUDAMAST", "PRICETICK")
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "PRICETICK", vbNullString)
    Call Delete_DependentConstrainst("SAUDAMAST", "ACTIVE")
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "ACTIVE", vbNullString)
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "CONTRASAUDA", vbNullString)
    Call Delete_DependentConstrainst("SAUDAMAST", "QUOTQTY")
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "QUOTQTY", vbNullString)
    Call AddAlter_Column("SAUDAMAST", "DROP COLUMN", "QUOTUNIT", vbNullString)
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='SAUDACODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN SAUDACODE VARCHAR(50) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='SAUDANAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN SAUDANAME VARCHAR(50) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN ITEMCODE VARCHAR(20) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN EXCODE VARCHAR(10) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='MATURITY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN MATURITY SMALLDATETIME  NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='OPTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN OPTTYPE  VARCHAR(2) NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='STRIKEPRICE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN STRIKEPRICE FLOAT  NOT  NULL"
    Cnn.Execute mysql
    
    
    mysql = "UPDATE SAUDAMAST  SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE SAUDAMAST  ALTER COLUMN EXID INT  NOT  NULL"
    Cnn.Execute mysql
    mysql = "UPDATE SAUDAMAST SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =SAUDAMAST.COMPCODE AND EXMAST.EXCODE = SAUDAMAST.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    
    mysql = "UPDATE SAUDAMAST  SET ITEMID  =0 WHERE ITEMID  IS NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SAUDAMAST' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE SAUDAMAST  ALTER COLUMN ITEMID INT  NOT  NULL"
    Cnn.Execute mysql
    mysql = "UPDATE SAUDAMAST SET ITEMID =(SELECT ITEMID FROM ITEMMAST WHERE SAUDAMAST.COMPCODE=ITEMMAST.COMPCODE AND SAUDAMAST.ITEMCODE =ITEMMAST.ITEMCODE  ) WHERE ITEMID =0  "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("SAUDAMAST") = False Then
        mysql = "ALTER TABLE SAUDAMAST ADD Primary key (SAUDAID)"
        Cnn.Execute mysql
    End If
    
        'SAUDAMMAST
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX SAUDAMAST_COMPCODE_SAUDACODE ON SAUDAMAST (COMPCODE,SAUDACODE )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX SAUDAMAST_COMPCODE_SAUDANAME ON SAUDAMAST (COMPCODE,SAUDANAME  )"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = "CREATE UNIQUE NONCLUSTERED INDEX ITEMID_MATURITY ON SAUDAMAST (ITEMID,INSTTYPE,OPTTYPE,STRIKEPRICE ,MATURITY)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql

    
    
End Sub
Public Sub Update_SpreadQty(ByVal LSSParties As String, ByVal LSSItems As String, ByVal LSSExIDs, ByVal LSSFromDate As Date)
    Dim PtyRec As ADODB.Recordset:          Dim DateRec As ADODB.Recordset
    Dim SaudaRec As ADODB.Recordset:        Dim TRec As ADODB.Recordset
    Dim LACCID As Long
    
    Set PtyRec = Nothing
    Set DateRec = Nothing
    Set SaudaRec = Nothing
    If GUniqClientId = "2641AHM" Then
        mysql = "UPDATE DMARGIN SET FlatQty=ABS(CLOSEQTY ) WHERE CompCode= " & GCompCode & ""
        If LenB(LSSItems) > 0 Then mysql = mysql & " AND ITEMID  IN (" & LSSItems & ")"
        If LenB(LSSExIDs) > 0 Then mysql = mysql & " AND EXID   IN (" & LSSExIDs & ")"
        If LenB(LSSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LSSParties & ")"
        mysql = mysql & " AND CONDATE>='" & Format(LSSFromDate, "YYYY/MM/DD") & "'"
        Cnn.Execute mysql
    
    Else
        mysql = "UPDATE DMARGIN SET FlatQty=0, SpreadQty=0 WHERE CompCode= " & GCompCode & ""
        If LenB(LSSItems) > 0 Then mysql = mysql & " AND ITEMID IN (" & LSSItems & ")"
        If LenB(LSSExIDs) > 0 Then mysql = mysql & " AND EXID IN (" & LSSExIDs & ")"
        If LenB(LSSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LSSParties & ")"
        mysql = mysql & " AND CONDATE>='" & Format(LSSFromDate, "YYYY/MM/DD") & "'"
        Cnn.Execute mysql
        Set TRec = Nothing
        Set TRec = New ADODB.Recordset
        
        mysql = "SELECT ACCID,PARTY,ITEMID,CONDATE, COUNT(*) FROM DMARGIN "
        mysql = mysql & " WHERE COMPCODE = " & GCompCode & " AND CLOSEQTY <> 0 AND EXCODE IN ('MCX','NCDX') "
        If LenB(LSSItems) > 0 Then mysql = mysql & " AND ITEMID IN (" & LSSItems & ") "
        If LenB(LSSExIDs) > 0 Then mysql = mysql & " AND EXID IN (" & LSSExIDs & ") "
        If LenB(LSSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LSSParties & ") "
        mysql = mysql & " AND CONDATE>='" & Format(LSSFromDate, "YYYY/MM/DD") & "' "
        mysql = mysql & " AND ACCID IN (SELECT DISTINCT ACCID  FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND INSTTYPE='FUT' AND MARTYPE ='I' AND UPTOSTDT >='" & Format(LSSFromDate, "YYYY/MM/DD") & "'AND EXCODE IN ('MCX','NCDX'))"
        mysql = mysql & " GROUP BY ACCID ,PARTY,ITEMID,CONDATE "
        mysql = mysql & " HAVING COUNT(*) =1 "
        TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        GETMAIN.Label1.Caption = "Updateing Flat Qty "
        DoEvents
        Do While Not TRec.EOF
            LACCID = TRec!ACCID
            mysql = " EXEC UPDATE_FLATQTY " & LACCID & "," & TRec!itemid & ",'" & Format(TRec!Condate, "YYYY/MM/DD") & "'"
            Cnn.Execute mysql
            TRec.MoveNext
        Loop
        mysql = "UPDATE DMARGIN SET FLATQTY =CLOSEQTY WHERE COMPCODE =" & GCompCode & " "
        mysql = mysql & " AND SAUDAID IN (SELECT DISTINCT SAUDAID FROM SAUDAMAST WHERE COMPCODE=" & GCompCode & " AND INSTTYPE ='OPT')"
        If LenB(LSSItems) > 0 Then mysql = mysql & " AND ITEMID  IN (" & LSSItems & ") "
        If LenB(LSSExIDs) > 0 Then mysql = mysql & " AND EXID   IN (" & LSSExIDs & ") "
        If LenB(LSSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LSSParties & ") "
        mysql = mysql & " AND ACCID  IN (SELECT DISTINCT ACCID  FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND INSTTYPE='FUT' AND MARTYPE ='I' AND UPTOSTDT >='" & Format(LSSFromDate, "YYYY/MM/DD") & "')"
        mysql = mysql & " AND CONDATE>='" & Format(LSSFromDate, "YYYY/MM/DD") & "' "
        Cnn.Execute mysql
        
        Call Update_NCDX_Spread(LSSParties, LSSItems, LSSExIDs, LSSFromDate)
        Call Update_MCX_Spread(LSSParties, LSSItems, LSSExIDs, LSSFromDate)
        ' FOR ONLY NSE CONTRACTS
        mysql = "UPDATE DMARGIN SET FLATQTY = ABS(CLOSEQTY) WHERE COMPCODE =" & GCompCode & " AND EXCODE ='NSE' "
        If Len(LSSItems) > 0 Then mysql = mysql & " AND ITEMID IN (" & LSSItems & ")"
        If Len(LSSExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LSSExIDs & ")"
        If Len(LSSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LSSParties & ")"
        mysql = mysql & " AND CONDATE>='" & Format(CDate(LSSFromDate), "YYYY/MM/DD") & "'"
        Cnn.Execute mysql
    End If



End Sub
Public Sub Update_NCDX_Spread(ByVal LNSParties As String, ByVal LNSItems As String, ByVal LNSExIDs, ByVal LNSFromDate As Date)
'for ncdx
Dim TRec As ADODB.Recordset
Dim mparty As String:       Dim MItemCode  As String:   Dim MCondate As Date:
Dim MCloseQty As Double:    Dim MSpreadQty As Double:   Dim MBalQty As Double
Dim LItemID  As Integer:    Dim LExID As Integer:       Dim Lmaturity As Date
Dim LSaudaID As Integer:    Dim NewRec As ADODB.Recordset
Dim LSSaudaID As Integer
Dim LACCID As Long


Set TRec = Nothing
mysql = "SELECT ACCID,PARTY,ITEMCODE,SAUDAID,ITEMID,EXID,MATURITY,CONDATE,SUM(CLOSEQTY) AS CLOSQTY FROM DMARGIN WHERE COMPCODE =" & GCompCode & " AND EXCODE IN ('MCX','NCDX') "
If Len(LNSItems) > 0 Then mysql = mysql & " AND ITEMID IN (" & LNSItems & ")"
If Len(LNSExIDs) > 0 Then mysql = mysql & " AND EXID   IN (" & LNSExIDs & ")"
If Len(LNSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LNSParties & ")"
mysql = mysql & " AND CONDATE>='" & Format(LNSFromDate, "YYYY/MM/DD") & "'"
mysql = mysql & " AND ACCID  IN (SELECT DISTINCT ACCID  FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND INSTTYPE='FUT' AND MARTYPE ='I' AND UPTOSTDT >='" & Format(LNSFromDate, "YYYY/MM/DD") & "' AND EXCODE ='NCDX')"
mysql = mysql & " AND EXCODE ='NCDX' AND FLATQTY<>CLOSEQTY "
mysql = mysql & " GROUP BY ACCID,PARTY,CONDATE,ITEMCODE,SAUDAID,ITEMID,EXID,MATURITY "
mysql = mysql & " ORDER BY PARTY,CONDATE,ITEMCODE,MATURITY "
Set TRec = Nothing: Set TRec = New ADODB.Recordset
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
DoEvents
GETMAIN.Label1.Caption = "Updateing Spread Qty NCDX"
Do While Not TRec.EOF
    mparty = TRec!PARTY:            MItemCode = TRec!ITEMCODE:
    MCondate = TRec!Condate:        MCloseQty = TRec!CLOSQTY:
    MSpreadQty = 0:                 MBalQty = Abs(MCloseQty)
    LItemID = TRec!itemid:          LExID = TRec!EXID
    Lmaturity = TRec!MATURITY
    LSaudaID = TRec!SAUDAID
    LACCID = TRec!ACCID
    ' If LItemID = 78 Then
    '     MsgBox ""
    ' End If
    If MCloseQty > 0 Then
        mysql = "SELECT SAUDAID,CLOSEQTY FROM DMARGIN WHERE ACCID =" & LACCID & " AND ITEMID =" & LItemID & " AND (ABS(FLATQTY)+abs(SPREADQTY)) <> ABS(CLOSEQTY) "
        mysql = mysql & " AND CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "' AND CLOSEQTY < 0  "
        Set NewRec = Nothing: Set NewRec = New ADODB.Recordset
        NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not NewRec.EOF Then
            Do While Not NewRec.EOF
                LSSaudaID = NewRec!SAUDAID
                mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "',0,0"
                Cnn.Execute mysql
                MSpreadQty = MSpreadQty + Abs(NewRec!CLOSEQTY)
                NewRec.MoveNext
            Loop
        End If
        If MSpreadQty = 0 Then
            mysql = " EXEC UPDATE_FLATQTYBUY  " & LACCID & "," & LItemID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'"
            Cnn.Execute mysql
        Else
            mysql = "SELECT SAUDAID,CLOSEQTY FROM DMARGIN WHERE  ACCID   =" & LACCID & " AND ITEMID=" & LItemID & " AND (ABS(FLATQTY)+ABS(SPREADQTY)) <>ABS(CLOSEQTY)  "
            mysql = mysql & "  AND CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "'AND CLOSEQTY > 0 ORDER BY MATURITY"
            Set NewRec = Nothing
            Set NewRec = New ADODB.Recordset
            NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not NewRec.EOF Then
                Do While Not NewRec.EOF
                    LSSaudaID = NewRec!SAUDAID
                    If MSpreadQty > Abs(NewRec!CLOSEQTY) Then
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "',0," & Abs(NewRec!CLOSEQTY) & ""
                        Cnn.Execute mysql
                        MSpreadQty = MSpreadQty - Abs(NewRec!CLOSEQTY)
                    ElseIf MSpreadQty = 0 Then
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) & ", 0 "
                        Cnn.Execute mysql
                        MSpreadQty = 0
                    ElseIf MSpreadQty < Abs(NewRec!CLOSEQTY) Then
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) - MSpreadQty & "," & MSpreadQty & ""
                        Cnn.Execute mysql
                        MSpreadQty = 0
                    End If
                    NewRec.MoveNext
                Loop
            End If
        End If
    Else
        mysql = "SELECT SAUDAID,CLOSEQTY FROM DMARGIN WHERE ACCID =" & LACCID & " AND ITEMID =" & LItemID & " AND (abs(FLATQTY)+ABS(SPREADQTY)  <> ABS(CLOSEQTY))  "
        mysql = mysql & " AND CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "'  AND CLOSEQTY > 0 "
        Set NewRec = Nothing
        Set NewRec = New ADODB.Recordset
        NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not NewRec.EOF Then
            Do While Not NewRec.EOF
                LSSaudaID = NewRec!SAUDAID
                mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "',0,0"
                Cnn.Execute mysql
                MSpreadQty = MSpreadQty + Abs(NewRec!CLOSEQTY)
                NewRec.MoveNext
            Loop
        End If
        If MSpreadQty = 0 Then
            mysql = " EXEC UPDATE_FLATQTYSELL " & LACCID & "," & LItemID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'"
            Cnn.Execute mysql
            'MYSQL = "UPDATE DMARGIN SET FLATQTY = ABS(CLOSEQTY)-ABS(SPREADQTY) WHERE SAUDAID =" & LSaudaID & " AND CONDATE ='" & Format(MCondate, "YYYY/MM/DD") & "'  " '
            'Cnn.Execute MYSQL
        Else
            mysql = "SELECT SAUDAID,CLOSEQTY FROM DMARGIN WHERE ACCID =" & LACCID & " AND ITEMID =" & LItemID & " "
            mysql = mysql & " AND ABS(FLATQTY) <> ABS(CLOSEQTY)  AND CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "'AND CLOSEQTY < 0   ORDER BY MATURITY"
            Set NewRec = Nothing
            Set NewRec = New ADODB.Recordset
            NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not NewRec.EOF Then
                Do While Not NewRec.EOF
                    LSSaudaID = NewRec!SAUDAID
                    If MSpreadQty > Abs(NewRec!CLOSEQTY) Then
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "',0," & Abs(NewRec!CLOSEQTY) & ""
                        Cnn.Execute mysql
                        MSpreadQty = MSpreadQty - Abs(NewRec!CLOSEQTY)
                    ElseIf MSpreadQty = 0 Then
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) & ", 0 "
                        Cnn.Execute mysql
                        MSpreadQty = 0
                    ElseIf MSpreadQty <> NewRec!CLOSEQTY Then
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) - MSpreadQty & ", " & MSpreadQty & " "
                        Cnn.Execute mysql
                        MSpreadQty = 0
                    End If
                    NewRec.MoveNext
                Loop
            End If
            Set NewRec = Nothing
        End If
    End If
    TRec.MoveNext
Loop
        
End Sub
Public Sub Update_MCX_Spread(ByVal LMSParties As String, ByVal LMSItems As String, ByVal LMSExIDs, ByVal LMSFromDate As Date)
Dim TRec As ADODB.Recordset
Dim mparty As String:       Dim MItemCode  As String:   Dim MCondate As Date:
Dim MCloseQty As Double:    Dim MSpreadQty As Double:   Dim MBalQty As Double
Dim LItemID  As Integer:    Dim LExID As Integer:       Dim Lmaturity As Date
Dim LSaudaID As Long:       Dim NewRec As ADODB.Recordset: Dim MSauda As String
Dim LSSaudaID As Long:      Dim LExCode As String
Dim LACCID As Long
Dim DSaudaid As Long

        ' FOR ONLY MCX CONTRACTS
    
    mysql = "SELECT ACCID,PARTY,ITEMCODE,ITEMID,EXID,CONDATE,SAUDA,SAUDAID,MATURITY,CLOSEQTY,EXCODE FROM DMARGIN WHERE COMPCODE =" & GCompCode & " "
    If Len(LMSItems) > 0 Then mysql = mysql & " AND ITEMID IN (" & LMSItems & ")"
    If Len(LMSExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LMSExIDs & ")"
    If Len(LMSParties) > 0 Then mysql = mysql & " AND PARTY IN (" & LMSParties & ")"
    mysql = mysql & " AND CONDATE>='" & Format(CDate(LMSFromDate), "YYYY/MM/DD") & "'"
    mysql = mysql & " AND EXCODE='MCX' AND FLATQTY <>CLOSEQTY "
    mysql = mysql & " AND ACCID  IN (SELECT DISTINCT ACCID FROM PEXBROK WHERE COMPCODE =" & GCompCode & " AND INSTTYPE='FUT' AND MARTYPE ='I' AND EXCODE='MCX' AND UPTOSTDT >='" & Format(LMSFromDate, "YYYY/MM/DD") & "')"
    mysql = mysql & " ORDER BY PARTY,CONDATE,ITEMCODE,MATURITY,SAUDA"
    Set TRec = Nothing: Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        mparty = TRec!PARTY:            MItemCode = TRec!ITEMCODE:
        MSauda = TRec!Sauda:            Lmaturity = TRec!MATURITY:
        MCondate = TRec!Condate:        MCloseQty = TRec!CLOSEQTY
        MSpreadQty = 0:                 MBalQty = Abs(MCloseQty)
        DSaudaid = TRec!SAUDAID:        LExCode = TRec!excode
        LExID = TRec!EXID
        LACCID = TRec!ACCID
        LItemID = TRec!itemid
        GETMAIN.Label1.Caption = "Updateing Spread Qty for " & mparty & " " & MSauda & " " & MCondate
        DoEvents
        If MCloseQty > 0 Then
            mysql = "SELECT SAUDAID,CLOSEQTY FROM DMARGIN WHERE ACCID   =" & LACCID & " AND ITEMID =" & LItemID & " AND Maturity >'" & Format(Lmaturity, "YYYY/MM/DD") & "'"
            mysql = mysql & " AND CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "' ORDER BY MATURITY "
            Set NewRec = Nothing
            Set NewRec = New ADODB.Recordset
            NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not NewRec.EOF Then
                Do While Not NewRec.EOF
                    LSaudaID = NewRec!SAUDAID
                    If NewRec!CLOSEQTY < 0 Then
                        If MBalQty = 0 Then
                            mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) & ",0 "
                            Cnn.Execute mysql
                        ElseIf Abs(MBalQty) >= Abs(NewRec!CLOSEQTY) Then
                            MSpreadQty = MSpreadQty + Abs(NewRec!CLOSEQTY)
                            MBalQty = Abs(MBalQty) - Abs(NewRec!CLOSEQTY)
                            mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "',0," & Abs(NewRec!CLOSEQTY) & ""
                            Cnn.Execute mysql
                        ElseIf Abs(MCloseQty) < Abs(NewRec!CLOSEQTY) Then
                            MSpreadQty = MSpreadQty + Abs(MBalQty)
                            mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) - Abs(MBalQty) & "," & Abs(MBalQty) & ""
                            Cnn.Execute mysql
                            MBalQty = 0
                        End If
                    Else
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "', " & Abs(NewRec!CLOSEQTY) & ", 0 "
                        Cnn.Execute mysql
                    End If
                    NewRec.MoveNext
                Loop
            End If
            Set NewRec = Nothing
        Else
            mysql = "SELECT SAUDAID,CLOSEQTY FROM DMARGIN WHERE ACCID =" & LACCID & " AND ITEMID =" & LItemID & " AND MATURITY>'" & Format(Lmaturity, "YYYY/MM/DD") & "' AND CONDATE='" & Format(MCondate, "YYYY/MM/DD") & "'"
            Set NewRec = Nothing
            Set NewRec = New ADODB.Recordset
            NewRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            '2420258
            If Not NewRec.EOF Then
                Do While Not NewRec.EOF
                    LSaudaID = NewRec!SAUDAID
                    If NewRec!CLOSEQTY > 0 Then
                        If MBalQty = 0 Then
                            mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) & ",0"
                            Cnn.Execute mysql
                        ElseIf Abs(MBalQty) >= Abs(NewRec!CLOSEQTY) Then
                            MSpreadQty = MSpreadQty + Abs(NewRec!CLOSEQTY)
                            mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "',0," & Abs(NewRec!CLOSEQTY) & ""
                            Cnn.Execute mysql
                            MBalQty = Abs(MBalQty) - Abs(NewRec!CLOSEQTY)
                        ElseIf Abs(MBalQty) < Abs(NewRec!CLOSEQTY) Then
                            MSpreadQty = MSpreadQty + Abs(MBalQty)
                            mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) - Abs(MBalQty) & "," & Abs(MBalQty) & ""
                            Cnn.Execute mysql
                            MBalQty = 0
                        End If
                    Else
                        mysql = "EXEC UPDQTY " & LACCID & "," & LSaudaID & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(NewRec!CLOSEQTY) & ",0"
                        Cnn.Execute mysql
                    End If
                    NewRec.MoveNext
                Loop
            End If
            Set NewRec = Nothing
        End If
        mysql = "EXEC UPDQTY " & LACCID & "," & DSaudaid & ",'" & Format(MCondate, "YYYY/MM/DD") & "'," & Abs(MCloseQty) - Abs(MSpreadQty) & "," & MSpreadQty & ""
        Cnn.Execute mysql
        Do While MItemCode = TRec!ITEMCODE And mparty = TRec!PARTY And MCondate = TRec!Condate
            TRec.MoveNext
            If TRec.EOF Then Exit Do
        Loop
    Loop
    Set TRec = Nothing

End Sub


Public Sub Post_Inv_d2(ByVal LVParties As String, ByVal LVSaudas As String, ByVal LVExIDs As String, ByVal LVFromDate As Date)
On Error GoTo err1
Dim LInvdRec As ADODB.Recordset:    Dim LParty As String:       Dim LExCode As String:      Dim LExID As Integer:       Dim LBIllAmt As Double
Dim LIVouNo As String:              Dim LBrokAmt  As Double:    Dim LDiffAmt As Double:     Dim LMVNo As Long:          Dim LPartyType  As String
Dim LPartyDrCr As String:           Dim LContraDrCr As String:  Dim LBillDate As Date:      Dim LDiffDrCr As String:    Dim LBrokDrCr As String
Dim LNarration As String:           Dim LPartyName As String:   Dim LTradingAcc As String:  Dim LBrokAcc As String:     Dim LCGSTAcc As String:
Dim LFmlyCode As String:            Dim LContraAc As String:    Dim LBBrokAmt As Double:    Dim LShareAmt As Double:    Dim LShNarration As String
Dim LShVouNo As String:             Dim MDR As String:          Dim MCR As String:          Dim BVNO As Long:           Dim SVNO As Long
Dim GMaxBVouNo As Long:             Dim GMaxHVouNo As Long:     Dim LCHK  As ADODB.Recordset:                           Dim LExRec As ADODB.Recordset
Dim LBillParties As String:         Dim LCurrency  As String:   Dim LCurrRate  As Double:   Dim LCurrRec As ADODB.Recordset
Dim LCurrType As String:            Dim LUSDINRID As Long:      Dim LShreeAcc As String:    Dim LShreeAmt  As Double
Dim GMaxOVouNo As Long:             Dim LTotDiffAmt  As Double: Dim LTotBrokAmt  As Double: Dim LTotBillamt As Double
Dim LCurrentRate As Double:         Dim LHeadAc As String:      Dim LFmlyID As Long
Dim LHighRate  As Double:           Dim LLowRate As Double:     Dim LCloseRate As Double:   Dim LOVouNo  As String
Dim LACCID As Long:                 Dim LTradingAccID As Long:  Dim LBrokAccID As Long:     Dim LShreeAccID As Long
Dim LHeadID As Long:                Dim LContraID As Long

mysql = "SELECT * FROM EXMAST WHERE COMPCODE =" & GCompCode & "  "
If LenB(LVExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LVExIDs & ") "
Set LExRec = Nothing
Set LExRec = New ADODB.Recordset
LExRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If LExRec.EOF Then Exit Sub
    
GMaxVouNo = Val(Right$(Get_VouNo("SETL", GFinYear), 7))
GMaxBVouNo = Val(Right$(Get_VouNo("BROK", GFinYear), 7))
GMaxHVouNo = Val(Right$(Get_VouNo("SHAR", GFinYear), 7))
GMaxOVouNo = Val(Right$(Get_VouNo("CONT", GFinYear), 7))
    
Dim TRec As ADODB.Recordset
Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = " SELECT SAUDAID FROM SAUDAMAST WHERE SAUDACODE ='USDINR' AND MATURITY ='" & Format(GFinEnd, "YYYY/MM/DD") & "'"
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    LUSDINRID = TRec!SAUDAID
Else
'    MsgBox " PLEASE CREATE USDINR CONTRACT WITH YEAR END MATURITY"
 '   Exit Sub
End If
Dim LCondate  As Date
    mysql = "SELECT CONDATE,SAUDAID,CLOSERATE,HGRATE,LOWRATE FROM CTR_R WHERE SAUDAID  =" & LUSDINRID & ""
    mysql = mysql & " AND CONDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
    
    Set LCurrRec = Nothing
    Set LCurrRec = New ADODB.Recordset
    LCurrRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If LCurrRec.EOF Then Exit Sub
    Do While Not LCurrRec.EOF
        LCondate = LCurrRec!Condate
        LHighRate = LCurrRec!HGRATE
        LLowRate = LCurrRec!LOWRATE
        LCloseRate = LCurrRec!CLOSERATE
        LBillDate = LCondate
        Set LInvdRec = Nothing
        Set LInvdRec = New ADODB.Recordset
        mysql = "SELECT A.CURRRATE,A.CURRTYPE,A.NAME, I.EXCODE,I.EXID,A.ACCID,A.AC_CODE,SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT FROM INV_D AS I, ACCOUNTD AS A "
        mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & " AND A.ACCID =I.ACCID  AND I.POST  =0 "
        mysql = mysql & " AND  STDATE >'" & Format(GSysLockDt) & "'"
        mysql = mysql & " AND EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
        mysql = mysql & " AND STDATE  <='" & Format(LCondate, "yyyy/mm/dd") & "'"
        If LenB(LVParties) > 0 Then mysql = mysql & " AND A.AC_CODE IN (" & LVParties & ") "
        If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
        mysql = mysql & " GROUP BY A.CURRRATE,A.CURRTYPE,A.NAME,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE "
        mysql = mysql & " HAVING (ABS(SUM(I.DIFFAMT))+ABS(SUM(I.BROKAMT))) <> 0 "
        mysql = mysql & " ORDER BY I.EXCODE,A.AC_CODE  "
        LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not LInvdRec.EOF
            LExCode = LInvdRec!excode
            LExID = LInvdRec!EXID
            LExRec.MoveFirst
            LExRec.Find "EXID=" & LExID & ""
            
            If Not LExRec.EOF Then
                LTradingAcc = LExRec!TRADINGACC & vbNullString:    LBrokAcc = LExRec!BROKAC & vbNullString:
                LShreeAcc = LExRec!shreeac
                
                LTradingAccID = Get_AccID(LTradingAcc)
                LShreeAccID = Get_AccID(LShreeAcc)
                LBrokAccID = Get_AccID(LBrokAcc)
                
            End If
            Do While LExID = LInvdRec!EXID
                LDiffDrCr = "C":    LBrokDrCr = "C":    LPartyDrCr = "C"::
                LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
                LTotDiffAmt = 0:    LTotBrokAmt = 0:    LTotBillamt = 0:
                LParty = LInvdRec!AC_CODE:
                LACCID = LInvdRec!ACCID
                LCurrType = LInvdRec!CURRTYPE
                LCurrRate = LInvdRec!CURRRATE
                LPartyName = LInvdRec!NAME:
                GETMAIN.Label1.Caption = LExCode & " Posting Bill Voucher " & LCondate & LPartyName & ""
                DoEvents
        
                'LPartyType = LInvdRec!PARTYTYPE
                LDiffAmt = Round(LInvdRec!dAMT, 2)
                LBrokAmt = Round(LInvdRec!BrAMT, 2)
                LBIllAmt = Round(LInvdRec!BAMT, 2)
                
                LTotDiffAmt = LTotDiffAmt + LDiffAmt:
                LTotBrokAmt = LTotBrokAmt + LBrokAmt
                LTotBillamt = LTotBillamt + LBIllAmt
                If LCurrType = "S" Then
                    LTotBillamt = LTotBillamt * LCloseRate
                    LTotDiffAmt = LTotDiffAmt * LCloseRate
                    LTotBrokAmt = LTotBrokAmt * LCloseRate
                    LCurrentRate = LCloseRate
                    LShreeAmt = 0
                ElseIf LCurrType = "H" Then
                    If LTotBillamt > 0 Then
                        LShreeAmt = Round(LTotDiffAmt * (LCloseRate - LLowRate), 2)
                        LTotBillamt = LTotBillamt * LLowRate
                        LTotDiffAmt = LTotDiffAmt * LLowRate
                        LTotBrokAmt = LTotBrokAmt * LLowRate
                        
                        LCurrentRate = LLowRate
                    Else
                        LShreeAmt = Round(LTotDiffAmt * (LHighRate - LCloseRate), 2)
                        LTotBillamt = LTotBillamt * LHighRate
                        LTotDiffAmt = LTotDiffAmt * LHighRate
                        LTotBrokAmt = LTotBrokAmt * LHighRate
                        
                        LCurrentRate = LHighRate
                    End If
                End If
                If Val(LTotBillamt) < 0 Then LPartyDrCr = "D"
                If Val(LTotDiffAmt) > 0 Then LDiffDrCr = "D"
                If Val(LTotBrokAmt) > 0 Then LBrokDrCr = "D"
                
                
                If gcurrtype = 1 And LExCode = "CMX" Then
                    'Dim LLowRate As Double
                    Dim LHGRate As Double
                    Dim RateRec As ADODB.Recordset
            
                    mysql = "SELECT HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LBillDate, "yyyy/mm/dd") & "' "
                    Set RateRec = Nothing
                    Set RateRec = New ADODB.Recordset
                    RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not RateRec.EOF Then
                        LLowRate = RateRec!LOWRATE
                        LHGRate = RateRec!HGRATE
                    Else
                        LLowRate = 1
                        LHGRate = 1
                    End If
                    Set RateRec = Nothing
                    If LTotBillamt > 0 Then
                        LTotBillamt = LTotBillamt * LLowRate
                        LTotDiffAmt = LTotDiffAmt * LLowRate
                        LTotBrokAmt = LTotBrokAmt * LLowRate
                    Else
                        LTotBillamt = LTotBillamt * LHGRate
                        LTotDiffAmt = LTotDiffAmt * LHGRate
                        LTotBrokAmt = LTotBrokAmt * LHGRate
                    End If
                End If

                If Abs(LTotDiffAmt) + Abs(LTotBrokAmt) + Abs(LTotBillamt) <> 0 Then
                    LIVouNo = Get_Next_Vou_No(GMaxVouNo, "SETL", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                    GMaxVouNo = GMaxVouNo + 1
                    LMVNo = PInsert_Voucher(LIVouNo, LBillDate, "S", "P", 0, "ADD", LParty, 0, vbNullString, LExCode, "0", LExID, LACCID)
                    If LExCode <> "CMX" Then
                        LCurrentRate = 1
                    End If
                    mysql = "UPDATE INV_D SET POST = 1 ,CURR_RATE  =" & LCurrentRate & " , VOU_ID  =" & LMVNo & ", VCHNO  ='" & LIVouNo & "' WHERE PARTY ='" & LParty & "' And EXID = " & LExID & ""
                    mysql = mysql & " AND STDATE <='" & Format(LBillDate, "YYYY/MM/DD") & "' AND POST  = 0 " '
                    Cnn.Execute mysql
                    
                    LNarration = LExCode & " Settlemet @" & LCurrentRate & ""
                    ''PARTY AC POSTING
                    If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, LParty, Abs(Val(LTotBillamt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                    If LTotDiffAmt <> 0 Then
                        LNarration = "Settlemet " & LExCode & " " & LPartyName & " " & LParty
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LDiffDrCr, LTradingAcc, Abs(Val(LTotDiffAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LTradingAccID)
                    End If
                    If LTotBrokAmt <> 0 Then
                        LNarration = "Brok " & LExCode & " " & LPartyName & " " & LParty & " @ " & LCurrentRate & ""
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LBrokDrCr, LBrokAcc, Abs(Val(LTotBrokAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBrokAccID)
                    End If
                    If LShreeAmt <> 0 Then
                        LNarration = "Curr Rate Diff " & LExCode & " " & LPartyName & " " & LParty & " @ " & LCurrentRate & ""
                        If LShreeAmt > 0 Then
                            Call PInsert_Vchamt(LIVouNo, "S", LBillDate, "C", LShreeAcc, Abs(Val(LShreeAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LShreeAccID)
                            Call PInsert_Vchamt(LIVouNo, "S", LBillDate, "D", LTradingAcc, Abs(Val(LShreeAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LTradingAccID)
                        End If
                    End If
                End If
                LInvdRec.MoveNext
                If LInvdRec.EOF Then Exit Do
            Loop
            If LInvdRec.EOF Then Exit Do
        Loop
        LCurrRec.MoveNext
    Loop
    GETMAIN.ProgressBar1.Visible = False
    GETMAIN.PERLBL.Caption = vbNullString
    Dim LTotBBrokAmt As Double
    Dim LTotShareAmt As Double
    LCurrRec.MoveFirst
    Do While Not LCurrRec.EOF
        LCondate = LCurrRec!Condate
        LHighRate = LCurrRec!HGRATE
        LLowRate = LCurrRec!LOWRATE
        LCloseRate = LCurrRec!CLOSERATE
        GETMAIN.Label1.Caption = LExCode & " Posting Bill Voucher " & LCondate
        DoEvents
        LBillDate = LCondate
        Set LInvdRec = Nothing
        Set LInvdRec = New ADODB.Recordset
        mysql = "SELECT B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRAID,B.CONTRA_AC,C.NAME,C.ACCID,C.AC_CODE,C.CURRRATE,C.CURRTYPE,A.STDATE,A.EXCODE,A.EXID,"
        mysql = mysql & " SUM(A.AMOUNT) AS BROKAMT ,SUM(A.SAMOUNT) AS SHAREAMT "
        mysql = mysql & " FROM INV_D1 AS A,ACCFMLY AS B, ACCOUNTD AS C"
        mysql = mysql & " Where C.COMPCODE =" & GCompCode & " And A.FMLYID = B.FMLYID AND A.ACCID = C.ACCID "
        mysql = mysql & " AND A.POST =0 "
        mysql = mysql & " AND  A.STDATE >'" & Format(GSysLockDt) & "'"
        mysql = mysql & " AND A.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
        mysql = mysql & " AND A.STDATE  <='" & Format(LCondate, "yyyy/mm/dd") & "'"
        If LenB(LVParties) > 0 Then mysql = mysql & " AND C.AC_CODE  IN (" & LVParties & ") "
        If LenB(LVExIDs) > 0 Then mysql = mysql & " AND A.EXID  IN (" & LVExIDs & ") "
        mysql = mysql & " GROUP BY B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRAID,B.CONTRA_AC,C.NAME,C.ACCID,C.AC_CODE,C.CURRRATE,C.CURRTYPE,A.STDATE,A.EXCODE,A.EXID "
        mysql = mysql & " ORDER BY C.AC_CODE,B.FMLYCODE,A.EXCODE,A.STDATE "
        LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not LInvdRec.EOF
            GETMAIN.Label1.Caption = "Posting Share Voucher " & LFmlyCode & " " & LPartyName
            DoEvents
            LIVouNo = vbNullString:                  LShVouNo = vbNullString
            BVNO = 0:                                SVNO = 0
            LTotBBrokAmt = 0:                        LTotShareAmt = 0
            LFmlyCode = LInvdRec!FMLYCODE:           LHeadAc = LInvdRec!FMLYHEAD
            LContraAc = LInvdRec!Contra_Ac:          LParty = LInvdRec!AC_CODE
            LPartyName = LInvdRec!NAME:              LExCode = LInvdRec!excode:
            LExID = LInvdRec!EXID:                   LFmlyID = LInvdRec!FMLYID
            LACCID = LInvdRec!ACCID:                 LHeadID = LInvdRec!HEADID
            LContraID = LInvdRec!CONTRAID
            
            LCurrType = LInvdRec!CURRTYPE
            LCurrRate = LInvdRec!CURRRATE
            Do While LFmlyCode = LInvdRec!FMLYCODE And LParty = LInvdRec!AC_CODE And LExID = LInvdRec!EXID
                LBBrokAmt = LInvdRec!BROKAMT:            LShareAmt = LInvdRec!SHAREAMT
                LTotBBrokAmt = LTotBBrokAmt + LBBrokAmt
                LTotShareAmt = LTotShareAmt + LShareAmt
                LInvdRec.MoveNext
                If LInvdRec.EOF Then Exit Do
            Loop
            If LCurrType = "S" Then
                LTotBBrokAmt = Round(LTotBBrokAmt * LCloseRate, 2)
                LTotShareAmt = Round(LTotShareAmt * LCloseRate, 2)
                LShreeAmt = 0
                LCurrentRate = LCloseRate
            ElseIf LCurrType = "H" Then
                If LTotShareAmt > 0 Then
                    LTotShareAmt = Round(LTotShareAmt * LLowRate, 2)
                    LTotBBrokAmt = Round(LTotBBrokAmt * LLowRate, 2)
                    LCurrentRate = LLowRate
                Else
                    LTotShareAmt = Round(LTotShareAmt * LHighRate, 2)
                    LTotBBrokAmt = Round(LTotBBrokAmt * LHighRate, 2)
                    LCurrentRate = LHighRate
                End If
            End If
            If LBBrokAmt <> 0 Then
                If LBBrokAmt > 0 Then
                    MDR = "C": MCR = "D"
                Else
                    MDR = "D": MCR = "C"
                End If
                LIVouNo = Get_Next_Vou_No(GMaxBVouNo, "BROK", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxBVouNo = GMaxBVouNo + 1
                LShNarration = LExCode & " Sub Brok For Client " & LPartyName & ""
                BVNO = PInsert_Voucher(LIVouNo, LBillDate, "B", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MDR, LHeadAc, Abs(LTotBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LHeadID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MCR, LBrokAcc, Abs(LTotBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LBrokAccID)
            End If
            If LTotShareAmt <> 0 Then
                If LTotShareAmt < 0 Then
                    MCR = "D": MDR = "C"
                Else
                    MCR = "C": MDR = "D"
                End If
                LShVouNo = Get_Next_Vou_No(GMaxHVouNo, "SHAR", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxHVouNo = GMaxHVouNo + 1
                LShNarration = LExCode & " Share Amt For Client " & LPartyName & " "
                SVNO = PInsert_Voucher(LShVouNo, LBillDate, "H", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                'PARTY AC POSTING
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MCR, LContraAc, Abs(Val(LTotShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LContraID)
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MDR, LHeadAc, Abs(Val(LTotShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LHeadID)
            End If
            If LExCode <> "CMX" Then
                LCurrentRate = 1
            End If

            mysql = "UPDATE INV_D1 SET POST=1,CURR_RATE =" & LCurrentRate & ", SVOU_ID  =" & SVNO & ",BVOU_ID =" & BVNO & ",VOU_NO='" & LIVouNo & "',SVOU_NO='" & LShVouNo & "' WHERE "
            mysql = mysql & " ACCID  =" & LACCID & " And EXID = " & LExID & "  AND FMLYID =" & LFmlyID & ""  '
            mysql = mysql & " AND STDATE <='" & Format(LBillDate, "YYYY/MM/DD") & "' AND POST=0 " '
            Cnn.Execute mysql
            If LInvdRec.EOF Then Exit Do
        Loop
        LCurrRec.MoveNext
    Loop
    Exit Sub
GETMAIN.ProgressBar1.Visible = False
err1:
MsgBox (err.Description)

End Sub



Public Sub Post_Inv_d3(ByVal LVParties As String, ByVal LVSaudas As String, ByVal LVExIDs As String, ByVal LVFromDate As Date)
On Error GoTo err1
Dim LInvdRec As ADODB.Recordset:    Dim LParty As String:       Dim LExCode As String:      Dim LExID As Integer:       Dim LBIllAmt As Double
Dim LIVouNo As String:              Dim LBrokAmt  As Double:    Dim LDiffAmt As Double:     Dim LMVNo As Long:          Dim LPartyType  As String
Dim LPartyDrCr As String:           Dim LContraDrCr As String:  Dim LBillDate As Date:      Dim LDiffDrCr As String:    Dim LBrokDrCr As String
Dim LNarration As String:           Dim LPartyName As String:   Dim LTradingAcc As String:  Dim LBrokAcc As String:     Dim LHeadAc As String
Dim LFmlyCode As String:            Dim LContraAc As String:    Dim LBBrokAmt As Double:    Dim LShareAmt As Double:    Dim LShNarration As String
Dim LShVouNo As String:             Dim MDR As String:          Dim MCR As String:          Dim BVNO As Long:           Dim SVNO As Long
Dim GMaxBVouNo As Long:             Dim GMaxHVouNo As Long:     Dim LCHK  As ADODB.Recordset:                           Dim LExRec As ADODB.Recordset
Dim LBillParties As String:         Dim LSetRec As ADODB.Recordset
Dim GMaxOVouNo As Long:             Dim LTotDiffAmt  As Double: Dim LTotBrokAmt  As Double: Dim LTotBillamt As Double
Dim LACCID As Long:                 Dim LTradingAccID As Long:  Dim LBrokAccID As Long:     Dim LShreeAccID As Long
Dim LHeadID As Long:                Dim LContraID As Long:      Dim LFmlyID As Long
Dim TRec As ADODB.Recordset

Dim LMaxDate  As Date
Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = "SELECT MAX(CONDATE) AS MDATE FROM CTR_M WHERE COMPCODE =" & GCompCode & ""
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    If Not IsNull(TRec!MDate) Then
        LMaxDate = TRec!MDate
    End If
End If
                        
GMaxVouNo = Val(Right$(Get_VouNo("SETL", GFinYear), 7))
GMaxBVouNo = Val(Right$(Get_VouNo("BROK", GFinYear), 7))
GMaxHVouNo = Val(Right$(Get_VouNo("SHAR", GFinYear), 7))

mysql = "SELECT EXID,EXCODE,TRADINGACC,BROKAC FROM EXMAST WHERE COMPCODE =" & GCompCode & " "
If LenB(LVExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LVExIDs & ") "
Set LExRec = Nothing
Set LExRec = New ADODB.Recordset
LExRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
   

    Dim LCondate  As Date
    mysql = "SELECT SETDATE FROM SETTLE  WHERE COMPCODE =" & GCompCode & ""
    mysql = mysql & " AND SETDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
    mysql = mysql & " AND SETDATE  <='" & Format(LMaxDate, "yyyy/mm/dd") & "'"
    Set LSetRec = Nothing
    Set LSetRec = New ADODB.Recordset
    LSetRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If LSetRec.EOF Then Exit Sub
    Do While Not LSetRec.EOF
        LCondate = LSetRec!SETDATE
        LBillDate = LCondate
        Set LInvdRec = Nothing
        Set LInvdRec = New ADODB.Recordset
        mysql = "SELECT A.ACCID,A.AC_CODE,A.NAME,I.EXCODE,I.EXID, SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT FROM INV_D AS I, ACCOUNTD AS A "
        mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & " AND  A.ACCID =I.ACCID  AND I.POST = 0 "
        mysql = mysql & " AND EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR<>'Y') "
        mysql = mysql & " AND STDATE  <='" & Format(LBillDate, "yyyy/mm/dd") & "'"
        If LenB(LVParties) > 0 Then mysql = mysql & " AND A.AC_CODE IN (" & LVParties & ") "
        If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
        mysql = mysql & " GROUP BY  A.ACCID,A.AC_CODE,A.NAME,I.EXCODE,I.EXID "
        mysql = mysql & " HAVING (ABS(SUM(I.DIFFAMT))+ABS(SUM(I.BROKAMT))) <> 0 "
        mysql = mysql & " ORDER BY I.EXCODE,A.AC_CODE  "
        LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not LInvdRec.EOF
            LExCode = LInvdRec!excode
            GETMAIN.Label1.Caption = LExCode & " Posting Bill Voucher " & LBillDate
            DoEvents
        
            LExID = LInvdRec!EXID
            LExRec.MoveFirst
            LExRec.Find "EXID=" & LExID & ""
            If Not LExRec.EOF Then
                LTradingAcc = LExRec!TRADINGACC & vbNullString:    LBrokAcc = LExRec!BROKAC & vbNullString:
                LTradingAccID = Get_AccID(LTradingAcc)
                LBrokAccID = Get_AccID(LBrokAcc)
                
                
            End If
            Do While LExID = LInvdRec!EXID
                LDiffDrCr = "C":    LBrokDrCr = "C":    LPartyDrCr = "C"::
                LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
                LTotDiffAmt = 0:    LTotBrokAmt = 0:    LTotBillamt = 0:
                LParty = LInvdRec!AC_CODE:
                LACCID = LInvdRec!ACCID
                LPartyName = LInvdRec!NAME:
                LDiffAmt = LInvdRec!dAMT:   LBrokAmt = LInvdRec!BrAMT:     LBIllAmt = LInvdRec!BAMT
                LTotDiffAmt = LTotDiffAmt + LDiffAmt:                      LTotBrokAmt = LTotBrokAmt + LBrokAmt
                LTotBillamt = LTotBillamt + LBIllAmt
                If Val(LTotBillamt) < 0 Then LPartyDrCr = "D"
                If Val(LTotDiffAmt) > 0 Then LDiffDrCr = "D"
                If Val(LTotBrokAmt) > 0 Then LBrokDrCr = "D"
                If Abs(LTotDiffAmt) + Abs(LTotBrokAmt) + Abs(LTotBillamt) <> 0 Then
                    LIVouNo = Get_Next_Vou_No(GMaxVouNo, "SETL", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                    GMaxVouNo = GMaxVouNo + 1
                    LMVNo = PInsert_Voucher(LIVouNo, LBillDate, "S", "P", 0, "ADD", LParty, 0, vbNullString, LExCode, "0", LExID, LACCID)
                    mysql = "UPDATE INV_D SET POST = 1 ,VOU_ID  =" & LMVNo & ", VCHNO  ='" & LIVouNo & "' WHERE ACCID  =" & LACCID & " And EXID = " & LExID & ""
                    mysql = mysql & " AND STDATE <='" & Format(LBillDate, "YYYY/MM/DD") & "' AND POST =0 " '
                    Cnn.Execute mysql

                    LNarration = LExCode & " Settlemet "
                    ''PARTY AC POSTING
                    If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, LParty, Abs(Val(LTotBillamt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                    If LTotDiffAmt <> 0 Then
                        LNarration = "Settlemet " & LExCode & " " & LPartyName & " " & LParty
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LDiffDrCr, LTradingAcc, Abs(Val(LTotDiffAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LTradingAccID)
                    End If
                    If LTotBrokAmt <> 0 Then
                        LNarration = "Brok " & LExCode & " " & LPartyName & " " & LParty & " "
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LBrokDrCr, LBrokAcc, Abs(Val(LTotBrokAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBrokAccID)
                    End If
                    LInvdRec.MoveNext
                    If LInvdRec.EOF Then Exit Do
                End If
                Loop
            If LInvdRec.EOF Then Exit Do
        Loop
        LSetRec.MoveNext
    Loop
    GETMAIN.ProgressBar1.Visible = False
    GETMAIN.PERLBL.Caption = vbNullString
    Dim LTotBBrokAmt As Double
    Dim LTotShareAmt As Double
    LSetRec.MoveFirst
    Do While Not LSetRec.EOF
        LCondate = LSetRec!SETDATE
        
        GETMAIN.Label1.Caption = " Posting Share Voucher " & LCondate
        DoEvents
            
        LBillDate = LCondate
        Set LInvdRec = Nothing
        Set LInvdRec = New ADODB.Recordset
        mysql = "SELECT B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRAID,B.CONTRA_AC,C.ACCID,C.AC_CODE,C.NAME,A.EXCODE,A.EXID,"
        mysql = mysql & " SUM(A.AMOUNT) AS BROKAMT ,SUM(A.SAMOUNT) AS SHAREAMT FROM INV_D1 AS A,ACCFMLY AS B, ACCOUNTD AS C"
        mysql = mysql & " Where C.COMPCODE =" & GCompCode & " And A.FMLYID = B.FMLYID AND A.ACCID = C.ACCID "
        mysql = mysql & " AND A.POST = 0 "
        mysql = mysql & " AND A.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR<>'Y') "
        mysql = mysql & " AND A.STDATE  <='" & Format(LCondate, "yyyy/mm/dd") & "'"
        If LenB(LVParties) > 0 Then mysql = mysql & " AND C.AC_CODE  IN (" & LVParties & ") "
        If LenB(LVExIDs) > 0 Then mysql = mysql & " AND A.EXID  IN (" & LVExIDs & ") "
        mysql = mysql & " GROUP BY B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRAID,B.CONTRA_AC,C.ACCID,C.AC_CODE,C.NAME,A.EXCODE,A.EXID"
        mysql = mysql & " ORDER BY C.AC_CODE ,B.FMLYCODE,A.EXCODE "
        LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not LInvdRec.EOF
            LIVouNo = vbNullString:                  LShVouNo = vbNullString
            BVNO = 0:                                SVNO = 0
            LTotBBrokAmt = 0:                        LTotShareAmt = 0
            LFmlyCode = LInvdRec!FMLYCODE:           LHeadAc = LInvdRec!FMLYHEAD
            LContraAc = LInvdRec!Contra_Ac:          LParty = LInvdRec!AC_CODE
            LPartyName = LInvdRec!NAME:              LExCode = LInvdRec!excode:
            LExID = LInvdRec!EXID:                   LHeadID = LInvdRec!HEADID
            LFmlyID = LInvdRec!FMLYID:               LACCID = LInvdRec!ACCID:
            LContraID = LInvdRec!CONTRAID
            
            Do While LFmlyCode = LInvdRec!FMLYCODE And LParty = LInvdRec!AC_CODE And LExID = LInvdRec!EXID
                LBBrokAmt = LInvdRec!BROKAMT:            LShareAmt = LInvdRec!SHAREAMT
                LTotBBrokAmt = LTotBBrokAmt + LBBrokAmt
                LTotShareAmt = LTotShareAmt + LShareAmt
                LInvdRec.MoveNext
                If LInvdRec.EOF Then Exit Do
            Loop
            If LBBrokAmt <> 0 Then
                If LBBrokAmt > 0 Then
                    MDR = "C": MCR = "D"
                Else
                    MDR = "D": MCR = "C"
                End If
                LIVouNo = Get_Next_Vou_No(GMaxBVouNo, "BROK", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxBVouNo = GMaxBVouNo + 1
                LShNarration = LExCode & " Sub Brok For Client " & LPartyName & ""
                BVNO = PInsert_Voucher(LIVouNo, LBillDate, "B", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MDR, LHeadAc, Abs(LTotBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LHeadID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MCR, LBrokAcc, Abs(LTotBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LBrokAccID)
            End If
            If LShareAmt <> 0 Then
                If LShareAmt < 0 Then
                    MCR = "D": MDR = "C"
                Else
                    MCR = "C": MDR = "D"
                End If
                LShVouNo = Get_Next_Vou_No(GMaxHVouNo, "SHAR", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxHVouNo = GMaxHVouNo + 1
                LShNarration = LExCode & " Share Amt For Client " & LPartyName & " "
                SVNO = PInsert_Voucher(LShVouNo, LBillDate, "H", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                'PARTY AC POSTING
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MCR, LContraAc, Abs(Val(LTotShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LContraID)
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MDR, LHeadAc, Abs(Val(LTotShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LHeadID)
            End If

            mysql = "UPDATE INV_D1 SET POST  =1 ,SVOU_ID  =" & SVNO & ",BVOU_ID =" & BVNO & ",VOU_NO='" & LIVouNo & "',SVOU_NO='" & LShVouNo & "' WHERE "
            mysql = mysql & " ACCID  =" & LACCID & "  And EXID = " & LExID & "  AND FMLYID =" & LFmlyID & ""   '
            mysql = mysql & " AND STDATE <='" & Format(LBillDate, "YYYY/MM/DD") & "' AND POST  =0 " '
            Cnn.Execute mysql
            If LInvdRec.EOF Then Exit Do
        Loop
        LSetRec.MoveNext
    Loop
    'If GCurr = "Y" Then
        Call Post_Inv_d2(LVParties, LVSaudas, LVExIDs, LVFromDate)
    'End If
    Exit Sub
GETMAIN.ProgressBar1.Visible = False
err1:
MsgBox (err.Description)
'If CNNERR = True Then
    'Cnn.RollbackTrans'
'End If

End Sub


Public Sub Updt_EXBrokQty_Opening(lbparty As String, LBEXCODE As String, LBItemCode As String, LBSauda As String, LBFromDate As Date, LPBrok As String)
Dim AccRec As ADODB.Recordset: Dim TrdRec As ADODB.Recordset
Dim mparty  As String:        Dim MSauda As String
Dim MBQty As Double:          Dim msqty As Double:      Dim MBalQty As Double
Dim MTBQty  As Double:        Dim MTSQty As Double:     Dim MBrokQty As Double:   Dim MDt As Date
Dim LSaudaID As Long
Dim LOpenQty As Double
Dim LACCID As Long
mysql = "UPDATE CTR_D SET BROKQTY =0, UPDBQTY =0 WHERE COMPCODE =" & GCompCode & ""
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID IN (" & LBEXCODE & ")"
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN (" & LBItemCode & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
mysql = mysql & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' "
mysql = mysql & " AND BrokType ='" & LPBrok & "'"
Cnn.Execute mysql
On Error GoTo ERR6
mysql = "SELECT DISTINCT ACCID,PARTY ,SAUDA,SAUDAID FROM CTR_D WHERE COMPCODE  = " & GCompCode & " "
If LenB(lbparty) <> 0 Then mysql = mysql & " AND PARTY IN  (" & lbparty & ") "
If LenB(LBEXCODE) <> 0 Then mysql = mysql & "AND EXID IN (" & LBEXCODE & ")"
If LenB(LBItemCode) <> 0 Then mysql = mysql & " AND ITEMID IN (" & LBItemCode & ") "
If LenB(LBSauda) <> 0 Then mysql = mysql & " AND SAUDAID IN  (" & LBSauda & ")  "
mysql = mysql & " AND CONDATE >='" & Format(LBFromDate, "YYYY/MM/DD") & "' "
mysql = mysql & " AND BrokType ='" & LPBrok & "' ORDER BY PARTY"
Set AccRec = Nothing: Set AccRec = New ADODB.Recordset
AccRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not AccRec.EOF Then
    Do While Not AccRec.EOF
        DoEvents
        mparty = AccRec!PARTY
        LACCID = AccRec!ACCID
        MSauda = AccRec!Sauda
        LSaudaID = AccRec!SAUDAID
        DoEvents
        GETMAIN.Label1.Caption = "Updating Opening Qty for " & mparty & " for " & MSauda & " "
        mysql = " SELECT CONDATE,ROWNO,CONTYPE,QTY,PATTAN FROM CTR_D WHERE PARTY  = '" & AccRec!PARTY & "'"
        mysql = mysql & " AND SAUDAID =" & LSaudaID & " AND UPDBQTY =0 AND CONDATE  >= '" & Format(LBFromDate, "yyyy/MM/dd") & "'"
        mysql = mysql & " AND BROKTYPE='" & LPBrok & "' AND INVNO = 0 "
        mysql = mysql & " ORDER BY CONDATE,CONTYPE"
        Set TrdRec = Nothing: Set TrdRec = New ADODB.Recordset:
        TrdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        MBalQty = 0: MTBQty = 0: MTSQty = 0: MBQty = 0: msqty = 0
        Do While Not TrdRec.EOF
            MBQty = 0: msqty = 0
            MDt = TrdRec!Condate
            LOpenQty = Get_CloseQty(LACCID, LSaudaID, MDt - 1)
            MBalQty = LOpenQty
            Do While MDt = TrdRec!Condate
                MBrokQty = 0
                If MBalQty = 0 Then
                    MBrokQty = TrdRec!QTY
                ElseIf MBalQty > 0 And TrdRec!CONTYPE = "B" Then
                    MBrokQty = TrdRec!QTY
                ElseIf MBalQty < 0 And TrdRec!CONTYPE = "S" Then
                    MBrokQty = TrdRec!QTY
                ElseIf MBalQty > 0 And TrdRec!CONTYPE = "S" And Abs(MBalQty) <= TrdRec!QTY Then
                    MBrokQty = TrdRec!QTY - Abs(MBalQty)
                ElseIf MBalQty < 0 And TrdRec!CONTYPE = "B" And Abs(MBalQty) <= TrdRec!QTY Then
                    MBrokQty = TrdRec!QTY - Abs(MBalQty)
                End If
                If TrdRec!CONTYPE = "B" Then
                    MBalQty = MBalQty + TrdRec!QTY
                Else
                    MBalQty = MBalQty + (TrdRec!QTY * -1)
                End If
                'If TrdRec!pattan = "O" Then
                 '   MBrokQty = 0
                'End If
                mysql = " EXEC UPD_BROKQTY " & GCompCode & "," & TrdRec!ROWNO & "," & MBrokQty & ""
                Cnn.Execute mysql
                TrdRec.MoveNext
                If TrdRec.EOF Then Exit Do
            Loop
            If TrdRec.EOF Then Exit Do
        Loop
        AccRec.MoveNext
    Loop
End If
Exit Sub
ERR6:
    If err.Number <> 0 Then
        MsgBox err.Description
        If CNNERR = True Then
            Cnn.RollbackTrans: CNNERR = False
        End If
    End If
End Sub


'Sub TelegramMessage_Send(ByRef strNumber As String, ByRef strMessage As String)
'  Dim CLIENT_ID As String, CLIENT_SECRET As String, API_URL As String
'  Dim strJson As Variant
'  Dim sHTML As String
'  Dim oHttp As Object
'
'  ''' TODO: Replace the following with your gateway instance ID, your Premium client ID and secret:
'  INSTANCE_ID = "1206555137:AAHezv9wY-E6TBuMviDlBczCIWPzL4ufrLo"
'  CLIENT_ID = "minkibot"
'  CLIENT_SECRET = "minkibatbot"
'  API_URL = "http://api.whatsmate.net/v1/telegram/single/message/" & INSTANCE_ID
'
'  strJson = "{""number"": """ & strNumber & """, ""message"": """ & strMessage & """}"
'
'  Set oHttp = CreateObject("Msxml2.XMLHTTP")
'  oHttp.Open "POST", API_URL, False
'  oHttp.setRequestHeader "Content-type", "application/json"
'  oHttp.setRequestHeader "X-WM-CLIENT-ID", CLIENT_ID
'  oHttp.setRequestHeader "X-WM-CLIENT-SECRET", CLIENT_SECRET
'  oHttp.Send strJson
'
'  sHTML = oHttp.ResponseText
'  MsgBox sHTML
'End Sub
Public Sub CL_01()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("1393171677"): CustId = "309GON":: LTDate = DateValue("28/02/2024"): LLDATE = DateValue("02/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 309)
    '2
    B = Encrypt("967269184"): CustId = "388JOD": LTDate = DateValue("31/01/2024"): LLDATE = DateValue("08/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 388)
    '3
    B = Encrypt("1064457486"): CustId = "534SAG": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 534)
    '4
    B = Encrypt("560423659"): CustId = "713NAS": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 713)
    '5
    B = Encrypt("105010196"): CustId = "1193BUL": LTDate = DateValue("31/12/2023"): LLDATE = DateValue("14/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1193)
    '6
    B = Encrypt("1869421237"): CustId = "1345NGP": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("06/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1345)
    '7
    B = Encrypt("366049699"): CustId = "1640MUM":: LTDate = DateValue("31/01/2021"): LLDATE = DateValue("11/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1640)
    '8
    B = Encrypt("1761307950"): CustId = "1646BHO":: LTDate = DateValue("15/02/2023"): LLDATE = DateValue("18/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1646)
    '9
    B = Encrypt("739889369"): CustId = "1647MUM": LTDate = DateValue("12/04/2022"): LLDATE = DateValue("22/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1647)
    '10
    B = Encrypt("795916721"): CustId = "1648IND": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("08/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1648)
    '11
    B = Encrypt("1682306298"): CustId = "1649HYD": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("22/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1649)
    '12
    B = Encrypt("1505119226"): CustId = "1668AMB": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("07/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1668)
    '13
    B = Encrypt("870777365"): CustId = "1793JAB": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("17/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1793)
    '14
    B = Encrypt("1471676945"): CustId = "1799JOD": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("01/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1799)
    '15
    B = Encrypt("2024030623"): CustId = "1800MUM": LTDate = DateValue("31/01/2022"): LLDATE = DateValue("02/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1800)
    '16
    B = Encrypt("1575173419"): CustId = "1801MUM": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("06/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1801)
    '17
    B = Encrypt("2132743778-"): CustId = "1806RAI": LTDate = DateValue("31/01/2023"): LLDATE = DateValue("04/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1806)
    '18
    B = Encrypt("2012662497"): CustId = "1807IND": LTDate = DateValue("31/01/2023"): LLDATE = DateValue("14/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1807)
    '19
    B = Encrypt("702057261"): CustId = "1879MUM": LTDate = DateValue("31/12/2023"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1879)
    '20
    B = Encrypt("810314360"): CustId = "1882HYD": LTDate = DateValue("27/07/2023"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1879)
    '45
    SNo2 = Encrypt("607888382")
    B = Encrypt("1832277396"): CustId = "1886PUN": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("08/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1886)
    SNo2 = vbNullString
    '21
    B = Encrypt("1486417114"): CustId = "1970NGP": LTDate = DateValue("31/01/2024"): LLDATE = DateValue("31/01/2019")
    SNo2 = Encrypt("2022495406")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1970)
    '22
    SNo2 = vbNullString
    B = Encrypt("434598864"): CustId = "1973AKL": LTDate = DateValue("25/06/2024"): LLDATE = DateValue("31/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1973)
    '23
    B = Encrypt("1168518008"): CustId = "1974RTM": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("30/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1974)
    '24
    B = Encrypt("934767816"): CustId = "1975IND": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("31/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1975)
    '25
    B = Encrypt("1806837778"): CustId = "1979BAG": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("12/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1979)
    '26
    B = Encrypt("1357690386"): CustId = "1982LAT": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("04/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1982)
    '27
    B = Encrypt("313346868"): CustId = "2204JAB": LTDate = DateValue("31/01/2022"): LLDATE = DateValue("11/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2204)
    '28
    B = Encrypt("1029258524"): CustId = "2206IND": LTDate = DateValue("31/01/2024"): LLDATE = DateValue("04/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2206)
    '29
    B = Encrypt("1486417114"): CustId = "2207IND": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("09/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2207)
    '30
    SNo3 = Encrypt("2120070219")
    SNo2 = Encrypt("2077517295")
    B = Encrypt("1751416914"): CustId = "2210MUM": LTDate = DateValue("31/01/2024"): LLDATE = DateValue("09/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2210)
    SNo2 = vbNullString
    '31
    B = Encrypt("817606029"): CustId = "2215JOD": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("09/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2215)
    '32
    B = Encrypt("1046083456"): CustId = "2416FA": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2416)
    '33
    B = Encrypt(""): CustId = "2679NGP": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2679)
    
    B = Encrypt("1133061542"): CustId = "BHR-MUM": LTDate = DateValue("09/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2679)
    
End Sub

Public Sub CL_02()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    SNo2 = Encrypt("814806771")
    B = Encrypt("1872919328"):   CustId = "86IND": LTDate = DateValue("16/02/2021"): LLDATE = DateValue("05/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 86)
    SNo2 = vbNullString
    '2
    B = Encrypt("414564386"): CustId = "94IND": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("23/02/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 94)
    '3
    B = Encrypt("1728090608"): CustId = "215AUR": LTDate = DateValue("19/02/2021"): LLDATE = DateValue("11/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 215)
    '4
    B = Encrypt("1199237566"): CustId = "526RTM": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("15/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 526)
    
    '4
    B = Encrypt("1913869712"): CustId = "550IND": LTDate = DateValue("15/12/2021"): LLDATE = DateValue("15/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 526)
    '5
    SNo2 = Encrypt("1054760365"): SNo3 = Encrypt("893385974")
    B = Encrypt("1685339946"): CustId = "895AKT": LTDate = "15/02/2021": LLDATE = DateValue("22/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 895)
    SNo2 = vbNullString: SNo3 = vbNullString
    '6
    B = Encrypt("2055228182"): CustId = "925NGP": LTDate = "28/02/2021": LLDATE = DateValue("26/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 925)
    '7
    B = Encrypt("1899116973"): CustId = "928HYD": LTDate = "28/02/2021": LLDATE = DateValue("26/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 928)
    '8
    B = Encrypt("451567623"): CustId = "1357NAS": LTDate = DateValue("10/05/2024"): LLDATE = DateValue("06/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1357)
    
    
    '9
    SNo2 = "8258685"
    B = Encrypt("1722145272"): CustId = "1479IND": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("11/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1479)
    '10
    
    
    B = Encrypt("68788892"): CustId = "1642AUR": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("02/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1642)
    '11
    B = Encrypt("1259150872"): CustId = "1652RTM": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("04/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1652)
    '12
    B = Encrypt("1323495864"): CustId = "1653KHM": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1653)
    '13
    B = Encrypt("1050820614"): CustId = "1657KHC": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1657)
    '14
    B = Encrypt("171439614"): CustId = "1665AUR": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("22/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1665)
    '15
    B = Encrypt("1791935138"): CustId = "1808RAI": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1808)
    '16
    B = Encrypt("14198590864"): CustId = "1812MUM": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1812)
    '17
    B = Encrypt("1129798791"): CustId = "1815MUM": LTDate = DateValue("28/02/2023"): LLDATE = DateValue("05/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1815)
    '18
    B = Encrypt("2028344586"): CustId = "849MHW": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("05/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 849)

    B = Encrypt("9357185"): CustId = "1984KOP": LTDate = DateValue("15/10/2022"): LLDATE = DateValue("02/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1984)
    '19
    B = Encrypt("71125521"): CustId = "1986VIJ": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("28/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1986)
    '20
    B = Encrypt("1405810707"): CustId = "1987SHE": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1987)
    '21
    B = Encrypt("1124419705"): CustId = "1993NGP": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("08/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1993)
    '22
    B = Encrypt("1124550788"): CustId = "1995SUM": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("02/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1995)
    '23
    B = Encrypt("1414854363 "): CustId = "2004IND": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("04/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2004)
    '24
    B = Encrypt("1099154931"): CustId = "2211RAI": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("09/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2211)
    '25
    B = Encrypt("546881158"): CustId = "2226IND": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("10/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2226)
    '26
    SNo2 = Encrypt("1309078008")
    B = Encrypt("1476253634"): CustId = "2229SIL": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/01/2000")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2229)
    '27
    SNo2 = vbNullString
    B = Encrypt("1281841352"): CustId = "2230GWA": LTDate = DateValue("31/07/2023"): LLDATE = DateValue("19/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2230)
    '28
    B = Encrypt("818035968"): CustId = "2234NGP": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("26/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2234)
    '29
    B = Encrypt("774592622"): CustId = "2408PUN": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2408)
    '30
    B = Encrypt("1252347708"): CustId = "2409IND": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2409)
    '31
    B = Encrypt("712953228"): CustId = "2414IND": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2414)
    '32
    B = Encrypt("215305901"): CustId = "2415NEM": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2415)
    '33
    B = Encrypt("1092219144"): CustId = "2417IND": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2417)
    '34
    B = Encrypt("287113555"): CustId = "2418NGP": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2418)
    '35
    B = Encrypt(""): CustId = "2419KOL": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2419)
    '37
    B = Encrypt("457723252"): CustId = "2420IND": LTDate = DateValue("28/02/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2420)
    
End Sub

Public Sub CL_03()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("1136692723"): CustId = "4AGR": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 4)
    '2
    B = Encrypt("1281841352"): CustId = "96IND": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 96)
    '3
    SNo2 = vbNullString
    B = Encrypt("1863639676"): CustId = "110IND": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 110)
    '4
    SNo2 = Encrypt("38272923")
    B = Encrypt("270268744"):   CustId = "124IND": LTDate = DateValue("18/03/2021"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 124)
    SNo2 = vbNullString
    '5
    B = Encrypt("1095308571"): CustId = "127IND": LTDate = DateValue("19/03/2021"): LLDATE = DateValue("13/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 127)
    '6
    SNo2 = Encrypt("15562919")
    B = Encrypt("628998263"): CustId = "199SAN": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("19/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 199)
    '7
    SNo2 = vbNullString
    B = Encrypt("441138788"): CustId = "209KHA": LTDate = DateValue("08/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 209)
    '8
    B = Encrypt("122801821"):  CustId = "367IND": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("25/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 367)
    '9
    B = Encrypt("1141575953"): CustId = "368IND":: LTDate = DateValue("15/04/2022"): LLDATE = DateValue("01/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 368)
    '10
    B = Encrypt("1607364236"): CustId = "385JOD": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("26/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 385)
    '11
    B = Encrypt("764525674"): CustId = "387JOD": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 387)
    
    B = Encrypt("729293106"): CustId = "389JOD": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 387)
    '12
    B = Encrypt("1814730648"): CustId = "412HYD": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("28/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 412)
    '13
    B = Encrypt("540408038"): CustId = "449NGP": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("28/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 449)
    '14
    B = Encrypt("254920731"): CustId = "465PRA": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("08/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 465)
    '15
    SNo2 = Encrypt("750380421")
    B = Encrypt("1704985979"): CustId = "560IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 560)
    '16
    SNo2 = vbNullString
    B = Encrypt("1083945274"): CustId = "609IND": LTDate = DateValue("15/03/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 609)
    '17
    B = Encrypt("1199615903"): CustId = "746BAL": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("18/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 746)
    '18
    B = Encrypt("362715892"): CustId = "755IND": LTDate = DateValue("15/07/2022"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 755)
    '19
    B = Encrypt("1704985979"): CustId = "783IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("29/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 783)
    '20
    B = Encrypt("696577200"): CustId = "1063BDR": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("26/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1063)
    '21
    SNo2 = vbNullString
    B = Encrypt("2064372360"): CustId = "1082AMR": LTDate = DateValue("24/03/2022"): LLDATE = DateValue("27/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1082)
    '22
    B = Encrypt("1761361613"): CustId = "1205IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("14/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1205)
    '23
    B = Encrypt(""): CustId = "1389IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1389)
    '24
    B = Encrypt("1334659816"): CustId = "1504RTM":: LTDate = DateValue("20/03/2021"): LLDATE = DateValue("31/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1504)
    '25
    B = Encrypt("2081095651"): CustId = "1514BAN":: LTDate = DateValue("31/03/2021"): LLDATE = DateValue("06/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1514)
    '26
    B = Encrypt("1920235911"): CustId = "1631RAN":: LTDate = DateValue("31/03/2021"): LLDATE = DateValue("16/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1631)
    '27
    B = Encrypt("1512552380"): CustId = "1716IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1716)
    '28
    B = Encrypt("1290474998"): CustId = "1805IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("26/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1805)
    '29
    B = Encrypt("1623407215"): CustId = "1823JAB": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("01/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1823)
    '30
    B = Encrypt("1724232603"): CustId = "1824GWA": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("10/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1824)
    '31
    B = Encrypt("1379562727"): CustId = "1830VLD": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("06/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1830)
    '32
    B = Encrypt("1276221785"): CustId = "1851RAI": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("11/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1851)
    '33
    B = Encrypt("449473117"): CustId = "1996GWA": SNo2 = Encrypt("449473117"): LTDate = DateValue("31/03/2021"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1996)
    '34
    SNo2 = vbNullString
    B = Encrypt("705444284"): CustId = "1997DEL": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1997)
    '35
    B = Encrypt("659478536"): CustId = "2006IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("04/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2006)
    '36
    B = Encrypt("1510723563"): CustId = "2015IND": LTDate = DateValue("31/01/2021"): LLDATE = DateValue("01/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2015)
    '37
    B = Encrypt("546838592"): CustId = "2016AHD": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("30/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2016)
    '38
    B = Encrypt("545995556"): CustId = "2199KOP": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("06/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2199)
    '39
    B = Encrypt("344819182"): CustId = "2233MUM": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/01/2000")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2233)
    '40
    B = Encrypt("991631619"): CustId = "2235MUM": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("23/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2235)
    '41
    B = Encrypt("1995925135"): CustId = "2239UDR": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("09/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2239)
    '42
    B = Encrypt("1432087193"): CustId = "2352IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2352)
    '43
    B = Encrypt("1123603392"): CustId = "2421IND": LTDate = DateValue("31/01/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2421)
    '44
    B = Encrypt("392605688"): CustId = "2422BAT": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2422)
    '45
    B = Encrypt("1287720260"): CustId = "2432GWA": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2432)
    '46
    B = Encrypt("132006078"): CustId = "2551JAG": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2551)
    '47
    B = Encrypt(""): CustId = "2563GWA": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2563)
    '48
    B = Encrypt("1202616118"): CustId = "2564MUM": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2564)
    '49
    B = Encrypt("1871364912"): CustId = "2580MUM": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2580)
    '50
    B = Encrypt("1343047465"): CustId = "2583IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2583)
    '51
    B = Encrypt("1343047465"): CustId = "2584IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2584)
    '52
    B = Encrypt("1343047465"): CustId = "2585IND": LTDate = DateValue("31/03/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2585)
    
End Sub
Public Sub CL_13()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    Dim SNo4 As String:
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("122801821"): CustId = "AMT-DEL": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
    '2
    B = Encrypt("593072747"): CustId = "AMT-DELEQ": LTDate = DateValue("15/07/2022"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
    '3
    B = Encrypt("1864818509"): CustId = "RAJ-IND": LTDate = DateValue("30/06/2022"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
    '4
    B = Encrypt("1960266715"): CustId = "HRH-IND": LTDate = DateValue("31/07/2023"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
    '5
    B = Encrypt("826315768"): CustId = "GOLU-RTM": LTDate = DateValue("31/08/2022"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
    '6
    B = Encrypt("1682504704"): CustId = "ROCK-MUM": LTDate = DateValue("15/07/2022"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
    '7
    B = Encrypt("1340124661"): CustId = "GOP-IND": LTDate = DateValue("05/10/2023"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    
End Sub



Public Sub CL_04()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    Dim SNo4 As String:
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("187729658"): CustId = "6AKL": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 6)
    '2
    B = Encrypt("1108279122"): CustId = "23BAL": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 23)
    '3
    B = Encrypt("1168452546"): CustId = "40DHR": LTDate = DateValue("04/04/2021"): LLDATE = DateValue("07/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 40)
    '4
    B = Encrypt("1746104343"):  CustId = "52IND": LTDate = DateValue("12/12/2021"): LLDATE = DateValue("09/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 52)
    '5
    B = Encrypt("1894290980"): CustId = "54IND": LTDate = DateValue("19/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 54)
    '6
    B = Encrypt("624577085"): CustId = "55IND": LTDate = DateValue("10/04/2024"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 55)
    
    B = Encrypt("624577085"): CustId = "55MIND": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 55)
    '7
    SNo2 = Encrypt("1745064571")
    B = Encrypt("1919695479"): CustId = "56IND": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("26/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 56)
    '8
    SNo2 = Encrypt("1421812740")
    B = Encrypt("933235445"): CustId = "58IND": LTDate = DateValue("08/04/2022"): LLDATE = DateValue("26/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 58)
    SNo2 = vbNullString
    '9
    B = Encrypt("1915624301"): CustId = "69IND": LTDate = DateValue("10/04/2021"): LLDATE = DateValue("26/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 69)
    '10
    B = Encrypt("1154951908"): CustId = "70IND": LTDate = DateValue("07/04/2021"): LLDATE = DateValue("01/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 70)
    '11
    B = Encrypt("313289134"): CustId = "84IND": LTDate = DateValue("03/04/2024"): LLDATE = DateValue("04/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 84)
    '12
    B = Encrypt("1404010614"): CustId = "92IND": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 92)
    '13
    B = Encrypt("1895818133"): CustId = "98IND": LTDate = DateValue("05/04/2021"): LLDATE = DateValue("25/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 98)
    '14
    B = Encrypt("228319395"): CustId = "108IND": LTDate = DateValue("05/04/2024"): LLDATE = DateValue("26/03/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 108)
    '15
    B = Encrypt("1397941024"): CustId = "111IND": LTDate = DateValue("06/04/2021"): LLDATE = DateValue("01/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 111)
    '16
    B = Encrypt("289397211"):   CustId = "113IND": LTDate = DateValue("17/04/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 113)
    '17
    B = Encrypt("299480083"): CustId = "114IND": LTDate = DateValue("24/04/2021"): LLDATE = DateValue("15/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 114)
    '18
    SNo2 = Encrypt("1178486744")
    B = Encrypt("799314027"): CustId = "118IND": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("01/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 118)
    SNo2 = vbNullString
    '19
    B = Encrypt("1991634915"): CustId = "122IND": LTDate = DateValue("11/04/2023"): LLDATE = DateValue("05/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 122)
    '20
    B = Encrypt("928288269"): CustId = "123IND": LTDate = DateValue("08/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 123)
    '21
    B = Encrypt("482933349"): CustId = "125IND": LTDate = DateValue("17/04/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 125)
    '22
    B = Encrypt("2040104162"): CustId = "131IND": LTDate = DateValue("10/04/2024"): LLDATE = DateValue("05/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 131)
    '23
    'SNo2 = Encrypt("1464048049")
    B = Encrypt("938115580"): CustId = "138IND": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("18/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 138)
    SNo2 = vbNullString
    '24
    SNo2 = vbNullString
    '1989819832
    B = Encrypt("1741749917"): CustId = "140IND": LTDate = DateValue("13/04/2022"): LLDATE = DateValue("02/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 140)
    '25
    B = Encrypt("109628527"): CustId = "144IND": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("13/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 144)
    '26
    B = Encrypt("1878415983"): CustId = "145IND": LTDate = DateValue("17/04/2021"): LLDATE = DateValue("03/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 145)
    '27
    B = Encrypt("929354969"): CustId = "146IND": LTDate = DateValue("06/04/2022"): LLDATE = DateValue("26/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 146)
    '28
    B = Encrypt("1355261791"): CustId = "147IND": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("02/05/2019")
    SNo2 = Encrypt("1693086520"): SNo3 = Encrypt("1015014823")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 147)
    SNo2 = vbNullString
    SNo3 = vbNullString
    '29
    B = Encrypt("462063285"): CustId = "150IND": LTDate = DateValue("06/04/2021"): LLDATE = DateValue("09/04/2019")
    SNo2 = Encrypt("1615128850"): SNo3 = vbNullString
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 150)
    '30
    B = Encrypt("672510427"): CustId = "154IND": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("05/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 154)
    '31
    B = Encrypt("1742486995"): CustId = "159IND": LTDate = DateValue("06/04/2021"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 159)
    '32
    B = Encrypt("1179901429"): CustId = "162IND": LTDate = DateValue("06/04/2022"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 162)
    '33
    B = Encrypt("875138264"): CustId = "165IND": LTDate = DateValue("18/04/2021"): LLDATE = DateValue("05/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 165)
    '34
    B = Encrypt("1532264885"): CustId = "166IND": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 166)
    '35
    B = Encrypt("2013588268"): CustId = "172IND": LTDate = DateValue("07/04/2024"): LLDATE = DateValue("05/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 172)
    '36
    B = Encrypt("421148728"): CustId = "173IND": LTDate = DateValue("19/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 173)
    '37
    B = Encrypt("10291451"): CustId = "179KOL": LTDate = DateValue("19/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 179)
    '38
    B = Encrypt("566419676"): CustId = "202VER": LTDate = DateValue("19/04/2024"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 202)
    '39
    B = Encrypt("1332992540"): CustId = "204NGP": LTDate = DateValue("08/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 204)
    '40
    B = Encrypt("1206584479"): CustId = "214PUN": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 214)
    '41
    B = Encrypt("1677995644"): CustId = "219AGR": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 219)
    '42
    B = Encrypt("169653409"): CustId = "224ALI": LTDate = DateValue("20/04/2021"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 224)
    '43
    B = Encrypt("576024658"): CustId = "237BHO": LTDate = DateValue("11/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 237)
    '44
    B = Encrypt("537364980"): CustId = "248FA": LTDate = DateValue("09/04/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 248)
    '45
    SNo2 = Encrypt("1606382564")
    B = Encrypt("1915624301"): CustId = "308DUR":: LTDate = DateValue("09/04/2021"): LLDATE = DateValue("08/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 308)
    '46
    SNo2 = vbNullString
    B = Encrypt("847281456"): CustId = "353BUL": LTDate = DateValue("06/04/2024"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 353)
    '47
    B = Encrypt("1178999739"): CustId = "364IND": LTDate = DateValue("10/04/2024"): LLDATE = DateValue("11/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 364)
    '48
    B = Encrypt("2144414973"): CustId = "365IND": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("11/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 365)
    '49
    B = Encrypt("219679037"): CustId = "383JOD": LTDate = DateValue("19/10/2022"): LLDATE = DateValue("01/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 383)
    '50
    B = Encrypt("145571582"): CustId = "384JOD": LTDate = DateValue("15/04/2022"): LLDATE = DateValue("18/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 384)
    '51
    B = Encrypt("1594049481"): CustId = "394KHD": LTDate = DateValue("11/04/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 394)
    '52
    B = Encrypt("519667795"): CustId = "400KHD": LTDate = DateValue("16/04/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 400)
    '53
    B = Encrypt("553521734"): CustId = "401KHG": LTDate = DateValue("24/04/2022"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 401)
    '54
    B = Encrypt("2034658"): CustId = "406MAT": LTDate = DateValue("11/04/2020"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 406)
    '55
    B = Encrypt("665738052"): CustId = "407HYD": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("05/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 407)
    '56
    B = Encrypt("1336958905"): CustId = "411HYD": LTDate = DateValue("20/04/2024"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 411)
    '57
    SNo2 = Encrypt("133305707")
    B = Encrypt("772041996"): CustId = "423MUM": LTDate = DateValue("12/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 423)
    '58
    SNo2 = Encrypt("1416739658")
    B = Encrypt("707578"): CustId = "434MUR": LTDate = DateValue("10/04/2023"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 434)
    '59
    SNo2 = vbNullString:
    B = Encrypt("200818174"): CustId = "435MUR": LTDate = DateValue("13/04/2022"): LLDATE = DateValue("01/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 435)
    '60
    B = Encrypt("729752754"): CustId = "439NGP": LTDate = DateValue("12/04/2021"): LLDATE = DateValue("15/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 439)
    '61
    B = Encrypt("429449171"): CustId = "457NEM": LTDate = DateValue("19/04/2021"): LLDATE = DateValue("28/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 457)
    '62
    SNo2 = Encrypt("737162886"): SNo3 = Encrypt("150028925")
    B = Encrypt("286200916"): CustId = "462PAR":  LTDate = DateValue("12/04/2021"): LLDATE = DateValue("17/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 462)
    '63
    SNo2 = vbNullString:    SNo3 = vbNullString
    B = Encrypt("668750218"): CustId = "464PET":  LTDate = DateValue("17/04/2022"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 464)
    '64
     SNo2 = Encrypt("977605731")
    B = Encrypt("1833710421"): CustId = "466PUN": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("15/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 466)
    SNo2 = vbNullString
    '65
    B = Encrypt("923928136"): CustId = "501RAJ": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("18/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 501)
    '66
    B = Encrypt("1256349008"): CustId = "511RJN": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 511)
    '67
    B = Encrypt("1915624301"): CustId = "537SEH": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 537)
    '68
    B = Encrypt("478766648"): CustId = "539SUM": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("26/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 539)
    '69
    B = Encrypt("1254825781"): CustId = "540UJN":: LTDate = DateValue("25/04/2021"): LLDATE = DateValue("24/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 540)
    '70
    B = Encrypt("1199580949"): CustId = "541UJN": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("25/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 541)
    '71
    B = Encrypt("337420956"): CustId = "542UJN": LTDate = DateValue("22/04/2021"): LLDATE = DateValue("18/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 542)
    '72

    SNo2 = Encrypt("911465315") ' Active
    SNo3 = Encrypt("1052351603") ' Active
    SNo4 = Encrypt("1242814312") ' Active
    B = Encrypt("1705822985"): CustId = "543UJN": LTDate = DateValue("27/04/2024"): LLDATE = DateValue("21/05/2019")
    mysql = "INSERT INTO SYSTNO (CUSTID,SERIALNO,REGNO2,REGNO3,REGNO4,TDATE,LDATE,CCODE)"
    mysql = mysql & " VALUES ('" & CustId & "','" & B & "','" & SNo2 & " ','" & SNo3 & "','" & SNo4 & "','" & Format(LTDate, "YYYY/MM/DD") & "','" & Format(LLDATE, "YYYY/MM/DD") & "',543)"
    MCnn.Execute mysql
    
    '73
    SNo2 = Encrypt("911465315"):    SNo3 = vbNullString::    SNo4 = vbNullString:
    B = Encrypt("1783994433"): CustId = "545VAR": LTDate = DateValue("14/04/2021"): LLDATE = DateValue("23/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 545)
    '74
    SNo2 = vbNullString:
    B = Encrypt("386280900"): CustId = "546VAR": LTDate = DateValue("20/04/2021"): LLDATE = DateValue("24/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 546)
    '75
    B = Encrypt("1140595755"): CustId = "555RAI": LTDate = DateValue("14/04/2021"): LLDATE = DateValue("30/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 555)
    '76
    B = Encrypt("1174628148"): CustId = "561IND": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 561)
    '77
    B = Encrypt("1281841352"): CustId = "564BIL": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("15/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 564)
    '78
    B = Encrypt("1150535043"): CustId = "566IND":: LTDate = DateValue("19/04/2024"): LLDATE = DateValue("22/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 566)
    '79
    B = Encrypt("1691265318"): CustId = "572UJN":: LTDate = DateValue("15/04/2021"): LLDATE = DateValue("19/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 572)
    '80
    B = Encrypt("1809500777"): CustId = "576IND":: LTDate = DateValue("15/04/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 576)
    '81
    SNo2 = Encrypt("1626055977"): SNo3 = Encrypt("1738318812")
    B = Encrypt("1243484"): CustId = "577UJN": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("07/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 577)
    '82
    SNo2 = vbNullString: SNo3 = vbNullString
    B = Encrypt("419031732"):  CustId = "583IND": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 583)
    '83
    B = Encrypt("2085421339"): CustId = "638IND":: LTDate = DateValue("29/04/2021"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 638)
    '84
    SNo2 = "530730107"
    B = Encrypt("1938992849"): CustId = "674SUM": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 674)
    '85
    B = Encrypt("188854213"): CustId = "679AMR": LTDate = DateValue("21/04/2021"): LLDATE = DateValue("18/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 679)
    '86
    B = Encrypt("139712054"): CustId = "706JAG": LTDate = DateValue("23/04/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 706)
    '87
    B = Encrypt("1088769343"): CustId = "719IND": LTDate = DateValue("17/04/2021"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 719)
    '88
    SNo2 = vbNullString
    B = Encrypt("1789836751"): CustId = "732AMR": LTDate = DateValue("29/04/2022"): LLDATE = DateValue("29/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 732)
    '89
    B = Encrypt("1288044007"): CustId = "737IND": LTDate = DateValue("10/04/2024"): LLDATE = DateValue("26/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 737)
    '90
    B = Encrypt("661921028"): CustId = "743RJM": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("16/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 743)
    '91
    B = Encrypt("1555928574"): CustId = "748IND": LTDate = DateValue("29/04/2021"): LLDATE = DateValue("25/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 748)
    '92
    SNo2 = Encrypt("1812647575")
    B = Encrypt("1720540128"): CustId = "752IND": LTDate = DateValue("18/04/2021"): LLDATE = DateValue("20/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 752)
    '93
    B = Encrypt("1164738005"): CustId = "759IND": LTDate = DateValue("24/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 759)
    '94
    B = Encrypt("274131322"): CustId = "760IND": LTDate = DateValue("11/04/2022"): LLDATE = DateValue("17/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 760)
    '95
    B = Encrypt("1868868981"): CustId = "766UJN":: LTDate = DateValue("03/04/2021"): LLDATE = DateValue("25/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 766)
    '96
    SNo2 = Encrypt("1533716785")
    B = Encrypt("1442995207"): CustId = "767NGP": LTDate = DateValue("18/04/2021"): LLDATE = DateValue("11/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 767)
    '97
    SNo2 = Encrypt("1233590693")
    B = Encrypt("1423418920"): CustId = "769IND": LTDate = DateValue("19/04/2021"): LLDATE = DateValue("16/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 769)
    '98
    SNo2 = Encrypt("162")
    B = Encrypt("1135690807"): CustId = "770IND": LTDate = DateValue("19/04/2024"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 770)
    '99
    B = Encrypt("1845890948"): CustId = "772JAG": LTDate = DateValue("24/04/2021"): LLDATE = DateValue("24/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 772)
    '100
    B = Encrypt("242331795"): CustId = "786IND": LTDate = DateValue("19/04/2022"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 786)
    '101
    SNo2 = Encrypt("2127024001")
    B = Encrypt("1061716937"): CustId = "787KHG": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 787)
    '102
    B = Encrypt("1518660408"): CustId = "803JOD":: LTDate = DateValue("21/04/2021"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 803)
    '103
    B = Encrypt("1576716064"): CustId = "806IND":: LTDate = DateValue("15/04/2022"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 806)
    '104
    B = Encrypt("1468088001"): CustId = "807IND": LTDate = DateValue("19/04/2021"): LLDATE = DateValue("23/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 807)
    '105
    B = Encrypt("103794550"): CustId = "808MAN": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("21/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 808)
    '106
    B = Encrypt("1560222647"): CustId = "813NGP": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("18/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 813)
    '107
    B = Encrypt("1722387732"): CustId = "819IND": LTDate = DateValue("20/04/2024"): LLDATE = DateValue("05/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 819)
    '108
    B = Encrypt("99381167"): CustId = "847KHD": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("07/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 847)
        '109
    B = Encrypt("319624299"):    CustId = "851IND":: LTDate = DateValue("20/04/2021"): LLDATE = DateValue("11/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 851)
    '110
    B = Encrypt("1821503202"):    CustId = "857MAT": LTDate = DateValue("21/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 857)
    '111
    B = Encrypt("557344836"): CustId = "858NGP": LTDate = DateValue("25/04/2021"): LLDATE = DateValue("25/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 858)
    '112
    B = Encrypt("1152406081"): CustId = "869MUR": LTDate = DateValue("24/04/2021"): LLDATE = DateValue("24/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 869)
    '113
    B = Encrypt("1276257334"): CustId = "871IND": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("24/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 871)
    '114
    B = Encrypt("1546506743"): CustId = "873MUR": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("24/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 873)
    '115
    B = Encrypt("17058336"): CustId = "874AGR": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("07/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 874)
    '116
    B = Encrypt("277711901"): CustId = "877NAS": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 877)
    '117
    B = Encrypt("771165602"): CustId = "899KOL": LTDate = "05/04/2021": LLDATE = DateValue("13/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 899)
    '118
    SNo2 = vbNullString
    B = Encrypt("1074334306"): CustId = "913NGP": LTDate = DateValue("22/04/2021"): LLDATE = DateValue("02/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 913)
    '119
    B = Encrypt("1630392408"): CustId = "979DAV": LTDate = DateValue("08/12/2023"): LLDATE = DateValue("27/06/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 979)
    '120
    B = Encrypt("1279023500"): CustId = "978DAV": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("27/06/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 979)
    '155
    B = Encrypt("631084629"): CustId = "1008NGP": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("04/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1008)
    '121
    B = Encrypt("1886838550"): CustId = "1016IND": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("12/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1016)
    '122
    B = Encrypt("1302676198"): CustId = "1017MUM": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("17/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1017)
    '123
    B = Encrypt("1317253370"): CustId = "1028IND": LTDate = DateValue("25/04/2021"): LLDATE = DateValue("15/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1028)
    '124
    B = Encrypt("145505103"):   CustId = "1031RAI": LTDate = DateValue("23/04/2021"): LLDATE = DateValue("24/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1031)
    '125
    B = Encrypt("540571028"): CustId = "1037KOL": LTDate = DateValue("04/05/2024"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1037)
    '126
    B = Encrypt("333628998"): CustId = "1042NGP": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("19/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1042)
    '127
    B = Encrypt("2088166486"): CustId = "1045CHI": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("07/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1045)
    '128
    B = Encrypt("1082019575"): CustId = "1058CHA": LTDate = DateValue("24/04/2021"): LLDATE = DateValue("08/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1058)
    '129
    SNo2 = Encrypt("335891093")
    B = Encrypt("249129278"): CustId = "1060KOL": LTDate = DateValue("30/04/2020"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1060)
    '130
    B = Encrypt("1281841352"): CustId = "1088RAI": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("01/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1088)
    '131
    B = Encrypt("1281841352"): CustId = "1089RAI": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("06/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1089)
    '132
    B = Encrypt("1181204830"): CustId = "1172IND":: LTDate = DateValue("26/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1172)
    '133
    B = Encrypt("999764341"): CustId = "1174BIL": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("28/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1174)
    '134
    B = Encrypt("749844553"): CustId = "1187JAG": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("17/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1187)
    '135
    B = Encrypt("1724250158"): CustId = "1194RTM": LTDate = DateValue("21/04/2021"): LLDATE = DateValue("02/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1194)
    '136
    SNo2 = Encrypt("1852098600")
    B = Encrypt("825563248"): CustId = "1207BIK": LTDate = DateValue("26/04/2021"): LLDATE = DateValue("13/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1207)
    
    '137
    B = Encrypt("998144333"): CustId = "1231MUR": LTDate = DateValue("27/04/2021"): LLDATE = DateValue("25/08/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1231)
    
    '138
    B = Encrypt("640336635"): CustId = "1326JAG": LTDate = DateValue("16/04/2023"): LLDATE = DateValue("11/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1326)
    '139
    B = Encrypt("358177309"): CustId = "1337IND": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("11/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1337)
    '140
    B = Encrypt("1570790645"): CustId = "1338IND": LTDate = DateValue("30/07/2024"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1338)
    '141
    B = Encrypt("1738613636"): CustId = "1347IND": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("18/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1347)
    '142
    B = Encrypt("1980033238"): CustId = "1356BUL": LTDate = DateValue("05/04/2021"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1356)
    
    B = Encrypt("67029191"): CustId = "1375RJN": LTDate = DateValue("25/07/2023"): LLDATE = DateValue("01/01/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1375)
    
    '143
    B = Encrypt("398121978"): CustId = "1376NAS": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/01/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1376)
    '144
    B = Encrypt("1841590373"): CustId = "1397IND": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1397)
    
    '145
    B = Encrypt("1943992217"): CustId = "1413NGP": LTDate = DateValue("15/12/2024"): LLDATE = DateValue("09/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1438)
    '145
    B = Encrypt("466340809"): CustId = "1438NGP": LTDate = DateValue("12/04/2024"): LLDATE = DateValue("09/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1438)
    '146
    B = Encrypt("1313176647"): CustId = "1483JOD": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("14/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1483)
    '147
    SNo2 = "721941201"
    B = Encrypt("1118643054"): CustId = "1496IND": LTDate = DateValue("16/01/2022"): LLDATE = DateValue("17/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1496)
    '148
    B = Encrypt("1159403678"): CustId = "1502IND": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("19/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1502)
    '149
    B = Encrypt("778654291"): CustId = "1508IND":: LTDate = DateValue("30/04/2021"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1508)
    '150
    B = Encrypt("1896456883"): CustId = "1533IND": LTDate = DateValue("13/04/2021"): LLDATE = DateValue("04/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1533)
    '151
    B = Encrypt("1511610844"): CustId = "1650KOL": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("28/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1650)
    '152
    B = Encrypt("663040626"): CustId = "1662JAG": LTDate = DateValue("15/04/2021"): LLDATE = DateValue("06/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1662)
    '153
    B = Encrypt("605650176"): CustId = "1675NGP": LTDate = DateValue("16/04/2021"): LLDATE = DateValue("07/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1675)
    '154
    B = Encrypt("2025039381"): CustId = "1679JOD": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("22/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1679)
    '155
    B = Encrypt("567103170"): CustId = "1687DEL": LTDate = DateValue("16/04/2021"): LLDATE = DateValue("28/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1687)
    '156
    B = Encrypt("1957626180"): CustId = "1846IND": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("05/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1846)
    '157
    B = Encrypt("951868012"): CustId = "1860LIM": LTDate = DateValue("30/04/2022"): LLDATE = DateValue("10/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1860)
    '158
    B = Encrypt("1483750145"): CustId = "1869NAS": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("03/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1869)
    '159
    B = Encrypt("1046084883"): CustId = "1871MUR": LTDate = DateValue("16/04/2021"): LLDATE = DateValue("02/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1871)
    '150
    B = Encrypt(""): CustId = "1937AKL": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("12/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1937)
    '161
     B = Encrypt("1418904513"): CustId = "1938MUM": LTDate = DateValue("15/07/2022"): LLDATE = DateValue("12/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1937)
    '161
    B = Encrypt("1635785174"): CustId = "2021DHD": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("04/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2021)
    '152
    B = Encrypt("1874004467"): CustId = "2022NGP": LTDate = DateValue("10/05/2020"): LLDATE = DateValue("02/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2022)
    '163
    B = Encrypt("1752777792"): CustId = "2248IND": LTDate = DateValue("16/04/2021"): LLDATE = DateValue("08/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2248)
    '164
    B = Encrypt(""): CustId = "2250GWA": LTDate = DateValue("30/04/2020"): LLDATE = DateValue("08/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2250)
    '165
    B = Encrypt("150390147"): CustId = "2251BIK": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("20/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2251)
    '166
    B = Encrypt("1313433763"): CustId = "2252IND": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("23/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2252)
    '167
    B = Encrypt("1678168068"): CustId = "2254FA": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("21/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2254)
    '168
    B = Encrypt("120207554"): CustId = "2255SUR": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("28/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2255)
    '169
    B = Encrypt("2085544120"): CustId = "2347AHM": SNo2 = vbNullString: SNo3 = vbNullString
    LTDate = DateValue("19/08/2024"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2347)
    '170
    SNo2 = vbNullString: SNo3 = vbNullString
    B = Encrypt("2137741464"): CustId = "2348IND": LTDate = DateValue("15/04/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2348)
    '171
    B = Encrypt("979180265"): CustId = "2565FA": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2565)
    '172
    B = Encrypt("355584052"): CustId = "2566KHA": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2566)
    '173
    B = Encrypt("1319813781"): CustId = "2567MYS": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2567)
    '174
    B = Encrypt("1892970677"): CustId = "ASH-HYD": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2568)
    '174
    B = Encrypt("38182903"): CustId = "2568HYD": LTDate = DateValue("31/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2568)
    '175
    B = Encrypt("1419988122"): CustId = "2569SHU": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2569)
    '176
    B = Encrypt("399860511"): CustId = "2570GON": LTDate = DateValue("30/04/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    SNo2 = "707149131"
    B = Encrypt("304784416"): CustId = "MANI-IND": LTDate = DateValue("01/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
        
        
    B = Encrypt("1634130623"): CustId = "SHUBH": LTDate = DateValue("01/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
        
    B = Encrypt("777781721"): CustId = "AVI-MUR": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("456086251"): CustId = "SNDP-KOH": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("326958102"): CustId = "ROH-CHN": LTDate = DateValue("30/05/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
        
    B = Encrypt("245851308"): CustId = "PRA-RTM": LTDate = DateValue("30/05/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1142516750"): CustId = "VIY-MUM": LTDate = DateValue("30/04/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("733859721"): CustId = "CHI-AUR": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1535094960"): CustId = "PWN-AKL": LTDate = DateValue("15/05/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1569241288"): CustId = "JAY-RTM": LTDate = DateValue("15/03/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1179475048"): CustId = "NAMO-MUM": LTDate = DateValue("31/05/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("2017351767"): CustId = "HRY-DUB": LTDate = DateValue("15/07/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("28006666"): CustId = "RMGI-IND": LTDate = DateValue("15/06/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1487646330"): CustId = "ARI-TRI": LTDate = DateValue("30/06/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("21905788"): CustId = "BMB-MUM": LTDate = DateValue("20/07/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1511610844"): CustId = "SAG-RAI": LTDate = DateValue("30/05/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1248805391"): CustId = "DPK-AUR": LTDate = DateValue("31/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("844299928"): CustId = "KAM-IND": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1983537062"): CustId = "MHV-AUR": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1799220526"): CustId = "ABHI-IND": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("240432831"): CustId = "SNY-IND": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
  
    B = Encrypt("1645098407"): CustId = "AYN-IND": LTDate = DateValue("20/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
  
    B = Encrypt("416682256"): CustId = "SWR-NMH": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1956532455"): CustId = "MONU-NMH": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1351155295"): CustId = "SHL-CHI": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("2056613937"): CustId = "RAJ-KOL": LTDate = DateValue("18/09/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
     
    B = Encrypt("677205182"): CustId = "DHN-BLR": LTDate = DateValue("15/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1198448587"): CustId = "OM-MUM": LTDate = DateValue("13/11/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("420783135"): CustId = "VIP-GWA": LTDate = DateValue("15/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("1415687255"): CustId = "SHM-NGP": LTDate = DateValue("15/10/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("1655362693"): CustId = "RSH-NGP": LTDate = DateValue("19/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("1442832198"): CustId = "AJY-CHI": LTDate = DateValue("15/11/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    'B = Encrypt("1252963371"): CustId = "KB-KOL": LTDate = DateValue("17/07/2024"): LLDATE = DateValue("01/07/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1335986322"): CustId = "KB-KOL": LTDate = DateValue("17/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1917248286"): CustId = "VDK-IND": LTDate = DateValue("05/01/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
        
    B = Encrypt("1260454813"): CustId = "MIH-IND": LTDate = DateValue("18/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
        
    B = Encrypt("2060831585"): CustId = "DMH-IND": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1490960902"): CustId = "DVD-IND": LTDate = DateValue("18/12/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
        
    B = Encrypt("1574790940"): CustId = "PNY-DEL": LTDate = DateValue("07/12/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("537941442"): CustId = "VRT-SRT": LTDate = DateValue("20/01/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("220226620"): CustId = "SDR-HYD": LTDate = DateValue("20/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1155361792"): CustId = "TNU-IND": LTDate = DateValue("14/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("594860264"): CustId = "MYR-KOC": LTDate = DateValue("14/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("393252836"): CustId = "VIK-MUM": LTDate = DateValue("04/03/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("545544443"): CustId = "PDM-JOD": LTDate = DateValue("15/01/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("243488046"): CustId = "2666NGP": LTDate = DateValue("11/03/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("80880732"): CustId = "VKY-HYD": LTDate = DateValue("28/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("917841690"): CustId = "SJU-RTM": LTDate = DateValue("18/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("80880732"): CustId = "VKY-HYD": LTDate = DateValue("28/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("45987654"): CustId = "SS-IND": LTDate = DateValue("08/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("393252836"): CustId = "VKM-BHD": LTDate = DateValue("04/03/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

     B = Encrypt("2145127093"): CustId = "LFL-IND": LTDate = DateValue("28/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

     B = Encrypt("409454917"): CustId = "KDM-MUM": LTDate = DateValue("16/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
     B = Encrypt("1546312555"): CustId = "SJY-KOL": LTDate = DateValue("03/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    
    B = Encrypt("1511610844"): CustId = "MUM-IND": LTDate = DateValue("15/05/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    
      B = Encrypt("1546645445"): CustId = "MNH-PRA": LTDate = DateValue("08/04/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)


    B = Encrypt("409454917"): CustId = "AMT-MUM": LTDate = DateValue("17/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    
    B = Encrypt("1281841352"): CustId = "SNY-KOL": LTDate = DateValue("23/07/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1679703784"): CustId = "MOFX": LTDate = DateValue("31/12/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1679703784"): CustId = "MOFX-PR": LTDate = DateValue("31/12/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("9832875"): CustId = "ALM-HWD": LTDate = DateValue("11/12/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    SNo2 = Encrypt("1107102285") 'ACTIVE
    SNo3 = Encrypt("884474621")
    SNo4 = Encrypt("1981504043")
    'SNo2 = Encrypt("")
    B = Encrypt("1665294804"): CustId = "SBAG-KOL": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("01/07/2019")
    mysql = "INSERT INTO SYSTNO (CUSTID,SERIALNO,REGNO2,REGNO3,REGNO4,TDATE,LDATE,CCODE)"
    mysql = mysql & " VALUES ('" & CustId & "','" & B & "','" & SNo2 & " ','" & SNo3 & "','" & SNo4 & "','" & Format(LTDate, "YYYY/MM/DD") & "','" & Format(LLDATE, "YYYY/MM/DD") & "',543)"
    MCnn.Execute mysql
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1281841352"): CustId = "MJR-BIK": LTDate = DateValue("04/06/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1317435881"): CustId = "SYM3-MUM": LTDate = DateValue("15/06/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1182136339"): CustId = "AHK-HIS": LTDate = DateValue("20/06/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)


    B = Encrypt("1576241186"): CustId = "SHR-BIK": LTDate = DateValue("24/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1461570253"): CustId = "SAI-KOL": LTDate = DateValue("11/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
     B = Encrypt("298820898"): CustId = "RON-HYD": LTDate = DateValue("27/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("457138684"): CustId = "NAK-IND": LTDate = DateValue("18/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1761307950"): CustId = "SHV-MUM": LTDate = DateValue("21/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("851389424"): CustId = "SHB-JPR": LTDate = DateValue("27/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("975203533"): CustId = "KNG-JOD": LTDate = DateValue("02/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1666805492"): CustId = "RON-PRA": LTDate = DateValue("03/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1446975207"): CustId = "BEN-DUB": LTDate = DateValue("03/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1203192846"): CustId = "AMI-MUM": LTDate = DateValue("07/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("2104098345"): CustId = "HAR-IND": LTDate = DateValue("02/08/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("879068649"): CustId = "TRN-IND": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1864924593"): CustId = "HIT-MUM": LTDate = DateValue("26/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1273350462"): CustId = "RRT-MUM": LTDate = DateValue("13/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("922899802"): CustId = "BTY-DEL": LTDate = DateValue("10/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1044146892"): CustId = "UTM-MUM": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("844993796"): CustId = "SKR-NGP": LTDate = DateValue("26/10/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1731339918"): CustId = "DIN-TOH": LTDate = DateValue("11/11/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("2144414973"): CustId = "BBY-IND": LTDate = DateValue("01/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("278115141"): CustId = "ABHI-AKL": LTDate = DateValue("16/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("122801821"): CustId = "MOH-NGP": LTDate = DateValue("17/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("122801821"): CustId = "JAI-GWL": LTDate = DateValue("22/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1157542453"): CustId = "ABK-KOL": LTDate = DateValue("29/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1914010372"): CustId = "HMT-RAI": LTDate = DateValue("19/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1569673943"): CustId = "HRH-GWA": LTDate = DateValue("01/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1656134106"): CustId = "SR-PUN": LTDate = DateValue("17/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1696943589"): CustId = "SLH-AHD": LTDate = DateValue("15/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("118268436"): CustId = "ABK-HYD": LTDate = DateValue("03/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("103615498"): CustId = "MYR-MUM": LTDate = DateValue("07/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("193781987"): CustId = "AKT-KOL": LTDate = DateValue("12/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("353547124"): CustId = "MAH-KOL": LTDate = DateValue("05/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("477070688"): CustId = "MAC-KOL": LTDate = DateValue("26/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("930027675"): CustId = "SUR-BAT": LTDate = DateValue("02/12/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
End Sub
Public Sub CL_05()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    
    '1
    B = Encrypt("1708841876"): CustId = "57IND": LTDate = DateValue("04/05/2022"): LLDATE = DateValue("03/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 57)
    '2
    B = Encrypt("1024322982"):  CustId = "64IND": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("26/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 64)
    '3
    B = Encrypt("1268038352"): CustId = "78IND": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("06/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 78)
    '4
    SNo2 = Encrypt("1041470997")
    B = Encrypt("1702806650"):  CustId = "89IND": LTDate = DateValue("01/05/2021"): LLDATE = DateValue("24/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 89)
    SNo2 = vbNullString
    '5
    B = Encrypt("255128873"): CustId = "132IND": LTDate = DateValue("05/05/2021"): LLDATE = DateValue("13/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 132)
    '6
    B = Encrypt("998677945"): CustId = "161IND": LTDate = DateValue("06/05/2021"): LLDATE = DateValue("14/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 161)
    '7
    B = Encrypt("419200364"): CustId = "520RTM": LTDate = DateValue("15/05/2021"): LLDATE = DateValue("15/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 520)
    '8
    B = Encrypt("1202291543"): CustId = "590UJN": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("28/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 590)
    '9
    B = Encrypt("987732520"): CustId = "591IND": LTDate = DateValue("12/05/2021"): LLDATE = DateValue("27/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 591)
    '10
    B = Encrypt("1409283552"): CustId = "698IND": LTDate = DateValue("05/05/2021"): LLDATE = DateValue("23/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 698)
    '11
    B = Encrypt("1480686798"): CustId = "753IND": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("08/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 753)
    '12
    B = Encrypt("3213401"):   CustId = "1122RAI": LTDate = DateValue("25/05/2021"): LLDATE = DateValue("01/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1122)
    '13
    B = Encrypt("1881386260"): CustId = "1162AHM": LTDate = DateValue("15/04/2022"): LLDATE = DateValue("25/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1162)
    '14
    B = Encrypt("760477560"): CustId = "1213NGP": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("25/08/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1213)
    '15
    B = Encrypt("1781568986"): CustId = "1321HYD": LTDate = DateValue("11/05/2021"): LLDATE = DateValue("25/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1321)
    '16
    B = Encrypt("1664561960"): CustId = "1322IND": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("25/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1322)
    '17
    B = Encrypt("908719614"): CustId = "1355BAG": LTDate = DateValue("30/05/2021"): LLDATE = DateValue("23/05/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1355)
    '18
    B = Encrypt("1317642932"): CustId = "1469IND": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("31/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1469)
    '19
    B = Encrypt("1565087149"): CustId = "1498MUM": LTDate = DateValue("01/05/2021"): LLDATE = DateValue("13/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1498)
    '20
    B = Encrypt("2033707362"): CustId = "1521IND":: LTDate = DateValue("30/05/2022"): LLDATE = DateValue("10/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1521)
    '21
    B = Encrypt("312482292"): CustId = "1528JAG":: LTDate = DateValue("30/05/2021"): LLDATE = DateValue("01/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1528)
    '22
    B = Encrypt("2333638"): CustId = "1712IND": LTDate = DateValue("31/05/2022"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1712)
    '23
    B = Encrypt("132384829"): CustId = "1845NGP": LTDate = DateValue("30/05/2021"): LLDATE = DateValue("05/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1845)
    '24
    B = Encrypt("1533990779"): CustId = "1872HYD": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("13/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1872)
    '25
    B = Encrypt("122801821"): CustId = "2027MUM": LTDate = DateValue("31/05/2024"): LLDATE = DateValue("30/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2027)
    '26
    B = Encrypt("1489437585"): CustId = "2095MUM": LTDate = DateValue("04/09/2024"): LLDATE = DateValue("18/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2261)
    '34
    B = Encrypt("179356295"): CustId = "2259NAN": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("10/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2259)
    '27
    B = Encrypt("2046802750"): CustId = "2261NGP": LTDate = DateValue("10/06/2021"): LLDATE = DateValue("18/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2261)
    '28
    B = Encrypt("700052660"): CustId = "2262NEM": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("12/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2262)
    '29
    B = Encrypt("1834105689"): CustId = "2275RTM": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/01/2000")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2275)
    '30
    B = Encrypt("1416611139"): CustId = "2571CHI": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2571)
    
    B = Encrypt("1948845005"): CustId = "2686NOI": LTDate = DateValue("30/11/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2686)
    '31
    B = Encrypt(""): CustId = "2572HUB": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2572)
    '32
    B = Encrypt("240092959"): CustId = "2573IND": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2573)
    '33
    B = Encrypt("700654130"): CustId = "2574NGP": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2574)
    '34
    B = Encrypt("1348760238"): CustId = "2575MUM": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2575)
    '35
    B = Encrypt("1662850985"): CustId = "2576AUR": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2576)
    '36
    B = Encrypt("1878382385"): CustId = "2577IND": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2577)
    '37
    B = Encrypt("375889507"): CustId = "2578NGP": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2578)
    '38
    B = Encrypt("903855147"): CustId = "2581AKT": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2581)
    
     B = Encrypt("786020708"): CustId = "SYM-MUM": LTDate = DateValue("19/04/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

End Sub
Public Sub CL_06()
Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("1199237566"): CustId = "529RTM": LTDate = DateValue("10/07/2021"): LLDATE = DateValue("15/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 529)
    '2
    SNo2 = Encrypt("46092596")
    B = Encrypt("615674065"): CustId = "1365MUM": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("16/06/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1365)
    
     B = Encrypt("46092596"): CustId = "1365MUM-EQ": LTDate = DateValue("08/11/2023"): LLDATE = DateValue("16/06/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1365)
    '3
    B = Encrypt("2061093914"): CustId = "1562PUN": LTDate = DateValue("15/06/2021"): LLDATE = DateValue("30/06/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1562)
    '4
    B = Encrypt("526459577"): CustId = "1565RTM": LTDate = DateValue("10/07/2021"): LLDATE = DateValue("15/03/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1565)
    '5
    B = Encrypt("2076069751"): CustId = "1702NGP": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("24/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1702)
    '6
    B = Encrypt("2110983209"): CustId = "1703MHW": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("13/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1703)
    '7
    B = Encrypt("801282179"): CustId = "1713IND": LTDate = DateValue("31/07/2024"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1713)
    '8
    B = Encrypt("409382053"): CustId = "1899IND": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("08/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1899)
    '9
    B = Encrypt("572325006"): CustId = "1900IND": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("08/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1900)
    
    B = Encrypt("67029191"): CustId = "1375RJN": LTDate = DateValue("15/01/2021"): LLDATE = DateValue("01/01/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1375)
    '10
    B = Encrypt("1486417114"): CustId = "2033NGP": LTDate = DateValue("30/06/2020"): LLDATE = DateValue("18/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2033)
    '11
    B = Encrypt("1265536711"): CustId = "2035DEL": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2035)
    '12
    B = Encrypt("2051679838"): CustId = "2036JOD": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2036)
    '16
    B = Encrypt("347103903"): CustId = "2060IND": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("29/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2060)
    
    '16
    B = Encrypt("1055914496"): CustId = "ISHU-IND": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("29/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2060)
    '14
    B = Encrypt("1954836462"): CustId = "2276KOL": LTDate = DateValue("14/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2276)
    '15
    B = Encrypt("503502045"): CustId = "2277GOA": LTDate = DateValue("30/06/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2277)
    '16
    B = Encrypt("2002810637"): CustId = "2279IND": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2279)
    '17
    B = Encrypt("777023225"): CustId = "2281AKL": LTDate = DateValue("30/06/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2281)
    '18
    B = Encrypt(""): CustId = "2403DUB": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2403)
    
    B = Encrypt("731256651"): CustId = "2413AUR": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2413)
    '19
    SNo2 = Encrypt("1008803941"):
    B = Encrypt("10203165"): CustId = "2582KOH": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2582)
    '20
    B = Encrypt("252324914"): CustId = "2586SUM": LTDate = DateValue("01/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2586)
    '21
    B = Encrypt("1698743875"): CustId = "2587UDR": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2587)
    '22
    B = Encrypt("1139738421"): CustId = "2588AHM": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2588)
    '23
    B = Encrypt("885580863"): CustId = "2589MUM": LTDate = DateValue("20/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2589)
    '24
    B = Encrypt("1051908644"): CustId = "2590AKL": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2590)
    '25
    B = Encrypt("1404363941"): CustId = "2592JAG": LTDate = DateValue("20/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2592)
    '26
    B = Encrypt("996551653"): CustId = "2593AKT": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2593)
    '27
    B = Encrypt("2055228182"): CustId = "2594JPR": LTDate = DateValue("10/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2594)
    '28
    B = Encrypt("1327873649"): CustId = "2595MUM": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2595)
    '29
    B = Encrypt("1448931992"): CustId = "2596AHM": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2596)
    '30
    B = Encrypt("1704985979"): CustId = "2597IND": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2597)
    '31
    B = Encrypt("1265762545"): CustId = "2598MUM": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2598)
    '32
    B = Encrypt("6684024"): CustId = "2599RTM": LTDate = DateValue("30/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2599)
    '33
    B = Encrypt("525333280"): CustId = "2601MUM": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2601)
    '34
    B = Encrypt("1983712272"): CustId = "2602RTM": LTDate = DateValue("30/06/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2602)
    '35
    B = Encrypt("10132145"): CustId = "2603IND": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2603)
    '36
    B = Encrypt("747236765"): CustId = "2604MUM": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2604)
    '37
    B = Encrypt("302409964"): CustId = "2605IND": LTDate = DateValue("30/06/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2605)
    '38
    B = Encrypt("238418384"): CustId = "2606MUM": LTDate = DateValue("31/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2606)
End Sub

Public Sub CL_07()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    SNo2 = Encrypt("1056949355"):
    B = Encrypt("1506949355"): CustId = "651MUM":: LTDate = DateValue("31/07/2021"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 651)
    SNo2 = vbNullString
    '2
    B = Encrypt("488117599"): CustId = "1289AMR": LTDate = DateValue("02/11/2024"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1394)
    
    B = Encrypt("2119207225"): CustId = "1385NGP": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1385)
    SNo2 = vbNullString: SNo3 = vbNullString
    '3
    B = Encrypt("1349145456"): CustId = "1394IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1394)
    '4
    B = Encrypt("76804372"): CustId = "1424HYD": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("06/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1424)
    '5
    B = Encrypt("159481612"): CustId = "1572MUR": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("31/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1572)
    '6
    B = Encrypt("1784186736"): CustId = "1579BAL": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("20/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1579)
    '7
    B = Encrypt("1478583976"): CustId = "1577AMR": LTDate = DateValue("15/06/2022"): LLDATE = DateValue("31/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1577)
    '20
    B = Encrypt("1828148703"): CustId = "1700IND": LTDate = DateValue("31/07/2023"): LLDATE = DateValue("23/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1700)
    '81
    B = Encrypt("1648412838"): CustId = "1706HYD": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1706)
    '9
    B = Encrypt("1790171835"): CustId = "1756MUM":: LTDate = DateValue("31/07/2022"): LLDATE = DateValue("04/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1756)
    '10
    B = Encrypt("64089617"): CustId = "1870AMR": LTDate = DateValue("31/07/2024"): LLDATE = DateValue("02/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1870)
    '11
    B = Encrypt("1511610844"): CustId = "1873PUN": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("28/06/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1873)
    '12
    SNo2 = Encrypt("1170104781")
    B = Encrypt("1915624301"): CustId = "1876KHA": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1876)
    '13
    SNo2 = vbNullString
    B = Encrypt("691386747"): CustId = "1947GWA": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("26/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1947)
    '14
    B = Encrypt("1909303681"): CustId = "2040NGP": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("06/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2040)
    '15
    B = Encrypt("792542232"): CustId = "2050IND": LTDate = DateValue("31/07/2024"): LLDATE = DateValue("20/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2050)
    '16
    B = Encrypt("1473735094"): CustId = "2051MUM": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("16/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2051)
    '17
    B = Encrypt("879185722"): CustId = "2052UDR": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("29/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2052)
    '18
    B = Encrypt("1076057202"): CustId = "2094LIM": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("13/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2094)
    '19
    B = Encrypt("2144443054"): CustId = "2114PUN": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("06/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2114)
    '20
    B = Encrypt("1327328798"): CustId = "2116IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("29/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2116)
    '21
    B = Encrypt("823412223"): CustId = "2154BET": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("15/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2154)
    '22
    B = Encrypt("2093065127"): CustId = "2282PUN": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2282)
    '23
    B = Encrypt("1181731040"): CustId = "2285BIL": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2285)
    '24
    B = Encrypt("196133487"): CustId = "2288IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2288)
    '25
    B = Encrypt("152272023"): CustId = "2289BIL": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2289)
    '26
    B = Encrypt("1807990502"): CustId = "2290JAG": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2290)
    '27
    B = Encrypt("859079185"): CustId = "2291BUL": LTDate = DateValue("31/07/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2291)
    '28
    B = Encrypt("1098585746"): CustId = "2292KOL": LTDate = DateValue("31/07/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2292)
    '29
    B = Encrypt("1019479088"): CustId = "2303IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2303)
    '30
    B = Encrypt("1675847770"): CustId = "2304GWA": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2304)
    '31
    B = Encrypt("1243487370"): CustId = "2305IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2305)
    '32
    B = Encrypt("662094969"): CustId = "2306UJN": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2306)
    '33
    B = Encrypt("530404081"): CustId = "2607PAL": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2607)
    '34
    B = Encrypt("223738580"): CustId = "2608KOL": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2608)
    '35
    B = Encrypt("859079185"): CustId = "2609NOI": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2609)
    '36
    B = Encrypt("959893749"): CustId = "2610RTM": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2610)
    '37
    B = Encrypt("1231289826"): CustId = "2612IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2612)
    '38
    B = Encrypt("2043408307"): CustId = "2613BIA": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2613)
    '39
    B = Encrypt("1113439506"): CustId = "2614IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2614)
    '40
    B = Encrypt("1208827707"): CustId = "2615RAI": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2615)
    '41
    B = Encrypt("1177995275"): CustId = "2616GON": LTDate = DateValue("31/07/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2616)
    '42
    B = Encrypt("292643362"): CustId = "2617KOL": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2617)
    '43
    B = Encrypt("1095297816"): CustId = "2619IND": LTDate = DateValue("31/07/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2619)
    '44
    B = Encrypt("1598777187"): CustId = "2623AKL": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2623)
    
    
    
    

    
End Sub

Public Sub CL_08()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("552603785"): CustId = "14AMR": LTDate = DateValue("21/08/2021"): LLDATE = DateValue("26/03/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 14)
    '2
    B = Encrypt("1057900355"): CustId = "239CHI": LTDate = DateValue("21/08/2021"): LLDATE = DateValue("26/03/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 239)
    '3
    B = Encrypt("1276010426"): CustId = "840NGP": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("13/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 840)
    
    'B = Encrypt("1169630547"): CustId = "840-NGP": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("13/10/2018")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 840)
    '4
    B = Encrypt("390790365"): CustId = "1243KOL": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("06/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1243)
    '5
    B = Encrypt("1179242554"):: CustId = "1295BLR": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("08/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1415)
    '80
    B = Encrypt("882103373"):: CustId = "1415NEM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("08/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1415)
    '6
    B = Encrypt("881964064"): CustId = "1422IND": LTDate = DateValue("31/08/2024"): LLDATE = DateValue("27/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1422)
    '7
    B = Encrypt("367274061"): CustId = "1494NGP": LTDate = DateValue("31/07/2023"): LLDATE = DateValue("27/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1494)
    '8
    B = Encrypt("1166932235"): CustId = "1529AMR": LTDate = DateValue("14/07/2023"): LLDATE = DateValue("01/06/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1529)
    '9
    B = Encrypt("845358841"):: CustId = "1531NGP": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("20/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1531)
    '10
    B = Encrypt("829559851"): CustId = "1574IND": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("12/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1574)
    '11
    B = Encrypt("899574350"): CustId = "1575IND": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("04/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1575)
    '12
    B = Encrypt("916815704"): CustId = "1587CHI": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("20/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1587)
    '13
    B = Encrypt("882742889-"): CustId = "1590NGP": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("05/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1590)
    '14
    B = Encrypt("326660256"): CustId = "1591BTM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("05/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1591)
    '14
    B = Encrypt("520826888"): CustId = "1067IND": LTDate = DateValue("31/08/2022"): LLDATE = DateValue("05/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1591)
    '18
    B = Encrypt("1814947096"): CustId = "1592IND": LTDate = DateValue("31/08/2022"): LLDATE = DateValue("05/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1591)
    '15
    B = Encrypt("801662508"): CustId = "1593HYD": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("04/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1593)
    '17
    B = Encrypt("828990050"): CustId = "1594BUL": LTDate = DateValue("31/05/2024"): LLDATE = DateValue("10/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1594)
    '18
    B = Encrypt("98047933"): CustId = "1750BIL": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("31/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1750)
    '19
    B = Encrypt("141694476"): CustId = "1902IND": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1902)
    '20
    B = Encrypt("1494506719"): CustId = "1904BHU": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("03/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1904)
    '21
    B = Encrypt("1979177835"): CustId = "2103IND": LTDate = DateValue("31/08/2022"): LLDATE = DateValue("03/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2103)
    '22
    B = Encrypt("1257535276"): CustId = "2110IND": LTDate = DateValue("15/08/2024"): LLDATE = DateValue("01/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2110)
    '23
    B = Encrypt("625704369"): CustId = "2112KOL": LTDate = DateValue("31/08/2023"): LLDATE = DateValue("05/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2112)
    '24
    B = Encrypt("1886715692"): CustId = "2113JAG": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("05/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2113)
    '25
    B = Encrypt("1927361248"): CustId = "2124JPR": LTDate = DateValue("31/12/2023"): LLDATE = DateValue("25/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2124)
    '26
    B = Encrypt("321976596"): CustId = "2125NGP": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("03/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2125)
    '27
    B = Encrypt("1550958358"): CustId = "2129MUM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("21/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2129)
    '28
    B = Encrypt("896893417"): CustId = "2140RAI": LTDate = DateValue("30/08/2020"): LLDATE = DateValue("03/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2140)
    '29
    B = Encrypt("839927721"): CustId = "2142CHI": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("17/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2142)
    '30
    B = Encrypt("1800334173"): CustId = "2149GWA": LTDate = DateValue("31/08/2020"): LLDATE = DateValue("23/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2149)
    '31
    B = Encrypt("1109379891"): CustId = "2295IND": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2295)
    '32
    B = Encrypt("1098989837"): CustId = "2309RTM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2309)
    '33
    B = Encrypt("407367100"): CustId = "2311MND": LTDate = DateValue("31/08/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2311)
    '34
    B = Encrypt("104071022"): CustId = "2312RTM": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2312)
    '35
    B = Encrypt("1406280849"): CustId = "2314IND": LTDate = DateValue("07/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2314)
    '36
    B = Encrypt("2092154923"): CustId = "2620CHI": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2620)
    '37
    B = Encrypt("816347229"): CustId = "2621PUN": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2621)
    '38
    B = Encrypt("358693391"): CustId = "2625FA": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2625)
    '39
    B = Encrypt("1869734383"): CustId = "2629JOD": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2629)
    '40
    B = Encrypt("304330446"): CustId = "2632AHM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2632)
    '41
    B = Encrypt("384394240"): CustId = "2633KOL": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2633)
    '42
    B = Encrypt("1142488832"): CustId = "2636NGP": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2636)
    '43
    B = Encrypt("1950979205"): CustId = "2639IND": LTDate = DateValue("04/10/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2639)
    '44
    SNo2 = Encrypt("1767368502"):    SNo3 = Encrypt("1363237102")
    B = Encrypt("1149802080"): CustId = "2641AHM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2622)
    SNo2 = vbNullString:    SNo3 = vbNullString
    '45
    B = Encrypt("1149802080"): CustId = "2642AHM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2642)
    '46
    B = Encrypt("1578049158"): CustId = "2644AHM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2644)
    '47
    B = Encrypt("301440392"): CustId = "2645JOD": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2645)
    '48
    B = Encrypt("1024521088"): CustId = "2648IND": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2648)
    '49
    B = Encrypt("1287868921"): CustId = "2650AHM": LTDate = DateValue("31/08/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2650)
End Sub

Public Sub CL_09()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("945779865"): CustId = "349AUR": LTDate = DateValue("30/09/2024"): LLDATE = DateValue("07/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 349)
    '2
    B = Encrypt("1326381263"): CustId = "1401AKL": LTDate = DateValue("30/09/2024"): LLDATE = DateValue("04/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1401)
    '3
    B = Encrypt("2085466566"): CustId = "1409BIL": LTDate = DateValue("30/09/2024"): LLDATE = DateValue("04/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1409)
    '4
    B = Encrypt("1663550765"): CustId = "1414IND": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("08/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1414)
    '5
    B = Encrypt("1172320690"):: CustId = "1423PRA": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("31/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1423)
    '6
    B = Encrypt("1253632896"): CustId = "1755NAS":: LTDate = DateValue("30/09/2021"): LLDATE = DateValue("26/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1755)
    '7
    B = Encrypt("1611669874"): CustId = "1760MUR":: LTDate = DateValue("30/09/2020"): LLDATE = DateValue("05/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1760)
    '8
    B = Encrypt("497610515"): CustId = "1764KOL":: LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1764)
    '9
    B = Encrypt("1154544352"): CustId = "1777MUM":: LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1777)
    '10
    B = Encrypt("2069763034"): CustId = "1907AKL": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("26/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1907)
    '11
    B = Encrypt("338749060"): CustId = "1908IND": LTDate = DateValue("20/10/2020"): LLDATE = DateValue("11/10/2017")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1908)
    '12
    B = Encrypt("1476230540"): CustId = "1911NGP": LTDate = DateValue("20/10/2023"): LLDATE = DateValue("26/09/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1911)
    '13
    B = Encrypt("732268079"): CustId = "1924IND": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("04/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1924)
    '14
    SNo2 = Encrypt("123239045")
    B = Encrypt("972969358"): CustId = "2144DEL": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("20/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2144)
    SNo2 = vbNullString
    '15
    B = Encrypt("947671209"): CustId = "2317IND": LTDate = DateValue("10/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2317)
    '16
    B = Encrypt("122742449"): CustId = "2318NGP": LTDate = DateValue("30/09/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2318)
    '17
    B = Encrypt("53805702"): CustId = "2319IND": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2319)
    '18
    B = Encrypt("413309445"): CustId = "2322MUM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2322)
    '19
    B = Encrypt("597990152"): CustId = "2325IND": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2325)
    '20
    SNo2 = Encrypt("891753335")
    B = Encrypt("1346653927"): CustId = "2326AHM": LTDate = DateValue("30/09/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2326)
    '21
    SNo2 = vbNullString
    B = Encrypt("986167927"): CustId = "2327KHA": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2327)
    '22
    B = Encrypt("1589953493"): CustId = "2328GON": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2328)
    '23
    B = Encrypt("234861192"): CustId = "2329PUN": LTDate = DateValue("26/04/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2329)
    '24
    B = Encrypt("2113614751"): CustId = "2330KOL": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2330)
    '25
    B = Encrypt("1621183137"): CustId = "2331PUN": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2331)
    '26
    B = Encrypt("981722141"): CustId = "2332IND": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2332)
    '27
    B = Encrypt("1349779285"): CustId = "2626AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2626)
    '28
    B = Encrypt("1754535420"): CustId = "2627AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2627)
    '29
    B = Encrypt("416782850"): CustId = "2628AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2628)
    '30
    B = Encrypt("988323188"): CustId = "2630AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2630)
    '31
    B = Encrypt("1337215727"): CustId = "2631MUM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2631)
    '32
    B = Encrypt("795916721"): CustId = "2638IND": LTDate = DateValue("02/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2638)
    '33
    B = Encrypt("1618301911"): CustId = "2643AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2643)
    '34
    B = Encrypt("1132065107"): CustId = "2647AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2647)
    '35
    B = Encrypt("1000348084"): CustId = "2649PUN": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2649)
    '36
    B = Encrypt("1129798791"): CustId = "2652MUM": LTDate = DateValue("10/10/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2652)
    '37
    B = Encrypt("1017291264"): CustId = "2653MUM": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2653)
    '38
    B = Encrypt("696162279"): CustId = "2654MUM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2654)
    '39
    B = Encrypt("781249552"): CustId = "2655AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2655)
    '40
    B = Encrypt("652060942"): CustId = "2656AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2656)
    '41
    B = Encrypt("986562691"): CustId = "2660DHU": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2660)
    '42
    B = Encrypt("988323188"): CustId = "2661AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2661)
    '43
    B = Encrypt("1364634923"): CustId = "2662AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2662)
    '44
    B = Encrypt("1200390859"): CustId = "2663DUB": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2663)
    '45
    B = Encrypt("2070110305"): CustId = "2664NGP": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2664)
    '46
    B = Encrypt("2136776853"): CustId = "2666AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2666)
    '47
    B = Encrypt("317348680"): CustId = "2668AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2668)
    '48
    B = Encrypt("523229506"): CustId = "2670AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2670)
    '49
    B = Encrypt("451586247"): CustId = "2671AHM": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1489563623"): CustId = "2687DEL": LTDate = DateValue("30/12/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1885330426"): CustId = "2688DEL": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    SNo2 = "1377926035"
    B = Encrypt("1634130623"): CustId = "SHUBH-IND": LTDate = DateValue("30/09/2029"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    
    '49
    B = Encrypt("532124513"): CustId = "2123SHA": LTDate = DateValue("20/01/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("543008064"): CustId = "GUR-IND": LTDate = DateValue("30/08/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1400754370"): CustId = "ROM-UJN": LTDate = DateValue("15/12/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1125912611"): CustId = "ABH-IND": LTDate = DateValue("31/12/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1746233536"): CustId = "JYT-AHM": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1365531539"): CustId = "SN-NGP": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1219459978"): CustId = "JB-MUM": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '49
    B = Encrypt("1640777602"): CustId = "KRI-IND": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
     B = Encrypt("1803909265"): CustId = "AMI-IND": LTDate = DateValue("06/06/2022"): LLDATE = DateValue("01/07/2019")
         Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
      '707249309
      SNo2 = "1713138570"
    B = Encrypt("1713138270"): CustId = "SANT2-IND": LTDate = DateValue("15/01/2022"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("588291306"): CustId = "KRISH-KOL": LTDate = DateValue("15/01/2022"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
     B = Encrypt("1351085008"): CustId = "NIT-RAI": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
         Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("945779865"): CustId = "KIR2-AUR": LTDate = DateValue("31/12/2022"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1446688813"): CustId = "NIN-MUM": LTDate = DateValue("01/03/2022"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
        
    B = Encrypt("840155301"): CustId = "PRA-RJN": LTDate = DateValue("15/01/2023"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
        
    B = Encrypt("147986477"): CustId = "MOT-FA": LTDate = DateValue("15/04/2024"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
        
    B = Encrypt("889065492"): CustId = "DESH-MAT": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)

    B = Encrypt("1620915723"): CustId = "76IND": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("2130762321"): CustId = "SUN-RTM": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
        Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("45987654"): CustId = "AUT-IND": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("287292844"): CustId = "AVT-KOL": LTDate = DateValue("31/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1261176095"): CustId = "ARN-BIK": LTDate = DateValue("28/02/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("5429757"): CustId = "JAY-GON": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1333161181"): CustId = "SK-JAI": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    '2199KOP OLD CODE
    B = Encrypt("688556747"): CustId = "2199SHD": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("823412223"): CustId = "2155-BET": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("2141016886"): CustId = "SUM-MOR": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)

    B = Encrypt("968183643"): CustId = "HAR-DAV": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1137147846"): CustId = "MAD-MUM": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1454813544"): CustId = "SGR-RAI": LTDate = DateValue("31/03/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("296702801"): CustId = "PAP-MUM": LTDate = DateValue("31/03/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1365531539"): CustId = "2702NGP": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("2035031886"): CustId = "YOG-SRM": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("849449154"): CustId = "KUB-WHM": LTDate = DateValue("28/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("112905912"): CustId = "VIK-DHR": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("377713009"): CustId = "SAT-IND": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1411704659"): CustId = "MOFX-MUM": LTDate = DateValue("30/04/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("266004372"): CustId = "MYR-RJT": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1285841975"): CustId = "BLU-IND": LTDate = DateValue("28/02/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("738310096"): CustId = "JIM-MUM": LTDate = DateValue("30/04/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)

    B = Encrypt("1644001021"): CustId = "ZKR-PRA": LTDate = DateValue("31/03/2024"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("648217895"): CustId = "AS-MUM": LTDate = DateValue("10/05/2023"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("767479550"): CustId = "NEHA-IND": LTDate = DateValue("15/04/2022"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("597814812"): CustId = "SHR-MUM": LTDate = DateValue("30/04/2024"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)
    
    B = Encrypt("1511610844"): CustId = "AMN-IND": LTDate = DateValue("31/05/2022"): LLDATE = DateValue("30/04/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2671)


    
End Sub

Public Sub CL_10()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    '1
    B = Encrypt("451567623"): CustId = "790KOL": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 790)
    '2
    B = Encrypt("270577833"): CustId = "931KOL": LTDate = "31/10/2023": LLDATE = DateValue("02/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 931)
    '3
    B = Encrypt("280096199"): CustId = "1346IND": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("29/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1346)
    '4
    B = Encrypt("913736611"):: CustId = "1416URA": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("20/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1416)
    '5
    B = Encrypt("619706488"): CustId = "1581IND": LTDate = DateValue("31/10/2022"): LLDATE = DateValue("20/07/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1581)
    '6
    B = Encrypt("404533046"): CustId = "1601BIK": LTDate = DateValue("30/09/2023"): LLDATE = DateValue("05/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1601)
    '7
    B = Encrypt("1525140333"): CustId = "1678BAW": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("17/08/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1678)
    '8
    B = Encrypt("523413646"): CustId = "1779GWA": LTDate = DateValue("31/10/2023"): LLDATE = DateValue("16/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1779)
    '9
    B = Encrypt("1657950122"): CustId = "1781RTM":: LTDate = DateValue("31/10/2023"): LLDATE = DateValue("06/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1781)
    '10
    B = Encrypt("1064664538"): CustId = "1926KOL": LTDate = DateValue("30/10/2020"): LLDATE = DateValue("01/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1926)
    '11
    B = Encrypt("1839265260"): CustId = "1934IND": LTDate = DateValue("31/10/2020"): LLDATE = DateValue("14/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1934)
    '12
    B = Encrypt("648217895"): CustId = "1936MUM": LTDate = DateValue("31/10/2022"): LLDATE = DateValue("12/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1936)
    '13
    B = Encrypt("1213806943"): CustId = "1939PUN": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("30/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1939)
    '14
    B = Encrypt("299005259"): CustId = "2148MUM": LTDate = DateValue("31/10/2024"): LLDATE = DateValue("17/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2148)
    
    B = Encrypt("172425366"): CustId = "1610MUM": LTDate = DateValue("15/04/2022"): LLDATE = DateValue("17/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2148)
    '15
    B = Encrypt("166469441"): CustId = "2151HYD": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("09/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2151)
    '16
    B = Encrypt("358119951"): CustId = "2156MUM": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("17/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2156)
    '17
    B = Encrypt("139756145"): CustId = "2158IND": LTDate = DateValue("30/11/2023"): LLDATE = DateValue("04/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2158)
    '18
    B = Encrypt("1927311885"): CustId = "1850IND": LTDate = DateValue("10/08/2021"): LLDATE = DateValue("04/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2158)
    
    B = Encrypt("187729658"): CustId = "2159MUM": LTDate = DateValue("31/10/2024"): LLDATE = DateValue("03/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2159)
    
    B = Encrypt(""): CustId = "2225UDR": LTDate = DateValue("28/10/2021"): LLDATE = DateValue("04/03/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2225)
    '19
    
    B = Encrypt("532729151"): CustId = "2333HYD": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2333)
    '20
    
    B = Encrypt("660201997"): CustId = "2337RAI": LTDate = DateValue("31/10/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2337)
    '21
    B = Encrypt("467834928"): CustId = "2338MUM": LTDate = DateValue("31/10/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2338)
    '22
    B = Encrypt("58303505"): CustId = "2339KOL": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2339)
    '23
    B = Encrypt("1388565974"): CustId = "2340NIZ": LTDate = DateValue("31/10/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2340)
    '24
    B = Encrypt("1895218890"): CustId = "2350NEM": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2350)
    '25
    B = Encrypt("738310096"): CustId = "2672JPR": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2672)
    
    B = Encrypt(""): CustId = "2673AHM": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2673)
    
    B = Encrypt(""): CustId = "2674KOL": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2674)
    
    B = Encrypt("1895154678"): CustId = "2676IND": LTDate = DateValue("31/10/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2676)
    
    
    
End Sub

Public Sub CL_11()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    SNo2 = vbNullString
    
    '1
    B = Encrypt("1370193130"): CustId = "1293AUR": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("06/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1293)
    '2
    B = Encrypt("1947912436"): CustId = "1441IND": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("30/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1441)
    '3
    
    B = Encrypt("1511610844"): CustId = "1442KOL": LTDate = DateValue("30/09/2022"): LLDATE = DateValue("06/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1442)
    '4
    B = Encrypt("2147191593"): CustId = "1506MUM":: LTDate = DateValue("30/11/2020"): LLDATE = DateValue("31/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1506)
    '5
    B = Encrypt("1239293475"): CustId = "1538IND": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("22/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1538):
    '6
    B = Encrypt("128946609"): CustId = "1615CHI": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("30/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1615)
    '7
    B = Encrypt("580597201"): CustId = "1616KHG": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("06/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1616)
    '8
    B = Encrypt("102159480"): CustId = "1619IND":: LTDate = DateValue("05/12/2023"): LLDATE = DateValue("29/11/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1619)
    '9
    B = Encrypt("1071561486"): CustId = "1621MUM":: LTDate = DateValue("30/11/2021"): LLDATE = DateValue("03/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1621)
    '10
    B = Encrypt("765614967"): CustId = "1784DHU": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("03/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1784)
    '11
    B = Encrypt("122801821"): CustId = "1792GWA": LTDate = DateValue("30/11/2023"): LLDATE = DateValue("05/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1792)
    '12
    B = Encrypt("1984858581"): CustId = "1956KHA": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1956)
    '13
    B = Encrypt("1909303681"): CustId = "2162BAG": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("17/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2162)
    '14
    B = Encrypt("1152430283"): CustId = "2174NGP": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("17/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2174)
    '15
    B = Encrypt("565923666"): CustId = "2175AHM": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("24/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2175)
    '16
    B = Encrypt("1933320925"): CustId = "2178AHM": LTDate = DateValue("30/11/2021"): LLDATE = DateValue("24/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2178)
    '17
    B = Encrypt("1228384969"): CustId = "2179IND": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("24/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2179)
    '18
    B = Encrypt("1564346771"): CustId = "2353IND": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2353)
    '19
    B = Encrypt("2055228182"): CustId = "2354NGP": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2354)
    '20
    B = Encrypt("1727232657"): CustId = "2355BUL": LTDate = DateValue("30/04/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2355)
    '21
    B = Encrypt("1659048907"): CustId = "2362IND": LTDate = DateValue("30/11/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2362)
    '22
    B = Encrypt("1101974315"): CustId = "2363AHM": LTDate = DateValue("30/11/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2363)
    '23
    B = Encrypt("402544111"): CustId = "2364MUM": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2364)
    '24
    B = Encrypt("1286869473"): CustId = "2365NGP": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2365)
    '25
    B = Encrypt("599540695"): CustId = "2366IND": LTDate = DateValue("30/11/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2366)
    '26
    B = Encrypt(""): CustId = "2367JAB": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2367)
    '27
    B = Encrypt("1066841168"): CustId = "2368IND": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2368)
    '28
    B = Encrypt("858005749"): CustId = "2369KOL": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2369)
    '29
    B = Encrypt("1307076641"): CustId = "2371IND": LTDate = DateValue("30/11/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2371)
    
    B = Encrypt("773301354"): CustId = "2681PUN": LTDate = DateValue("30/11/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2381)

    
End Sub

Public Sub CL_12()


    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    
    B = vbNullString: CustId = vbNullString: SNo2 = vbNullString: SNo3 = vbNullString: LLDATE = DateValue("01/01/2000")
    Dim SNo4 As String
    
    '1
    B = Encrypt("2142538710"): CustId = "893BUL": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("02/05/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 893)
    '2
    SNo2 = vbNullString
    B = Encrypt("504810823"): CustId = "1102JBL": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("19/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1102)
    '3
    B = Encrypt("1276914726"): CustId = "1115MUR": LTDate = DateValue("10/01/2024"): LLDATE = DateValue("02/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1115)
    SNo2 = Encrypt("510813262"): SNo3 = Encrypt("687923557"): SNo4 = Encrypt("1152430283")
    '4
    B = Encrypt("941826965"): CustId = "1274NGP":: LTDate = DateValue("31/12/2020"): LLDATE = DateValue("14/01/2019")
    'Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1274)
    mysql = "INSERT INTO SYSTNO (CUSTID,SERIALNO,REGNO2,REGNO3,REGNO4,TDATE,LDATE,CCODE)"
    mysql = mysql & " VALUES ('" & CustId & "','" & B & "','" & SNo2 & " ','" & SNo3 & "','" & SNo4 & "','" & Format(LTDate, "YYYY/MM/DD") & "','" & Format(LLDATE, "YYYY/MM/DD") & "',1274)"
    MCnn.Execute mysql
    SNo2 = vbNullString:    SNo3 = vbNullString:    SNo4 = vbNullString
    '5
    SNo2 = Encrypt("1957564422")
    B = Encrypt("398416570"): CustId = "1451KOL": LTDate = DateValue("31/12/2022"): LLDATE = DateValue("18/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1451)
    SNo2 = vbNullString
    '6
    B = Encrypt("354133923"): CustId = "1465AUR": LTDate = DateValue("31/12/2023"): LLDATE = DateValue("31/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1465)
    '7
    B = Encrypt("1901683550"): CustId = "1474KHC": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("19/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1474)
    '8
    B = Encrypt("44724998"): CustId = "1523DHM": LTDate = DateValue("31/12/2022"): LLDATE = DateValue("14/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1523)
    '9
    B = Encrypt("1049932241"): CustId = "1624AUR":: LTDate = DateValue("31/12/2020"): LLDATE = DateValue("16/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1624)
    '10
    B = Encrypt("841431664"): CustId = "1634NGP":: LTDate = DateValue("31/12/2020"): LLDATE = DateValue("27/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1634)
    '11
    SNo2 = Encrypt("1090798675")
    B = Encrypt("1379521920"): CustId = "1637IND":: LTDate = DateValue("31/12/2020"): LLDATE = DateValue("27/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1637)
    '12
    SNo2 = vbNullString
    B = Encrypt("57009862"): CustId = "1641KOL": LTDate = DateValue("31/12/2023"): LLDATE = DateValue("02/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1641)
    '13
    SNo2 = Encrypt("1964579184")
    B = Encrypt("653823817"): CustId = "1787JHN": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("10/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1787)
    '14
    SNo2 = vbNullString
    B = Encrypt("1687084294"): CustId = "1791NAS": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("22/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1791)
    '15
    B = Encrypt("1301758447"): CustId = "1922NGP": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("04/10/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1922)
    '16
    B = Encrypt("140962470"): CustId = "1951LAT": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("06/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1951)
    '17
    B = Encrypt("673083618"): CustId = "1952KHD": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("05/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1952)
    '18
    B = Encrypt("814164782"): CustId = "1954NGP": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("02/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1954)
    '19
    B = Encrypt("432765953"): CustId = "1957UNJ": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("05/01/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1957)
    '20
    B = Encrypt("130585771"): CustId = "1959IND": LTDate = DateValue("31/12/2023"): LLDATE = DateValue("31/12/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 1959)
    '21
    B = Encrypt("632624294"): CustId = "2180IND": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("08/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2180)
    '22
    B = Encrypt("838742539"): CustId = "2184IND": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("03/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2184)
    '23
    B = Encrypt("2032311647"): CustId = "2185MUM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("15/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2185)
    '24
    B = Encrypt("1857031010"): CustId = "2194BAG": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("10/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2194)
    '25
    B = Encrypt("479957366"): CustId = "2196RTM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("22/01/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2196)
    '26
    B = Encrypt("1139713205"): CustId = "2208IND": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("09/02/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2208)
    '27
    B = Encrypt("1143450762"): CustId = "2346IND": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("06/04/2018")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2346)
    '28
    B = Encrypt("1089531942"): CustId = "2370IND": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2370)
    '29
    B = Encrypt("439194317"): CustId = "2372HYD": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2372)
    '30
    B = Encrypt("672440319"): CustId = "2373BUL": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2373)
    '31
    B = Encrypt("1143450762"): CustId = "2374IND": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2374)
    '32
    B = Encrypt("270382864"): CustId = "2375MUM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2375)
    '33
    B = Encrypt("1091392746"): CustId = "2376HYD": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2376)
    '34
    B = Encrypt("1091392746"): CustId = "2379LIM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2379)
    '35
    B = Encrypt("1511446334"): CustId = "2380AKL": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2380)
    '36
    B = Encrypt("1432087193"): CustId = "2381IND": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2381)
    '37
    B = Encrypt("1831758152"): CustId = "2382RTM": LTDate = DateValue("31/12/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2382)
    '38
    B = Encrypt("320793016"): CustId = "2383BHO": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2383)
    '39
    B = Encrypt("1259163969"): CustId = "2384MUM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2384)
    '40
    B = Encrypt("1697216135"): CustId = "2385AUR": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2385)
    '41
    B = Encrypt("2107842413"): CustId = "2386CHN": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2386)
    '42
    B = Encrypt("1849332689"): CustId = "2387MUM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2387)
    '43
    B = Encrypt("1395855833"): CustId = "2388IND": LTDate = DateValue("30/09/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2388)
    '44
    SNo2 = "17131383570"
    B = Encrypt("699497272"): CustId = "2389GWA": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2389)
    '45
    B = Encrypt("2055228182"): CustId = "2394NGP": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2394)
    '46
    B = Encrypt("2453338830"): CustId = "2395MUR": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2395)
    '47
    B = Encrypt("452804093"): CustId = "2396GWA": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2396)
    '48
    B = Encrypt(""): CustId = "2401IND": LTDate = DateValue("31/05/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2401)
    
    B = Encrypt("520120826"): CustId = "KUBER": LTDate = DateValue("15/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2401)
    
    B = Encrypt("1625551091"): CustId = "2682MUM": LTDate = DateValue("31/12/2020"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("2006164595"): CustId = "MUK-RAK": LTDate = DateValue("31/12/2021"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("192767211"): CustId = "2307NGP": LTDate = DateValue("15/01/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)

End Sub
Public Sub CL_100()
    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
    '1
    B = Encrypt("1724777803"): CustId = "RHT-RAI": LTDate = DateValue("30/07/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '2
    B = Encrypt("2130958954"): CustId = "VIK-IND": LTDate = DateValue("15/10/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '3
    B = Encrypt("935907734"): CustId = "HAM-MUM": LTDate = DateValue("25/12/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '4
    B = Encrypt("1000810344"): CustId = "HAM2-MUM": LTDate = DateValue("25/11/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    '5
    B = Encrypt("156191185"): CustId = "BAL-PUN": LTDate = DateValue("15/11/2022"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    '6
    B = Encrypt("1982572117"): CustId = "PRM-MUM": LTDate = DateValue("05/05/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '7
    B = Encrypt("345517715"): CustId = "MHU-KHJ": LTDate = DateValue("15/04/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '8
    B = Encrypt("2144564916"): CustId = "BLJ-MUM": LTDate = DateValue("04/07/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '9
    B = Encrypt("907770133"): CustId = "SAG-DEL": LTDate = DateValue("20/11/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '10
    B = Encrypt("298244941"): CustId = "CHN-AHM": LTDate = DateValue("06/12/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '11
    B = Encrypt("77570788"): CustId = "MDV-IND": LTDate = DateValue("02/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '12
    B = Encrypt("61066959"): CustId = "JAI-KOL": LTDate = DateValue("07/12/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '13
    B = Encrypt("585769600"): CustId = "HRH-GWL": LTDate = DateValue("06/12/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '14
    B = Encrypt("466978566"): CustId = "RIT-DHR": LTDate = DateValue("26/12/2023"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '15
    B = Encrypt("237169324"): CustId = "MAN-MUM": LTDate = DateValue("03/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '16
    B = Encrypt("775986568"): CustId = "ROH-GWA": LTDate = DateValue("06/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    '17
    B = Encrypt("1728385030"): CustId = "SAK-MUM": LTDate = DateValue("14/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    '18
    B = Encrypt("1084073849"): CustId = "WLT-BHO": LTDate = DateValue("10/04/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '19
    B = Encrypt("512113954"): CustId = "KAM-RTM": LTDate = DateValue("17/02/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '20
    B = Encrypt("448244988"): CustId = "SAN-RJT": LTDate = DateValue("03/04/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '21
    B = Encrypt("1265522747"): CustId = "VY-IND": LTDate = DateValue("04/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '22
    B = Encrypt("201170113"): CustId = "JGM-FA": LTDate = DateValue("26/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '23
    B = Encrypt("435117158"): CustId = "PKJ-PUN": LTDate = DateValue("21/03/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '24
    B = Encrypt("789178628"): CustId = "PRS-PUN": LTDate = DateValue("10/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '25
    B = Encrypt("1122904117"): CustId = "SRT-AKL": LTDate = DateValue("08/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    '26
    B = Encrypt("1070535820"): CustId = "SUN-MUM": LTDate = DateValue("11/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    '27
    B = Encrypt("247210020"): CustId = "ASH-RAT": LTDate = DateValue("10/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '28
    B = Encrypt("122801821"): CustId = "MHV-MUM": LTDate = DateValue("09/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '28
    B = Encrypt("1271184024"): CustId = "BHR-MUM": LTDate = DateValue("09/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)

    '29
    B = Encrypt("1425910244"): CustId = "RSH-GAG": LTDate = DateValue("06/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)

    '30
    B = Encrypt("193781987"): CustId = "2322MUM": LTDate = DateValue("12/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '29
    B = Encrypt("2116941339"): CustId = "ANUJ-GAG": LTDate = DateValue("18/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    '29
    B = Encrypt("688942439"): CustId = "BR-DAT": LTDate = DateValue("12/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)


End Sub
Public Sub CL_101()


    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
1
    B = Encrypt("247210020"): CustId = "ASH-RAT": LTDate = DateValue("10/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
2
    B = Encrypt("1758772986"): CustId = "MHV-MUM": LTDate = DateValue("09/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
3
    B = Encrypt("1862832477"): CustId = "VISH-RAI": LTDate = DateValue("29/05/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
4
    B = Encrypt("2144414973"): CustId = "BAL-KOL": LTDate = DateValue("23/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1795829997"): CustId = "GLD-DEL": LTDate = DateValue("10/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("837318439"): CustId = "2827IND": LTDate = DateValue("10/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("608842888"): CustId = "2303IND": LTDate = DateValue("10/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("111378281"): CustId = "BRO2-CHE": LTDate = DateValue("27/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("118915062"): CustId = "NIK-NGP": LTDate = DateValue("07/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1372627855"): CustId = "YOG-MUM": LTDate = DateValue("10/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1983429692"): CustId = "PNK-IND": LTDate = DateValue("14/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("982297982"): CustId = "DRS-JAM": LTDate = DateValue("13/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1694900741"): CustId = "MEH-MUM": LTDate = DateValue("11/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("2030280513"): CustId = "MOH-GAG": LTDate = DateValue("10/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1400977402"): CustId = "PGA-MUM": LTDate = DateValue("22/07/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
   
    B = Encrypt("1710535560"): CustId = "ANUJ-PUN": LTDate = DateValue("23/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)

    B = Encrypt("2130992"): CustId = "SONU-FER": LTDate = DateValue("20/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("207942363"): CustId = "ANI-DEL": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("66005216"): CustId = "SUR-BAL": LTDate = DateValue("30/06/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("2144296614"): CustId = "GAN-IND": LTDate = DateValue("07/08/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1793756007"): CustId = "TWN-IND": LTDate = DateValue("10/01/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
    
    B = Encrypt("1641666136"): CustId = "SYM-KOL": LTDate = DateValue("03/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)

'     Dubai
End Sub

Public Sub CL_SEP23()


    Dim B As String:       Dim SNo2 As String:    Dim SNo3 As String:    Dim CustId As String:  Dim LTDate As Date: Dim LLDATE   As Date
1
    B = Encrypt("353547124"): CustId = "MAH-KOL": LTDate = DateValue("05/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2682)
2
    B = Encrypt("417805137"): CustId = "SVM-KHJ": LTDate = DateValue("08/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
3
    B = Encrypt("1300543836"): CustId = "JAI-AHM": LTDate = DateValue("08/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
4
    B = Encrypt("1417142739"): CustId = "SKR-RAI": LTDate = DateValue("04/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
5
    B = Encrypt("1159614439"): CustId = "JMD2-AHM": LTDate = DateValue("24/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
6
    B = Encrypt("122801821"): CustId = "JMD-AHM": LTDate = DateValue("24/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1960701040"): CustId = "KPH-MUM": LTDate = DateValue("25/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("620577012"): CustId = "RCY-MUM": LTDate = DateValue("25/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1658550929"): CustId = "ROH-MUM": LTDate = DateValue("26/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("730097826"): CustId = "JBL-MUM": LTDate = DateValue("18/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)

    B = Encrypt("678092997"): CustId = "MAR-AHM": LTDate = DateValue("14/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("443567635"): CustId = "SDJ-MAT": LTDate = DateValue("16/09/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("751969422"): CustId = "SKB-KOL": LTDate = DateValue("03/11/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("308915787"): CustId = "BAB-KOL": LTDate = DateValue("02/11/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("1904874090"): CustId = "RAM-SRT": LTDate = DateValue("28/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("4103912"): CustId = "RNK-PRA": LTDate = DateValue("20/10/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
    
    B = Encrypt("792542232"): CustId = "VPL-MUM": LTDate = DateValue("18/12/2024"): LLDATE = DateValue("01/07/2019")
    Call PInsert_SystNo(B, CustId, SNo2, SNo3, "N", LTDate, LLDATE, 2570)
End Sub



'Public Sub API_TEST()
''
'Dim objWinHTTP
'Set objWinHTTP = CreateObject("WinHttp.WinHttpRequest.5.1")
'
'
'    objWinHTTP.Open "PUT", "https://localhost:5001/api/?department=DDBB&changenumber=1337&isNew=1"
'    objWinHTTP.SetTimeouts 5000, 5000, 5000, 5000
'
'
'    Call objWinHTTP.Send(psData)
'    MsgBox (objWinHTTP.Status)
'    If objWinHTTP.Status <> 200 Then
'
'    MsgBox ("Something went wrong.")
'
'    End If
'
'End Sub

'Private objWinHTTP As WinHttp.WinHttpRequest

Public Sub Send_Telegram(LTUserId As String, LTAccessHash As String, ltfilepath As String, ltfilename As String)
      If Len(Trim(GEmail)) <= 0 Then
        Call Send_Document(LTUserId, LTAccessHash, ltfilepath)
      Else
        Call send_whatsup(LTUserId, ltfilepath, ltfilename)
      End If
      
     'Dim data
    ''Set rawData = 0
    'Dim base64
    ''Set base64 = Convert.ToBase64String(rawData)
    'Dim objWinHTTP
    'Set objWinHTTP = CreateObject("WinHttp.WinHttpRequest.5.1")
    'Dim LSTR As String
    'With objWinHTTP
       
         
        '.Open "GET", "http://127.0.0.1:5000/telegram_send_file", Async:=False
         'LSTR = "http://127.0.0.1:5000/telegram_send_file?user_id=" & LTUserId & "&access_hash=" & LTAccessHash & "&file_path=" & LTFilePath & ""
        '.Open "GET", "http://127.0.0.1:5000/telegram_send_file?user_id=" & LTUserId & "&access_hash=" & LTAccessHash & "&file_path=" & LTFilePath & "", Async:=False
        '.Open "GET", "https://api.telegram.org/bot5898123695:AAF5So0_cLN31mvEiE5131vCXNjg1QA4ZxQ/sendMessage?chat_id=" & LTUserId & "&text=Hello%20yes;", Async:=False
        '.Open "GET", "https://api.telegram.org/bot5898123695:AAF5So0_cLN31mvEiE5131vCXNjg1QA4ZxQ/sendDocument?chat_id=" & LTUserId & "&document=" & base64, Async:=False
        
       
        
        'http://127.0.0.1:5000/telegram_send_file?user_id=1454491022&access_hash=-710179035315170840&file_path=H:\\tmp\test.txt
'        'http://127.0.0.1:5000/telegram_send_file?user_id=1454491022&access_hash=-710179035315170840&file_path=H:\\tmp\test.txt
        '.SetRequestHeader "Content-Type", "application/hal+json"
        '.SetRequestHeader "Accept", "text/*, application/hal+json, application/json"
'        'Note: Normally you don't include all of this whitespace, but
'        'we'll use it in this example:
        '.SetTimeouts 5000, 5000, 5000, 5000
        '.send
        '.Send "{" & vbCrLf _
            & """Client"": ""YYYA""," & vbCrLf _
'            & """Platforms"":  []," & vbCrLf _
'            & """ProgramIdentifier"": """"," & vbCrLf _
'            & """MapToEnterpriseView"": ""true""," & vbCrLf _
'            & """ParticipantRequest"": {" & vbCrLf _
'            & "   ""FirstName"" : """"," & vbCrLf _
'            & "   ""LastName"": ""Test""" & vbCrLf _
'            & "}" & vbCrLf _
'            & "}"
    '    GETMAIN.Label1.Caption = CStr(.Status) & " " & .StatusText & vbNewLine _
    '                   & .GetAllResponseHeaders() & vbNewLine _
    '                   & String$(40, "-") & vbNewLine _
    '                   & .responseText
    'End With
End Sub

Public Sub Send_Document(LTUserId As String, LTAccessHash As String, ltfilepath As String)
    Const url = "https://api.telegram.org/bot"
    'Const TOKEN = "6123150746:AAFopigeSmmh-hh_IswWAaXFxpqSMSmp_fs"
    '
    'Const TOKEN = "5609301787:AAHYfD3m9qixQaLUG_9HGIuL6vyQ754j7vE"
     'Const TOKEN = "1"

    If Len(ltfilepath) <= 0 Then
        Exit Sub
    End If
    Const METHOD_NAME = "/sendDocument?"
    
    Dim CHAT_ID As String
     CHAT_ID = Trim(LTUserId)

    Dim FOLDER As String
     FOLDER = ltfilepath
     
     Dim DOCUMENT_FILE As String
     'DOCUMENT_FILE = LTFilePath
    Dim arrSplitStrings1() As String
     arrSplitStrings1 = Split(ltfilepath, "\")
     DOCUMENT_FILE = arrSplitStrings1(UBound(arrSplitStrings1, 1))
     
    
    Dim data As Object, key
    Set data = CreateObject("Scripting.Dictionary")
    data.Add "chat_id", CHAT_ID
    
    ' generate boundary
    Dim BOUNDARY, s As String, n As Integer
    For n = 1 To 16: s = s & Chr(65 + Int(Rnd * 25)): Next
    BOUNDARY = s & CDbl(Now)

    Dim part As String, ado As Object
    For Each key In data.Keys
        part = part & "--" & BOUNDARY & vbCrLf
        part = part & "Content-Disposition: form-data; name=""" & key & """" & vbCrLf & vbCrLf
        part = part & data(key) & vbCrLf
    Next
    ' filename
    part = part & "--" & BOUNDARY & vbCrLf
    part = part & "Content-Disposition: form-data; name=""document""; filename=""" & DOCUMENT_FILE & """" & vbCrLf & vbCrLf
    
    ' read document file as binary
    Dim doc
    Set ado = CreateObject("ADODB.Stream")
    ado.Type = 1 'binary
    ado.Open
    ado.LoadFromFile FOLDER
    ado.Position = 0
    doc = ado.Read
    ado.Close

    ' combine part, document, end
    ado.Open
    ado.Position = 0
    ado.Type = 1 ' binary
    ado.Write ToBytes(part)
    ado.Write doc
    ado.Write ToBytes(vbCrLf & "--" & BOUNDARY & "--")
    ado.Position = 0

    Dim req As Object, reqURL As String
    Set req = CreateObject("MSXML2.XMLHTTP")
    reqURL = url & Trim(GSrvRegNo) & METHOD_NAME
    With req
        .Open "POST", reqURL, False
        .setRequestHeader "Content-Type", "multipart/form-data; boundary=" & BOUNDARY
        .send ado.Read
        'MsgBox .responseText
    End With

End Sub

Function ToBytes(str As String) As Variant

    Dim ado As Object
    Set ado = CreateObject("ADODB.Stream")
    ado.Open
    ado.Type = 2 ' text
    ado.Charset = "_autodetect"
    ado.WriteText str
    ado.Position = 0
    ado.Type = 1
    ToBytes = ado.Read
    ado.Close

End Function



Public Sub INSERT_PROC()

    On Error GoTo err1
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_SAUDAMAST') DROP PROCEDURE INSERT_SAUDAMAST"
    mysql = " CREATE PROCEDURE INSERT_SAUDAMAST @MC_CODE INT ,@SAUDACODE VARCHAR(50),@SAUDANAME VARCHAR(50),@ITEMCODE VARCHAR(20),@MATURITY SMALLDATETIME,"
    mysql = mysql & " @TRADEABLELOT FLOAT,@BROKLOT FLOAT,@NOCODE INT,@INSTTYPE VARCHAR(3),@OPTTYPE VARCHAR(2),@STRIKEPRICE FLOAT,@EXCODE VARCHAR(10),@REFLOT FLOAT,@EXID INT,@ITEMID INT"
    mysql = mysql & " AS SET NOCOUNT ON INSERT INTO SAUDAMAST"
    mysql = mysql & "        ( COMPCODE, SAUDACODE, SAUDANAME, ITEMCODE, MATURITY, TRADEABLELOT, BROKLOT, NOCODE, INSTTYPE, OPTTYPE, STRIKEPRICE, EXCODE, REFLOT,EXID,ITEMID)"
    mysql = mysql & " VALUES (@MC_CODE ,@SAUDACODE,@SAUDANAME,@ITEMCODE,@MATURITY,@TRADEABLELOT,@BROKLOT,@NOCODE,@INSTTYPE,@OPTTYPE,@STRIKEPRICE,@EXCODE,@REFLOT,@EXID,@ITEMID)"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_BILLSUM') DROP PROCEDURE INSERT_BILLSUM "
    mysql = "CREATE PROC INSERT_BILLSUM  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " TRUNCATE TABLE BILLSUM "
    mysql = mysql & " INSERT INTO BillSum (PARTY,NAME,CONTRACT,OPENQTY,OPENRATE,OPENAMT,BUYQTY,BUYRATE,SELLQTY,SELLRATE,CLOSEQTY,LTP,GROSSMTM,BROKAMT,MARGINAMT,EXCODE,BUYAMT,SELLAMT,CALVAL  )"
    mysql = mysql & " SELECT B.Party,A.Name,S.SAUDACODE AS  CONTRACT, B.OPQTY,B.OPRATE, B.OPAMT AS OPENAMT,B.BUYQTY,B.BUYRATE, B.SELLQTY,B.SELLRATE, B.CLQTY AS CLOSEQTY"
    mysql = mysql & ",B.CLRATE AS LTP,"
    mysql = mysql & " (B.OPAMT)+(B.BUYAMT*-1)+B.SELLAMT+(B.CLAMT) as GrossMTM ,B.BROKAMT,"
    mysql = mysql & " CASE WHEN MARGIN <1 THEN abs(B.CLQTY)*B.CLRATE*B.CALVAL*B.MARGIN WHEN MARGIN >=1 THEN abs(B.CLQTY)* MARGIN END  AS MarginAmt,S.EXCODE ,B.BUYAMT,B.SELLAMT,B.CALVAL "
    mysql = mysql & " FROM ACCOUNTM AS A, BILLSUMREC AS B , SAUDAMAST AS S "
    mysql = mysql & " WHERE A.AC_CODE = B.PARTY And S.SAUDAID = B.SAUDAID  "
    mysql = mysql & " UPDATE BILLSUM SET NETQTY = BUYQTY-SELLQTY "
    mysql = mysql & " UPDATE BILLSUM SET NETQTY = 0 WHERE BUYQTY=SELLQTY "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(SELLAMT-BUYAMT)/ ( ABS(NETQTY) * CALVAL) WHERE BUYQTY <> 0 AND SELLQTY<>0  AND NETQTY<>0 "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(SELLAMT-BUYAMT)/ ( ABS(BUYQTY) * CALVAL) WHERE BUYQTY <> 0 AND SELLQTY<>0  AND NETQTY=0 "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(BUYAMT)/ ( ABS(NETQTY) *  CALVAL)  WHERE BUYQTY <>0 AND SELLQTY=0 "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(SELLAMT)/ ( ABS(NETQTY) * CALVAL) WHERE BUYQTY =0 AND SELLQTY<>0 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_BILLSUM2') DROP PROCEDURE INSERT_BILLSUM2 "
    mysql = "CREATE PROC INSERT_BILLSUM2  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " TRUNCATE TABLE BILLSUM "
    mysql = mysql & " INSERT INTO BillSum (ACCID,NAME,CONTRACT,OPENQTY,OPENRATE,OPENAMT,BUYQTY,BUYRATE,SELLQTY,SELLRATE,CLOSEQTY,LTP,GROSSMTM,BROKAMT,EXCODE,BUYAMT,SELLAMT,CALVAL,SAUDAID  )"
    mysql = mysql & " SELECT A.ACCID ,A.Name, S.SAUDACODE AS  CONTRACT, B.OPQTY,B.OPENRATE, B.OPAMT AS OPENAMT,B.BUYQTY,B.BUYRATE, B.SELLQTY,B.SELLRATE, B.CLQTY AS CLOSEQty"
    mysql = mysql & ",B.CLRATE AS LTP,"
    mysql = mysql & " (B.sellamt - B.opamt - B.buyamt + B.clamt) as GrossMTM ,B.BROKAMT,"
    mysql = mysql & " S.EXCODE ,B.BUYAMT,B.SELLAMT,B.CALVAL ,S.SAUDAID "
    mysql = mysql & " FROM ACCOUNTM AS A, BILLSUMREC AS B , SAUDAMAST AS S "
    mysql = mysql & " WHERE A.ACCID = B.ACCID And S.SAUDAID = B.SAUDAID  "
    mysql = mysql & " UPDATE BILLSUM SET NETQTY = BUYQTY-SELLQTY "
    mysql = mysql & " UPDATE BILLSUM SET NETQTY = 0 WHERE BUYQTY=SELLQTY "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(SELLAMT-BUYAMT)/ ( ABS(NETQTY) * CALVAL) WHERE BUYQTY <> 0 AND SELLQTY<>0  AND NETQTY<>0 "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(SELLAMT-BUYAMT)/ ( ABS(BUYQTY) * CALVAL) WHERE BUYQTY <> 0 AND SELLQTY<>0  AND NETQTY=0 "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(BUYAMT)/ ( ABS(NETQTY) *  CALVAL)  WHERE BUYQTY <>0 AND SELLQTY=0 "
    mysql = mysql & " UPDATE BILLSUM SET NETRATE =(SELLAMT)/ ( ABS(NETQTY) * CALVAL) WHERE BUYQTY =0 AND SELLQTY<>0 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='PINSERT_ACCT_EX') DROP PROCEDURE PINSERT_ACCT_EX"
    mysql = " CREATE PROCEDURE PINSERT_ACCT_EX (@COMPCODE INT,@AC_CODE VARCHAR(15),@EXCODE VARCHAR(10),@ACEXCODE VARCHAR(50),@BILLBY VARCHAR(1),@EXID INT,@ACCID INT ) "
    mysql = mysql & " AS SET NOCOUNT ON  "
    mysql = mysql & " INSERT INTO ACCT_EX (COMPCODE ,AC_CODE,EXCODE,ACEXCODE,BILLBY,EXID,ACCID ) VALUES "
    mysql = mysql & " ( @CompCode ,@AC_CODE,@EXCODE,@ACEXCODE,@BILLBY,@EXID,@ACCID )"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='PINSERT_EXBROKCLIENT') DROP PROCEDURE PINSERT_EXBROKCLIENT"
    mysql = " CREATE PROCEDURE PINSERT_EXBROKCLIENT (@COMPCODE INT,@BROKER VARCHAR(15),@CLIENT VARCHAR(15),@BROKID INT ,@CLIENTID INT ) "
    mysql = mysql & " AS SET NOCOUNT ON  BEGIN "
    mysql = mysql & " INSERT INTO EXBROKCLIENT( COMPCODE, BROKER, CLIENT, BROKID, CLIENTID ) VALUES "
    mysql = mysql & " ( @CompCode, @BROKER, @CLIENT, @BROKID, @CLIENTID )  END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_BILLSUMOP') DROP PROCEDURE INSERT_BILLSUMOP"
    mysql = " CREATE PROCEDURE INSERT_BILLSUMOP  (@ACCID INT,@EXID INT,@SAUDAID INT,@OPQTY FLOAT ,@OPENRATE FLOAT,@OPAMT FLOAT,@CALVAL FLOAT ) AS SET NOCOUNT ON  "
    mysql = mysql & " DECLARE @OPRATE FLOAT SET @OPRATE =0"
    mysql = mysql & " IF @OPQTY <>0 BEGIN SET  @OPRATE = (@OPAMT/(@OPQTY*@CALVAL))  END "
    mysql = mysql & " INSERT INTO BILLSUMREC (ACCID,EXID,SAUDAID,OPQTY,OPENRATE,OPRATE,OPAMT,CALVAL,CLQTY )  "
    mysql = mysql & " VALUES (@ACCID,@EXID,@SAUDAID,@OPQTY,@OPENRATE,@OPRATE,@OPAMT,@CALVAL,@OPQTY)"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS (SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_BILLSUMTRD') DROP PROCEDURE INSERT_BILLSUMTRD"
    mysql = " CREATE PROCEDURE INSERT_BILLSUMTRD  (@ACCID INT ,@EXID INT,@SAUDAID INT,@BUYQTY FLOAT,@BUYAMT FLOAT,@SELLQTY FLOAT,@SELLAMT FLOAT,@BROKAMT FLOAT,@CALVAL FLOAT)"
    mysql = mysql & "  AS SET NOCOUNT ON BEGIN DECLARE @BUYRATE FLOAT DECLARE @SELLRATE FLOAT "
    mysql = mysql & " SET @BUYRATE =0 SET @SELLRATE=0"
    mysql = mysql & " IF @BUYQTY <>0 BEGIN SET  @BUYRATE = (@BUYAMT/(@BUYQTY*@CALVAL)) END "
    mysql = mysql & " IF @SELLQTY  <>0 BEGIN SET  @SELLRATE = (@SELLAMT/(@SELLQTY*@CALVAL)) END "
    mysql = mysql & " IF EXISTS(SELECT ACCID  FROM BILLSUMREC WHERE ACCID =@ACCID  AND SAUDAID=@SAUDAID)"
    mysql = mysql & " BEGIN UPDATE BILLSUMREC SET BUYQTY=@BUYQTY,SELLQTY=@SELLQTY,BUYRATE =@BUYRATE,SELLRATE=@SELLRATE,"
    mysql = mysql & " BUYAMT =@BUYAMT,SELLAMT=@SELLAMT,BROKAMT =BROKAMT+@BROKAMT,CLQTY = (ISNULL(OPQTY,0) + @BUYQTY - @SELLQTY) WHERE ACCID  =@ACCID  AND SAUDAID=@SAUDAID  END "
    mysql = mysql & " ELSE BEGIN "
    mysql = mysql & " INSERT INTO BILLSUMREC (ACCID ,EXID,SAUDAID,OPQTY,OPENRATE,OPRATE,OPAMT,BUYQTY,BUYRATE,BUYAMT,SELLQTY,SELLRATE,SELLAMT,BROKAMT,CALVAL,CLQTY )  "
    mysql = mysql & " VALUES (@ACCID,@EXID,@SAUDAID,0,0,0,0,@BUYQTY,@BUYRATE,@BUYAMT,@SELLQTY,@SELLRATE,@SELLAMT,@BROKAMT,@CALVAL,@BUYQTY - @SELLQTY ) END END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_ACCOUNTM') DROP PROCEDURE INSERT_ACCOUNTM "
    mysql = "CREATE PROCEDURE INSERT_ACCOUNTM @COMPCODE INT,@AC_CODE VARCHAR(15),@NAME VARCHAR(100),@GCODE INT,@GRPCODE INT,@OP_BAL FLOAT,@ACTIVE BIT,@PTYHEAD INT "
    mysql = mysql & " AS  SET NOCOUNT ON BEGIN "
    mysql = mysql & " if (@AC_CODE = '') "
    mysql = mysql & " begin "
        mysql = mysql & " SELECT @AC_CODE = max(ACCID) FROM ACCOUNTM WHERE COMPCODE =1003 "
        mysql = mysql & " set @AC_CODE = @AC_CODE + substring(@name,1,(6-len(@AC_CODE))) "
    mysql = mysql & " End "
    mysql = mysql & " INSERT INTO ACCOUNTM (COMPCODE, AC_CODE, NAME, GCODE, GRPCODE, OP_BAL, ACTIVE,PTYHEAD)"
    mysql = mysql & " VALUES (@COMPCODE,@AC_CODE,@NAME,@GCODE,@GRPCODE,@OP_BAL,@ACTIVE,@PTYHEAD) END"
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_ACCOUNTD') DROP PROCEDURE INSERT_ACCOUNTD "
    mysql = "CREATE PROCEDURE INSERT_ACCOUNTD @COMPCODE INT,@AC_CODE VARCHAR(15),@GCODE INT, @NAME VARCHAR(100),@ADD1 VARCHAR(100),@CITY VARCHAR(30),"
    mysql = mysql & " @PIN VARCHAR(30),@PHONEO VARCHAR(30),@PHONER VARCHAR(30),@FAX VARCHAR(30),@MOBILE VARCHAR(30),@EMAIL VARCHAR(30),"
    mysql = mysql & " @PERSONNELAC CHAR(1),@INTAPP CHAR(1),@SRTAXAPP CHAR(1),@PANNO VARCHAR(30),@DIRECTOR VARCHAR(30),@BROKTYPE VARCHAR(1),"
    mysql = mysql & " @BROKRATE FLOAT,@TRANTYPE VARCHAR(1),@TRANRATE FLOAT ,@STDRATE FLOAT,@PARTYTYPE VARCHAR(1),"
    mysql = mysql & " @STTRATE FLOAT, @CTTTYPE VARCHAR(1),@APPLYON VARCHAR(1),@RISKMTYPE VARCHAR(1),@SEBITYPE VARCHAR(1),"
    mysql = mysql & " @INTRATE FLOAT,@GSTIN VARCHAR(30),@CGST VARCHAR(1),@SGST VARCHAR(1),@IGST VARCHAR(1),@UTT VARCHAR(1),@UCC VARCHAR(30),@STATE VARCHAR(30), "
    mysql = mysql & " @STATECODE VARCHAR(30),@IntType VARCHAR(1), @OPTCUTBROK VARCHAR(1),@FUTCUTBROK VARCHAR(1),@MULTIPLIER VARCHAR(1), @SEBIRATE FLOAT,"
    mysql = mysql & " @CURRRATE FLOAT,@CURRTYPE VARCHAR(1),@ACCID INT ,@CRLIMIT FLOAT,@BCYCLE VARCHAR(1) AS  SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO ACCOUNTD (COMPCODE,AC_CODE,GCODE,NAME,ADD1,CITY,PIN,PHONEO,PHONER,FAX,MOBILE,EMAIL,PERSONNELAC,INTAPP,SRTAXAPP,PANNO,DIRECTOR,BROKTYPE,BROKRATE,TRANTYPE,"
    mysql = mysql & " TRANRATE,STDRATE,PARTYTYPE,STTRATE,CTTTYPE,APPLYON,RISKMTYPE,SEBITYPE,INTRATE,GSTIN,CGST,SGST,IGST,UTT,UCC,STATE,STATECODE,INTTYPE,"
    mysql = mysql & " OPTCUTBROK,FUTCUTBROK,MULTIPLIER,SEBIRATE,CURRRATE,CURRTYPE,ACCID,CRLIMIT,BCYCLE)"
    mysql = mysql & " VALUES (@COMPCODE,@AC_CODE,@GCODE,@NAME,@ADD1,@CITY,@PIN,@PHONEO,@PHONER,@FAX,@MOBILE,@EMAIL,@PERSONNELAC,@INTAPP,@SRTAXAPP,"
    mysql = mysql & " @PANNO,@DIRECTOR,@BROKTYPE,@BROKRATE,@TRANTYPE,@TRANRATE,@STDRATE,@PARTYTYPE,@STTRATE,@CTTTYPE,@APPLYON,"
    mysql = mysql & " @RISKMTYPE,@SEBITYPE,@INTRATE,@GSTIN,@CGST,@SGST,@IGST,@UTT,@UCC,@STATE,@STATECODE,@INTTYPE, "
    mysql = mysql & " @OPTCUTBROK,@FUTCUTBROK,@MULTIPLIER,@SEBIRATE,@CURRRATE,@CURRTYPE,@ACCID,@CRLIMIT,@BCYCLE ) END "
    Cnn.Execute mysql
    
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_VCHAMT') DROP PROCEDURE INSERT_VCHAMT "
    mysql = "CREATE PROCEDURE INSERT_VCHAMT @COMPCODE INT,@VOU_NO VARCHAR(20),@VOU_TYPE VARCHAR(2),@VOU_DT SMALLDATETIME,@DR_CR VARCHAR(1),@AC_CODE VARCHAR(15), "
    mysql = mysql & " @AMOUNT FLOAT,@CHEQUE_NO VARCHAR(20),@CHEQUE_DT SMALLDATETIME,"
    mysql = mysql & " @NARRATION VARCHAR(200),@BRANCH VARCHAR(200),@BANK_NAME VARCHAR(100),@INVNO INT,@EXCODE VARCHAR(10),@MVNO INT,@EXID INT,@ACCID INT,@VOUTIME SMALLDATETIME"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " INSERT INTO VCHAMT(COMPCODE, VOU_NO,VOU_TYPE,VOU_DT,DR_CR,AC_CODE,AMOUNT,CHEQUE_NO,CHEQUE_DT, NARRATION, BRANCH, BANK_NAME,INVNO,EXCODE,VOU_ID,EXID,ACCID,VOUTIME )"
    mysql = mysql & " VALUES (@COMPCODE, @VOU_NO,@VOU_TYPE,@VOU_DT,@DR_CR,@AC_CODE,@AMOUNT,@CHEQUE_NO,@CHEQUE_DT,@NARRATION,@BRANCH,@BANK_NAME,@INVNO,@EXCODE,@MVNO,@EXID,@ACCID,@VOUTIME)"
    Cnn.Execute mysql
    

    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_DMARGIN') DROP PROCEDURE INSERT_DMARGIN"
    mysql = " CREATE PROCEDURE INSERT_DMARGIN "
    mysql = mysql & "(@COMPCODE INT,@ITEMCODE VARCHAR(20),@LOT FLOAT,@SAUDA VARCHAR(50),@MATURITY SMALLDATETIME,@PARTY VARCHAR(15),"
    mysql = mysql & " @CONDATE SMALLDATETIME,@OPQTY FLOAT,@BUYQTY FLOAT,@SELLQTY FLOAT,@CLOSEQTY FLOAT,@CLOSERATE FLOAT,@EXCODE VARCHAR(10),@SAUDAID INT,@ITEMID INT,@EXID INT , @ACCID INT )"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " INSERT INTO DMARGIN(COMPCODE,ITEMCODE,LOT,SAUDA,MATURITY,PARTY,CONDATE,OPENQTY,BUYQTY,SELLQTY,CLOSEQTY,CLOSERATE,EXCODE,SAUDAID,ITEMID,EXID,ACCID ) "
    mysql = mysql & " VALUES ( @COMPCODE, @ITEMCODE,@LOT,@SAUDA,@MATURITY,@PARTY,@ConDate,@OPQTY,@BuyQty,@SellQty ,@CloseQty ,@CLoseRate,@EXCODE,@SAUDAID,@ITEMID,@EXID,@ACCID) "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_INV_D') DROP PROCEDURE INSERT_INV_D "
    mysql = " CREATE PROCEDURE INSERT_INV_D"
    mysql = mysql & " (@COMPCODE INT,@BILLNO INT,@STDATE SMALLDATETIME,@PARTY VARCHAR(15),@SAUDA VARCHAR(50),@ITEMCODE VARCHAR(20),@OPQTY FLOAT,"
    mysql = mysql & " @OPRATE FLOAT,@CLQTY FLOAT,@CLRATE FLOAT,@DIFFAMT FLOAT,@BROKAMT FLOAT,@STDAMT FLOAT,@TRANAMT FLOAT,@VCHNO VARCHAR(20),"
    mysql = mysql & " @BILLAMT FLOAT,@SETNO INT,@INVNO INT,@CUTQTY FLOAT,@CUTRATE FLOAT,@OPENDT SMALLDATETIME,@SRVAMT FLOAT,@CALVAL FLOAT,"
    mysql = mysql & " @TOTBQTY FLOAT,@TOTBAMT FLOAT,@TOTSQTY FLOAT,@TOTSAMT FLOAT,@STAMPAMT FLOAT,@STTTAX FLOAT,@FROMDATE SMALLDATETIME,"
    mysql = mysql & " @RISKMAMT FLOAT,@SEBITAXAMT FLOAT,@SBCAMT FLOAT,@CGSTAMT FLOAT,@SGSTAMT FLOAT,@IGSTAMT FLOAT,@UTTAMT FLOAT,@EXCODE VARCHAR(10),@EXID INT,@ITEMID INT,@SAUDAID INT,@ACCID INT,@USDINR FLOAT,@BROKAMT2 FLOAT )"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO INV_D(COMPCODE,BILLNO,STDATE,PARTY,SAUDA,ITEMCODE,OPQTY,OPRATE,CLQTY,CLRATE,DIFFAMT,BROKAMT,STDAMT,TRANAMT,VCHNO,BILLAMT,SETNO,INVNO,CUTQTY,CUTRATE,OPENDT,"
    mysql = mysql & "  SRVAMT,CALVAL,TOTBQTY,TOTBAMT,TOTSQTY,TOTSAMT,STAMPAMT,STTTAX,FROMDATE,RISKMAMT,SEBITAXAMT,SBC_TAX_AMT,CGSTAMT,SGSTAMT,IGSTAMT,UTTAMT,EXCODE,SAUDAID,ITEMID,EXID,ACCID,USDINR,BROKAMT2)"
    mysql = mysql & " VALUES (@COMPCODE,@BILLNO,@STDATE,@PARTY,@SAUDA,@ITEMCODE,@OPQTY,@OPRATE,@CLQTY,@CLRATE,@DiffAmt,@BROKAMT,@STDAMT, @TRANAMT,@VCHNO,@BILLAMT,@SETNO,@INVNO,@CUTQTY,@CUTRATE,"
    mysql = mysql & " @OPENDT,@SRVAMT,@CALVAL,@TOTBQTY,@TOTBAMT,@TOTSQTY,@TOTSAMT,@STAMPAMT,@STTTAX, @FROMDATE,@RISKMAMT,@SEBITAXAMT,@SBCAMT,@CGSTAMT,@SGSTAMT,@IGSTAMT,@UTTAMT,@EXCODE,@SAUDAID,@ITEMID,@EXID,@ACCID,@USDINR,@BROKAMT2) "
    mysql = mysql & " DECLARE @UBILLNO INT SELECT @UBILLNO=UBILLNO FROM INV_D WHERE STDATE =@STDATE AND ACCID=@ACCID AND SAUDAID=@SAUDAID "
    mysql = mysql & " UPDATE CTR_D SET BILLNO=@UBILLNO WHERE CONDATE>= @FromDate AND CONDATE<= @STDATE AND ACCID = @ACCID  AND SAUDAID= @SaudaID END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_UBILLNO') DROP PROCEDURE GET_UBILLNO  "
    mysql = " CREATE PROCEDURE GET_UBILLNO @STDATE SMALLDATETIME,@ACCID INT ,@SAUDAID INT, @UBILLNO INT OUTPUT"
    mysql = mysql & " AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " SELECT @UBILLNO= UBILLNO FROM INV_D WHERE STDATE =@STDATE AND ACCID =@ACCID AND SAUDAID =@SAUDAID "
    mysql = mysql & " IF @UBILLNO IS NULL SET @UBILLNO =0 END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_INV_D1') DROP PROCEDURE INSERT_INV_D1 "
    mysql = " CREATE PROCEDURE INSERT_INV_D1 "
    mysql = mysql & " (@COMPCODE INT,@FMLYCODE VARCHAR(15),@PARTY VARCHAR(15),@EXCODE VARCHAR(10),@ITEMCODE VARCHAR(20),@SAUDA VARCHAR(50),@VOU_NO VARCHAR(20),"
    mysql = mysql & " @AMOUNT FLOAT,@BILLNO INT,@STDATE SMALLDATETIME,@SVOU_NO VARCHAR(20),@SAMOUNT FLOAT,@VNO INT,@EXID INT,@ITEMID INT,@SAUDAID INT,@FMLYID INT,@ACCID AS INT,@USDINR AS FLOAT) AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO INV_D1 (COMPCODE ,FMLYCODE ,PARTY ,EXCODE ,ITEMCODE ,SAUDA ,VOU_NO ,AMOUNT ,BILLNO ,STDATE,SVOU_NO,SAMOUNT,SAUDAID,EXID,ITEMID,ACCID,FMLYID,USDINR )"
    mysql = mysql & " VALUES (@COMPCODE,@FMLYCODE,@PARTY,@EXCODE,@ITEMCODE,@SAUDA,@VOU_NO,@AMOUNT,@BILLNO,@STDATE,@SVOU_NO,@SAMOUNT,@SAUDAID,@EXID,@ITEMID,@ACCID,@FMLYID,@USDINR) END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_PITBROK')DROP PROCEDURE INSERT_PITBROK"
    mysql = "CREATE PROCEDURE INSERT_PITBROK "
    mysql = mysql & " @MC_CODE INT ,@AC_CODE VARCHAR(15),@ITEMCODE VARCHAR(20),@BROKTYPE VARCHAR(1),@BROKRATE FLOAT,@STDRATE FLOAT,@TRANRATE FLOAT,"
    mysql = mysql & " @TRANTYPE VARCHAR(1),@BROKRATE2 FLOAT,@MARTYPE VARCHAR(1),@MARRATE FLOAT,@UPTOSTDT SMALLDATETIME,@STMRATE FLOAT,@STTRATE FLOAT,"
    mysql = mysql & " @MINRATE FLOAT,@MBROKTYPE VARCHAR(1),@MBROKRATE FLOAT,@MBROKRATE2 FLOAT,@INSTTYPE VARCHAR(3),@EXCODE VARCHAR(10),@EXID INT,@ITEMID INT,@ACCID INT AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO PITBROK "
    mysql = mysql & " (COMPCODE,AC_CODE,ITEMCODE,BROKTYPE,BROKRATE,STDRATE,TRANRATE,TRANTYPE,BROKRATE2,MARTYPE,MARRATE,UPTOSTDT,STMRATE,STTRATE,MINRATE,"
    mysql = mysql & " MBROKTYPE,MBROKRATE,MBROKRATE2,INSTTYPE,EXCODE,EXID,ITEMID,ACCID)"
    mysql = mysql & " VALUES (@MC_CODE,@AC_CODE,@ITEMCODE,@BROKTYPE,@BROKRATE,@STDRATE,@TRANRATE,@TRANTYPE,@BROKRATE2,@MARTYPE,@MARRATE,@UPTOSTDT,"
    mysql = mysql & " @STMRATE,@STTRATE,@MINRATE,@MBROKTYPE,@MBROKRATE,@MBROKRATE2,@INSTTYPE,@EXCODE,@EXID,@ITEMID,@ACCID) END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_PITSBROK') DROP PROCEDURE INSERT_PITSBROK "
    mysql = "CREATE PROCEDURE INSERT_PITSBROK"
    mysql = mysql & " @MC_CODE INT,@PARTY VARCHAR(15),@FMLYCODE VARCHAR(6),@EXCODE VARCHAR(10),@ITEMCODE VARCHAR(20),@BROKTYPE VARCHAR(1),@BROKRATE FLOAT,"
    mysql = mysql & " @SHTYPE VARCHAR(1),@SHRATE FLOAT,@UPTOSTDT SMALLDATETIME,@INSTTYPE VARCHAR(3),@BROKRATE2 FLOAT,@ITEMID INT,@EXID INT,@FMLYID INT,@ACCID INT  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO PITSBROK (COMPCODE,PARTY,FMLYCODE,EXCODE,ITEMCODE,BROKTYPE,BROKRATE,SHTYPE,SHRATE,UPTOSTDT,INSTTYPE,BROKRATE2,EXID,ITEMID,FMLYID,ACCID) "
    mysql = mysql & " VALUES               (@MC_CODE,@PARTY,@FMLYCODE,@EXCODE,@ITEMCODE,@BROKTYPE,@BROKRATE,@SHTYPE,@SHRATE,@UPTOSTDT,@INSTTYPE,@BROKRATE2,@EXID,@ITEMID,@FMLYID,@ACCID ) END  "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_PEXSBROK')DROP PROCEDURE INSERT_PEXSBROK"
    mysql = "CREATE PROCEDURE INSERT_PEXSBROK"
    mysql = mysql & " @MC_CODE INT,@PARTY VARCHAR(15),@FMLYCODE VARCHAR(6),@EXCODE VARCHAR(10),@BROKTYPE VARCHAR(1),@BROKRATE FLOAT,@SHTYPE VARCHAR(1),@SHRATE FLOAT,@UPTOSTDT SMALLDATETIME,@INSTTYPE VARCHAR(3),@BROKRATE2 FLOAT,@EXID INT,@FMLYID INT,@ACCID INT AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO PEXSBROK (COMPCODE,PARTY,FMLYCODE,EXCODE,BROKTYPE,BROKRATE,SHTYPE,SHRATE,UPTOSTDT,INSTTYPE,BROKRATE2,EXID,ACCID,FMLYID) "
    mysql = mysql & " VALUES               (@MC_CODE,@PARTY,@FMLYCODE,@EXCODE,@BROKTYPE,@BROKRATE,@SHTYPE,@SHRATE,@UPTOSTDT,@INSTTYPE,@BROKRATE2,@EXID,@ACCID,@FMLYID ) END "
    Cnn.Execute mysql
    
    Cnn.Execute " IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_PEXBROK') DROP PROCEDURE INSERT_PEXBROK"
    mysql = "CREATE PROCEDURE INSERT_PEXBROK"
    mysql = mysql & " @MC_CODE INT,@AC_CODE VARCHAR(15),@ExCode VARCHAR(10),@BrokType VARCHAR(1),@BROKRATE FLOAT,@BROKRATE2 FLOAT,@STDRATE FLOAT,"
    mysql = mysql & " @TranRate FLOAT,@TranType VARCHAR(1),@STTRATE FLOAT,@MINRATE FLOAT,@MBROKTYPE VARCHAR(1),@MBROKRATE FLOAT,@MBROKRATE2 FLOAT,"
    mysql = mysql & " @MARTYPE VARCHAR(1),@MARRATE FLOAT,@UPTOSTDT SMALLDATETIME,@INSTTYPE VARCHAR(3),@SELLBROK FLOAT,@SELLBROK2 FLOAT,@EXID INT,@ACCID INT  AS SET NOCOUNT ON BEGIN "
    mysql = mysql & " INSERT INTO PEXBROK "
    mysql = mysql & " (COMPCODE,AC_CODE,EXCODE,BROKTYPE,BROKRATE,STDRATE,TRANRATE,TranType,BROKRATE2,MARTYPE,MARRATE,UptoStdt,STTRATE,MINRATE,MBROKTYPE,MBROKRATE,MBROKRATE2,INSTTYPE,SELLBROK,SELLBROK2,EXID,ACCID)"
    mysql = mysql & " VALUES (@MC_CODE,@AC_CODE,@EXCODE,@BrokType,@BROKRATE,@STDRATE,@TranRate,@TranType,@BROKRATE2,@MARTYPE,@MARRATE,@UPTOSTDT,@STTRATE,@MINRATE,@MBROKTYPE,@MBROKRATE,@MBROKRATE2,@INSTTYPE,@SELLBROK,@SELLBROK2,@EXID,@ACCID) END "
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_VOUCHER') DROP PROCEDURE INSERT_VOUCHER "
    mysql = "CREATE PROCEDURE INSERT_VOUCHER @COMPCODE INT,@VOU_NO VARCHAR(20),@VOU_TYPE VARCHAR(2),@VOU_DT SMALLDATETIME,@VOU_PR VARCHAR(1),@CASHCODE VARCHAR(15),"
    mysql = mysql & " @INVNO INT,@EXCODE VARCHAR(10),@IMPORT VARCHAR(1),@EXID INT, @FMLYID INT, @MAXVNO INT OUTPUT "
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " INSERT INTO VOUCHER( COMPCODE ,VOU_NO ,VOU_TYPE ,VOU_DT ,VOU_PR ,CASHCODE,INVNO ,EXCODE,IMPORT,EXID,FMLYID) "
    mysql = mysql & " VALUES             (@COMPCODE,@VOU_NO,@VOU_TYPE,@VOU_DT,@VOU_PR,@CASHCODE,@INVNO,@EXCODE,@IMPORT,@EXID,@FMLYID ) "
    mysql = mysql & " SELECT @MAXVNO =VOU_ID FROM VOUCHER  WHERE COMPCODE =@COMPCODE AND VOU_NO=@VOU_NO"
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_CTR_D') DROP PROCEDURE INSERT_CTR_D"
    mysql = "CREATE PROCEDURE [dbo].[INSERT_CTR_D]  (@COMPCODE INT,@BCLCODE VARCHAR(20),@SCLCODE VARCHAR(20),@CONSNO FLOAT,@CONDATE SMALLDATETIME,@CONNO FLOAT,@SAUDA VARCHAR(50),"
    mysql = mysql & " @ITEMCODE VARCHAR(20), @BPARTY VARCHAR(15),@BQTY FLOAT, @BRATE FLOAT,@PERCONT VARCHAR(1),@SPARTY VARCHAR(15),@SQTY FLOAT,@SRATE FLOAT,@DATAIMPORT VARCHAR(1),"
    mysql = mysql & " @CONTIME VARCHAR(15),@USERID VARCHAR(50),@ORDNO VARCHAR(25),@ROWNO1 VARCHAR(50),@EXCODE VARCHAR(10),@PATTAN VARCHAR(1),@CONCODE VARCHAR(15), @LCALVAL FLOAT,"
    mysql = mysql & " @BCONFIRM INT,@SCONFIRM INT,@ORDTIME VARCHAR(50), @INSTTYPE VARCHAR(3),@OPTTYPE VARCHAR(2),@STRIKE FLOAT,@FILETYPE VARCHAR(3),@BROKFLAG VARCHAR(1),@EXID INT ,@ITEMID INT,@SAUDAID INT,@BCODE INT)"
    mysql = mysql & " AS SET NOCOUNT ON  BEGIN  DECLARE @LBROKAMT AS FLOAT DECLARE @LPERCONT AS VARCHAR(1)"
    mysql = mysql & " IF @BPARTY=@CONCODE SET @LPERCONT ='C'"
    mysql = mysql & " Else SET @LPERCONT ='P'"
    mysql = mysql & " IF @BPARTY<>@CONCODE SET @LBROKAMT=@SRATE"
    mysql = mysql & " Else SET @LBROKAMT=0"
    mysql = mysql & " DECLARE @ACCID INT SELECT @ACCID=ACCID  FROM ACCOUNTM WHERE COMPCODE =@COMPCODE AND AC_CODE =@BPARTY"
    mysql = mysql & " INSERT INTO CTR_D (COMPCODE,CLCODE,CONSNO,CONDATE,CONNO,SAUDA,ITEMCODE,PARTY,QTY,RATE,CONTYPE,PERCONT,DATAIMPORT,CONTIME,USERID,ORDNO,ROWNO1,EXCODE,PATTAN,CONCODE,CALVAL,CONFIRM,ORDTIME,INSTTYPE,OPTTYPE,STRIKE,BROKAMT,BrokType,BROKRATE,BROKRATE2,TranType,TRANRATE,FILETYPE,BROKFLAG,SAUDAID,EXID,ITEMID ,ACCID)"
    mysql = mysql & " VALUES(@COMPCODE,@BCLCODE,@CONSNO,@CONDATE,@CONNO,@SAUDA,@ITEMCODE,@BPARTY,@BQTY,@BRATE,'B',@LPERCONT,@DATAIMPORT,@CONTIME,@USERID,@ORDNO,@ROWNO1,@EXCODE,@PATTAN,@CONCODE,@LCALVAL,@BCONFIRM,@ORDTIME,@INSTTYPE,@OPTTYPE,@STRIKE,@LBROKAMT,'P',0,0,'P',0,@FILETYPE,@BROKFLAG,@SAUDAID,@EXID,@ITEMID,@ACCID )"
    mysql = mysql & " IF @SPARTY=@CONCODE SET @LPERCONT ='C'"
    mysql = mysql & " Else SET @LPERCONT ='P'"
    mysql = mysql & " IF @SPARTY<>@CONCODE SET @LBROKAMT=@BRATE"
    mysql = mysql & " Else SET @LBROKAMT=0"
    mysql = mysql & "  SELECT @ACCID=ACCID  FROM ACCOUNTM WHERE COMPCODE =@COMPCODE AND AC_CODE =@SPARTY"
    mysql = mysql & " INSERT INTO CTR_D (COMPCODE,CLCODE,CONSNO,CONDATE,CONNO,SAUDA,ITEMCODE,PARTY,QTY,RATE,CONTYPE,PERCONT,DATAIMPORT,CONTIME,USERID,ORDNO,ROWNO1,EXCODE,PATTAN,CONCODE,CALVAL,CONFIRM,ORDTIME,INSTTYPE,OPTTYPE,STRIKE,BROKAMT,BrokType,BROKRATE,BROKRATE2,TranType,TRANRATE,FILETYPE,BROKFLAG,SAUDAID,EXID,ITEMID,ACCID )"
    mysql = mysql & " VALUES(@COMPCODE,@SCLCODE,@CONSNO,@CONDATE,@CONNO,@SAUDA,@ITEMCODE,@SPARTY,@SQTY,@SRATE,'S',@LPERCONT,@DATAIMPORT,@CONTIME,@USERID,@ORDNO,@ROWNO1,@EXCODE,@PATTAN,@CONCODE,@LCALVAL,@SCONFIRM,@ORDTIME,@INSTTYPE,@OPTTYPE,@STRIKE,@LBROKAMT,'P',0,0,'T',0,@FILETYPE,@BROKFLAG,@SAUDAID,@EXID,@ITEMID,@ACCID )"
    mysql = mysql & " End"
    Cnn.Execute mysql
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='INSERT_ORD_M_D') DROP PROCEDURE INSERT_ORD_M_D"
    mysql = "CREATE PROCEDURE [dbo].[INSERT_ORD_M_D]  (@COMPCODE INT,@BCLCODE VARCHAR(20),@SCLCODE VARCHAR(20),@CONSNO FLOAT,@CONDATE SMALLDATETIME,@CONNO FLOAT,@SAUDA VARCHAR(50),"
    mysql = mysql & " @ITEMCODE VARCHAR(20), @BPARTY VARCHAR(15),@BQTY FLOAT, @BRATE FLOAT,@PERCONT VARCHAR(1),@SPARTY VARCHAR(15),@SQTY FLOAT,@SRATE FLOAT,@DATAIMPORT VARCHAR(1),"
    mysql = mysql & " @CONTIME VARCHAR(15),@USERID VARCHAR(50),@ORDNO VARCHAR(25),@ROWNO1 VARCHAR(50),@EXCODE VARCHAR(10),@PATTAN VARCHAR(1),@CONCODE VARCHAR(15), @LCALVAL FLOAT,"
    mysql = mysql & " @BCONFIRM INT,@SCONFIRM INT,@ORDTIME VARCHAR(50), @INSTTYPE VARCHAR(3),@OPTTYPE VARCHAR(2),@STRIKE FLOAT,@FILETYPE VARCHAR(2),@BROKFLAG VARCHAR(1),@EXID INT ,@ITEMID INT,@SAUDAID INT,@BCODE INT)"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " DECLARE @ACCID INT "
    mysql = mysql & " SELECT @ACCID=ACCID  FROM ACCOUNTM WHERE COMPCODE =@COMPCODE AND AC_CODE =@BPARTY "
    mysql = mysql & " SELECT @ACCID=ACCID  FROM ACCOUNTM WHERE COMPCODE =@COMPCODE AND AC_CODE =@SPARTY "
    mysql = mysql & " Delete from ORD_M where ORDNO=@CONNO "
    mysql = mysql & " Delete from ORD_D where ORDNO=@CONNO "
    mysql = mysql & " INSERT INTO ORD_M (COMPCODE,ORDDT,ORDNO,PARTY,ACCID) VALUES (@COMPCODE,@CONDATE,@CONNO,@BPARTY,@ACCID)  "
    mysql = mysql & " INSERT INTO ORD_D (COMPCODE,ORDDT,ORDNO,SAUDA,ITEMCODE,QTY,RATE,CONTYPE,Status) VALUES (@COMPCODE,@CONDATE,@CONNO,@SAUDA,@ITEMCODE,@BQTY,@BRATE,@BCLCODE,@CONSNO) "
    Cnn.Execute mysql
    
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='GET_MAX_ORDERNO') DROP PROCEDURE GET_MAX_ORDERNO"
    mysql = "CREATE PROCEDURE [dbo].[GET_MAX_ORDERNO]  (@MC_CODE INT,@LCONDATE SMALLDATETIME, @LCONNO INT OUTPUT)"
    mysql = mysql & " AS SET NOCOUNT ON "
    mysql = mysql & " SELECT @LCONNO=MAX(ORDNO)  FROM ORD_M WHERE COMPCODE =@MC_CODE "
    mysql = mysql & " IF (@LCONNO IS NULL) SET @LCONNO = 0 "
    Cnn.Execute mysql
    
    
    Cnn.Execute "IF EXISTS(SELECT OBJECT_ID FROM SYS.OBJECTS WHERE TYPE='P' AND NAME='ORDER_REGISTER') DROP PROCEDURE ORDER_REGISTER"
    mysql = "CREATE PROCEDURE [dbo].[ORDER_REGISTER]  ( @COMPCODE INT, @AccCode nvarchar(1000),@FROMDATE SMALLDATETIME, @TODATE SMALLDATETIME )"
    mysql = mysql & " AS  SET NOCOUNT ON "
    mysql = mysql & " DECLARE @LAccCode NVARCHAR(50) "
    mysql = mysql & " CREATE TABLE #TEMPACCODE (AC_CODE NVARCHAR(50)) "
    mysql = mysql & " while charindex('^',@AccCode) > 0 "
    mysql = mysql & " begin "
    mysql = mysql & " SET @LAccCode = rtrim(ltrim(substring(@AccCode,1,charindex('^',@AccCode)-1))) "
    mysql = mysql & " INSERT INTO #TEMPACCODE (AC_CODE) VALUES (@LAccCode) "
    mysql = mysql & " set @AccCode=rtrim(ltrim(substring(@AccCode,charindex('^',@AccCode)+1,len(@AccCode)))) "
    mysql = mysql & " IF @AccCode = '^' "
    mysql = mysql & " SET @AccCode = '' "
    mysql = mysql & " end "
    mysql = mysql & " SELECT M.ORDDT, M.ORDNO, D.SAUDA, "
    mysql = mysql & " (CASE WHEN D.CONTYPE ='B' THEN'BUY' ELSE 'SEL' END) AS 'BS', D.QTY, D.Rate, "
    mysql = mysql & " (CASE WHEN D.Status =1 THEN 'Pending' WHEN D.Status =2 THEN 'Cancelled' WHEN D.Status =3 THEN 'Executed' END) AS 'STATUS' "
    mysql = mysql & " FROM ORD_M M, ORD_D D "
    mysql = mysql & " WHERE M.COMPCODE=D.COMPCODE AND M.COMPCODE=@COMPCODE AND M.ORDNO = D.ORDNO AND M.ORDDT = D.ORDDT AND M.ORDDT >= @FROMDATE AND M.ORDDT <= @TODATE "
    mysql = mysql & " AND M.PARTY  IN (SELECT AC_CODE FROM #TEMPACCODE) "
    Cnn.Execute mysql

    Exit Sub
    
err1:
    MsgBox err.Description & Left(mysql, 500)
  
End Sub


Public Sub VER_PEXBROK()
    GETMAIN.Label1.Caption = "Data Integration Check PEXBROK  "
    DoEvents
    VER_ADJ "PEXBROK", "COMPCODE", "INT", , "0"
    VER_ADJ "PEXBROK", "AC_CODE ", "VARCHAR", 15, ""
    VER_ADJ "PEXBROK", "ACCID", "INT", , "0"
    VER_ADJ "PEXBROK", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "PEXBROK", "INSTTYPE", "VARCHAR", 3, "FUT"
    VER_ADJ "PEXBROK", "BROKTYPE", "VARCHAR", 1, "P"
    VER_ADJ "PEXBROK", "BROKRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "BROKRATE2", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "STTRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "MINRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "MBROKRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "MBROKTYPE", "VARCHAR", 1, "P"
    VER_ADJ "PEXBROK", "MBROKRATE2", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "STDRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "TRANTYPE", "VARCHAR", 1, "P"
    VER_ADJ "PEXBROK", "TRANRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "MARTYPE", "VARCHAR", 1, "P"
    VER_ADJ "PEXBROK", "MARRATE", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "SELLBROK", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "SELLBROK2", "FLOAT", , "0"
    VER_ADJ "PEXBROK", "UPTOSTDT", "SMALLDATETIME", , ""
    VER_ADJ "PEXBROK", "FROMDATE", "SMALLDATETIME", , ""
    VER_ADJ "PEXBROK", "EXID", "INT", , "0"
    
    mysql = "DELETE FROM PEXBROK WHERE EXCODE NOT IN (SELECT DISTINCT EXCODE FROM EXMAST ) "
    Cnn.Execute mysql
    
    
    mysql = "UPDATE PEXBROK  SET ACCID  =0 WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXBROK  ALTER COLUMN ACCID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PEXBROK   SET ACCID  =isnull((SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE=PEXBROK.COMPCODE AND ACCOUNTM.AC_CODE  =PEXBROK.AC_CODE  ),0) WHERE ACCID  =0  "
    Cnn.Execute mysql
    
    mysql = "UPDATE PEXBROK  SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & "ALTER TABLE PEXBROK  ALTER COLUMN EXID INT NOT NULL"
    Cnn.Execute mysql
    mysql = "UPDATE PEXBROK SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =PEXBROK.COMPCODE AND EXMAST.EXCODE = PEXBROK.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE PEXBROK  ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='AC_CODE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE PEXBROK  ALTER COLUMN AC_CODE VARCHAR(15) NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE PEXBROK  ALTER COLUMN EXCODE VARCHAR(10) NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='UPTOSTDT' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE PEXBROK  ALTER COLUMN UPTOSTDT SMALLDATETIME NOT  NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='INSTTYPE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE PEXBROK  ALTER COLUMN INSTTYPE VARCHAR(3)  NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PEXBROK' AND COLUMN_NAME ='BROKTYPE' AND IS_NULLABLE ='YES')"
    mysql = "ALTER TABLE PEXBROK  ALTER COLUMN BROKTYPE  VARCHAR(1)  NOT  NULL"
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("PEXBROK") = False Then
    mysql = "ALTER TABLE PEXBROK ADD Primary key (ACCID,EXID,INSTTYPE,UPTOSTDT )"
    Cnn.Execute mysql
    End If
End Sub

Public Sub UPDATE_FROMDATE_PEXBROK()
    
    Dim TRec As ADODB.Recordset:        Dim TRec2 As ADODB.Recordset
    Dim LCOMP As Integer:               Dim LFromDate As Date
    Dim LUPTODT As Date:                Dim LACCID As Long
    Dim LExID As Integer:               Dim LInstType As String
    Dim TREC3 As ADODB.Recordset
    
    
    GETMAIN.Label1.Caption = "Updateing FromDate PEXBROK "
    DoEvents
    
    mysql = "SELECT COMPCODE FROM COMPANY"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not TRec.EOF
        LCOMP = TRec!CompCode
        mysql = "SELECT DISTINCT ACCID,EXID,INSTTYPE FROM PEXBROK WHERE COMPCODE =" & LCOMP & " AND FROMDATE IS NULL ORDER BY ACCID,EXID,INSTTYPE"
        LFromDate = GFinBegin
        Set TRec2 = Nothing
        Set TRec2 = New ADODB.Recordset
        TRec2.Open mysql, Cnn, adOpenStatic, adLockReadOnly
        Do While Not TRec2.EOF
            LACCID = TRec2!ACCID
            LExID = TRec2!EXID
            LInstType = TRec2!INSTTYPE
            mysql = "SELECT DISTINCT UPTOSTDT FROM PEXBROK WHERE COMPCODE =" & LCOMP & " AND ACCID =" & LACCID & " AND EXID =" & LExID & " "
            mysql = mysql & " AND INSTTYPE='" & LInstType & "' AND FROMDATE IS NULL ORDER BY UPTOSTDT"
            Set TREC3 = Nothing
            Set TREC3 = New ADODB.Recordset
            TREC3.Open mysql, Cnn, adOpenStatic, adLockReadOnly
            Do While Not TREC3.EOF
                LUPTODT = TREC3!UPTOSTDT
                mysql = "UPDATE PEXBROK SET FROMDATE ='" & Format(LFromDate, "YYYY/MM/DD") & "'"
                mysql = mysql & " WHERE COMPCODE =" & LCOMP & " AND ACCID =" & LACCID & " AND EXID =" & LExID & " "
                mysql = mysql & " AND INSTTYPE='" & LInstType & "' AND FROMDATE IS NULL AND UPTOSTDT ='" & Format(LUPTODT, "YYYY/MM/DD") & "'"
                Cnn.Execute mysql
                LFromDate = LUPTODT
            Loop
            TRec2.MoveNext
        Loop
        TRec.MoveNext
    Loop
End Sub
Public Sub VER_ACCT_EX()
    GETMAIN.Label1.Caption = "Data Integration Check ACCT EX "
    DoEvents
    
    VER_ADJ "ACCT_EX", "BILLBY", "VARCHAR", 1, "S"
    VER_ADJ "ACCT_EX", "ACCID", "INT", , "0"
    VER_ADJ "ACCT_EX", "EXCODE", "VARCHAR", 10, "0"
    VER_ADJ "ACCT_EX", "EXID", "INT", , "0"
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCT_EX' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCT_EX ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCT_EX' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
   mysql = mysql & " ALTER TABLE ACCT_EX ALTER COLUMN ACCID INT NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ACCT_EX' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE ACCT_EX ALTER COLUMN EXID INT NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM ACCT_EX WHERE EXCODE NOT IN (SELECT DISTINCT EXCODE FROM EXMAST ) "
    Cnn.Execute mysql
    
    mysql = "DELETE FROM ACCT_EX WHERE AC_CODE  NOT IN (SELECT DISTINCT AC_CODE  FROM ACCOUNTM  ) "
    Cnn.Execute mysql
    mysql = "UPDATE ACCT_EX SET ACCID =0 WHERE ACCID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE ACCT_EX SET EXID =0 WHERE EXID  IS NULL"
    Cnn.Execute mysql
    
    mysql = "UPDATE ACCT_EX SET ACCID =(SELECT ACCID FROM ACCOUNTM WHERE ACCT_EX.COMPCODE =ACCOUNTM.COMPCODE AND ACCT_EX.AC_CODE =ACCOUNTM.AC_CODE ) WHERE ACCID =0 "
    Cnn.Execute mysql
    
    mysql = "UPDATE ACCT_EX SET EXID  =(SELECT EXID FROM EXMAST WHERE ACCT_EX.COMPCODE =EXMAST.COMPCODE AND ACCT_EX.EXCODE =EXMAST.EXCODE ) WHERE EXID  =0 "
    Cnn.Execute mysql
    If CHK_PRIMARY_KEY("ACCT_EX") = False Then
        mysql = "ALTER TABLE ACCT_EX ADD Primary key (ACCID,EXID )"
        Cnn.Execute mysql
    End If
    
    mysql = "CREATE  NONCLUSTERED INDEX ACCT_EX_COMPCODE_AC_CODE_EXID_ACEXCODE ON ACCT_EX (COMPCODE,AC_CODE,EXID )"
    mysql = mysql & "INCLUDE (ACEXCODE)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
End Sub

Public Sub VER_EXTAX()
    
    GETMAIN.Label1.Caption = "Data Integration Check EX_TAX "
    DoEvents
    
    VER_ADJ "EXTAX", "CGSTRATE", "FLOAT", , "0"
    VER_ADJ "EXTAX", "CLGRATE", "FLOAT", , "0"
    VER_ADJ "EXTAX", "SGSTRATE", "FLOAT", , "0"
    VER_ADJ "EXTAX", "IGSTRATE", "FLOAT", , "0"
    VER_ADJ "EXTAX", "UTTRATE", "FLOAT", , "0"
    VER_ADJ "EXTAX", "SEBITAXOPT", "FLOAT", , "0"
    VER_ADJ "EXTAX", "OPT_STAMPDTAX", "Float", "0"
    VER_ADJ "EXTAX", "EQ_STAMPDTAX", "Float", "0"
    VER_ADJ "EXTAX", "EQ_STT", "Float", "0"
    
    VER_ADJ "EXTAX", "STMPRATE", "FLOAT", , "0"
    VER_ADJ "EXTAX", "STCTAX", "FLOAT", , "0"
    VER_ADJ "EXTAX", "OPT_TURNOVERTAX", "FLOAT", , "0"
    VER_ADJ "EXTAX", "SBC_TAX", "FLOAT", , "0"
    VER_ADJ "EXTAX", "EXID", "INT", , "0"
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXTAX' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXTAX ALTER COLUMN COMPCODE INT NOT  NULL"
    Cnn.Execute mysql
    
    mysql = "DELETE FROM EXTAX WHERE EXCHANGECODE NOT IN (SELECT EXCODE FROM EXMAST)"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXTAX' AND COLUMN_NAME ='EXCHANGECODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXTAX ALTER COLUMN EXCHANGECODE VARCHAR(10)NOT NULL "
    Cnn.Execute mysql
    
    mysql = "UPDATE EXTAX SET EXID =0 WHERE EXID  IS NULL"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXTAX' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXTAX ALTER COLUMN EXID  INT NOT NULL "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXTAX' AND COLUMN_NAME ='FROMDT' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXTAX ALTER COLUMN FROMDT SMALLDATETIME NOT NULL "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXTAX' AND COLUMN_NAME ='TODT' AND IS_NULLABLE ='YES')"
    mysql = mysql & " ALTER TABLE EXTAX ALTER COLUMN TODT SMALLDATETIME NOT NULL "
    Cnn.Execute mysql
    
    mysql = "UPDATE EXTAX SET EXID  =(SELECT EXID  FROM EXMAST WHERE EXMAST.COMPCODE =EXTAX.COMPCODE AND EXTAX.EXCHANGECODE =EXMAST.EXCODE ) WHERE EXID  =0 "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("EXTAX") = False Then
        mysql = "ALTER TABLE EXTAX  ADD Primary key (EXID,FROMDT,TODT  )"
        Cnn.Execute mysql
    End If
End Sub
Public Sub Ver_ContractMaster()

    GETMAIN.Label1.Caption = "Data Integration CONTRACTMASTER "
    DoEvents
    
    VER_ADJ "CONTRACTMASTER", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "CONTRACTMASTER", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "CONTRACTMASTER", "ITEMNAME", "VARCHAR", 50, ""
    VER_ADJ "CONTRACTMASTER", "EX_SYMBOL", "VARCHAR", 50, ""
    VER_ADJ "CONTRACTMASTER", "LOT", "FLOAT", , "0"
    VER_ADJ "CONTRACTMASTER", "SC_GROUP", "VARCHAR", 50, ""
    VER_ADJ "CONTRACTMASTER", "PRICEUNIT", "VARCHAR", 50, ""
    VER_ADJ "CONTRACTMASTER", "QTYUNIT", "VARCHAR", 50, ""
    VER_ADJ "CONTRACTMASTER", "REGULARLOT", "FLOAT", , "0"
    VER_ADJ "CONTRACTMASTER", "DELIVERYUNIT", "VARCHAR", 50, ""
    Call Delete_DependentConstrainst("CONTRACTMASTER", "ACTIVE")
    Call AddAlter_Column("CONTRACTMASTER", "DROP COLUMN", "ACTIVE", vbNullString)
    Call Delete_DependentConstrainst("CONTRACTMASTER", "TRADEABLELOT")
    Call AddAlter_Column("CONTRACTMASTER", "DROP COLUMN", "TRADEABLELOT", vbNullString)
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTRACTMASTER' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CONTRACTMASTER ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTRACTMASTER' AND COLUMN_NAME ='EX_SYMBOL' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CONTRACTMASTER ALTER COLUMN EX_SYMBOL VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTRACTMASTER' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CONTRACTMASTER ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL END"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTRACTMASTER' AND COLUMN_NAME ='ITEMNAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE CONTRACTMASTER ALTER COLUMN ITEMNAME  VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("CONTRACTMASTER") = False Then
        mysql = "ALTER TABLE CONTRACTMASTER ADD Primary key (EXCODE,EX_SYMBOL ) "
        Cnn.Execute mysql
    End If

    mysql = " CREATE NONCLUSTERED INDEX [CONTRACTMASTER_EXCODE] ON [CONTRACTMASTER] ([EXCODE])"
    mysql = mysql & "INCLUDE ([ITEMCODE],[ITEMNAME],[LOT])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    'SCRIPTMASTER

    VER_ADJ "SCRIPTMASTER", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "SCRIPTMASTER", "EX_SYMBOL", "VARCHAR", 50, ""
    VER_ADJ "SCRIPTMASTER", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "SCRIPTMASTER", "LOT", "FLOAT", , "0"
    VER_ADJ "SCRIPTMASTER", "SAUDACODE", "VARCHAR", 50, "0"
    VER_ADJ "SCRIPTMASTER", "SAUDANAME", "VARCHAR", 50, ""
    VER_ADJ "SCRIPTMASTER", "MATURITY", "SMALLDATETIME", , ""
    VER_ADJ "SCRIPTMASTER", "STRIKEPRICE", "FLOAT", , "0"
    VER_ADJ "SCRIPTMASTER", "OPTTYPE", "VARCHAR", 2, ""
    VER_ADJ "SCRIPTMASTER", "INSTTYPE", "VARCHAR", 3, ""
    VER_ADJ "SCRIPTMASTER", "NOCODE", "INT", , "0"
    VER_ADJ "SCRIPTMASTER", "BrokLot", "Float", , "1"
    VER_ADJ "SCRIPTMASTER", "RefLot", "Float", , "1"
    
    Call AddAlter_Column("SCRIPTMASTER", "DROP COLUMN", "ITEMNAME", vbNullString)
    Call AddAlter_Column("SCRIPTMASTER", "DROP COLUMN", "ACTIVE", vbNullString)
    Call AddAlter_Column("SCRIPTMASTER", "DROP COLUMN", "SC_GROUP", vbNullString)
    Call AddAlter_Column("SCRIPTMASTER", "DROP COLUMN", "PRICE_UNIT", vbNullString)
    Call AddAlter_Column("SCRIPTMASTER", "DROP COLUMN", "QTY_UNIT", vbNullString)
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='EX_SYMBOL' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN EX_SYMBOL VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL END"
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='ITEMNAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN ITEMNAME  VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='SAUDACODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN SAUDACODE  VARCHAR(50) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='MATURITY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN MATURITY  SMALLDATETIME NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='INSTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN INSTTYPE  VARCHAR(3) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='OPTTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN OPTTYPE  VARCHAR(2) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'SCRIPTMASTER' AND COLUMN_NAME ='STRIKEPRICE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE SCRIPTMASTER ALTER COLUMN STRIKEPRICE  FLOAT  NOT NULL END "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("SCRIPTMASTER") = False Then
        mysql = "ALTER TABLE SCRIPTMASTER ADD Primary key (EXCODE,EX_SYMBOL,INSTTYPE,OPTTYPE,STRIKEPRICE,MATURITY ) "
        Cnn.Execute mysql
    End If
    mysql = "  CREATE NONCLUSTERED INDEX [SCRIPTMASTER_EXCODE_ITEMCODE_MATURITY] ON [SCRIPTMASTER]"
    mysql = mysql & " ( [EXCODE] ASC,    [ITEMCODE] ASC,    [MATURITY] Asc )"
    mysql = mysql & " INCLUDE([EX_SYMBOL], [LOT], [SAUDACODE], [SAUDANAME], [STRIKEPRICE], [OPTTYPE], [INSTTYPE], [BROKLOT], [REFLOT])"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
End Sub


Public Sub VER_EXFILE()
    GETMAIN.Label1.Caption = "Data Integration EXFILE "
    DoEvents
    
    VER_ADJ "EXFILE", "COMPCODE", "INT", , "0"
    VER_ADJ "EXFILE", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "EXFILE", "FOLDERNAME", "VARCHAR", 50, ""
    VER_ADJ "EXFILE", "CONTRACTACC", "VARCHAR", 15, ""
    VER_ADJ "EXFILE", "BROKERTYPE", "VARCHAR", 1, ""
    VER_ADJ "EXFILE", "PARTYAS", "VARCHAR", 1, ""
    VER_ADJ "EXFILE", "EXFILETYPE", "VARCHAR", 3, "0"
    VER_ADJ "EXFILE", "CLIENTCODE", "VARCHAR", 15, ""
    VER_ADJ "EXFILE", "FILEID", "INT", , "0"
    VER_ADJ "EXFILE", "QTYMULTI", "FLOAT", , "1"
    VER_ADJ "EXFILE", "BROKER2", "VARCHAR", 15, ""
    VER_ADJ "EXFILE", "EXID", "INT", , "0"
    VER_ADJ "EXFILE", "CLIENTID", "INT", , "0"
    VER_ADJ "EXFILE", "BROKERID", "INT", , "0"
    VER_ADJ "EXFILE", "BROKER2ID", "INT", , "0"
    VER_ADJ "EXFILE", "NEWPARTY", "VARCHAR", 1, "Y"
    VER_ADJ "EXFILE", "QTYLOT", "INT", , "0"

    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN COMPCODE INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN EXCODE VARCHAR(10)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='FOLDERNAME' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN FOLDERNAME VARCHAR(50)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='CONTRACTACC' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN CONTRACTACC VARCHAR(15)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='PARTYAS' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN PARTYAS  VARCHAR(1)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='BROKERTYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN BROKERTYPE VARCHAR(1)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='EXFILETYPE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN EXFILETYPE VARCHAR(3)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE EXFILE SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN EXID INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE EXFILE SET BROKERID  =0 WHERE BROKERID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='BROKERID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN BROKERID INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXFILE' AND COLUMN_NAME ='FILEID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXFILE ALTER COLUMN FILEID INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE EXFILE SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =EXFILE.COMPCODE AND EXMAST.EXCODE = EXFILE.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    mysql = "UPDATE EXFILE SET BROKERID =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE =EXFILE.COMPCODE AND EXFILE.CONTRACTACC = ACCOUNTM.AC_CODE ) WHERE BROKERID  =0"
    Cnn.Execute mysql
    
    mysql = "UPDATE EXFILE SET CLIENTID  =0 WHERE CLIENTID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE EXFILE SET CLIENTCODE  =0 WHERE CLIENTCODE IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE EXFILE SET CLIENTID =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE =EXFILE.COMPCODE AND EXFILE.CLIENTCODE  = ACCOUNTM.AC_CODE ) WHERE CLIENTID  =0 AND CLIENTCODE <>'' "
    Cnn.Execute mysql
    
    If CHK_PRIMARY_KEY("EXFILE") = False Then
        mysql = "ALTER TABLE EXFILE ADD Primary key (COMPCODE,FILEID) "
        Cnn.Execute mysql
    End If
    
End Sub
    
Public Sub VER_EXBROKCLIENT()
    GETMAIN.Label1.Caption = "Data Integration EXBROKCLIENT "
    DoEvents

    VER_ADJ "EXBROKCLIENT", "COMPCODE", "INT", , "0"
    VER_ADJ "EXBROKCLIENT", "SNO", "INT", , "0"
    VER_ADJ "EXBROKCLIENT", "BROKER", "VARCHAR", 15, ""
    VER_ADJ "EXBROKCLIENT", "CLIENT", "VARCHAR", 15, ""
    VER_ADJ "EXBROKCLIENT", "BROKID", "INT", , "0"
    VER_ADJ "EXBROKCLIENT", "CLIENTID", "INT", , "0"
    
    Call AddAlter_Column("EXBROKCLIENT", "DROP COLUMN", "EXCODE", vbNullString)
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXBROKCLIENT' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXBROKCLIENT ALTER COLUMN COMPCODE INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXBROKCLIENT' AND COLUMN_NAME ='BROKER' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXBROKCLIENT ALTER COLUMN BROKER VARCHAR(15)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXBROKCLIENT' AND COLUMN_NAME ='CLIENT' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXBROKCLIENT ALTER COLUMN CLIENT  VARCHAR(15)  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXBROKCLIENT' AND COLUMN_NAME ='BROKID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXBROKCLIENT ALTER COLUMN BROKID INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'EXBROKCLIENT' AND COLUMN_NAME ='CLIENTID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE EXBROKCLIENT ALTER COLUMN CLIENTID INT  NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE EXBROKCLIENT SET CLIENTID  =0 WHERE CLIENTID IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE EXBROKCLIENT SET CLIENTID =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE =EXBROKCLIENT.COMPCODE AND EXBROKCLIENT.CLIENT  = ACCOUNTM.AC_CODE ) WHERE CLIENTID  =0  "
    Cnn.Execute mysql
    mysql = "UPDATE EXBROKCLIENT SET BROKID   =0 WHERE BROKID  IS NULL"
    Cnn.Execute mysql
    mysql = "UPDATE EXBROKCLIENT SET BROKID =(SELECT ACCID FROM ACCOUNTM WHERE ACCOUNTM.COMPCODE =EXBROKCLIENT.COMPCODE AND EXBROKCLIENT.BROKER = ACCOUNTM.AC_CODE ) WHERE BROKID   =0  "
    Cnn.Execute mysql
    If CHK_PRIMARY_KEY("EXBROKCLIENT") = False Then
        mysql = "ALTER TABLE EXBROKCLIENT ADD Primary key (BROKID,CLIENTID) "
        Cnn.Execute mysql
    End If
    
    mysql = " CREATE UNIQUE  NONCLUSTERED INDEX [IX_EXBROKCLIENT ] ON  [EXBROKCLIENT] ( COMPCODE,BROKER,CLIENT ) "
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
    
    mysql = " CREATE UNIQUE NONCLUSTERED INDEX [IX_EXBROKCLIENT2 ] ON  [EXBROKCLIENT] ( COMPCODE,CLIENT ) "
    mysql = mysql & " INCLUDE (BROKER)"
    mysql = mysql & " WITH ( FILLFACTOR = 80)"
    Cnn.Execute mysql
End Sub
Public Sub VER_NARRATION()
    mysql = "IF COL_LENGTH('NARRATIONM','NARRID') IS NULL "
    mysql = mysql & " ALTER TABLE NARRATIONM ADD NARRID  INT IDENTITY(1,1) NOT NULL "
    Cnn.Execute mysql
    
    VER_ADJ "NARRATIONM", "NARRCODE", "INT", 1, 0
    VER_ADJ "NARRATIONM", "NARRNAME", "VARCHAR", 1000, "A"
    VER_ADJ "NARRATIONM", "COMPCODE", "INT", 0
    If CHK_PRIMARY_KEY("NARRATIONM") = False Then
        mysql = "ALTER TABLE NARRATIONM  ADD Primary key (NARRID ) "
        Cnn.Execute mysql
    End If
End Sub

Public Sub VER_DAILYMARGIN()
    
    VER_ADJ "DailyMargin", "Compcode", "INT", , "0"
    VER_ADJ "DailyMargin", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "DailyMargin", "ConDate", "SmallDateTime", , ""
    VER_ADJ "DailyMargin", "Party", "VARCHAR", 15, ""
    VER_ADJ "DailyMargin", "ACEXCODE", "VARCHAR", 50, ""
    VER_ADJ "DailyMargin", "RegMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "AddMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "TenMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "DelMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "SpMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "NetBuyMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "TotalMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "TotalMTM", "Float", , "0"
    VER_ADJ "DailyMargin", "TotalMargin", "Float", , "0"
    VER_ADJ "DailyMargin", "NetBal", "Float", , "0"
    VER_ADJ "DailyMargin", "PEAKPER", "Float", , "0"
    VER_ADJ "DailyMargin", "PEAKMARGIN", "Float", , "0"
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DailyMargin' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DailyMargin  ALTER COLUMN COMPCODE INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DailyMargin' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DailyMargin  ALTER COLUMN PARTY VARCHAR(15)   NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DailyMargin' AND COLUMN_NAME ='CONDATE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DailyMargin  ALTER COLUMN CONDATE SMALLDATETIME NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DailyMargin' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE DailyMargin  ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    
End Sub
Public Sub VER_PartyYMulti()

    VER_ADJ "PARTYMULTI", "COMPCODE", "INT", , "0"
    VER_ADJ "PARTYMULTI", "SNO", "INT", , ""
    VER_ADJ "PARTYMULTI", "PARTY", "VARCHAR", 15, ""
    VER_ADJ "PARTYMULTI", "EXCODE", "VARCHAR", 10, ""
    VER_ADJ "PARTYMULTI", "ITEMCODE", "VARCHAR", 20, ""
    VER_ADJ "PARTYMULTI", "RATE", "FLOAT", , "0"
    VER_ADJ "PARTYMULTI", "ACCID", "INT", , "0"
    VER_ADJ "PARTYMULTI", "ITEMID", "INT", , "0"
    VER_ADJ "PARTYMULTI", "EXID", "INT", , "0"
    
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='COMPCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI  ALTER COLUMN COMPCODE INT  NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='PARTY' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI  ALTER COLUMN PARTY VARCHAR(15)   NOT NULL END "
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='EXCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI ALTER COLUMN EXCODE VARCHAR(10) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE PARTYMULTI SET ITEMCODE ='' WHERE ITEMCODE IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='ITEMCODE' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI  ALTER COLUMN ITEMCODE VARCHAR(20) NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE PARTYMULTI SET EXID =0 WHERE EXID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='EXID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI ALTER COLUMN EXID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE PARTYMULTI SET EXID =(SELECT EXID FROM EXMAST WHERE EXMAST.COMPCODE =PARTYMULTI.COMPCODE AND EXMAST.EXCODE = PARTYMULTI.EXCODE) WHERE EXID =0"
    Cnn.Execute mysql
    
    
    mysql = "UPDATE PARTYMULTI SET ITEMID =0  WHERE ITEMID IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='ITEMID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI  ALTER COLUMN ITEMID INT NOT NULL END "
    Cnn.Execute mysql
    mysql = "UPDATE PARTYMULTI SET ITEMID  =(SELECT ITEMID FROM ITEMMAST WHERE ITEMMAST.COMPCODE =PARTYMULTI.COMPCODE AND ITEMMAST.ITEMCODE  = PARTYMULTI.ITEMCODE ) WHERE ITEMCODE <>''"
    Cnn.Execute mysql
    
    mysql = "UPDATE PARTYMULTI SET ACCID  =0   WHERE ACCID  IS NULL"
    Cnn.Execute mysql
    mysql = "IF EXISTS( SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PARTYMULTI' AND COLUMN_NAME ='ACCID' AND IS_NULLABLE ='YES')"
    mysql = mysql & " BEGIN ALTER TABLE PARTYMULTI ALTER COLUMN ACCID  INT NOT NULL END "
    Cnn.Execute mysql
    
    mysql = "UPDATE PARTYMULTI SET ACCID  =(SELECT ACCID FROM ACCOUNTM  WHERE ACCOUNTM.COMPCODE =PARTYMULTI.COMPCODE AND ACCOUNTM.AC_CODE  = PARTYMULTI.PARTY ) WHERE ACCID =0 "
    Cnn.Execute mysql

End Sub

Public Sub Get_LiveRate(LvcDTP1 As Date, LRopt As String, LCount As Integer)

On Error GoTo err1

    '>>> GET LIVE PRICE -- START
    Dim Flag_144 As Boolean
    Dim Flag_178 As Boolean
    
    Dim ldate As Date
    Dim VFiledownload As Boolean
    Dim GRec As ADODB.Recordset
    Dim SREC As ADODB.Recordset
    Dim UREC As ADODB.Recordset
    Dim UREC1 As ADODB.Recordset
    Dim Vconsno As Double
    Dim LExCode As String
    Dim LItemCode As String
    Dim LItemCode_ANGEL As String
    Dim VLiveRate As String
    Dim VSTR As String
    Dim VSTR_ANGEL As String
    Dim VCount As Integer
    Dim Vday As Integer
    Dim VLiveRatestr As String
    Dim myarray() As String
    Dim mytemparray() As String
    Dim LFileSystemObject As FileSystemObject
    Dim FWrite As Variant
    Dim I As Integer
    Dim flag As Boolean
    Dim Dfileame As String
    Dim flaghighlow As Boolean
    Dim TRec As ADODB.Recordset
    Dim TRec2 As ADODB.Recordset
    Dim mscript As String
    Dim mdayname As Integer
    
    
    mdayname = Weekday(LvcDTP1)
    If mdayname = 1 Then
        MsgBox "Sunday Is Rest Day For Live Rate"
        Exit Sub
    End If
    Flag_144 = False
    Flag_178 = True
    
    Dfileame = "rate" & Format(Now, "hhmmss") & ".csv"
    LItemCode = ""
    LItemCode_ANGEL = ""
    flaghighlow = False
    ldate = LvcDTP1 - 10
    Set GRec = Nothing
    Set GRec = New ADODB.Recordset
    If LCount < 1 Then
        'Deletes Rates B4 Taking New
        mysql = "DELETE FROM CTR_R WHERE COMPCODE=" & GCompCode & ""
        mysql = mysql + " AND CONDATE = '" & Format(LvcDTP1, "YYYY/MM/DD") & "' "
        mysql = mysql + " AND ITEMCODE NOT LIKE 'SGX%' "
        If LRopt = "MCX" Then
            mysql = mysql & "AND excode in ('MCX') "
        ElseIf LRopt = "NSE" Then
            mysql = mysql & "AND excode in ('NSE') "
        ElseIf LRopt = "BOTH" Then
            mysql = mysql & "AND excode in ('MCX' ,'NSE') "
        End If
        'GRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
   End If

   mysql = ""
    mysql = "SELECT distinct s.saudaid,upper(I.exHCODE) as 'exsymbol',i.itemcode,i.itemid, i.exid,upper(s.excode) as 'excode', s.saudacode,S.MATURITY , SUBSTRING(CONVERT(VARCHAR,YEAR(S.MATURITY)),3,2)  AS 'VYEAR',  upper(FORMAT (S.MATURITY, 'MMM'))  AS 'VMONTH'  "
    mysql = mysql & ",GETDATE() AS 'CONDATE' , upper(s.insttype) as 'insttype',s.opttype, isnull(s.strikeprice,0) as 'strikeprice'  "
    mysql = mysql & "from saudamast S,ITEMMAST I "
    mysql = mysql & "WHERE s.COMPCODE=i.COMPCODE AND s.COMPCODE=" & GCompCode & " AND i.COMPCODE=" & GCompCode & " AND i.itemid = s.itemid "
    mysql = mysql & " and S.MATURITY >='" & Format(LvcDTP1, "YYYY/MM/DD") & "' AND  (s.saudaid in (select distinct saudaid from ctr_d where COMPCODE=" & GCompCode & " and condate = '" & Format(LvcDTP1, "YYYY/MM/DD") & "') "
    mysql = mysql & " or s.saudaid in (select distinct saudaid from inv_d where COMPCODE=" & GCompCode & " and stdate >= '" & Format(ldate, "YYYY/MM/DD") & "')) "
    If LRopt = "MCX" Then
        mysql = mysql & "AND s.excode in ('MCX') "
    ElseIf LRopt = "NSE" Then
        mysql = mysql & "AND s.excode in ('NSE') "
    ElseIf LRopt = "BOTH" Then
        mysql = mysql & "AND s.excode in ('MCX' ,'NSE') "
    End If
    If LCount >= 1 Then
        mysql = mysql & "AND s.saudaid not in (select distinct saudaid from ctr_r where compcode = " & GCompCode & "  AND CONDATE = '" & Format(LvcDTP1, "YYYY/MM/DD") & "' and isnull(CLOSERATE,0) <> 0) "
    End If
    mysql = mysql & "ORDER BY s.saudacode "
    GRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly

    If Not GRec.EOF Then
        DoEvents
        GETMAIN.ProgressBar1.Max = GRec.RecordCount + 25
        GETMAIN.ProgressBar1.Value = 0
        GETMAIN.ProgressBar1.Visible = True
    
        DoEvents
        Set SREC = Nothing
        Set SREC = New ADODB.Recordset
        SREC.Fields.Append "ITEMCODE", adVarChar, 50, adFldIsNullable
        SREC.Fields.Append "excode", adVarChar, 50, adFldIsNullable
        SREC.Fields.Append "saudacode", adVarChar, 50, adFldIsNullable
        SREC.Fields.Append "saudaid", adVarChar, 50, adFldIsNullable
        SREC.Fields.Append "Condate", adDate, , adFldIsNullable
        SREC.Fields.Append "VYear", adVarChar, 10, adFldIsNullable
        SREC.Fields.Append "VMonth", adVarChar, 10, adFldIsNullable
        SREC.Fields.Append "LiveRate", adDouble, , adFldIsNullable
        SREC.Fields.Append "high", adDouble, , adFldIsNullable
        SREC.Fields.Append "low", adDouble, , adFldIsNullable
        SREC.Fields.Append "open", adDouble, , adFldIsNullable
        SREC.Fields.Append "VSTR", adVarChar, 100, adFldIsNullable
        SREC.Fields.Append "VSTR_ANGEL", adVarChar, 200, adFldIsNullable
        SREC.Fields.Append "ITEMID", adVarChar, 100, adFldIsNullable
        SREC.Fields.Append "EXID", adVarChar, 100, adFldIsNullable
        SREC.Open , , adOpenKeyset, adLockBatchOptimistic
    
        VCount = 0
        Do While Not GRec.EOF
            DoEvents
            '>>> create URL to get live rate
            
            'If GRec!INSTTYPE = "OPT" Then GoTo nextrec
            Vday = Day(GRec!MATURITY)
            If GRec!excode = "NSE" Then
                If GRec!INSTTYPE = "OPT" Then
                    If Vday > 24 Then
                        VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & GRec!STRIKEPRICE & GRec!OPTTYPE
                    ElseIf Vday < 10 Then
                        VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & month(GRec!MATURITY) & "0" & Vday & GRec!STRIKEPRICE & GRec!OPTTYPE
                    Else
                        VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & month(GRec!MATURITY) & Vday & GRec!STRIKEPRICE & GRec!OPTTYPE
                    End If
                    VSTR_ANGEL = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & GRec!VYear & GRec!STRIKEPRICE & GRec!OPTTYPE
                Else
                    VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & "FUT"
                    VSTR_ANGEL = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & Vday & GRec!Vmonth & GRec!VYear & "FUT"
                End If
                
                If LItemCode = "" Then
                    If GRec!STRIKEPRICE > 0 Then
                        LItemCode = "NFO" & ":" & VSTR
                        'LItemCode_ANGEL = VSTR_ANGEL
                    Else
                        LItemCode = "NFO" & ":" & VSTR
                        LItemCode_ANGEL = "NFO" & ":" & VSTR_ANGEL
                    End If
                Else
                    If GRec!STRIKEPRICE > 0 Then
                        LItemCode = LItemCode & "$" & "NFO" & ":" & VSTR
                        'LItemCode_ANGEL = LItemCode_ANGEL & "$" & VSTR_ANGEL
                     Else
                        LItemCode = LItemCode & "$" & "NFO" & ":" & VSTR
                        LItemCode_ANGEL = LItemCode_ANGEL & "$" & "NFO" & ":" & VSTR_ANGEL
                     End If
                End If
                
            ElseIf GRec!excode = "MCX" Then
                VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & "FUT"
                VSTR_ANGEL = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & "FUT"
                If LItemCode = "" Then
                    LItemCode = "MCX" & ":" & VSTR
                    LItemCode_ANGEL = "MCX" & ":" & VSTR_ANGEL
                Else
                    LItemCode = LItemCode & "$" & "MCX" & ":" & VSTR
                    LItemCode_ANGEL = LItemCode_ANGEL & "$" & "MCX" & ":" & VSTR_ANGEL
                End If
            End If
            DoEvents
            '>>> add in record set
            With SREC
       
                .AddNew
                !ITEMCODE = GRec!exsymbol
                !excode = GRec!excode
                !saudacode = GRec!saudacode
                !SAUDAID = GRec!SAUDAID
                !Condate = GRec!Condate
                !VYear = GRec!VYear
                !Vmonth = GRec!Vmonth
                !liverate = 0
                !HIGH = 0
                !LOW = 0
                !Open = 0
                !VSTR = Replace(Replace(VSTR, "%26", "&"), "%2D", "-")
                !VSTR_ANGEL = Replace(Replace(VSTR_ANGEL, "%26", "&"), "%2D", "-")
                !itemid = GRec!itemid
                !EXID = GRec!EXID
                
                .Update
            End With
            DoEvents
            VCount = VCount + 1
            
            If VCount = 5 Then
                VCount = 0
                DoEvents

                If Flag_144 Then
                    mscript = "http://" & IP_ANGEL & "/liveprice_angel.aspx?scrip=" & LItemCode_ANGEL
                    DeleteUrlCacheEntry "http://" & IP_ANGEL & "/liveprice_ANGEL.aspx?scrip=" & LItemCode_ANGEL
               
                    VFiledownload = URLDownloadToFile(0&, "http://" & IP_ANGEL & "/liveprice_ANGEL.aspx?scrip=" & LItemCode_ANGEL, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                    DoEvents
                Else
                    VFiledownload = False
                End If
                
                If Not VFiledownload Then
                    Flag_144 = False
                    mscript = "http://" & IP_ZERODHA & "/liveprice.aspx?scrip=" & LItemCode
                    DeleteUrlCacheEntry "http://" & IP_ZERODHA & "/liveprice.aspx?scrip=" & LItemCode
                    VFiledownload = URLDownloadToFile(0&, "http://" & IP_ZERODHA & "/liveprice.aspx?scrip=" & LItemCode, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                    If VFiledownload Then
                        Flag_178 = True
                    End If
                    DoEvents
                End If
                
                If VFiledownload Then
                    If FileExist(App.Path & "\" & Dfileame) Then
                        VLiveRatestr = ""
                        Open App.Path & "\" & Dfileame For Input As #1
                            Do While Not EOF(1)
                                Line Input #1, VLiveRate
                            Loop
                        Close #1
                        DoEvents
                        VLiveRate = Replace(VLiveRate, "[", "")
                        VLiveRate = Replace(VLiveRate, "]", "")
                        myarray() = Split(VLiveRate, "},{")
        
                        For I = 0 To UBound(myarray)
                            DoEvents
                            VLiveRate = Replace(myarray(I), "{", "")
                            VLiveRate = Replace(VLiveRate, "}", "")
                            VLiveRate = Replace(VLiveRate, """scrip"":""", "")
                            
                            If InStr(1, VLiveRate, "NFO") > 0 Then
                                VLiveRate = Replace(VLiveRate, """,""exchange"":""NFO"",""price"":""", "^")
                                '>>> to manage high, low, open
                                If InStr(1, VLiveRate, "high") > 0 Then
                                    flaghighlow = True
                                    VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                                    VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                                    VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                                    VLiveRate = Replace(VLiveRate, """,""close"":""", "^")
                                End If
                            ElseIf InStr(1, VLiveRate, "MCX") > 0 Then
                                VLiveRate = Replace(VLiveRate, """,""exchange"":""MCX"",""price"":""", "^")
                                '>>> to manage high, low, open
                                If InStr(1, VLiveRate, "high") > 0 Then
                                    flaghighlow = True
                                    VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                                    VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                                    VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                                    VLiveRate = Replace(VLiveRate, """,""close"":""", "^")
                                End If
                            End If
                            VLiveRate = Replace(VLiveRate, """", "")
                            mytemparray() = Split(VLiveRate, "^")
                            DoEvents
                            SREC.MoveFirst
                                                        
                            SREC.Find "VSTR='" & mytemparray(0) & "'", , adSearchForward
                            If SREC.EOF Then
                                SREC.MoveFirst
                                SREC.Find "VSTR_ANGEL='" & mytemparray(0) & "'", , adSearchForward
                            End If
                            If Not SREC.EOF Then
                                DoEvents
                                If mytemparray(1) <> "" Then
                                    SREC!liverate = mytemparray(1)
                                    If flaghighlow Then
                                        SREC!HIGH = mytemparray(2)
                                        SREC!LOW = mytemparray(3)
                                        SREC!Open = mytemparray(4)
                                    End If
                                    SREC.Update
                                End If
                            End If
                            DoEvents
                            Erase mytemparray
                        Next
                        Erase myarray
                        '>>> delete live rate file
                        DoEvents
                        Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                        LFileSystemObject.DeleteFile App.Path & "\" & Dfileame
                    End If
                 Else
                        Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                        Set FWrite = LFileSystemObject.CreateTextFile(App.Path & "\LiveRate_log.txt", True)
                        FWrite.WriteLine ("[" & Now & " >>> " & "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode & "]")
                        FWrite.Close
                 End If
                LItemCode = ""
                LItemCode_ANGEL = ""
            End If
            DoEvents
            GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
            DoEvents
nextrec:
            GRec.MoveNext
        Loop

        If LItemCode <> "" Then
        
            If Flag_144 Then
                'mscript = "http://" & IP_ANGEL & "/liveprice.aspx?scrip=" & LItemCode_ANGEL
                mscript = "http://" & IP_ANGEL & "/LivePrice_angel.aspx?scrip=" & LItemCode_ANGEL
                DeleteUrlCacheEntry "http://" & IP_ANGEL & "/LivePrice_angel.aspx?scrip=" & LItemCode_ANGEL
                VFiledownload = URLDownloadToFile(0&, "http://" & IP_ANGEL & "/LivePrice_angel.aspx?scrip=" & LItemCode_ANGEL, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                DoEvents
            Else
                VFiledownload = False
            End If
            DoEvents

            If Not VFiledownload Then
                Flag_144 = False

                mscript = "http://" & IP_ZERODHA & "/liveprice.aspx?scrip=" & LItemCode
                DeleteUrlCacheEntry "http://" & IP_ZERODHA & "/liveprice.aspx?scrip=" & LItemCode
                VFiledownload = URLDownloadToFile(0&, "http://" & IP_ZERODHA & "/liveprice.aspx?scrip=" & LItemCode, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                DoEvents
                If VFiledownload Then
                    Flag_178 = True
                End If
            End If
                
            DoEvents
            GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
            DoEvents
        If VFiledownload Then
            If FileExist(App.Path & "\" & Dfileame) Then
                VLiveRatestr = ""
                DoEvents
                Open App.Path & "\" & Dfileame For Input As #1
                    Do While Not EOF(1)
                        Line Input #1, VLiveRate
                    Loop
                Close #1
                DoEvents
                VLiveRate = Replace(VLiveRate, "[", "")
                VLiveRate = Replace(VLiveRate, "]", "")
                
                myarray() = Split(VLiveRate, "},{")
                
                For I = 0 To UBound(myarray)
                    DoEvents
                    VLiveRate = Replace(myarray(I), "{", "")
                    VLiveRate = Replace(VLiveRate, "}", "")
                    VLiveRate = Replace(VLiveRate, """scrip"":""", "")
                    
                    If InStr(1, VLiveRate, "NFO") > 0 Then
                        VLiveRate = Replace(VLiveRate, """,""exchange"":""NFO"",""price"":""", "^")
                        '>>> to manage high, low, open
                        If InStr(1, VLiveRate, "high") > 0 Then
                            flaghighlow = True
                            VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                            VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                            VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                            VLiveRate = Replace(VLiveRate, """,""close"":""", "^")
                        End If
                        
                    ElseIf InStr(1, VLiveRate, "MCX") > 0 Then
                        VLiveRate = Replace(VLiveRate, """,""exchange"":""MCX"",""price"":""", "^")
                        
                        '>>> to manage high, low, open
                        If InStr(1, VLiveRate, "high") > 0 Then
                            flaghighlow = True
                            VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                            VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                            VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                            VLiveRate = Replace(VLiveRate, """,""close"":""", "^")
                        End If
                                                
                    End If
                    VLiveRate = Replace(VLiveRate, """", "")
                    mytemparray() = Split(VLiveRate, "^")
                                                            
                    SREC.MoveFirst
                    SREC.Find "VSTR='" & mytemparray(0) & "'", , adSearchForward
                    If SREC.EOF Then
                        SREC.MoveFirst
                        SREC.Find "VSTR_ANGEL='" & mytemparray(0) & "'", , adSearchForward
                    End If
                    If Not SREC.EOF Then
                        DoEvents
                        If mytemparray(1) <> "" Then
                            SREC!liverate = mytemparray(1)
                            If flaghighlow Then
                                SREC!HIGH = mytemparray(2)
                                SREC!LOW = mytemparray(3)
                                SREC!Open = mytemparray(4)
                            End If
                            SREC.Update
                        End If
                    End If
                    Erase mytemparray
                Next
                
                '>>> delete live rate file
                 DoEvents
                GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
                DoEvents
                Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                LFileSystemObject.DeleteFile App.Path & "\" & Dfileame
           End If
           Else
                Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                Set FWrite = LFileSystemObject.CreateTextFile(App.Path & "\LiveRate_log.txt", True)
                FWrite.WriteLine ("[" & Now & " >>> " & "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode & "]")
                FWrite.Close
           End If
           End If

        'loop SREC TO INSERT/UPDATE ROM CTR_R
        Dim LContime As String
        SREC.MoveFirst
        While Not SREC.EOF
            flag = False
            DoEvents

            If SREC!liverate > 0 Then
                mysql = "select saudaid from ctr_r where COMPCODE=" & GCompCode & " AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "' and saudaid='" & SREC!SAUDAID & "'"
                Set UREC = Nothing
                Set UREC = New ADODB.Recordset
                UREC.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                If Not UREC.EOF Then
                    'MYSQL = "update ctr_r set CLOSERATE = " & SREC!liverate & ",LOWRATE=" & SREC!low & ",HGRATE=" & SREC!high & "     WHERE COMPCODE=" & GCompCode & "  AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "  AND saudaid=" & SREC!SAUDAID & ""
                    Cnn.Execute "update ctr_r set CLOSERATE = " & SREC!liverate & ",LOWRATE=" & SREC!LOW & ",HGRATE=" & SREC!HIGH & ",OPRATE=" & SREC!Open & "  WHERE COMPCODE=" & GCompCode & "  AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "' AND saudaid=" & SREC!SAUDAID & ""
                Else
                    mysql = "select consno from ctr_m where COMPCODE=" & GCompCode & " AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "' and saudaid='" & SREC!SAUDAID & "'"
                    Set UREC1 = Nothing
                    Set UREC1 = New ADODB.Recordset
                    UREC1.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                    If UREC1.EOF Then
                        flag = True
                        mysql = "select max(consno)+1 as 'consno' from ctr_m where COMPCODE=" & GCompCode & ""
                        Set UREC1 = Nothing
                        Set UREC1 = New ADODB.Recordset
                        UREC1.Open mysql, Cnn, adOpenStatic, adLockReadOnly
                        If Not UREC1.EOF Then
                            Vconsno = UREC1!CONSNO
                        Else
                            Vconsno = 0
                        End If
                    Else
                        Vconsno = UREC1!CONSNO
                        flag = False
                    End If
                    LContime = Time
                    '>>> INSERT INTO CTR_R
                    DoEvents
                    Call PInsert_Ctr_R(Vconsno, SREC!saudacode, SREC!Condate, SREC!Open, SREC!HIGH, SREC!LOW, SREC!liverate, 0, SREC!excode, SREC!ITEMCODE, SREC!SAUDAID, SREC!itemid, SREC!EXID, 0, LContime)
                    DoEvents
                    If flag Then
                        mysql = "EXEC INSERT_CTR_M " & GCompCode & "," & Vconsno & ",'" & Format(SREC!Condate, "YYYY/MM/DD") & "','" & SREC!saudacode & "','" & SREC!ITEMCODE & "','C','" & SREC!excode & "'," & SREC!EXID & "," & SREC!itemid & "," & SREC!SAUDAID & ""
                        Cnn.Execute mysql
                    End If
                    
                    '''''Closing ID
                    
                End If
            End If
            DoEvents
            SREC.MoveNext
        Wend
        DoEvents
        GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
        DoEvents
        'End If
    End If  ' If Not GRec.EOF Then
    '>>> GET LIVE PRICE -- END
    
    LCount = LCount + 1
    VCount = GRec.RecordCount
    If LCount >= 1 Then
        If LCount >= 8 Or VCount = 0 Then
            Exit Sub
        End If

        Call Get_LiveRate(LvcDTP1, LRopt, LCount)
    End If
    
    '''Closing Id
     Dim LSConSno As Double
     Set TRec = Nothing
     Set TRec = New ADODB.Recordset
     mysql = "SELECT S.SAUDAID,I.CITEMID,S.SAUDACODE,S.EXCODE,I.ITEMCODE,I.ITEMID,I.EXID,S.MATURITY FROM SAUDAMAST AS S, ITEMMAST AS I"
     mysql = mysql & " WHERE s.COMPCODE =" & GCompCode & " AND S.ITEMID =I.ITEMID AND I.ITEMID <>I.CITEMID   "
     TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
     Do While Not TRec.EOF
        Set TRec2 = Nothing
        Set TRec2 = New ADODB.Recordset
        mysql = "SELECT OPRATE,HGRATE,LOWRATE,CLOSERATE FROM CTR_R WHERE COMPCODE =" & GCompCode & " AND CONDATE ='" & Format(LvcDTP1, "YYYY/MM/DD") & "' AND SAUDAID ="
        mysql = mysql & " (SELECT SAUDAID FROM SAUDAMAST WHERE COMPCODE =" & GCompCode & " AND  ITEMID =" & TRec!CITEMID & " AND MATURITY ='" & Format(TRec!MATURITY, "YYYY/MM/DD") & "')"
        TRec2.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec2.EOF Then
            LSConSno = Get_ConSNo(LvcDTP1, TRec!saudacode, TRec!ITEMCODE, TRec!excode, TRec!SAUDAID, TRec!itemid, TRec!EXID)
            mysql = "DELETE FROM CTR_R WHERE COMPCODE =" & GCompCode & " AND SAUDAID =" & TRec!SAUDAID & " AND CONDATE ='" & Format(LvcDTP1, "YYYY/MM/DD") & "'"
            Cnn.Execute mysql
            Call PInsert_Ctr_R(LSConSno, TRec!saudacode, LvcDTP1, TRec2!OPRATE, TRec2!HGRATE, TRec2!LOWRATE, TRec2!CLOSERATE, 0, TRec!excode, TRec!ITEMCODE, TRec!SAUDAID, TRec!itemid, TRec!EXID, 0, "")
        End If
        TRec.MoveNext
    Loop
err1:
If err.Number <> 0 Then
    MsgBox err.Description
End If


End Sub

Public Sub Bill_summary_share(LSParties As String, LSSaudas As String, LSExCodes As String, LSInst As String, vcDTP1 As Date, vcDTP2 As Date, Check4 As Integer, LSFmlyIDs As String, AllParties As Boolean, AllFmly As Boolean, AllSaudas As Boolean, AllExcodes As Boolean, AllInst As Boolean, mcons As Boolean, unqucc As String, minclcontra As String, mclshare As Boolean)
    On Error GoTo err1
    Dim SrNo As Long
    Dim LMEXCODE  As String:     Dim LSauda  As String:          Dim LOp_Bal As Double:           Dim LOpBalUSD As Double
    Dim LParty As String:        Dim LPartyName As String:       Dim LPartyCode As String:        Dim LPartyName2 As String
    Dim Rec As ADODB.Recordset:  Dim BillRec As ADODB.Recordset: Dim PartyRec As ADODB.Recordset: Dim VouRec As ADODB.Recordset
    Dim MRec As ADODB.Recordset: Dim RecInv As ADODB.Recordset:  Dim LTotBQty  As Double:         Dim LTotBAmt  As Double
    Dim LTotSQty As Double:      Dim LTotSamt As Double:         Dim LTotDiffAmt As Double:       Dim LTotBrokAmt As Double
    Dim LTotSTDAmt  As Double:   Dim LTotStampAmt  As Double:    Dim LTotBillamt As Double:       Dim LTotSrvAmt  As Double
    Dim LTotTranAmt As Double:   Dim LBAlFlag As Boolean:        Dim LAddFlag As Boolean:         Dim LBal As Double:
    Dim MBal As Double:          Dim RecRpt1 As ADODB.Recordset
    
    Dim LAcExCode As String
    Dim acexRec As ADODB.Recordset
    Dim LNetAmt As Double: Dim LSaudaID As Integer
    Dim TRec As ADODB.Recordset: Dim MDate As Date
    Dim lcrusdinr As Double, ldrusdinr As Double
    SrNo = 0
        
    FlagBillSummary = True
    Set RecRpt1 = Nothing
    
    Set RecRpt1 = New ADODB.Recordset
    RecRpt1.Fields.Append "CODE", adVarChar, 15, adFldIsNullable
    RecRpt1.Fields.Append "NAME", adVarChar, 100, adFldIsNullable
    RecRpt1.Fields.Append "DIFFER", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "BROKAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "STDAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "TRANAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "SRVAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "STAMPAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "BILLAMT", adDouble, , adFldIsNullable
    RecRpt1.Open , , adOpenKeyset, adLockBatchOptimistic
    
    
    Set GlobalRecRpt = Nothing
    Set GlobalRecRpt = New ADODB.Recordset
    GlobalRecRpt.Fields.Append "LCODE", adVarChar, 15, adFldIsNullable
    GlobalRecRpt.Fields.Append "LNAME", adVarChar, 100, adFldIsNullable
    GlobalRecRpt.Fields.Append "LDIFFER", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LBROKAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LSTDAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LTRANAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LBILLAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RCODE", adVarChar, 15, adFldIsNullable
    GlobalRecRpt.Fields.Append "RNAME", adVarChar, 100, adFldIsNullable
    GlobalRecRpt.Fields.Append "RDIFFER", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RBROKAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RSTDAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RTRANAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RBILLAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "SAUDACODE", adVarChar, 50, adFldIsNullable
    GlobalRecRpt.Fields.Append "SAUDA", adVarChar, 50, adFldIsNullable
    GlobalRecRpt.Fields.Append "ITEMCODE", adVarChar, 20, adFldIsNullable
    GlobalRecRpt.Fields.Append "ITEMNAME", adVarChar, 50, adFldIsNullable
    GlobalRecRpt.Fields.Append "LSRVAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RSRVAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LSTAMPAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RSTAMPAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LNetValue", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RNetValue", adDouble, , adFldIsNullable
    
    GlobalRecRpt.Open , , adOpenKeyset, adLockBatchOptimistic
    
    MDate = Format(vcDTP2, "YYYY/MM/DD")
    lcrusdinr = 0: ldrusdinr = 0
    LSaudaID = Get_SaudaID("USDINR")
    mysql = ""
    mysql = "select lowrate,hgrate as rate from ctr_r where saudaid = " & LSaudaID & " and condate = '" & Format(vcDTP2, "YYYY/MM/DD") & "'"
    Set BillRec = Nothing
    Set BillRec = New ADODB.Recordset
    BillRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    If Not BillRec.EOF Then
        lcrusdinr = BillRec!LOWRATE
        ldrusdinr = BillRec!Rate
    End If
       If GOnlyBrok = 0 Then
            mysql = "SELECT AD.AC_CODE,AD.NAME,SUM(I.DIFFAMT) AS DIFFAMT ,SUM(I.BROKAMT) AS BROKAMT ,SUM(I.SRVAMT) AS SRVAMT,"
            mysql = mysql & " SUM(I.STAMPAMT) AS STAMPAMT, SUM(I.BILLAMT) AS BILLAMT FROM INV_D AS I, ACCOUNTD AS AD, SAUDAMAST AS S   "
        Else
            If Check4 = 1 Then
                If GUniqClientId = "BRO2-CHE" Then
                    mysql = "SELECT AD.AC_CODE,AD.NAME,SUM(I.DIFFAMT*I.USDINR) AS DIFFAMT ,SUM(I.BROKAMT*I.CURRRATE) AS BROKAMT,"
                    mysql = mysql & " SUM(I.DIFFAMT*I.USDINR)+SUM(I.BROKAMT*I.CURRRATE) AS BILLAMT FROM INV_D AS I, ACCOUNTD AS AD , SAUDAMAST AS S "
                Else
                    mysql = "SELECT AD.AC_CODE,AD.NAME,SUM(I.DIFFAMT*I.USDINR) AS DIFFAMT ,SUM(I.BROKAMT*I.USDINR) AS BROKAMT,"
                    mysql = mysql & " SUM(I.BILLAMT*I.USDINR) AS BILLAMT FROM INV_D AS I, ACCOUNTD AS AD , SAUDAMAST AS S "
                End If
                
            Else
                mysql = "SELECT AD.AC_CODE,AD.NAME,SUM(I.DIFFAMT) AS DIFFAMT ,SUM(I.BROKAMT) AS BROKAMT,"
                mysql = mysql & " SUM(I.BILLAMT) AS BILLAMT FROM INV_D AS I, ACCOUNTD AS AD , SAUDAMAST AS S "
            End If
        End If
        mysql = mysql & " WHERE I.COMPCODE =" & GCompCode & " AND  I.ACCID =AD.ACCID "
        mysql = mysql & " AND S.SAUDAID = I.SAUDAID"
        mysql = mysql & " AND STDATE>='" & Format(vcDTP1, "YYYY/MM/DD") & "' AND STDATE<='" & Format(vcDTP2, "YYYY/MM/DD") & "' "
        If AllFmly = False And LenB(LSFmlyIDs) > 0 And AllParties = True Then
            mysql = mysql & " AND AD.ACCID  IN (SELECT ACCID FROM ACCFMLYD WHERE FMLYID IN (" & LSFmlyIDs & "))"
        End If
        If AllParties = False And LenB(LSParties) > 0 Then mysql = mysql & " AND AD.AC_CODE IN (" & LSParties & ")"
        If Len(LSSaudas) > 1 Then mysql = mysql & "  AND S.SAUDACODE IN ('" & LSSaudas & "')"
        If AllExcodes = False And LenB(LSExCodes) > 0 Then mysql = mysql & " AND S.EXID IN (" & LSExCodes & ")"
        If AllSaudas = True And AllInst = False Then mysql = mysql & " AND  S.INSTTYPE  IN  (" & LSInst & ") "
        mysql = mysql & " GROUP BY AD.AC_CODE,AD.NAME"
        mysql = mysql & " ORDER BY AD.NAME"
    'End If
    Set BillRec = Nothing
    Set BillRec = New ADODB.Recordset
    BillRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    
    
    Do While Not BillRec.EOF
        LBAlFlag = True
        ''
        LAcExCode = BillRec!AC_CODE
        LPartyName = BillRec!NAME
        If mcons <> 0 Then
            Set acexRec = Nothing
            Set acexRec = New ADODB.Recordset
            mysql = "SELECT UCC FROM ACCOUNTD "
            mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!AC_CODE & "'"
            acexRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not acexRec.EOF Then
                If Len(acexRec!UCC) > 0 Then
                    LAcExCode = acexRec!UCC
                    LPartyName = LAcExCode
                End If
            End If
            If Len(unqucc) > 0 Then
                If unqucc <> LAcExCode Then
                    LBAlFlag = False
                End If
                LAcExCode = BillRec!AC_CODE
                LPartyName = BillRec!NAME
            End If
        End If
        If LBAlFlag Then
            RecRpt1.AddNew
            RecRpt1!Code = Left(LAcExCode, 15):
            RecRpt1!NAME = LPartyName

            ''
            RecRpt1!DIFFER = BillRec!DIFFAMT:           RecRpt1!BROKAMT = BillRec!BROKAMT
            If GOnlyBrok = 0 Then
                RecRpt1!SRVAMT = BillRec!SRVAMT:   RecRpt1!STampamt = BillRec!STampamt
            Else
                RecRpt1!SRVAMT = 0:                     RecRpt1!STampamt = 0
            End If
            RecRpt1!STDAMT = 0:                         RecRpt1!TranAmt = 0
            RecRpt1!Billamt = BillRec!Billamt:    RecRpt1.Update
        End If
        BillRec.MoveNext
    Loop
    If Check4 = 1 Then
        mysql = "SELECT A.NAME,I.PARTY,FMLY.FMLYNAME,FMLY.FMLYHEAD,A2.NAME AS FMLYNM,FMLY.CONTRA_AC,A3.NAME AS CONTRANAME,SUM(AMOUNT*USDINR) AS BBROKAMT,SUM(SAMOUNT*USDINR)AS SHAREAMT "
    Else
         mysql = "SELECT A.NAME,I.PARTY,FMLY.FMLYNAME,FMLY.FMLYHEAD,A2.NAME AS FMLYNM,FMLY.CONTRA_AC,A3.NAME AS CONTRANAME,SUM(AMOUNT) AS BBROKAMT,SUM(SAMOUNT)AS SHAREAMT "
   End If
    mysql = mysql & " FROM INV_D1 AS I, ACCOUNTM AS A, ACCFMLY AS FMLY, ACCOUNTM AS A2, ACCOUNTM AS A3, SAUDAMAST AS S "
    mysql = mysql & " WHERE  A.COMPCODE =" & GCompCode & " And I.ACCID  = A.ACCID AND I.FMLYID = FMLY.FMLYID "
    mysql = mysql & " AND A2.ACCID  =FMLY.HEADID AND  A3.ACCID = FMLY.CONTRAID AND S.SAUDAID = I.SAUDAID "
    If AllFmly = False And LenB(LSFmlyIDs) > 0 And AllParties = True Then
        mysql = mysql & " AND A.ACCID IN (SELECT DISTINCT ACCID FROM ACCFMLYD WHERE FMLYID IN  (" & LSFmlyIDs & "))"
    End If
    If AllParties = False And LenB(LSParties) > 0 Then mysql = mysql & " AND A.AC_CODE IN (" & LSParties & ")"
    If Len(LSSaudas) > 1 Then mysql = mysql & "  AND S.SAUDACODE IN ('" & LSSaudas & "')"
    If AllExcodes = False And LenB(LSExCodes) > 0 Then mysql = mysql & " AND S.EXID IN (" & LSExCodes & ")"
    If AllSaudas = True And AllInst = False Then mysql = mysql & " AND  S.INSTTYPE  IN  (" & LSInst & ") "
    mysql = mysql & " AND I.STDATE>='" & Format(vcDTP1, "YYYY/MM/DD") & "' AND I.STDATE<='" & Format(vcDTP2, "YYYY/MM/DD") & "'"
    mysql = mysql & " GROUP BY A.NAME,I.PARTY, FMLY.FMLYNAME, FMLY.FMLYHEAD,A2.NAME, FMLY.CONTRA_AC,A3.NAME"
    mysql = mysql & " ORDER BY A.NAME,I.PARTY, FMLY.FMLYNAME, FMLY.FMLYHEAD,A2.NAME, FMLY.CONTRA_AC,A3.NAME"
    Set BillRec = Nothing
    Set BillRec = New ADODB.Recordset
    BillRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
    
    LBAlFlag = False
    Do While Not BillRec.EOF
        
        LBAlFlag = True
        If BillRec!BBROKAMT <> 0 Then
            ''
            If mclshare Then
                LAcExCode = BillRec!PARTY
                LPartyName = BillRec!NAME
            Else
                LAcExCode = BillRec!FMLYHEAD
                LPartyName = BillRec!fmlynm
            End If
            If mcons <> 0 Then
                Set acexRec = Nothing
                Set acexRec = New ADODB.Recordset
                mysql = "SELECT UCC FROM ACCOUNTD "
                mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!FMLYHEAD & "'"
                acexRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not acexRec.EOF Then
                    If Len(acexRec!UCC) > 0 Then
                        LAcExCode = acexRec!UCC
                        LPartyName = LAcExCode
                    End If
                End If
                If Len(unqucc) > 0 Then
                    If unqucc <> LAcExCode Then
                        LBAlFlag = False
                    End If
                    If mclshare Then
                        LAcExCode = BillRec!PARTY
                        LPartyName = BillRec!NAME
                    Else
                        LAcExCode = BillRec!FMLYHEAD
                        LPartyName = BillRec!fmlynm
                    End If
                End If
            End If
            If LBAlFlag Then
                RecRpt1.AddNew
                RecRpt1!Code = Left(LAcExCode, 15):
                RecRpt1!NAME = LPartyName
            ''
                RecRpt1!STDAMT = BillRec!BBROKAMT:  RecRpt1!Billamt = BillRec!BBROKAMT
                RecRpt1!DIFFER = 0:                 RecRpt1!BROKAMT = 0
                RecRpt1!TranAmt = 0:                RecRpt1!SRVAMT = 0
                RecRpt1!STampamt = 0

                RecRpt1.Update
            End If
        End If
        
        If BillRec!SHAREAMT <> 0 Then
            ''
            If mclshare Then
                LAcExCode = BillRec!PARTY
                LPartyName = BillRec!NAME
            Else
                LAcExCode = BillRec!FMLYHEAD
                LPartyName = BillRec!fmlynm
            End If
            If mcons <> 0 Then
                Set acexRec = Nothing
                Set acexRec = New ADODB.Recordset
                mysql = "SELECT UCC FROM ACCOUNTD "
                mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!FMLYHEAD & "'"
                acexRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not acexRec.EOF Then
                    If Len(acexRec!UCC) > 0 Then
                        LAcExCode = acexRec!UCC
                        LPartyName = LAcExCode
                    End If
                End If
                If Len(unqucc) > 0 Then
                    If unqucc <> LAcExCode Then
                        LBAlFlag = False
                    End If
                    If mclshare Then
                        LAcExCode = BillRec!PARTY
                        LPartyName = BillRec!NAME
                    Else
                        LAcExCode = BillRec!FMLYHEAD
                        LPartyName = BillRec!fmlynm
                    End If
                End If
            End If
            
            If LBAlFlag Then
                RecRpt1.AddNew
                RecRpt1!Code = Left(LAcExCode, 15):
                RecRpt1!NAME = LPartyName

                RecRpt1!TranAmt = BillRec!SHAREAMT * -1:    RecRpt1!Billamt = BillRec!SHAREAMT * -1
                RecRpt1!DIFFER = 0:                         RecRpt1!BROKAMT = 0
                RecRpt1!STDAMT = 0:                         RecRpt1!SRVAMT = 0
                RecRpt1!STampamt = 0:                       RecRpt1.Update
            End If

            ''
            If minclcontra = "1" Then
            LAcExCode = BillRec!Contra_Ac
            LPartyName = BillRec!CONTRAname
            If mcons <> 0 Then
                Set acexRec = Nothing
                Set acexRec = New ADODB.Recordset
                mysql = "SELECT UCC FROM ACCOUNTD "
                mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!Contra_Ac & "'"
                acexRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not acexRec.EOF Then
                    If Len(acexRec!UCC) > 0 Then
                        LAcExCode = acexRec!UCC
                        LPartyName = LAcExCode
                    End If
                End If
                If Len(unqucc) > 0 Then
                    If unqucc <> LAcExCode Then
                        LBAlFlag = False
                    End If
                    LAcExCode = BillRec!Contra_Ac
                    LPartyName = BillRec!CONTRAname
                End If
            End If
            If LBAlFlag Then
                RecRpt1.AddNew
                RecRpt1!Code = Left(LAcExCode, 15):
                RecRpt1!NAME = LPartyName

            ''
                RecRpt1!TranAmt = BillRec!SHAREAMT:         RecRpt1!Billamt = BillRec!SHAREAMT
                RecRpt1!DIFFER = 0:                         RecRpt1!BROKAMT = 0
                RecRpt1!STDAMT = 0:                         RecRpt1!SRVAMT = 0
                RecRpt1!STampamt = 0:                       RecRpt1.Update
           End If
           End If
        End If
        BillRec.MoveNext
    Loop
    LTotDiffAmt = 0: LTotBrokAmt = 0: LTotSTDAmt = 0: LTotStampAmt = 0: LTotBillamt = 0: LTotSrvAmt = 0: LTotTranAmt = 0
    If RecRpt1.RecordCount > 0 Then
        RecRpt1.MoveFirst
        RecRpt1.Sort = "NAME"
        RecRpt1.MoveFirst
        Do While Not RecRpt1.EOF
            LTotDiffAmt = 0: LTotBrokAmt = 0: LTotSTDAmt = 0: LTotStampAmt = 0: LTotBillamt = 0: LTotSrvAmt = 0: LTotTranAmt = 0
            LAddFlag = False
            LParty = RecRpt1!Code
            LPartyName = RecRpt1!NAME
            Do While LParty = RecRpt1!Code
                LTotDiffAmt = LTotDiffAmt + RecRpt1!DIFFER
                LTotBrokAmt = LTotBrokAmt + RecRpt1!BROKAMT
                LTotSTDAmt = LTotSTDAmt + RecRpt1!STDAMT
                LTotSrvAmt = LTotSrvAmt + RecRpt1!SRVAMT
                LTotTranAmt = LTotTranAmt + RecRpt1!TranAmt
                LTotStampAmt = LTotStampAmt + RecRpt1!STampamt
                LTotBillamt = LTotBillamt + RecRpt1!Billamt
                RecRpt1.MoveNext
                If RecRpt1.EOF Then Exit Do
            Loop
            GlobalRecRpt.Filter = adFilterNone
            mysql = "SELECT SUM (CLQTY*CLRATE) AS NAMT FROM INV_D WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & LParty & "' "
            mysql = mysql & " AND STDATE ='" & Format(vcDTP2, "YYYY/MM/DD") & "'"
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            LNetAmt = 0
            If Not TRec.EOF Then LNetAmt = Val(TRec!NAMT & vbNullString)
            If LNetAmt <> 0 Then LNetAmt = LNetAmt / 10000000
            
            LTotBillamt = Round(LTotBillamt, 2)
            If LTotBillamt > 0 Or (LTotBillamt = 0 And (LTotDiffAmt <> 0 Or LTotTranAmt <> 0 Or LTotBrokAmt)) Then
                If GlobalRecRpt.RecordCount > 0 Then
                    GlobalRecRpt.Filter = "LCODE='ZZZZZZ'"
                    If GlobalRecRpt.EOF Then
                        LAddFlag = True
                        GlobalRecRpt.AddNew
                    End If
                Else
                    LAddFlag = True
                    GlobalRecRpt.AddNew
                End If
                GlobalRecRpt!LCode = LParty:                GlobalRecRpt!LName = LPartyName
                GlobalRecRpt!LDIFFER = LTotDiffAmt:         GlobalRecRpt!LBrokAmt = LTotBrokAmt
                GlobalRecRpt!LStdAmt = LTotSTDAmt:          GlobalRecRpt!LTranAmt = LTotTranAmt
                GlobalRecRpt!LSrvAmt = LTotSrvAmt:          GlobalRecRpt!LStampAmt = LTotStampAmt
                GlobalRecRpt!LBIllAmt = LTotBillamt
                GlobalRecRpt!LNetValue = LNetAmt
                
                If LAddFlag = True Then
                    GlobalRecRpt!RCODE = "ZZZZZZ":                    GlobalRecRpt!RNAME = "ZZZZZZ"
                    GlobalRecRpt!RDIFFER = 0:                         GlobalRecRpt!RBrokAmt = 0
                    GlobalRecRpt!RStdAmt = 0:                         GlobalRecRpt!RTranAmt = 0
                    GlobalRecRpt!RSrvAmt = 0:                         GlobalRecRpt!RSTAMPAMT = 0
                    GlobalRecRpt!RBIllAmt = 0
                    GlobalRecRpt!RNetValue = 0
                End If
                GlobalRecRpt.Update
            ElseIf LTotBillamt < 0 Then
                If GlobalRecRpt.RecordCount > 0 Then
                    GlobalRecRpt.Filter = "RCODE='ZZZZZZ'"
                    If GlobalRecRpt.EOF Then
                        LAddFlag = True
                        GlobalRecRpt.AddNew
                    End If
                Else
                    LAddFlag = True
                    GlobalRecRpt.AddNew
                End If
                GlobalRecRpt!RCODE = LParty:                      GlobalRecRpt!RNAME = LPartyName
                GlobalRecRpt!RDIFFER = LTotDiffAmt:               GlobalRecRpt!RBrokAmt = LTotBrokAmt
                GlobalRecRpt!RStdAmt = LTotSTDAmt:                GlobalRecRpt!RTranAmt = LTotTranAmt
                GlobalRecRpt!RSrvAmt = LTotSrvAmt:                GlobalRecRpt!RSTAMPAMT = LTotStampAmt
                GlobalRecRpt!RBIllAmt = LTotBillamt
                GlobalRecRpt!RNetValue = LNetAmt
                
                If LAddFlag = True Then
                    GlobalRecRpt!LCode = "ZZZZZZ":               GlobalRecRpt!LName = "ZZZZZZ"
                    GlobalRecRpt!LDIFFER = 0:                    GlobalRecRpt!LBrokAmt = 0
                    GlobalRecRpt!LStdAmt = 0:                    GlobalRecRpt!LTranAmt = 0
                    GlobalRecRpt!LSrvAmt = 0:                    GlobalRecRpt!LStampAmt = 0
                    GlobalRecRpt!LBIllAmt = 0
                    GlobalRecRpt!LNetValue = 0
                End If
                GlobalRecRpt.Update
            End If
            If RecRpt1.EOF Then Exit Do
        Loop
        
        GlobalRecRpt.Filter = adFilterNone
        If GlobalRecRpt.RecordCount > 0 Then
            GlobalRecRpt.MoveFirst
        End If
    Else
        FlagBillSummary = False
    End If
    
err1:
    If err.Number <> 0 Then
        MsgBox err.Description
    End If

End Sub
Public Function NewPartyNM(ByVal LPExCode As String, ByVal LPAcExCode As String, ByVal LPPartyName As String, ByVal LUserId As String, ByVal LPNEW As Boolean) As String
Dim TRec As ADODB.Recordset:            Dim TRec2 As ADODB.Recordset:   Dim LExhangeCode As String:             Dim LPAcCode As String:
Dim LExCode As String:                  Dim LDuplicate As Boolean:      Dim LSRYN As String:                    Dim LNo As Integer
Dim LCac_code As String:                Dim LXAc_Code As String:        Dim LExID  As Integer:                  Dim LACCID As Long
    
    LExID = Get_ExID(LPExCode)
    LSRYN = "0"
    LPAcCode = Get_ACCT_EX(LExID, LPAcExCode)
    If LenB(LPAcCode) > 0 Then
        NewPartyNM = LPAcCode
        Exit Function
    Else
        If LPNEW = False Then
            NewPartyNM = vbNullString
            Exit Function
        End If
    End If
    Set TRec = Nothing
    If UCase(GAcCodeType) = "N" Then            ''IF SET PARTYCODE=NUMERIC IN COMPANY SETUP
        mysql = "SELECT MAX(CAST(AC_CODE AS INT)) AS AC_CODE FROM ACCOUNTM WHERE COMPCODE=" & GCompCode & ""
        Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        LPAcCode = Val(TRec!AC_CODE & "") + Val(1)
    Else
        LCac_code = Get_AccountMCode(Left(LPAcExCode, 6))
        If LenB(LCac_code) > 0 Then
            mysql = "SELECT COUNT(*) AS LNO  FROM ACCOUNTM WHERE COMPCODE=" & GCompCode & ""
            Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            LNo = (TRec!LNo & vbNullString)
            LPAcCode = Left$(Trim$(CStr(LNo + 1)), 6)
        Else
            LPAcCode = Left(LPAcExCode, 6)
        End If
        LDuplicate = True
        Do While LDuplicate
            LCac_code = vbNullString
            LCac_code = Get_AccountMCode(Left(LPAcCode, 6))
            If LenB(LCac_code) > 0 Then
                LDuplicate = True
                LNo = LNo + 1
                LPAcCode = Left$(Trim$(CStr(LNo)), 6)
            Else
                LDuplicate = False
            End If
        Loop
    End If
    LCac_code = vbNullString
    LCac_code = Get_AccountMCode(Left(LPAcCode, 6))
            
    If LenB(LCac_code) > 0 Then
       MsgBox "Please Create Account for " & LPAcCode & " Manually as Account Code Already Assigned to " & TRec!NAME & ""
        NewPartyNM = vbNullString
       Exit Function
    End If
    Set TRec = Nothing
    LSRYN = "0"
    If Chk_Name_Duplicate(LPPartyName) Then
        '>>> NEW TO GET AC_CODE
        mysql = "SELECT TOP 1 AC_code FROM ACCOUNTM WHERE COMPCODE =" & GCompCode & " and NAME='" & LPPartyName & "' order by ACCID DESC"
        Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        If Not TRec.EOF Then
            LPAcCode = TRec!AC_CODE
        End If
    Else
        Call PInsert_AccountM(LPAcCode, LPPartyName, 14, 14, 0, 1, 0)

        '>>> NEW TO GET AC_CODE
        mysql = "SELECT TOP 1 AC_code FROM ACCOUNTM WHERE COMPCODE =" & GCompCode & " and NAME='" & LPPartyName & "' order by ACCID DESC"
        Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        If Not TRec.EOF Then
            LPAcCode = TRec!AC_CODE
        End If
        
        If LPExCode = "RACE" Then
            mysql = "UPDATE ACCOUNTM SET PTYHEAD =1 WHERE COMPCODE =" & GCompCode & " AND AC_CODE ='" & LPAcCode & "'"
            Cnn.Execute mysql
        Else
            mysql = "UPDATE ACCOUNTM SET PTYHEAD =2 WHERE COMPCODE =" & GCompCode & " AND AC_CODE ='" & LPAcCode & "'"
            Cnn.Execute mysql
        End If
        LACCID = Get_AccID(LPAcCode)
        Call PInsert_Accountd(LPAcCode, 14, LPPartyName, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, vbNullString, "N", "0", "0", _
        vbNullString, vbNullString, "P", 0, "P", 0, 0, "D", "1", "D", vbNullString, 0, "N", Date, "N", 1, "N", "N", 0, vbNullString, "0", "0", "0", "0", "0", vbNullString, vbNullString, "W", "1", "1", "0", 0, 0, "S", LACCID, 0)
        
        mysql = "SELECT DISTINCT EXID ,EXCODE,OPTIONS  FROM EXMAST WHERE COMPCODE =" & GCompCode & " ORDER BY EXCODE "
        Set TRec = Nothing: Set TRec = New ADODB.Recordset: TRec.Open mysql, Cnn, adOpenKeyset, adLockReadOnly
        LXAc_Code = vbNullString
        While Not TRec.EOF
            If TRec!excode = "EQ" Or TRec!excode = "BEQ" Then
                Call PInsert_PExBrok(LPAcCode, TRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, DateValue(GFinEnd), "CSH", 0, 0, TRec!EXID, LACCID)
            Else
                If TRec!Options = "Y" Then
                        Call PInsert_PExBrok(LPAcCode, TRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, GFinEnd, "OPT", 0, 0, TRec!EXID, LACCID)
                End If
                    Call PInsert_PExBrok(LPAcCode, TRec!excode, "P", 0, 0, 0, 0, "P", 0, 0, "P", 0, 0, "I", 0, GFinEnd, "FUT", 0, 0, TRec!EXID, LACCID)
            End If
            TRec.MoveNext
        Wend
        Set TRec2 = Nothing
        Set TRec = Nothing: Set TRec = New ADODB.Recordset
        TRec.Open "SELECT EXCODE,EXID FROM EXMAST WHERE COMPCODE=" & GCompCode & "", Cnn, adOpenForwardOnly, adLockReadOnly
        If Not TRec.EOF Then
            Do While Not TRec.EOF
                LExCode = TRec!excode
                Call PINSERT_ACCT_EX(LPAcCode, LExCode, Trim(LPAcExCode), "S", TRec!EXID, LACCID)
                TRec.MoveNext
            Loop
        End If
        Set TRec = Nothing
    End If
    NewPartyNM = LPAcCode
End Function
Public Sub Bill_smry_shr_cons(LSParties As String, LSSaudas As String, LSExCodes As String, LSInst As String, vcDTP1 As Date, vcDTP2 As Date, Check4 As Integer, LSFmlyIDs As String, AllParties As Boolean, AllFmly As Boolean, AllSaudas As Boolean, AllExcodes As Boolean, AllInst As Boolean, unqucc As String)
    On Error GoTo err1
    
    Dim SrNo As Long
    Dim LMEXCODE  As String:     Dim LSauda  As String:          Dim LOp_Bal As Double:           Dim LOpBalUSD As Double
    Dim LParty As String:        Dim LPartyName As String:       Dim LPartyCode As String:        Dim LPartyName2 As String
    Dim Rec As ADODB.Recordset:  Dim BillRec As ADODB.Recordset: Dim PartyRec As ADODB.Recordset: Dim VouRec As ADODB.Recordset
    Dim MRec As ADODB.Recordset: Dim RecInv As ADODB.Recordset:  Dim LTotBQty  As Double:         Dim LTotBAmt  As Double
    Dim LTotSQty As Double:      Dim LTotSamt As Double:         Dim LTotDiffAmt As Double:       Dim LTotBrokAmt As Double
    Dim LTotSTDAmt  As Double:   Dim LTotStampAmt  As Double:    Dim LTotBillamt As Double:       Dim LTotSrvAmt  As Double
    Dim LTotTranAmt As Double:   Dim LBAlFlag As Boolean:        Dim LAddFlag As Boolean:         Dim LBal As Double:
    Dim MBal As Double:          Dim RecRpt1 As ADODB.Recordset: Dim acexRec As ADODB.Recordset
    Dim LAcExCode As String:     Dim LCNTRExCode As String
    Dim LNetAmt As Double: Dim LSaudaID As Integer
    Dim TRec As ADODB.Recordset: Dim MDate As Date
    Dim lcrusdinr As Double, ldrusdinr As Double
    SrNo = 0
        
    FlagBillSummary = True
    Set RecRpt1 = Nothing
    
    Set RecRpt1 = New ADODB.Recordset
    RecRpt1.Fields.Append "CODE", adVarChar, 15, adFldIsNullable
    RecRpt1.Fields.Append "NAME", adVarChar, 100, adFldIsNullable
    RecRpt1.Fields.Append "DIFFER", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "BROKAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "STDAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "TRANAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "SRVAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "STAMPAMT", adDouble, , adFldIsNullable
    RecRpt1.Fields.Append "BILLAMT", adDouble, , adFldIsNullable
    RecRpt1.Open , , adOpenKeyset, adLockBatchOptimistic
    
    
    Set GlobalRecRpt = Nothing
    Set GlobalRecRpt = New ADODB.Recordset
    GlobalRecRpt.Fields.Append "LCODE", adVarChar, 15, adFldIsNullable
    GlobalRecRpt.Fields.Append "LNAME", adVarChar, 100, adFldIsNullable
    GlobalRecRpt.Fields.Append "LDIFFER", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LBROKAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LSTDAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LTRANAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LBILLAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RCODE", adVarChar, 15, adFldIsNullable
    GlobalRecRpt.Fields.Append "RNAME", adVarChar, 100, adFldIsNullable
    GlobalRecRpt.Fields.Append "RDIFFER", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RBROKAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RSTDAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RTRANAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RBILLAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "SAUDACODE", adVarChar, 50, adFldIsNullable
    GlobalRecRpt.Fields.Append "SAUDA", adVarChar, 50, adFldIsNullable
    GlobalRecRpt.Fields.Append "ITEMCODE", adVarChar, 20, adFldIsNullable
    GlobalRecRpt.Fields.Append "ITEMNAME", adVarChar, 50, adFldIsNullable
    GlobalRecRpt.Fields.Append "LSRVAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RSRVAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LSTAMPAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RSTAMPAMT", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "LNetValue", adDouble, , adFldIsNullable
    GlobalRecRpt.Fields.Append "RNetValue", adDouble, , adFldIsNullable
    
    GlobalRecRpt.Open , , adOpenKeyset, adLockBatchOptimistic
   
    ''
    Dim comploop As Integer
    
    Dim Company As String
    Dim NoCompany As Integer
    NoCompany = 2
    
    
    Dim tempserver As String
    Dim tempuid As String
    Dim tempwd As String
    
    '>>> get server, uid and pwd from connection string
    tempserver = MServer
    tempserver = Replace(tempserver, "driver={SQL Server};server=", "")
    tempserver = Mid(tempserver, 1, InStr(1, tempserver, ";") - 1)
        
    tempuid = MServer
    tempuid = Replace(tempuid, "driver={SQL Server};server=" & tempserver & ";uid=", "")
    tempuid = Mid(tempuid, 1, InStr(1, tempuid, ";") - 1)
        
    tempwd = MServer
    tempwd = Replace(tempwd, "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=", "")
    tempwd = Mid(tempwd, 1, InStr(1, tempwd, ";") - 1)

    For comploop = 1 To NoCompany
    
        Set CompCnn = Nothing: Set CompCnn = New ADODB.Connection:
        If comploop = 1 Then
            Company = "m1"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-CMK2022"
        ElseIf comploop = 2 Then
            Company = "m2"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-IND2022"
        ElseIf comploop = 3 Then
            Company = "m3"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-SIL2022"
        End If
        CompCnn.Mode = adModeShareExclusive: CompCnn.IsolationLevel = adXactIsolated: CompCnn.CursorLocation = adUseClient
        CompCnn.Open: CompCnn.CommandTimeout = 300
        
        MDate = Format(vcDTP2, "YYYY/MM/DD")
        lcrusdinr = 0: ldrusdinr = 0
        LSaudaID = Get_SaudaID("USDINR")
        mysql = ""
        mysql = "select lowrate as rate from ctr_r where saudaid = " & LSaudaID & " and condate = '" & Format(vcDTP2, "YYYY/MM/DD") & "'"
        Set BillRec = Nothing
        Set BillRec = New ADODB.Recordset
        BillRec.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
        If Not BillRec.EOF Then
            lcrusdinr = BillRec!Rate
        End If
        
        mysql = ""
        mysql = "select hgrate as rate from ctr_r where saudaid = " & LSaudaID & " and condate = '" & Format(vcDTP2, "YYYY/MM/DD") & "'"
        Set BillRec = Nothing
        Set BillRec = New ADODB.Recordset
        BillRec.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
        If Not BillRec.EOF Then
            ldrusdinr = BillRec!Rate
        End If
        
        mysql = ""
        If GOnlyBrok = 0 Then
            mysql = "SELECT AD.AC_CODE,AD.NAME,SUM(I.DIFFAMT) AS DIFFAMT ,SUM(I.BROKAMT) AS BROKAMT ,SUM(I.SRVAMT) AS SRVAMT,"
            mysql = mysql & " SUM(I.STAMPAMT) AS STAMPAMT, SUM(I.BILLAMT) AS BILLAMT FROM INV_D AS I, ACCOUNTD AS AD, SAUDAMAST AS S   "
        Else
            mysql = "SELECT AD.AC_CODE,AD.NAME,SUM(I.DIFFAMT) AS DIFFAMT ,SUM(I.BROKAMT) AS BROKAMT,"
            mysql = mysql & " SUM(I.BILLAMT) AS BILLAMT FROM INV_D AS I, ACCOUNTD AS AD , SAUDAMAST AS S "
        End If
        mysql = mysql & " WHERE I.COMPCODE =" & GCompCode & " AND  I.ACCID =AD.ACCID "
        mysql = mysql & " AND S.SAUDAID = I.SAUDAID AND (I.DIFFAMT <> 0 OR I.BROKAMT <> 0 OR I.BILLAMT <> 0) "
        mysql = mysql & " AND STDATE>='" & Format(vcDTP1, "YYYY/MM/DD") & "' AND STDATE<='" & Format(vcDTP2, "YYYY/MM/DD") & "' "
        If AllFmly = False And LenB(LSFmlyIDs) > 0 And AllParties = True Then
            mysql = mysql & " AND AD.ACCID  IN (SELECT ACCID FROM ACCFMLYD WHERE FMLYID IN (" & LSFmlyIDs & "))"
        End If
        If AllParties = False And LenB(LSParties) > 0 Then mysql = mysql & " AND AD.AC_CODE IN (" & LSParties & ")"
        If AllSaudas = False Then mysql = mysql & "  AND S.saudacode IN ('" & LSSaudas & "')"
        If AllExcodes = False And LenB(LSExCodes) > 0 Then mysql = mysql & " AND S.EXID IN (" & LSExCodes & ")"
        If AllSaudas = True And AllInst = False Then mysql = mysql & " AND  S.INSTTYPE  IN  (" & LSInst & ") "
        mysql = mysql & " GROUP BY AD.AC_CODE,AD.NAME"
        mysql = mysql & " ORDER BY AD.NAME"
    
        Set BillRec = Nothing
        Set BillRec = New ADODB.Recordset
        BillRec.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
        

        
        Do While Not BillRec.EOF
            LBAlFlag = True
            LAcExCode = BillRec!AC_CODE
            Set acexRec = Nothing
            Set acexRec = New ADODB.Recordset
            mysql = "SELECT UCC FROM ACCOUNTD "
            mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!AC_CODE & "'"
            acexRec.Open mysql, CompCnn, adOpenForwardOnly, adLockReadOnly
            If Not acexRec.EOF Then
                If Len(acexRec!UCC) > 0 Then
                    LAcExCode = acexRec!UCC
                End If
            End If
            If Len(unqucc) > 0 Then
                If unqucc <> LAcExCode Then
                    LBAlFlag = False
                End If
                LAcExCode = BillRec!AC_CODE
            End If
           
            If LBAlFlag Then
                RecRpt1.AddNew
                RecRpt1!Code = Left(LAcExCode, 6):
                If Len(acexRec!UCC) > 0 Then
                    RecRpt1!NAME = acexRec!UCC
                End If
                If Len(acexRec!UCC) = 0 Or Len(unqucc) > 0 Then
                    RecRpt1!NAME = BillRec!NAME
                End If
                RecRpt1!DIFFER = BillRec!DIFFAMT:       RecRpt1!BROKAMT = BillRec!BROKAMT
                If GOnlyBrok = 0 Then
                    RecRpt1!SRVAMT = BillRec!SRVAMT:   RecRpt1!STampamt = BillRec!STampamt
                Else
                    RecRpt1!SRVAMT = 0:                     RecRpt1!STampamt = 0
                End If
                RecRpt1!STDAMT = 0:                         RecRpt1!TranAmt = 0
                RecRpt1!Billamt = BillRec!Billamt:    RecRpt1.Update
            End If
            BillRec.MoveNext
        Loop
        
        mysql = "SELECT A.NAME,I.PARTY,FMLY.FMLYNAME,FMLY.FMLYHEAD,A2.NAME AS FMLYNM,FMLY.CONTRA_AC,A3.NAME AS CONTRANAME,SUM(AMOUNT) AS BBROKAMT,SUM(SAMOUNT)AS SHAREAMT "
        mysql = mysql & " FROM INV_D1 AS I, ACCOUNTM AS A, ACCFMLY AS FMLY, ACCOUNTM AS A2, ACCOUNTM AS A3, SAUDAMAST AS S "
        mysql = mysql & " WHERE  A.COMPCODE =" & GCompCode & " And I.ACCID  = A.ACCID AND I.FMLYID = FMLY.FMLYID "
        mysql = mysql & " AND A2.ACCID  =FMLY.HEADID AND  A3.ACCID = FMLY.CONTRAID AND S.SAUDAID = I.SAUDAID "
        If AllFmly = False And LenB(LSFmlyIDs) > 0 And AllParties = True Then
            mysql = mysql & " AND A.ACCID IN (SELECT DISTINCT ACCID FROM ACCFMLYD WHERE FMLYID IN  (" & LSFmlyIDs & "))"
        End If
        If AllParties = False And LenB(LSParties) > 0 Then mysql = mysql & " AND A.AC_CODE IN (" & LSParties & ")"
        If AllSaudas = False Then mysql = mysql & "  AND S.saudacode IN ('" & LSSaudas & "')"
        If AllExcodes = False And LenB(LSExCodes) > 0 Then mysql = mysql & " AND S.EXID IN (" & LSExCodes & ")"
        If AllSaudas = True And AllInst = False Then mysql = mysql & " AND  S.INSTTYPE  IN  (" & LSInst & ") "
        mysql = mysql & " AND I.STDATE>='" & Format(vcDTP1, "YYYY/MM/DD") & "' AND I.STDATE<='" & Format(vcDTP2, "YYYY/MM/DD") & "'"
        mysql = mysql & " GROUP BY A.NAME,I.PARTY, FMLY.FMLYNAME, FMLY.FMLYHEAD,A2.NAME, FMLY.CONTRA_AC,A3.NAME"
        mysql = mysql & " ORDER BY A.NAME,I.PARTY, FMLY.FMLYNAME, FMLY.FMLYHEAD,A2.NAME, FMLY.CONTRA_AC,A3.NAME"
        Set BillRec = Nothing
        Set BillRec = New ADODB.Recordset
        BillRec.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
        
        LBAlFlag = False
        Do While Not BillRec.EOF
            LBAlFlag = True
            
            LAcExCode = BillRec!FMLYHEAD
            Set acexRec = Nothing
            Set acexRec = New ADODB.Recordset
            mysql = "SELECT UCC FROM ACCOUNTD "
            mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!FMLYHEAD & "'"
            acexRec.Open mysql, CompCnn, adOpenForwardOnly, adLockReadOnly
            If Not acexRec.EOF Then
                If Len(acexRec!UCC) > 0 Then
                    LAcExCode = acexRec!UCC
                End If
            End If
            If Len(unqucc) > 0 Then
                If unqucc <> LAcExCode Then
                    LBAlFlag = False
                End If
                LAcExCode = BillRec!FMLYHEAD
            End If
            
            If BillRec!BBROKAMT <> 0 And LBAlFlag Then
                RecRpt1.AddNew
                RecRpt1!Code = Left(LAcExCode, 6):
                If Len(acexRec!UCC) > 0 Then
                    RecRpt1!NAME = acexRec!UCC
                End If
                If Len(acexRec!UCC) = 0 Or Len(unqucc) > 0 Then
                    RecRpt1!NAME = BillRec!fmlynm
                End If
                RecRpt1!STDAMT = BillRec!BBROKAMT:  RecRpt1!Billamt = BillRec!BBROKAMT
                RecRpt1!DIFFER = 0:                 RecRpt1!BROKAMT = 0
                RecRpt1!TranAmt = 0:                RecRpt1!SRVAMT = 0
                RecRpt1!STampamt = 0
                
                RecRpt1.Update
            End If
            If BillRec!SHAREAMT <> 0 And LBAlFlag Then
                RecRpt1.AddNew
                RecRpt1!Code = Left(LAcExCode, 6):
                If Len(acexRec!UCC) > 0 Then
                    RecRpt1!NAME = acexRec!UCC
                End If
                If Len(acexRec!UCC) = 0 Or Len(unqucc) > 0 Then
                    RecRpt1!NAME = BillRec!fmlynm
                End If
                RecRpt1!TranAmt = BillRec!SHAREAMT * -1:    RecRpt1!Billamt = BillRec!SHAREAMT * -1
                RecRpt1!DIFFER = 0:                         RecRpt1!BROKAMT = 0
                RecRpt1!STDAMT = 0:                         RecRpt1!SRVAMT = 0
                RecRpt1!STampamt = 0:                       RecRpt1.Update
                
                LBAlFlag = True
                LAcExCode = BillRec!Contra_Ac
                If Len(unqucc) > 0 Then
                    If unqucc <> LAcExCode Then
                        LBAlFlag = False
                    End If
                    LAcExCode = BillRec!Contra_Ac
                End If
                
                Set acexRec = Nothing
                Set acexRec = New ADODB.Recordset
                mysql = "SELECT UCC FROM ACCOUNTD "
                mysql = mysql & " Where COMPCODE=" & GCompCode & " AND  AC_CODE ='" & BillRec!Contra_Ac & "'"
                acexRec.Open mysql, CompCnn, adOpenForwardOnly, adLockReadOnly
                If Not acexRec.EOF Then
                    If Len(acexRec!UCC) > 0 Then
                        LAcExCode = acexRec!UCC
                    End If
                End If

                If LBAlFlag Then
                    RecRpt1.AddNew
                    RecRpt1!Code = LAcExCode:
                    If Len(acexRec!UCC) > 0 Then
                        RecRpt1!NAME = acexRec!UCC
                    End If
                    If Len(acexRec!UCC) = 0 Or Len(unqucc) > 0 Then
                        RecRpt1!NAME = BillRec!CONTRAname
                    End If
                    
                    RecRpt1!TranAmt = BillRec!SHAREAMT:         RecRpt1!Billamt = BillRec!SHAREAMT
                    RecRpt1!DIFFER = 0:                         RecRpt1!BROKAMT = 0
                    RecRpt1!STDAMT = 0:                         RecRpt1!SRVAMT = 0
                    RecRpt1!STampamt = 0:                       RecRpt1.Update
                 End If
            End If
            BillRec.MoveNext
        Loop
        Next

        LTotDiffAmt = 0: LTotBrokAmt = 0: LTotSTDAmt = 0: LTotStampAmt = 0: LTotBillamt = 0: LTotSrvAmt = 0: LTotTranAmt = 0
        If RecRpt1.RecordCount > 0 Then
            RecRpt1.MoveFirst
            RecRpt1.Sort = "NAME"
            RecRpt1.MoveFirst
            Do While Not RecRpt1.EOF
                LTotDiffAmt = 0: LTotBrokAmt = 0: LTotSTDAmt = 0: LTotStampAmt = 0: LTotBillamt = 0: LTotSrvAmt = 0: LTotTranAmt = 0
                LAddFlag = False
                LParty = RecRpt1!Code
                LPartyName = RecRpt1!NAME

                Do While LParty = RecRpt1!Code
                    LTotDiffAmt = LTotDiffAmt + RecRpt1!DIFFER
                    LTotBrokAmt = LTotBrokAmt + RecRpt1!BROKAMT
                    LTotSTDAmt = LTotSTDAmt + RecRpt1!STDAMT
                    LTotSrvAmt = LTotSrvAmt + RecRpt1!SRVAMT
                    LTotTranAmt = LTotTranAmt + RecRpt1!TranAmt
                    LTotStampAmt = LTotStampAmt + RecRpt1!STampamt
                    LTotBillamt = LTotBillamt + RecRpt1!Billamt
                    RecRpt1.MoveNext
                    If RecRpt1.EOF Then Exit Do
                Loop
                
                
                GlobalRecRpt.Filter = adFilterNone
                mysql = "SELECT SUM (CLQTY*CLRATE) AS NAMT FROM INV_D WHERE COMPCODE =" & GCompCode & " AND PARTY ='" & LParty & "' "
                mysql = mysql & " AND STDATE ='" & Format(vcDTP2, "YYYY/MM/DD") & "'"
                Set TRec = Nothing
                Set TRec = New ADODB.Recordset
                TRec.Open mysql, CompCnn, adOpenForwardOnly, adLockReadOnly
                LNetAmt = 0
                If Not TRec.EOF Then LNetAmt = Val(TRec!NAMT & vbNullString)
                If LNetAmt <> 0 Then LNetAmt = LNetAmt / 10000000
                
                LTotBillamt = Round(LTotBillamt, 2)
                If LTotBillamt > 0 Then
                    If GlobalRecRpt.RecordCount > 0 Then
                        GlobalRecRpt.Filter = "LCODE='ZZZZZZ'"
                        If GlobalRecRpt.EOF Then
                            LAddFlag = True
                            GlobalRecRpt.AddNew
                        End If
                    Else
                        LAddFlag = True
                        GlobalRecRpt.AddNew
                    End If
                    GlobalRecRpt!LCode = LParty:                GlobalRecRpt!LName = LPartyName
                    GlobalRecRpt!LDIFFER = LTotDiffAmt:         GlobalRecRpt!LBrokAmt = LTotBrokAmt
                    GlobalRecRpt!LStdAmt = LTotSTDAmt:          GlobalRecRpt!LTranAmt = LTotTranAmt
                    GlobalRecRpt!LSrvAmt = LTotSrvAmt:          GlobalRecRpt!LStampAmt = LTotStampAmt
                    GlobalRecRpt!LBIllAmt = LTotBillamt
                    GlobalRecRpt!LNetValue = LNetAmt
                    
                    If lcrusdinr <> 0 And Check4 = 1 Then
                        GlobalRecRpt!LDIFFER = LTotDiffAmt * lcrusdinr
                        GlobalRecRpt!LBrokAmt = LTotBrokAmt * lcrusdinr
                        GlobalRecRpt!LBIllAmt = LTotBillamt * lcrusdinr
                        GlobalRecRpt!LTranAmt = LTotTranAmt * lcrusdinr
                        GlobalRecRpt!LStdAmt = LTotSTDAmt * lcrusdinr
                        GlobalRecRpt!LNetValue = LNetAmt * lcrusdinr
                    End If
                    
                    If LAddFlag = True Then
                        GlobalRecRpt!RCODE = "ZZZZZZ":                    GlobalRecRpt!RNAME = "ZZZZZZ"
                        GlobalRecRpt!RDIFFER = 0:                         GlobalRecRpt!RBrokAmt = 0
                        GlobalRecRpt!RStdAmt = 0:                         GlobalRecRpt!RTranAmt = 0
                        GlobalRecRpt!RSrvAmt = 0:                         GlobalRecRpt!RSTAMPAMT = 0
                        GlobalRecRpt!RBIllAmt = 0
                        GlobalRecRpt!RNetValue = 0
                    End If
                    GlobalRecRpt.Update
                ElseIf LTotBillamt < 0 Then
                    If GlobalRecRpt.RecordCount > 0 Then
                        GlobalRecRpt.Filter = "RCODE='ZZZZZZ'"
                        If GlobalRecRpt.EOF Then
                            LAddFlag = True
                            GlobalRecRpt.AddNew
                        End If
                    Else
                        LAddFlag = True
                        GlobalRecRpt.AddNew
                    End If
                    GlobalRecRpt!RCODE = LParty:                      GlobalRecRpt!RNAME = LPartyName
                    GlobalRecRpt!RDIFFER = LTotDiffAmt:               GlobalRecRpt!RBrokAmt = LTotBrokAmt
                    GlobalRecRpt!RStdAmt = LTotSTDAmt:                GlobalRecRpt!RTranAmt = LTotTranAmt
                    GlobalRecRpt!RSrvAmt = LTotSrvAmt:                GlobalRecRpt!RSTAMPAMT = LTotStampAmt
                    GlobalRecRpt!RBIllAmt = LTotBillamt
                    GlobalRecRpt!RNetValue = LNetAmt
                    
                    If ldrusdinr <> 0 And Check4 = 1 Then
                        GlobalRecRpt!RDIFFER = LTotDiffAmt * ldrusdinr
                        GlobalRecRpt!RBrokAmt = LTotBrokAmt * ldrusdinr
                        GlobalRecRpt!RTranAmt = LTotTranAmt * ldrusdinr
                        GlobalRecRpt!RStdAmt = LTotSTDAmt * ldrusdinr
                        GlobalRecRpt!RBIllAmt = LTotBillamt * ldrusdinr
                        GlobalRecRpt!RNetValue = LNetAmt * ldrusdinr
                    End If
                    If LAddFlag = True Then
                        GlobalRecRpt!LCode = "ZZZZZZ":               GlobalRecRpt!LName = "ZZZZZZ"
                        GlobalRecRpt!LDIFFER = 0:                    GlobalRecRpt!LBrokAmt = 0
                        GlobalRecRpt!LStdAmt = 0:                    GlobalRecRpt!LTranAmt = 0
                        GlobalRecRpt!LSrvAmt = 0:                    GlobalRecRpt!LStampAmt = 0
                        GlobalRecRpt!LBIllAmt = 0
                        GlobalRecRpt!LNetValue = 0
                    End If
                    GlobalRecRpt.Update
                End If
                If RecRpt1.EOF Then Exit Do
            Loop
            
            GlobalRecRpt.Filter = adFilterNone
            If GlobalRecRpt.RecordCount > 0 Then
                GlobalRecRpt.MoveFirst
            End If
        Else
            FlagBillSummary = False
        End If

err1:
    If err.Number <> 0 Then
        MsgBox err.Description
    End If

End Sub



Public Sub Get_CLiveRate(LvcDTP1 As Date, LRopt As String, LCount As Integer)

On Error GoTo err1



    '>>> GET LIVE PRICE -- START
    Dim Flag_144 As Boolean
    Dim Flag_178 As Boolean
    
    Dim ldate As Date
    Dim VFiledownload As Boolean
    Dim GRec As ADODB.Recordset
    Dim SREC As ADODB.Recordset
    Dim UREC As ADODB.Recordset
    Dim UREC1 As ADODB.Recordset
    Dim Vconsno As Double
    Dim LExCode As String
    Dim LItemCode As String
    Dim LSaudaID As Integer
    Dim LItemID As Integer
    Dim LExID As Integer
    Dim VLiveRate As String
    Dim VSTR As String
    Dim VCount As Integer
    Dim VLiveRatestr As String
    Dim myarray() As String
    Dim mytemparray() As String
    Dim LFileSystemObject As FileSystemObject
    Dim FWrite As Variant
    Dim I As Integer
    Dim flag As Boolean
    Dim Dfileame As String
    Dim flaghighlow As Boolean
    
    Flag_144 = True
    Flag_178 = True
    
    Dfileame = "rate" & Format(Now, "hhmmss") & ".csv"
    LItemCode = ""
    flaghighlow = False
    ldate = LvcDTP1 - 5
    
'''
    Dim comploop As Integer
    Dim comploop2 As Integer
    
    Dim Company As String
    Dim NoCompany As Integer
    NoCompany = 2
    
    Dim tempserver As String
    Dim tempuid As String
    Dim tempwd As String
    
    '>>> get server, uid and pwd from connection string
    tempserver = MServer
    tempserver = Replace(tempserver, "driver={SQL Server};server=", "")
    tempserver = Mid(tempserver, 1, InStr(1, tempserver, ";") - 1)
        
    tempuid = MServer
    tempuid = Replace(tempuid, "driver={SQL Server};server=" & tempserver & ";uid=", "")
    tempuid = Mid(tempuid, 1, InStr(1, tempuid, ";") - 1)
        
    tempwd = MServer
    tempwd = Replace(tempwd, "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=", "")
    tempwd = Mid(tempwd, 1, InStr(1, tempwd, ";") - 1)
    
    For comploop = 1 To NoCompany
    
        Set CompCnn = Nothing: Set CompCnn = New ADODB.Connection:
        If comploop = 1 Then
            Company = "m1"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-CMK2022"
        ElseIf comploop = 2 Then
            Company = "m2"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-IND2022"
        ElseIf comploop = 3 Then
            Company = "m3"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-SIL2022"
        End If
        CompCnn.Mode = adModeShareExclusive: CompCnn.IsolationLevel = adXactIsolated: CompCnn.CursorLocation = adUseClient
        CompCnn.Open: CompCnn.CommandTimeout = 300

        Set GRec = Nothing
        Set GRec = New ADODB.Recordset
        If LCount < 1 Then
            'Deletes Rates B4 Taking New
            mysql = "DELETE FROM CTR_R WHERE COMPCODE=" & GCompCode & ""
            mysql = mysql + " AND CONDATE = '" & Format(LvcDTP1, "YYYY/MM/DD") & "' "
            mysql = mysql + " AND ITEMCODE NOT LIKE 'SGX%' "
            If LRopt = "MCX" Then
                mysql = mysql & "AND excode in ('MCX') "
            ElseIf LRopt = "NSE" Then
                mysql = mysql & "AND excode in ('NSE') "
            ElseIf LRopt = "BOTH" Then
                mysql = mysql & "AND excode in ('MCX' ,'NSE') "
            End If
            GRec.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
        End If
    Next
    
    For comploop = 1 To NoCompany
    
        Set GRec = Nothing
        Set GRec = New ADODB.Recordset
        Set CompCnn = Nothing: Set CompCnn = New ADODB.Connection:
        If comploop = 1 Then
            Company = "m1"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-CMK2022"
        ElseIf comploop = 2 Then
            Company = "m2"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-IND2022"
        ElseIf comploop = 3 Then
            Company = "m3"
            CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-SIL2022"
        End If
        
        CompCnn.Mode = adModeShareExclusive: CompCnn.IsolationLevel = adXactIsolated: CompCnn.CursorLocation = adUseClient
        CompCnn.Open: CompCnn.CommandTimeout = 300

        mysql = ""
        mysql = "SELECT distinct s.saudaid,upper(I.exHCODE) as 'exsymbol',i.itemcode,i.itemid, i.exid,upper(s.excode) as 'excode', s.saudacode,S.MATURITY , SUBSTRING(CONVERT(VARCHAR,YEAR(S.MATURITY)),3,2)  AS 'VYEAR',  upper(FORMAT (S.MATURITY, 'MMM'))  AS 'VMONTH'  "
        mysql = mysql & ",GETDATE() AS 'CONDATE' , upper(s.insttype) as 'insttype',s.opttype, isnull(s.strikeprice,0) as 'strikeprice'  "
        mysql = mysql & "from saudamast S,ITEMMAST I "
        mysql = mysql & "WHERE s.COMPCODE=i.COMPCODE AND s.COMPCODE=" & GCompCode & " AND i.COMPCODE=" & GCompCode & " AND s.insttype = 'FUT' and i.itemid = s.itemid "
        mysql = mysql & " and S.MATURITY >='" & Format(ldate, "YYYY/MM/DD") & "' AND  (s.saudaid in (select distinct saudaid from ctr_d where COMPCODE=" & GCompCode & " and condate = '" & Format(LvcDTP1, "YYYY/MM/DD") & "') "
        mysql = mysql & " or s.saudaid in (select distinct saudaid from inv_d where COMPCODE=" & GCompCode & " and stdate >= '" & Format(ldate, "YYYY/MM/DD") & "')) "
        If LRopt = "MCX" Then
            mysql = mysql & "AND s.excode in ('MCX') "
        ElseIf LRopt = "NSE" Then
            mysql = mysql & "AND s.excode in ('NSE') "
        ElseIf LRopt = "BOTH" Then
            mysql = mysql & "AND s.excode in ('MCX' ,'NSE') "
        End If
    
        If LCount >= 1 Then
            mysql = mysql & "AND s.saudaid not in (select distinct saudaid from ctr_r where compcode = " & GCompCode & "  AND CONDATE = '" & Format(LvcDTP1, "YYYY/MM/DD") & "' and isnull(CLOSERATE,0) <> 0) "
        End If
        mysql = mysql & "ORDER BY s.saudacode "

        GRec.Open mysql, CompCnn, adOpenStatic, adLockReadOnly

        If Not GRec.EOF Then
            DoEvents
            GETMAIN.ProgressBar1.Max = GRec.RecordCount + 25
            GETMAIN.ProgressBar1.Value = 0
            GETMAIN.ProgressBar1.Visible = True
    
            DoEvents
            Set SREC = Nothing
            Set SREC = New ADODB.Recordset
            SREC.Fields.Append "ITEMCODE", adVarChar, 50, adFldIsNullable
            SREC.Fields.Append "excode", adVarChar, 50, adFldIsNullable
            SREC.Fields.Append "saudacode", adVarChar, 50, adFldIsNullable
            SREC.Fields.Append "saudaid", adVarChar, 50, adFldIsNullable
            SREC.Fields.Append "Condate", adDate, , adFldIsNullable
            SREC.Fields.Append "VYear", adVarChar, 10, adFldIsNullable
            SREC.Fields.Append "VMonth", adVarChar, 10, adFldIsNullable
            SREC.Fields.Append "LiveRate", adDouble, , adFldIsNullable
            SREC.Fields.Append "high", adDouble, , adFldIsNullable
            SREC.Fields.Append "low", adDouble, , adFldIsNullable
            SREC.Fields.Append "open", adDouble, , adFldIsNullable
            SREC.Fields.Append "VSTR", adVarChar, 100, adFldIsNullable
            SREC.Fields.Append "ITEMID", adVarChar, 100, adFldIsNullable
            SREC.Fields.Append "EXID", adVarChar, 100, adFldIsNullable
            SREC.Open , , adOpenKeyset, adLockBatchOptimistic
        
            VCount = 0
            Do While Not GRec.EOF
                DoEvents
                '>>> create URL to get live rate
                If GRec!excode = "NSE" Then
                    If GRec!INSTTYPE = "OPT" Then
                        VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & GRec!STRIKEPRICE & GRec!OPTTYPE
                    Else
                        VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & "FUT"
                    End If
                
                    If LItemCode = "" Then
                        If GRec!STRIKEPRICE > 0 Then
                            LItemCode = VSTR
                        Else
                            LItemCode = "NFO" & ":" & VSTR
                        End If
                    Else
                        If GRec!STRIKEPRICE > 0 Then
                            LItemCode = LItemCode & "$" & VSTR
                         Else
                            LItemCode = LItemCode & "$" & "NFO" & ":" & VSTR
                         End If
                    End If
                ElseIf GRec!excode = "MCX" Then
                    VSTR = Replace(Replace(GRec!exsymbol, "&", "%26"), "-", "%2D") & GRec!VYear & GRec!Vmonth & "FUT"
                    If LItemCode = "" Then
                        LItemCode = "MCX" & ":" & VSTR
                    Else
                        LItemCode = LItemCode & "$" & "MCX" & ":" & VSTR
                    End If
                End If
                DoEvents
                '>>> add in record set
                With SREC
                    .AddNew
                    !ITEMCODE = GRec!exsymbol
                    !excode = GRec!excode
                    !saudacode = GRec!saudacode
                    !Condate = GRec!Condate
                    !VYear = GRec!VYear
                    !Vmonth = GRec!Vmonth
                    !liverate = 0
                    !HIGH = 0
                    !LOW = 0
                    !Open = 0
                    !VSTR = Replace(Replace(VSTR, "%26", "&"), "%2D", "-")
                    
                    .Update
                End With
                
                DoEvents
                VCount = VCount + 1
            
                If VCount = 5 Then
                    VCount = 0
                    DoEvents
                
                    If Flag_144 Then
                        DeleteUrlCacheEntry "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode
                        VFiledownload = URLDownloadToFile(0&, "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                        DoEvents
                    Else
                        VFiledownload = False
                    End If
                
                    If Not VFiledownload Then
                        Flag_144 = False
                        DeleteUrlCacheEntry "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode
                        VFiledownload = URLDownloadToFile(0&, "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                        If VFiledownload Then
                            Flag_178 = True
                        End If
                        DoEvents
                    End If
                
                    If VFiledownload Then
                        If FileExist(App.Path & "\" & Dfileame) Then
                            VLiveRatestr = ""
                            Open App.Path & "\" & Dfileame For Input As #1
                            Do While Not EOF(1)
                                Line Input #1, VLiveRate
                            Loop

                            Close #1
                            DoEvents
                            VLiveRate = Replace(VLiveRate, "[", "")
                            VLiveRate = Replace(VLiveRate, "]", "")
                            myarray() = Split(VLiveRate, "},{")
            
                            For I = 0 To UBound(myarray)
                                DoEvents
                                VLiveRate = Replace(myarray(I), "{", "")
                                VLiveRate = Replace(VLiveRate, "}", "")
                                VLiveRate = Replace(VLiveRate, """scrip"":""", "")
                            
                                If InStr(1, VLiveRate, "NFO") > 0 Then
                                    VLiveRate = Replace(VLiveRate, """,""exchange"":""NFO"",""price"":""", "^")
                                    '>>> to manage high, low, open
                                    If InStr(1, VLiveRate, "high") > 0 Then
                                        flaghighlow = True
                                        VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                                        VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                                        VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                                    End If
                                ElseIf InStr(1, VLiveRate, "MCX") > 0 Then
                                    VLiveRate = Replace(VLiveRate, """,""exchange"":""MCX"",""price"":""", "^")
                                    '>>> to manage high, low, open
                                    If InStr(1, VLiveRate, "high") > 0 Then
                                        flaghighlow = True
                                        VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                                        VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                                        VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                                    End If
                                End If
                                VLiveRate = Replace(VLiveRate, """", "")
                                mytemparray() = Split(VLiveRate, "^")
                                DoEvents
                                SREC.MoveFirst
                                                        
                                SREC.Find "VSTR='" & mytemparray(0) & "'", , adSearchForward
                                If Not SREC.EOF Then
                                    DoEvents
                                    If mytemparray(1) <> "" Then
                                        SREC!liverate = mytemparray(1)
                                        If flaghighlow Then
                                            SREC!HIGH = mytemparray(2)
                                            SREC!LOW = mytemparray(3)
                                            SREC!Open = mytemparray(4)
                                        End If
                                        SREC.Update
                                    End If
                                End If
                                DoEvents
                                Erase mytemparray
                            Next
                            Erase myarray
                            '>>> delete live rate file
                            DoEvents
                            Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                            LFileSystemObject.DeleteFile App.Path & "\" & Dfileame
                        End If
                    Else
                        Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                        Set FWrite = LFileSystemObject.CreateTextFile(App.Path & "\LiveRate_log.txt", True)
                        FWrite.WriteLine ("[" & Now & " >>> " & "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode & "]")
                        FWrite.Close
                    End If
                    LItemCode = ""
                End If
                DoEvents
                GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
                DoEvents
                GRec.MoveNext
            Loop
            
            If LItemCode <> "" Then
                If Flag_144 Then
                    DeleteUrlCacheEntry "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode
                    VFiledownload = URLDownloadToFile(0&, "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                    DoEvents
                Else
                    VFiledownload = False
                End If
                DoEvents
    
                If Not VFiledownload Then
                    Flag_144 = False
                    DeleteUrlCacheEntry "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode
                    VFiledownload = URLDownloadToFile(0&, "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode, App.Path & "\" & Dfileame, BINDF_GETNEWESTVERSION, 0&) = ERROR_SUCCESS
                    DoEvents
                    If VFiledownload Then
                        Flag_178 = True
                    End If
                End If
            
                DoEvents
                GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
                DoEvents
            If VFiledownload Then
                If FileExist(App.Path & "\" & Dfileame) Then
                    VLiveRatestr = ""
                    DoEvents
                    Open App.Path & "\" & Dfileame For Input As #1
                    Do While Not EOF(1)
                        Line Input #1, VLiveRate
                    Loop
                    Close #1
                    DoEvents
                    VLiveRate = Replace(VLiveRate, "[", "")
                    VLiveRate = Replace(VLiveRate, "]", "")
                
                    myarray() = Split(VLiveRate, "},{")
                
                    For I = 0 To UBound(myarray)
                        DoEvents
                        VLiveRate = Replace(myarray(I), "{", "")
                        VLiveRate = Replace(VLiveRate, "}", "")
                        VLiveRate = Replace(VLiveRate, """scrip"":""", "")
                    
                        If InStr(1, VLiveRate, "NFO") > 0 Then
                            VLiveRate = Replace(VLiveRate, """,""exchange"":""NFO"",""price"":""", "^")
                            '>>> to manage high, low, open
                            If InStr(1, VLiveRate, "high") > 0 Then
                                flaghighlow = True
                                VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                                VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                                VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                            End If
                        
                        ElseIf InStr(1, VLiveRate, "MCX") > 0 Then
                            VLiveRate = Replace(VLiveRate, """,""exchange"":""MCX"",""price"":""", "^")
                        
                            '>>> to manage high, low, open
                            If InStr(1, VLiveRate, "high") > 0 Then
                                flaghighlow = True
                                VLiveRate = Replace(VLiveRate, """,""high"":""", "^")
                                VLiveRate = Replace(VLiveRate, """,""low"":""", "^")
                                VLiveRate = Replace(VLiveRate, """,""open"":""", "^")
                            End If
                        End If
                        VLiveRate = Replace(VLiveRate, """", "")
                        mytemparray() = Split(VLiveRate, "^")
                                                            
                        SREC.MoveFirst
                        SREC.Find "VSTR='" & mytemparray(0) & "'", , adSearchForward
                        If Not SREC.EOF Then
                            DoEvents
                            If mytemparray(1) <> "" Then
                                SREC!liverate = mytemparray(1)
                                If flaghighlow Then
                                    SREC!HIGH = mytemparray(2)
                                    SREC!LOW = mytemparray(3)
                                    SREC!Open = mytemparray(4)
                                End If
                                SREC.Update
                            End If
                        End If
                        Erase mytemparray
                    Next
                
                    '>>> delete live rate file
                    DoEvents
                    GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
                    DoEvents
                    Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                    LFileSystemObject.DeleteFile App.Path & "\" & Dfileame
                End If
            Else
                Set LFileSystemObject = CreateObject("Scripting.FileSystemObject")
                Set FWrite = LFileSystemObject.CreateTextFile(App.Path & "\LiveRate_log.txt", True)
                FWrite.WriteLine ("[" & Now & " >>> " & "http://178.33.73.246/liveprice.aspx?scrip=" & LItemCode & "]")
                FWrite.Close
            End If
        End If
        
        'loop SREC TO INSERT/UPDATE ROM CTR_R
        SREC.MoveFirst
        While Not SREC.EOF
        
        '''
            For comploop2 = 1 To NoCompany
                Set CompCnn = Nothing: Set CompCnn = New ADODB.Connection:
                If comploop2 = 1 Then
                    Company = "m1"
                    CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-CMK2022"
                ElseIf comploop2 = 2 Then
                    Company = "m2"
                    CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-IND2022"
                ElseIf comploop2 = 3 Then
                    Company = "m3"
                    CompCnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-SIL2022"
                End If
                CompCnn.Mode = adModeShareExclusive: CompCnn.IsolationLevel = adXactIsolated: CompCnn.CursorLocation = adUseClient
                CompCnn.Open: CompCnn.CommandTimeout = 300
            
                flag = False
                DoEvents
                Dim LContime As String
                
                LSaudaID = 0
                LItemID = 0
                LExID = 0
                Set UREC = Nothing
                Set UREC = New ADODB.Recordset
                mysql = ""
                mysql = "SELECT SAUDAID FROM SAUDAMAST WHERE COMPCODE = '" & GCompCode & "' and saudacode = '" & SREC!saudacode & "' "
                UREC.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
                If Not UREC.EOF Then
                    LSaudaID = UREC!SAUDAID
                    
                    Set UREC = Nothing
                    Set UREC = New ADODB.Recordset
                    mysql = ""
                    mysql = "SELECT ITEMID FROM ITEMMAST WHERE COMPCODE = '" & GCompCode & "' and EXHCODE = '" & SREC!ITEMCODE & "' "
                    UREC.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
                    If Not UREC.EOF Then
                        LItemID = UREC!itemid
                    End If
                    
                    Set UREC = Nothing
                    Set UREC = New ADODB.Recordset
                    mysql = ""
                    mysql = "SELECT EXID FROM EXMAST WHERE COMPCODE = '" & GCompCode & "' and EXCODE = '" & SREC!excode & "' "
                    UREC.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
                    If Not UREC.EOF Then
                        LExID = UREC!EXID
                    End If
                End If
                
                If SREC!liverate > 0 And LSaudaID <> 0 Then
            
                    mysql = "select saudaid from ctr_r where COMPCODE=" & GCompCode & " AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "' and saudaid='" & LSaudaID & "'"
                    Set UREC = Nothing
                    Set UREC = New ADODB.Recordset
                    UREC.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
                    If Not UREC.EOF Then
                        'MYSQL = "update ctr_r set CLOSERATE = " & SREC!liverate & ",LOWRATE=" & SREC!low & ",HGRATE=" & SREC!high & "     WHERE COMPCODE=" & GCompCode & "  AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "  AND saudaid=" & SREC!SAUDAID & ""
                        CompCnn.Execute "update ctr_r set CLOSERATE = " & SREC!liverate & ",LOWRATE=" & SREC!LOW & ",HGRATE=" & SREC!HIGH & ",OPRATE=" & SREC!Open & "  WHERE COMPCODE=" & GCompCode & "  AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "' AND saudaid=" & LSaudaID & ""
                    Else
                        mysql = "select consno from ctr_m where COMPCODE=" & GCompCode & " AND condate = '" & Format(SREC!Condate, "YYYY/MM/DD") & "' and saudaid='" & LSaudaID & "'"
                        Set UREC1 = Nothing
                        Set UREC1 = New ADODB.Recordset
                        UREC1.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
                        If UREC1.EOF Then
                            flag = True
                            mysql = "select max(consno)+1 as 'consno' from ctr_m where COMPCODE=" & GCompCode & ""
                            Set UREC1 = Nothing
                            Set UREC1 = New ADODB.Recordset
                            UREC1.Open mysql, CompCnn, adOpenStatic, adLockReadOnly
                            If Not UREC1.EOF Then
                                Vconsno = UREC1!CONSNO
                            Else
                                Vconsno = 0
                            End If
                        Else
                            Vconsno = UREC1!CONSNO
                            flag = False
                        End If

                        '>>> INSERT INTO CTR_R
                        DoEvents
                        LContime = Time
                        Call PInsert_Ctr_R_COMPCNN(Vconsno, SREC!saudacode, SREC!Condate, SREC!Open, SREC!HIGH, SREC!LOW, SREC!liverate, 0, SREC!excode, SREC!ITEMCODE, LSaudaID, LItemID, LExID, 0, LContime)
                        
                        DoEvents
                        If flag Then
                            mysql = "EXEC INSERT_CTR_M " & GCompCode & "," & Vconsno & ",'" & Format(SREC!Condate, "YYYY/MM/DD") & "','" & SREC!saudacode & "','" & SREC!ITEMCODE & "','C','" & SREC!excode & "'," & LExID & "," & LItemID & "," & LSaudaID & ""
                            CompCnn.Execute mysql
                        End If
                    End If
                End If
            Next
            DoEvents
            SREC.MoveNext
        Wend
        DoEvents
        GETMAIN.ProgressBar1.Value = GETMAIN.ProgressBar1.Value + 1
        DoEvents
        'End If
    End If  ' If Not GRec.EOF Then
    '>>> GET LIVE PRICE -- END
    
    LCount = LCount + 1
    VCount = GRec.RecordCount
    If LCount >= 1 Then
        If LCount >= 20 Or VCount = 0 Then
            GoTo BILLING
        End If
        Call Get_LiveRate(LvcDTP1, LRopt, LCount)
    End If
  Next
  
  
BILLING:
  '''' Consolidated Billing

    For comploop2 = 1 To NoCompany
        Company = ""
        Set Cnn = Nothing
        Set Cnn = New ADODB.Connection:
        
        If comploop2 = 1 And Right(MServer, 7) <> "cmk2022" Then
            Company = "m1"
            Cnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-CMK2022"
        ElseIf comploop2 = 2 And Right(MServer, 6) <> "TJ2022" Then
            Company = "m2"
            Cnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-IND2022"
        ElseIf comploop2 = 3 And Right(MServer, 7) <> "SIL2022" Then
            Company = "m3"
            Cnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-SIL2022"
        End If
        If Len(Company) > 0 Then
            Cnn.Mode = adModeShareExclusive: Cnn.IsolationLevel = adXactIsolated: Cnn.CursorLocation = adUseClient
            Cnn.Open: Cnn.CommandTimeout = 300

            DoEvents:
            Cnn.BeginTrans

            If BILL_GENERATION(LvcDTP1, GFinEnd, vbNullString, "", "") Then
                Cnn.CommitTrans
                CNNERR = False
            Else
                Cnn.RollbackTrans
                CNNERR = False
            End If
        End If
  Next
  
  Set Cnn = Nothing
  Set Cnn = New ADODB.Connection:
  If Right(MServer, 7) = "cmk2022" Then
    Cnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-CMK2022"
  ElseIf Right(MServer, 7) = "IND2022" Then
    Cnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-IND2022"
  Else
    Cnn.ConnectionString = "driver={SQL Server};server=" & tempserver & ";uid=" & tempuid & ";pwd=" & tempwd & ";database=S-TJ2022"
  End If
  Cnn.Mode = adModeShareExclusive: Cnn.IsolationLevel = adXactIsolated: Cnn.CursorLocation = adUseClient
  Cnn.Open: Cnn.CommandTimeout = 300
  ''''
err1:
If err.Number <> 0 Then
   MsgBox err.Description
End If
End Sub
Public Sub PInsert_Ctr_R_COMPCNN(ByVal LIConSno As Long, ByVal LISauda As String, ByVal LIConDate As Date, ByVal LIOpenRate As Double, ByVal LIHighRate As Double, ByVal LILowRate As Double, ByVal LISettleRate As Double, ByVal LICloseRate As Double, ByVal LIExCode As String, ByVal LIItemCode As String, ByVal LISaudaId As Long, ByVal LIItemID As Integer, ByVal LIExID As Integer, ByVal LPRATE As Double, LContime As String)
    mysql = "EXEC INSERT_CTR_R " & GCompCode & "," & Val(LIConSno) & ",'" & LISauda & "','" & Format(LIConDate, "yyyy/MM/dd") & "'," & LIOpenRate & ", " & LIHighRate & ", " & LILowRate & "," & LISettleRate & "," & LICloseRate & ",'" & LIExCode & "','" & LIItemCode & "'," & LISaudaId & "," & LIItemID & "," & LIExID & "," & LPRATE & ",'" & LContime & "'"
    CompCnn.Execute mysql
End Sub
Public Sub Post_Inv_d5(ByVal LVParties As String, ByVal LVSaudas As String, ByVal LVExIDs As String, ByVal LVFromDate As Date)
On Error GoTo err1
Dim LInvdRec As ADODB.Recordset:    Dim LParty As String:       Dim LExCode As String:      Dim LExID As Integer:       Dim LBIllAmt As Double
Dim LIVouNo As String:              Dim LBrokAmt  As Double:    Dim LDiffAmt As Double:     Dim LMVNo As Long:          Dim LPartyType  As String
Dim LPartyDrCr As String:           Dim LContraDrCr As String:  Dim LBillDate As Date:      Dim LDiffDrCr As String:    Dim LBrokDrCr As String
Dim LNarration As String:           Dim LPartyName As String:   Dim LTradingAcc As String:  Dim LBrokAcc As String:     Dim LHeadAc As String
Dim LFmlyCode As String:            Dim LContraAc As String:    Dim LBBrokAmt As Double:    Dim LShareAmt As Double:    Dim LShNarration As String
Dim LShVouNo As String:             Dim MDR As String:          Dim MCR As String:          Dim BVNO As Long:           Dim SVNO As Long
Dim GMaxBVouNo As Long:             Dim GMaxHVouNo As Long:     Dim LCHK  As ADODB.Recordset:                           Dim LExRec As ADODB.Recordset
Dim LBillParties As String:         Dim LSetRec As ADODB.Recordset
Dim GMaxOVouNo As Long:             Dim LTotDiffAmt  As Double: Dim LTotBrokAmt  As Double: Dim LTotBillamt As Double
Dim LACCID As Long:                 Dim LTradingAccID As Long:  Dim LBrokAccID As Long:     Dim LShreeAccID As Long
Dim LHeadID As Long:                Dim LContraID As Long:      Dim LFmlyID As Long
Dim mprevsetdate As Date
Dim TRec As ADODB.Recordset
Dim RateRec As ADODB.Recordset
Dim LBillBy As String
Dim LLowRate As Double
Dim LHGRate As Double
Dim LFIXRate As Double
Dim mbcycle As String
Dim LwInvdRec As ADODB.Recordset
Dim LWBIllAmt As Double: Dim LWBrokAmt  As Double:    Dim LWDiffAmt As Double:
mbcycle = "S"

Dim LMaxDate  As Date
Set TRec = Nothing
Set TRec = New ADODB.Recordset
mysql = "SELECT MAX(CONDATE) AS MDATE FROM CTR_M WHERE COMPCODE =" & GCompCode & ""
TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
If Not TRec.EOF Then
    If Not IsNull(TRec!MDate) Then
        LMaxDate = TRec!MDate
    End If
End If

mysql = "SELECT EXID,EXCODE,TRADINGACC,BROKAC FROM EXMAST WHERE COMPCODE =" & GCompCode & " "
If LenB(LVExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LVExIDs & ") "
Set LExRec = Nothing
Set LExRec = New ADODB.Recordset
LExRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly

mprevsetdate = GFinBegin
Dim LCondate  As Date
mysql = "SELECT SETDATE FROM SETTLE  WHERE COMPCODE =" & GCompCode & ""
mysql = mysql & " AND SETDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
mysql = mysql & " AND SETDATE  <='" & Format(LMaxDate, "yyyy/mm/dd") & "'"
Set LSetRec = Nothing
Set LSetRec = New ADODB.Recordset
LSetRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly
If LSetRec.EOF Then Exit Sub

Do While Not LSetRec.EOF
    LCondate = LSetRec!SETDATE
    LBillDate = LCondate
    
    mysql = "SELECT SETDATE FROM SETTLE WHERE COMPCODE =" & GCompCode & " AND SETDATE <='" & Format((LBillDate - 1), "YYYY/MM/DD") & "' ORDER BY SETDATE DESC"
    Set TRec = Nothing
    Set TRec = New ADODB.Recordset
    TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    If Not TRec.EOF Then
        mprevsetdate = TRec!SETDATE
    Else
        mprevsetdate = LBillDate - 7
    End If
        
    Set LwInvdRec = Nothing
    Set LwInvdRec = New ADODB.Recordset
    mysql = "SELECT A.ACCID,A.AC_CODE,A.NAME,A.PARTYTYPE,I.EXCODE,I.EXID, SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT FROM INV_D AS I, ACCOUNTD AS A "
    mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & " AND  A.ACCID =I.ACCID "
    mysql = mysql & " AND A.BCYCLE = 'S' AND EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
    mysql = mysql & " AND STDATE  >'" & Format(mprevsetdate, "yyyy/mm/dd") & "'"
    mysql = mysql & " AND STDATE  <='" & Format(LBillDate, "yyyy/mm/dd") & "'"
    If LenB(LVParties) > 0 Then mysql = mysql & " AND A.AC_CODE IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY  A.ACCID,A.AC_CODE,A.NAME,A.PARTYTYPE,I.EXCODE,I.EXID"
    mysql = mysql & " HAVING (ABS(SUM(I.DIFFAMT))+ABS(SUM(I.BROKAMT))) <> 0 "
    mysql = mysql & " ORDER BY I.EXCODE,A.AC_CODE,A.PARTYTYPE  "
    LwInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        
    Set LInvdRec = Nothing
    Set LInvdRec = New ADODB.Recordset
    mysql = "SELECT A.ACCID,A.AC_CODE,A.NAME,A.PARTYTYPE,I.EXCODE,I.EXID, SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT FROM INV_D AS I, ACCOUNTD AS A "
    mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & " AND  A.ACCID =I.ACCID  AND I.POST = 0 "
    mysql = mysql & " AND A.BCYCLE = 'S' AND EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
    mysql = mysql & " AND STDATE  >'" & Format(mprevsetdate, "yyyy/mm/dd") & "'"
    mysql = mysql & " AND STDATE  <='" & Format(LBillDate, "yyyy/mm/dd") & "'"
    If LenB(LVParties) > 0 Then mysql = mysql & " AND A.AC_CODE IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY  A.ACCID,A.AC_CODE,A.NAME,A.PARTYTYPE,I.EXCODE,I.EXID"
    mysql = mysql & " HAVING (ABS(SUM(I.DIFFAMT))+ABS(SUM(I.BROKAMT))) <> 0 "
    mysql = mysql & " ORDER BY I.EXCODE,A.AC_CODE,A.PARTYTYPE  "
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    
    If Not LInvdRec.EOF Then
        GMaxVouNo = Val(Right$(Get_VouNo("SETL", GFinYear), 7))
        GMaxBVouNo = Val(Right$(Get_VouNo("BROK", GFinYear), 7))
        GMaxHVouNo = Val(Right$(Get_VouNo("SHAR", GFinYear), 7))
    End If
    
    Do While Not LInvdRec.EOF
        LExCode = LInvdRec!excode
        GETMAIN.Label1.Caption = LExCode & " Posting Bill Voucher " & LBillDate
        DoEvents
        
        LExID = LInvdRec!EXID
        LExRec.MoveFirst
        LExRec.Find "EXID=" & LExID & ""
        If Not LExRec.EOF Then
            LTradingAcc = LExRec!TRADINGACC & vbNullString:    LBrokAcc = LExRec!BROKAC & vbNullString:
            LTradingAccID = Get_AccID(LTradingAcc)
            LBrokAccID = Get_AccID(LBrokAcc)
        End If
        Do While LExID = LInvdRec!EXID
            LDiffDrCr = "C":    LBrokDrCr = "C":    LPartyDrCr = "C"::
            LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
            LWDiffAmt = 0:      LWBrokAmt = 0:      LWBIllAmt = 0:
            LTotDiffAmt = 0:    LTotBrokAmt = 0:    LTotBillamt = 0:
            LParty = LInvdRec!AC_CODE:
            LACCID = LInvdRec!ACCID
            LPartyType = LInvdRec!PARTYTYPE
            LPartyName = LInvdRec!NAME:
            
            LwInvdRec.MoveFirst
            LwInvdRec.Find "ACCID=" & LACCID & ""
            If Not LwInvdRec.EOF Then
                LWDiffAmt = LwInvdRec!dAMT:   LWBrokAmt = LwInvdRec!BrAMT:     LWBIllAmt = LwInvdRec!BAMT
            End If

            LDiffAmt = LInvdRec!dAMT:   LBrokAmt = LInvdRec!BrAMT:     LBIllAmt = LInvdRec!BAMT
            
            mbcycle = "S"
                
            LBillBy = "S"
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            mysql = "SELECT BILLBY FROM ACCT_EX WHERE ACCID = '" & LACCID & "' AND EXID ='" & LExID & "'  "
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                LBillBy = TRec!billby
            End If

            If gcurrtype = 1 And LExCode = "CMX" Then
                mysql = "SELECT CLOSERATE,HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LBillDate, "yyyy/mm/dd") & "' "
                Set RateRec = Nothing
                Set RateRec = New ADODB.Recordset
                RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not RateRec.EOF Then
                    If LBillBy = "S" Then
                        LLowRate = RateRec!CLOSERATE
                        LHGRate = RateRec!CLOSERATE
                    Else
                        LLowRate = RateRec!LOWRATE
                        LHGRate = RateRec!HGRATE
                    End If
                Else
                    LLowRate = 1
                    LHGRate = 1
                End If
                    
                If LBillBy = "P" Then
                    Set RateRec = Nothing
                    Set RateRec = New ADODB.Recordset
                    mysql = "SELECT TOP 1 LOW,HIGH FROM CTR_RP WHERE ACCID = " & LACCID & " AND SAUDA ='USDINR' AND CONDATE = '" & Format(LBillDate, "yyyy/mm/dd") & "' "
                    RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not RateRec.EOF Then
                        LLowRate = IIf(RateRec!LOW = 0, LLowRate, RateRec!LOW)
                        LHGRate = IIf(RateRec!HIGH = 0, LHGRate, RateRec!HIGH)
                    End If
                    
                    Set RateRec = Nothing
                End If
            End If

            '''
            If LPartyType <> 2 Then
                If LWBIllAmt > 0 Then
                    LDiffAmt = LDiffAmt * LLowRate
                    
                    If GUniqClientId = "BRO2-CHE" Then
                        LBrokAmt = LBrokAmt * LHGRate
                        LBIllAmt = LDiffAmt + LBrokAmt
                    Else
                        LBIllAmt = LBIllAmt * LLowRate
                        LBrokAmt = LBrokAmt * LLowRate
                    End If
                    LFIXRate = LLowRate
                Else
                    LBIllAmt = LBIllAmt * LHGRate
                    LDiffAmt = LDiffAmt * LHGRate
                    LBrokAmt = LBrokAmt * LHGRate
                    LFIXRate = LHGRate
                End If
            Else
                If LWBIllAmt < 0 Then
                    LDiffAmt = LDiffAmt * LLowRate
                    If GUniqClientId = "BRO2-CHE" Then
                        LBrokAmt = LBrokAmt * LHGRate
                    Else
                        LBrokAmt = LBrokAmt * LLowRate
                    End If
                    LBIllAmt = LBIllAmt * LLowRate
                    LFIXRate = LLowRate
                Else
                    LBIllAmt = LBIllAmt * LHGRate
                    LDiffAmt = LDiffAmt * LHGRate
                    LBrokAmt = LBrokAmt * LHGRate
                    LFIXRate = LHGRate
                End If
            End If
            '''
            If Val(LBIllAmt) < 0 Then LPartyDrCr = "D"
            If Val(LDiffAmt) > 0 Then LDiffDrCr = "D"
            If Val(LBrokAmt) > 0 Then LBrokDrCr = "D"
            
            If GRoundOff = "Y" Then
                LBIllAmt = Round(LBIllAmt)
                LDiffAmt = Round(LDiffAmt)
                LBrokAmt = Round(LBrokAmt)
            End If
            If gcurrtype = 1 And LFIXRate = 1 And LExCode = "CMX" Then
                MsgBox "Please Enter USDINR Rate On " & LBillDate
            End If
            If Abs(LDiffAmt) + Abs(LBrokAmt) + Abs(LBIllAmt) <> 0 Then
                LIVouNo = Get_Next_Vou_No(GMaxVouNo, "SETL", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxVouNo = GMaxVouNo + 1
                LMVNo = PInsert_Voucher(LIVouNo, LBillDate, "S", "P", 0, "ADD", LParty, 0, vbNullString, LExCode, "0", LExID, LACCID)
                If LExCode <> "CMX" Then
                    LFIXRate = 1
                    LHGRate = 1
                End If
                mysql = "UPDATE INV_D SET currrate =" & LHGRate & " ,USDINR = " & LFIXRate & ",POST = 1 ,VOU_ID  =" & LMVNo & ", VCHNO  ='" & LIVouNo & "' WHERE ACCID  =" & LACCID & " And EXID = " & LExID & ""
                mysql = mysql & " AND STDATE <='" & Format(LBillDate, "YYYY/MM/DD") & "' AND POST =0 " '
                Cnn.Execute mysql
                
                LNarration = LExCode & " Settlemet "
                ''PARTY AC POSTING
                If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, LParty, Abs(Val(LBIllAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                If LDiffAmt <> 0 Then
                    LNarration = "Settlemet " & LExCode & " " & LPartyName & " " & LParty
                    Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LDiffDrCr, LTradingAcc, Abs(Val(LDiffAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LTradingAccID)
                End If
                If LBrokAmt <> 0 Then
                    LNarration = "Brok " & LExCode & " " & LPartyName & " " & LParty & " "
                    Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LBrokDrCr, LBrokAcc, Abs(Val(LBrokAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBrokAccID)
                End If
            End If
            
            '''''
            'If gcurrtype = 1 And LExCode = "CMX" And mbcycle = "S" Then
         '       mysql = "UPDATE INV_D SET currrate =" & LHGRate & " ,USDINR = " & LFIXRate & " WHERE COMPCODE = " & GCompCode & " AND EXID = " & LExID & " And STDATE > '" & Format(mprevsetdate, "YYYY/MM/DD") & "'  And STDATE <= '" & Format(LBillDate, "YYYY/MM/DD") & "' AND PARTY ='" & LParty & "'"
          '      Cnn.Execute mysql
            'End If

            LInvdRec.MoveNext
            If LInvdRec.EOF Then Exit Do
                mprevsetdate = LBillDate
            Loop
            If LInvdRec.EOF Then Exit Do
        Loop
        LSetRec.MoveNext
    Loop
    mprevsetdate = GFinBegin
    GETMAIN.ProgressBar1.Visible = False
    GETMAIN.PERLBL.Caption = vbNullString
    Dim LTotBBrokAmt As Double
    Dim LTotShareAmt As Double
    LSetRec.MoveFirst
    Do While Not LSetRec.EOF
        LCondate = LSetRec!SETDATE
        
        GETMAIN.Label1.Caption = " Posting Share Voucher " & LCondate
        DoEvents
            
        LBillDate = LCondate
        Set LInvdRec = Nothing
        Set LInvdRec = New ADODB.Recordset
        mysql = "SELECT a.usdinr,B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRAID,B.CONTRA_AC,C.ACCID,C.AC_CODE,C.NAME,C.PARTYTYPE,A.EXCODE,A.EXID,"
        mysql = mysql & " SUM(A.AMOUNT) AS BROKAMT ,SUM(A.SAMOUNT) AS SHAREAMT FROM INV_D1 AS A,ACCFMLY AS B, ACCOUNTD AS C"
        mysql = mysql & " Where C.COMPCODE =" & GCompCode & " And A.FMLYID = B.FMLYID AND A.ACCID = C.ACCID "
        mysql = mysql & " AND A.POST = 0 "
        mysql = mysql & " AND C.BCYCLE = 'S' AND A.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
        mysql = mysql & " AND STDATE  >'" & Format(mprevsetdate, "yyyy/mm/dd") & "'"
        mysql = mysql & " AND A.STDATE  <='" & Format(LCondate, "yyyy/mm/dd") & "'"
        If LenB(LVParties) > 0 Then mysql = mysql & " AND C.AC_CODE  IN (" & LVParties & ") "
        If LenB(LVExIDs) > 0 Then mysql = mysql & " AND A.EXID  IN (" & LVExIDs & ") "
        mysql = mysql & " GROUP BY B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRAID,B.CONTRA_AC,C.ACCID,C.AC_CODE,C.NAME,C.PARTYTYPE,A.EXCODE,A.EXID,A.USDINR"
        mysql = mysql & " ORDER BY C.AC_CODE ,B.FMLYCODE,A.EXCODE "
        LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
        Do While Not LInvdRec.EOF
            LIVouNo = vbNullString:                  LShVouNo = vbNullString
            BVNO = 0:                                SVNO = 0
            LTotBBrokAmt = 0:                        LTotShareAmt = 0
            LFmlyCode = LInvdRec!FMLYCODE:           LHeadAc = LInvdRec!FMLYHEAD
            LContraAc = LInvdRec!Contra_Ac:          LParty = LInvdRec!AC_CODE
            LPartyName = LInvdRec!NAME:              LExCode = LInvdRec!excode:
            LExID = LInvdRec!EXID:                   LHeadID = LInvdRec!HEADID
            LFmlyID = LInvdRec!FMLYID:               LACCID = LInvdRec!ACCID:
            LContraID = LInvdRec!CONTRAID
            LPartyType = LInvdRec!PARTYTYPE
            
            Do While LFmlyCode = LInvdRec!FMLYCODE And LParty = LInvdRec!AC_CODE And LExID = LInvdRec!EXID
                LBBrokAmt = LInvdRec!BROKAMT:            LShareAmt = LInvdRec!SHAREAMT
                LTotBBrokAmt = LTotBBrokAmt + LBBrokAmt
                LTotShareAmt = LTotShareAmt + LShareAmt
                LInvdRec.MoveNext
                If LInvdRec.EOF Then Exit Do
            Loop
            
            LBillBy = "S"
            Set TRec = Nothing
            Set TRec = New ADODB.Recordset
            mysql = "SELECT BILLBY FROM ACCT_EX WHERE ACCID = '" & LACCID & "' AND EXID ='" & LExID & "'  "
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                LBillBy = TRec!billby
            End If

            If gcurrtype = 1 And LExCode = "CMX" Then
                mysql = "SELECT CLOSERATE,HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LBillDate, "yyyy/mm/dd") & "' "
                Set RateRec = Nothing
                Set RateRec = New ADODB.Recordset
                RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not RateRec.EOF Then
                    If LBillBy = "S" Then
                        LLowRate = RateRec!CLOSERATE
                        LHGRate = RateRec!CLOSERATE
                    Else
                        LLowRate = RateRec!LOWRATE
                        LHGRate = RateRec!HGRATE
                    End If
                Else
                    LLowRate = 1
                    LHGRate = 1
                End If
                    
                If LBillBy = "P" Then
                    Set RateRec = Nothing
                    Set RateRec = New ADODB.Recordset
                    mysql = "SELECT TOP 1 LOW,HIGH FROM CTR_RP WHERE ACCID = " & LACCID & " AND SAUDA ='USDINR' AND CONDATE = '" & Format(LBillDate, "yyyy/mm/dd") & "' "
                    RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                    If Not RateRec.EOF Then
                        LLowRate = IIf(RateRec!LOW = 0, LLowRate, RateRec!LOW)
                        LHGRate = IIf(RateRec!HIGH = 0, LHGRate, RateRec!HIGH)
                    End If
                    
                    Set RateRec = Nothing
                End If
            End If

           ''''
            If LPartyType <> 2 Then
                If LTotShareAmt > 0 Then
                    LTotShareAmt = LTotShareAmt * LLowRate
                    If GUniqClientId = "BRO2-CHE" Then
                        LTotBBrokAmt = LTotBBrokAmt * LHGRate
                    Else
                         LTotBBrokAmt = LTotBBrokAmt * LLowRate
                    End If
                    LFIXRate = LLowRate
                Else
                    LTotShareAmt = LTotShareAmt * LHGRate
                    LTotBBrokAmt = LTotBBrokAmt * LHGRate
                    LFIXRate = LHGRate
                End If
            Else
                If LTotShareAmt > 0 Then
                    LTotShareAmt = LTotShareAmt * LHGRate
                    LTotBBrokAmt = LTotBBrokAmt * LHGRate
                    LFIXRate = LHGRate
                Else
                    LTotShareAmt = LTotShareAmt * LLowRate
                    If GUniqClientId = "BRO2-CHE" Then
                        LTotBBrokAmt = LTotBBrokAmt * LHGRate
                    Else
                         LTotBBrokAmt = LTotBBrokAmt * LLowRate
                    End If
                    LFIXRate = LLowRate
                End If
            End If
            
            
            If GRoundOff = "Y" Then
                LTotShareAmt = Round(LTotShareAmt)
                LTotBBrokAmt = Round(LTotBBrokAmt)
            End If

            If LTotBBrokAmt <> 0 Then
                If LTotBBrokAmt > 0 Then
                    MDR = "C": MCR = "D"
                Else
                    MDR = "D": MCR = "C"
                End If
                LIVouNo = Get_Next_Vou_No(GMaxBVouNo, "BROK", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxBVouNo = GMaxBVouNo + 1
                LShNarration = LExCode & " Sub Brok For Client " & LPartyName & ""
                BVNO = PInsert_Voucher(LIVouNo, LBillDate, "B", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MDR, LHeadAc, Abs(LTotBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LHeadID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MCR, LBrokAcc, Abs(LTotBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LBrokAccID)
            End If
            If LTotShareAmt <> 0 Then
                If LTotShareAmt < 0 Then
                    MCR = "D": MDR = "C"
                Else
                    MCR = "C": MDR = "D"
                End If
                LShVouNo = Get_Next_Vou_No(GMaxHVouNo, "SHAR", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxHVouNo = GMaxHVouNo + 1
                LShNarration = LExCode & " Share Amt For Client " & LPartyName & " "
                SVNO = PInsert_Voucher(LShVouNo, LBillDate, "H", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                'PARTY AC POSTING
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MCR, LContraAc, Abs(Val(LTotShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LContraID)
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MDR, LHeadAc, Abs(Val(LTotShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LHeadID)
            End If
            If LExCode <> "CMX" Then
                LFIXRate = 1
            End If
            mysql = "UPDATE INV_D1 SET POST  =1 ,USDINR = " & LFIXRate & ",SVOU_ID  =" & SVNO & ",BVOU_ID =" & BVNO & ",VOU_NO='" & LIVouNo & "',SVOU_NO='" & LShVouNo & "' WHERE "
            mysql = mysql & " ACCID  =" & LACCID & "  And EXID = " & LExID & "  AND FMLYID =" & LFmlyID & ""   '
            mysql = mysql & " AND STDATE <='" & Format(LBillDate, "YYYY/MM/DD") & "' AND POST  =0 " '
            Cnn.Execute mysql

            If LInvdRec.EOF Then Exit Do
        Loop
        mprevsetdate = LBillDate
        LSetRec.MoveNext
    Loop
    Exit Sub
GETMAIN.ProgressBar1.Visible = False
err1:
MsgBox (err.Description)

End Sub
Public Sub Post_Inv_d6(ByVal LVParties As String, ByVal LVSaudas As String, ByVal LVExIDs As String, ByVal LVFromDate As Date)
On Error GoTo err1
Dim LInvdRec As ADODB.Recordset:    Dim LParty As String:       Dim LExCode As String:         Dim LExID As Integer:       Dim LBIllAmt As Double
Dim LIVouNo As String:              Dim LBrokAmt  As Double:    Dim LDiffAmt As Double:        Dim LMVNo As Long:          Dim LPartyType  As String
Dim LPartyDrCr As String:           Dim LContraDrCr As String:  Dim LBillDate As Date:         Dim LDiffDrCr As String:    Dim LBrokDrCr As String
Dim LNarration As String:           Dim LPartyName As String:   Dim LTradingAcc As String:     Dim LBrokAcc As String:     Dim LCGSTAcc As String:
Dim LIGSTAcc As String:             Dim LSGSTAcc As String:     Dim LStampAcc As String:       Dim LSBCAcc As String:      Dim LSrvTaxAcc As String
Dim LStandAcc As String:            Dim LTranAcc As String:     Dim LSEBIAcc As String:        Dim LCTTAcc As String:      Dim LRiskMAcc As String
Dim LICGSTDrCr As String:           Dim LISGSTDrCr As String:   Dim LIIGSTDrCr As String:      Dim LISGSTAmt As Double:    Dim LICGSTAmt As Double
Dim LIIGSTAmt As Double:            Dim LTranDrCr As String:    Dim LSrvTAxDrCr As String:     Dim LStandDrCr As String:   Dim LTanAmt As Double
Dim LSrvTaxAmt  As Double:          Dim LStandAmt  As Double:   Dim LSEBITaxDrCr As String:    Dim LCTTDrCr As String:     Dim LSBCDrCr As String
Dim LSEBITaxAmt As Double:          Dim LCttAmt  As Double:     Dim LSBCDrCrR  As Double:      Dim LIStampDrCr As String:  Dim LIStampAmt As Double
Dim LTranAmt As Double:             Dim LRiskMDrCr As String:   Dim LISBCAmt As Double:        Dim LRiskMAmt As Double:    Dim LHeadAc As String
Dim LFmlyCode As String:            Dim LContraAc As String:    Dim LBBrokAmt As Double:       Dim LShareAmt As Double:    Dim LShNarration As String
Dim LShVouNo As String:             Dim MDR As String:          Dim MCR As String:             Dim BVNO As Long:           Dim SVNO As Long
Dim GMaxBVouNo As Long:             Dim GMaxHVouNo As Long:     Dim LCHK  As ADODB.Recordset:                           Dim LExRec As ADODB.Recordset
Dim LBillParties As String:         Dim LCurrency  As String:   Dim LACCID As Long:           Dim TradingAccID As Long

Dim LBrokAccID As Long:             Dim LFmlyID As Long:        Dim LHeadID   As Long:        Dim LContraID  As Long
Dim LExpAccID As Long:              Dim LBankAccID As Long:     Dim LCGSTAccID As Long:       Dim LSGSTAccID As Long
Dim LIGSTAccID As Long:             Dim LSBCAccID  As Long:     Dim LSrvTaxAccID As Long:     Dim LRiskMAccID As Long
Dim LStandAccID  As Long:           Dim LTranAccID As Long:     Dim LCTTAccID As Long:        Dim LStampAccID  As Long
Dim LSEBIAccID As Long:             Dim LNBOTBank As String
Dim LBillBy As String
Dim mbcycle As String
Dim mprevsetdate As Date
                
Dim LLowRate As Double
Dim LHGRate As Double
Dim LFIXRate As Double

Dim RateRec As ADODB.Recordset
Dim TRec As New ADODB.Recordset
Dim SetRec As New ADODB.Recordset


mysql = "SELECT * FROM EXMAST WHERE COMPCODE =" & GCompCode & " "
If LenB(LVExIDs) > 0 Then mysql = mysql & " AND EXID  IN (" & LVExIDs & ") "
Set LExRec = Nothing
Set LExRec = New ADODB.Recordset
LExRec.Open mysql, Cnn, adOpenStatic, adLockReadOnly

Dim LChkVouRec As ADODB.Recordset
Set LInvdRec = Nothing
Set LInvdRec = New ADODB.Recordset
If GOnlyBrok <> 0 Then
    mysql = "SELECT I.USDINR,A.PARTYTYPE,A.NAME,I.STDATE,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE ,SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT FROM INV_D AS I, ACCOUNTD AS A "
    mysql = mysql & " WHERE A.COMPCODE =" & GCompCode & " AND A.ACCID =I.ACCID   "
    mysql = mysql & " AND A.BCYCLE = 'D' AND i.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
    mysql = mysql & " AND STDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
    If LenB(LVParties) > 0 Then mysql = mysql & " AND I.PARTY IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY I.USDINR,A.PARTYTYPE,A.NAME,I.STDATE,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE "
    mysql = mysql & " ORDER BY I.EXCODE,I.STDATE,A.AC_CODE"
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
Else
    mysql = "SELECT I.USDINR,A.PARTYTYPE,A.NAME,I.STDATE,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE ,SUM(I.DIFFAMT) AS DAMT,SUM(I.BROKAMT) AS BRAMT,SUM(I.BILLAMT) AS BAMT "
    mysql = mysql & " ,SUM(TRANAMT) AS TRANAMT,SUM(SRVAMT) AS SRVAMT,SUM(RISKMAMT) AS RISKMAMT,SUM(STDAMT) AS STDAMT"
    mysql = mysql & ", SUM(SBC_TAX_AMT) AS SBCTAXAMT ,SUM(STTTAX) AS CTTAMT ,SUM(SEBITAXAMT) AS SEBITAX "
    mysql = mysql & ", SUM(CGSTAMT) AS CGSTAMT,SUM(SGSTAMT) AS SGSTAMT,SUM(IGSTAMT) AS IGSTAMT, SUM(STAMPAMT) AS STAMPAMT "
    mysql = mysql & " FROM INV_D AS I, ACCOUNTD AS A WHERE A.COMPCODE =" & GCompCode & " AND A.ACCID =I.ACCID AND "
    mysql = mysql & " STDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "' "
    mysql = mysql & "  AND A.BCYCLE = 'D' AND EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
    If LenB(LVParties) > 0 Then mysql = mysql & " AND I.PARTY IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND I.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY I.USDINR,A.PARTYTYPE,A.NAME,I.STDATE,I.EXCODE,I.EXID,A.ACCID,A.AC_CODE "
    mysql = mysql & " ORDER BY I.EXCODE,I.STDATE,A.AC_CODE"
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
End If
If Not LInvdRec.EOF Then
    GMaxVouNo = Val(Right$(Get_VouNo("SETL", GFinYear), 7))
    GMaxBVouNo = Val(Right$(Get_VouNo("BROK", GFinYear), 7))
    GMaxHVouNo = Val(Right$(Get_VouNo("SHAR", GFinYear), 7))
End If
    Do While Not LInvdRec.EOF
        LExCode = LInvdRec!excode
        LExID = LInvdRec!EXID
        LExRec.MoveFirst
        LExRec.Find "EXID=" & LExID & ""
        If Not LExRec.EOF Then
            LTradingAcc = LExRec!TRADINGACC & vbNullString:    LBrokAcc = LExRec!BROKAC & vbNullString:
            LBrokAccID = Get_AccID(LBrokAcc)
            TradingAccID = Get_AccID(LTradingAcc)
            If GOnlyBrok = 0 Then
                LNBOTBank = LExRec!BANKACC & vbNullString:    LCGSTAcc = (LExRec!CGSTACC & vbNullString):           LSGSTAcc = (LExRec!SGSTACC & vbNullString):
                LSBCAcc = (LExRec!SBCACC & vbNullString):       LSrvTaxAcc = (LExRec!SrvTaxACC & vbNullString):     LStandAcc = (LExRec!standac & vbNullString)
                LTranAcc = (LExRec!tranac & vbNullString):      LCTTAcc = (LExRec!TRANTAX & vbNullString):          LRiskMAcc = (LExRec!RISKMACC & vbNullString)
                LSEBIAcc = (LExRec!STCACC & vbNullString):      LStampAcc = (LExRec!SDutyTaxAcc & vbNullString):    LIGSTAcc = (LExRec!IGSTACC & vbNullString):
                
                LBankAccID = Get_AccID(LNBOTBank):                LCGSTAccID = Get_AccID(LCGSTAcc)
                LSGSTAccID = Get_AccID(LSGSTAcc):                 LIGSTAccID = Get_AccID(LIGSTAcc)
                LSBCAccID = Get_AccID(LSBCAcc):                   LSrvTaxAccID = Get_AccID(LSrvTaxAcc)
                LStandAccID = Get_AccID(LStandAcc):               LTranAccID = Get_AccID(LTranAcc)
                LCTTAccID = Get_AccID(LCTTAcc):                   LRiskMAccID = Get_AccID(LRiskMAcc)
                LSEBIAccID = Get_AccID(LSEBIAcc):                 LStampAccID = Get_AccID(LStampAcc)
            End If
        End If

        LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
        Do While LExID = LInvdRec!EXID
            LBillDate = LInvdRec!STDATE:
            GETMAIN.Label1.Caption = LExCode & " Posting Bill Voucher " & LBillDate
            DoEvents
            
            Do While LBillDate = LInvdRec!STDATE And LExID = LInvdRec!EXID

                If GOnlyBrok = 0 Then
                    LICGSTDrCr = "C":    LISGSTDrCr = "C":  LIIGSTDrCr = "C"
                    LIStampDrCr = "C":   LSBCDrCr = "C":    LSrvTAxDrCr = "C":  LStandDrCr = "C"
                    LTranDrCr = "C":     LCTTDrCr = "C":    LRiskMDrCr = "C":   LSEBITaxDrCr = "C":
                    
                    LStandAmt = 0:       LTranAmt = 0:      LIStampAmt = 0:
                    LICGSTAmt = 0:       LISGSTAmt = 0:     LIIGSTAmt = 0:
                    LCttAmt = 0:         LSrvTaxAmt = 0:    LRiskMAmt = 0
                    LSEBITaxAmt = 0:     LISBCAmt = 0
                End If
                LParty = LInvdRec!AC_CODE:
                LACCID = LInvdRec!ACCID
                LPartyName = LInvdRec!NAME:
                LPartyType = LInvdRec!PARTYTYPE
                LLowRate = LInvdRec!USDINR
                LHGRate = LInvdRec!USDINR
                LBIllAmt = LInvdRec!BAMT * LInvdRec!USDINR
                LDiffAmt = LInvdRec!dAMT * LInvdRec!USDINR
                LBrokAmt = LInvdRec!BrAMT * LInvdRec!USDINR
                
                LDiffDrCr = "C":    LBrokDrCr = "C":    LPartyDrCr = "C":
                If Val(LBIllAmt) < 0 Then LPartyDrCr = "D"
                If Val(LDiffAmt) > 0 Then LDiffDrCr = "D"
                If Val(LBrokAmt) > 0 Then LBrokDrCr = "D"
                If GOnlyBrok = 0 Then
                    LICGSTAmt = LInvdRec!cgstamt
                    If LICGSTAmt > 0 Then LICGSTDrCr = "D"
                    LISGSTAmt = LInvdRec!SGSTAMT
                    If LISGSTAmt > 0 Then LISGSTDrCr = "D"
                    LIIGSTAmt = LInvdRec!IGSTAMT
                    If LIIGSTAmt > 0 Then LIIGSTDrCr = "D"
                    LIStampAmt = LInvdRec!STampamt
                    If LIStampAmt > 0 Then LIStampDrCr = "D"
                    LTranAmt = LInvdRec!TranAmt
                    If LTranAmt > 0 Then LTranDrCr = "D"
                    LStandAmt = LInvdRec!STDAMT
                    If LStandAmt > 0 Then LStandDrCr = "D"
                    LRiskMAmt = LInvdRec!RISKMAMT
                    If LRiskMAmt > 0 Then LRiskMDrCr = "D"
                    LSrvTaxAmt = LInvdRec!SRVAMT
                    If LSrvTaxAmt > 0 Then LSrvTAxDrCr = "D"
                    LCttAmt = LInvdRec!CTTAMT
                    If LCttAmt > 0 Then LCTTDrCr = "D"
                    LSEBITaxAmt = LInvdRec!SEBITAX
                    If LSEBITaxAmt > 0 Then LSEBITaxDrCr = "D"
                    LISBCAmt = LInvdRec!SBCTaxAmt
                    If LISBCAmt > 0 Then LSBCDrCr = "D"
                End If
                

                
                ''
                If Abs(LDiffAmt) + Abs(LBrokAmt) + Abs(LBIllAmt) <> 0 Then
                    LIVouNo = Get_Next_Vou_No(GMaxVouNo, "SETL", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                    GMaxVouNo = GMaxVouNo + 1
                    LMVNo = PInsert_Voucher(LIVouNo, LBillDate, "S", "P", 0, "ADD", LParty, 0, vbNullString, LExCode, "0", LExID, 0)
                    mysql = "EXEC UPD_INVD_VNO " & LACCID & ",'" & Format(LBillDate, "YYYY/MM/DD") & "'," & LExID & "," & LMVNo & ",'" & LIVouNo & "'"
                    Cnn.Execute mysql
                    
                    LNarration = LExCode & " Settlemet"
                    If LPartyType = "3" Then
                        'NBOT BANK AC POSTING
                        If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, GNBOTBank, Abs(Val(LBIllAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBankAccID)
                    Else
                        ''PARTY AC POSTING
                        If LBIllAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LPartyDrCr, LParty, Abs(Val(LBIllAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LACCID)
                    End If
                    If LDiffAmt <> 0 Then
                        LNarration = "Settlemet " & LExCode & " " & LPartyName & " " & LParty
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LDiffDrCr, LTradingAcc, Abs(Val(LDiffAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, TradingAccID)
                    End If
                    If LBrokAmt <> 0 Then
                        LNarration = "Brok " & LExCode & " " & LPartyName & " " & LParty
                        Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LBrokDrCr, LBrokAcc, Abs(Val(LBrokAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LBrokAccID)
                    End If
                End If
                
                If GOnlyBrok = 0 Then
                    LNarration = "Exp " & LExCode & " " & LPartyName & " " & LParty
                    If LICGSTAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LICGSTDrCr, LCGSTAcc, Abs(Val(LICGSTAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LCGSTAccID)
                    If LISGSTAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LISGSTDrCr, LSGSTAcc, Abs(Val(LISGSTAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSGSTAccID)
                    If LIIGSTAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LIIGSTDrCr, LIGSTAcc, Abs(Val(LIIGSTAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LIGSTAccID)
                    If LIStampAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LIStampDrCr, LStampAcc, Abs(Val(LIStampAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LStampAccID)
                    If LISBCAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LSBCDrCr, LSBCAcc, Abs(Val(LISBCAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSBCAccID)
                    If LCttAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LCTTDrCr, LCTTAcc, Abs(Val(LCttAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LCTTAccID)
                    If LRiskMAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LRiskMDrCr, LRiskMAcc, Abs(Val(LRiskMAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LRiskMAccID)
                    If LSEBITaxAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LSEBITaxDrCr, LSEBIAcc, Abs(Val(LSEBITaxAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSEBIAccID)
                    If LStandAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LStandDrCr, LStandAcc, Abs(Val(LStandAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LStandAccID)
                    If LTranAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LTranDrCr, LTranAcc, Abs(Val(LTranAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LTranAccID)
                    If LSrvTaxAmt <> 0 Then Call PInsert_Vchamt(LIVouNo, "S", LBillDate, LSrvTAxDrCr, LSrvTaxAcc, Abs(Val(LSrvTaxAmt)), vbNullString, LBillDate, LNarration, vbNullString, LExCode, 0, LExCode, LMVNo, LExID, 0, LSrvTaxAccID)
                    'If LIUTTAmt <> 0 Then Call PInsert_PostVchamt(LDVouNo, LDUTTAmt, GUTTAcc, LDVouDate, LDExCode, LDParty, LDNarr, LDMVnO, LDExID, LDSaudaID)
                End If
                If gcurrtype = 1 And LExCode = "CMX" And mbcycle = "S" Then
                    If Not SetRec.EOF Then
                        LDiffAmt = 0:       LBrokAmt = 0:       LBIllAmt = 0:
                    End If
                End If
nextrec:
                LInvdRec.MoveNext
                If LInvdRec.EOF Then Exit Do
            Loop
            If LInvdRec.EOF Then Exit Do
        Loop
        If LInvdRec.EOF Then Exit Do
    Loop
    GETMAIN.ProgressBar1.Visible = False
    GETMAIN.PERLBL.Caption = vbNullString
    Set LInvdRec = Nothing
    Set LInvdRec = New ADODB.Recordset
    mysql = "SELECT B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRA_AC,B.CONTRAID,A.STDATE,A.ACCID,C.AC_CODE ,C.NAME,A.EXCODE,A.EXID,AD.PARTYTYPE,"
    mysql = mysql & " SUM(A.AMOUNT) AS BROKAMT ,SUM(A.SAMOUNT) AS SHAREAMT FROM INV_D1 AS A,ACCFMLY AS B, ACCOUNTM AS C,ACCOUNTD AS AD"
    mysql = mysql & " Where C.COMPCODE =" & GCompCode & " AND A.FMLYID  = B.FMLYID AND A.ACCID = AD.ACCID  AND A.ACCID = C.ACCID "
    mysql = mysql & " AND A.STDATE  >='" & Format(LVFromDate, "yyyy/mm/dd") & "'"
    mysql = mysql & "  AND AD.BCYCLE = 'D' AND A.EXID IN (SELECT EXID FROM EXMAST WHERE COMPCODE =" & GCompCode & " AND CURR='Y') "
    If LenB(LVParties) > 0 Then mysql = mysql & " AND C.AC_CODE  IN (" & LVParties & ") "
    If LenB(LVExIDs) > 0 Then mysql = mysql & " AND A.EXID  IN (" & LVExIDs & ") "
    mysql = mysql & " GROUP BY B.FMLYID,B.FMLYCODE,B.HEADID,B.FMLYHEAD,B.CONTRA_AC,B.CONTRAID,A.STDATE,A.ACCID,C.AC_CODE ,C.NAME,A.EXCODE,A.EXID,AD.PARTYTYPE"
    mysql = mysql & " ORDER BY A.STDATE,B.FMLYCODE,C.AC_CODE  ,A.EXCODE"
    LInvdRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
    Do While Not LInvdRec.EOF
        LBillDate = LInvdRec!STDATE
        GETMAIN.Label1.Caption = "Posting Share Voucher " & LBillDate
        DoEvents
        Do While LBillDate = LInvdRec!STDATE
            LIVouNo = vbNullString:                  LShVouNo = vbNullString
            BVNO = 0:                                SVNO = 0
            LBBrokAmt = LInvdRec!BROKAMT:            LShareAmt = LInvdRec!SHAREAMT
            LFmlyCode = LInvdRec!FMLYCODE:           LHeadAc = LInvdRec!FMLYHEAD
            LContraAc = LInvdRec!Contra_Ac:          LParty = LInvdRec!AC_CODE
            LPartyName = LInvdRec!NAME:              LExCode = LInvdRec!excode:
            LExID = LInvdRec!EXID:                   LFmlyID = LInvdRec!FMLYID:
            LACCID = LInvdRec!ACCID:                 LHeadID = LInvdRec!HEADID
            LContraID = LInvdRec!CONTRAID
            LPartyType = LInvdRec!PARTYTYPE
            
            LBillBy = "S"
            Set TRec = Nothing
            mysql = "SELECT BILLBY FROM ACCT_EX WHERE ACCID = '" & LACCID & "' AND EXID ='" & LExID & "'  "
            TRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
            If Not TRec.EOF Then
                LBillBy = TRec!billby
            End If

    ''''Currency Type = 1
            If gcurrtype = 1 And LExCode = "CMX" Then
    
                mysql = "SELECT CLOSERATE,HGRATE,LOWRATE FROM CTR_R  WHERE COMPCODE =" & GCompCode & " AND SAUDA ='USDINR' AND CONDATE  ='" & Format(LBillDate, "yyyy/mm/dd") & "' "
                Set RateRec = Nothing
                Set RateRec = New ADODB.Recordset
                RateRec.Open mysql, Cnn, adOpenForwardOnly, adLockReadOnly
                If Not RateRec.EOF Then
                    If LBillBy = "S" Then
                        LLowRate = RateRec!CLOSERATE
                        LHGRate = RateRec!CLOSERATE
                    Else
                        LLowRate = RateRec!LOWRATE
                        LHGRate = RateRec!HGRATE
                    End If
                Else
                    LLowRate = 1
                    LHGRate = 1
                End If
                Set RateRec = Nothing
                
                If LPartyType <> 2 Then
                    If LBBrokAmt > 0 Then
                        LBBrokAmt = LBBrokAmt * LLowRate
                    Else
                        LBBrokAmt = LBBrokAmt * LHGRate
                    End If
                
                    If LShareAmt > 0 Then
                        LShareAmt = LShareAmt * LLowRate
                    Else
                        LShareAmt = LShareAmt * LHGRate
                    End If
                Else
                    If LBBrokAmt < 0 Then
                        LBBrokAmt = LBBrokAmt * LLowRate
                    Else
                        LBBrokAmt = LBBrokAmt * LHGRate
                    End If
                
                    If LShareAmt < 0 Then
                        LShareAmt = LShareAmt * LLowRate
                    Else
                        LShareAmt = LShareAmt * LHGRate
                    End If
                End If
                    
            End If
            
            If LBBrokAmt <> 0 Then
                If LBBrokAmt > 0 Then
                    MDR = "C": MCR = "D"
                Else
                    MDR = "D": MCR = "C"
                End If
                LIVouNo = Get_Next_Vou_No(GMaxBVouNo, "BROK", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxBVouNo = GMaxBVouNo + 1
                LShNarration = LExCode & " Sub Brok For " & LPartyName & ""
                BVNO = PInsert_Voucher(LIVouNo, LBillDate, "B", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MDR, LHeadAc, Abs(LBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LHeadID)
                Call PInsert_Vchamt(LIVouNo, "B", LBillDate, MCR, LBrokAcc, Abs(LBBrokAmt), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, BVNO, LExID, 0, LBrokAccID)
            End If
            If LShareAmt <> 0 Then
                If LShareAmt < 0 Then
                    MCR = "D": MDR = "C"
                Else
                    MCR = "C": MDR = "D"
                End If
                LShVouNo = Get_Next_Vou_No(GMaxHVouNo, "SHAR", Right$(GFinBegin, 2) & Right$(GFinEnd, 2))
                GMaxHVouNo = GMaxHVouNo + 1
                LShNarration = LExCode & " Share Amt For Client " & LPartyName & " "
                SVNO = PInsert_Voucher(LShVouNo, LBillDate, "H", "P", 0, "ADD", LParty, 0, LHeadAc, LExCode, "0", LExID, LFmlyID)
                    'PARTY AC POSTING
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MCR, LContraAc, Abs(Val(LShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LContraID)
                Call PInsert_Vchamt(LShVouNo, "H", LBillDate, MDR, LHeadAc, Abs(Val(LShareAmt)), LParty, LBillDate, LShNarration, LParty, LExCode, 0, LExCode, SVNO, LExID, 0, LHeadID)
            End If

            mysql = "EXEC UPD_INVD1_VNO " & LFmlyID & "," & LACCID & ",'" & Format(LBillDate, "YYYY/MM/DD") & "'," & LExID & "," & BVNO & "," & SVNO & ",'" & LIVouNo & "','" & LShVouNo & "'"
            Cnn.Execute mysql
            LInvdRec.MoveNext
            If LInvdRec.EOF Then Exit Do
        Loop
        If LInvdRec.EOF Then Exit Do
    Loop

    Exit Sub
GETMAIN.ProgressBar1.Visible = False
err1:
 MsgBox (err.Description)

End Sub



Public Sub send_whatsup(LTUserId As String, ltfilepath As String, ltfilename)

    Dim WebRequest As Object
    Set WebRequest = CreateObject("MSXML2.ServerXMLHTTP")
    
    Dim bytes() As Byte
    Dim file As String
    Dim response As String
    
    Dim fileNumber As Integer
    fileNumber = FreeFile
    
    Dim filePath As String
    Dim myarr As String
    
    'myarr = Split(ltfilepath, "\")
    filePath = ltfilepath '"C:\Users\LENOVO\Downloads\mpdf.pdf" ' Replace this with the actual file path
    
    Open filePath For Binary Access Read As fileNumber
    ReDim bytes(LOF(fileNumber) - 1)
    Get #fileNumber, , bytes
    Close fileNumber
    
    file = Base64Encode(bytes)
    
    Dim apiUrl As String
   
    'GSrvRegNo = v4usl8767yd1g4p5&to=7724958567
    
    apiUrl = "token=" & GSrvRegNo & "&to=" & Trim(LTUserId) & "&filename=" & ltfilename & " &document=" & URLEncode(file) & "&caption=document caption"
    WebRequest.Open "POST", "https://api.ultramsg.com/" & Trim(GEmail) & "/messages/document", False
    WebRequest.setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
    WebRequest.send apiUrl
    
    response = WebRequest.responseText
    MsgBox (response)
    Debug.Print response
    
    Set WebRequest = Nothing
End Sub

Public Function Base64Encode(data() As Byte) As String
    Dim objXML As Object
    Set objXML = CreateObject("MSXML2.DOMDocument.6.0")
    
    With objXML.createElement("b64")
        .DataType = "bin.base64"
        .nodeTypedValue = data
        Base64Encode = Replace(.text, vbLf, "")
    End With
    
    Set objXML = Nothing
End Function

Public Function URLEncode(str As String) As String
    Dim I As Long
    Dim result As String
    
    For I = 1 To Len(str)
        Dim char As String
        char = Mid$(str, I, 1)
        
        Select Case char
            Case "A" To "Z", "a" To "z", "0" To "9", "-", "_", ".", "~"
                result = result & char
            Case Else
                result = result & "%" & Right$("0" & Hex(AscW(char)), 2)
        End Select
    Next I
    
    URLEncode = result
End Function

